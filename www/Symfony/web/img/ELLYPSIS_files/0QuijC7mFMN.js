/*!CK:1876129265!*//*1457697897,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["frRUc"]); }

__d("ContentSearchEvents",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CONTENT_SEARCH:"content_search",OPEN_TRAY:"open_tray",QUERY_RESULTS_LOADED:"query_results_loaded",RESULT_SENT:"result_sent",namesByValue:{content_search:"CONTENT_SEARCH",open_tray:"OPEN_TRAY",query_results_loaded:"QUERY_RESULTS_LOADED",result_sent:"RESULT_SENT"}};},null);
__d("MessengerPlatformQueryType",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SEARCH:0,MEDIAFY:1,TRENDING:2,SAMPLE:3,namesByValue:["SEARCH","MEDIAFY","TRENDING","SAMPLE"]};},null);
__d('CloseButton.atlas',['cx','PureRenderComponent.atlas','React','XUICloseButton.react','joinClasses'],function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').Component);j=i&&i.prototype;l.propTypes={onClick:k.func,shade:k.oneOf(['light','dark']),size:k.oneOf(['small','medium'])};function l(m,n){j.constructor.call(this,m,n);this.$CloseButton1=this.$CloseButton1.bind(this);}l.prototype.$CloseButton1=function(event){event.preventDefault();if(this.props.onClick)this.props.onClick(event);};l.prototype.render=function(){var m=c('joinClasses')(this.props.className,"_5tdj");return (c('React').createElement('label',{className:m},c('React').createElement(c('XUICloseButton.react'),{onClick:this.$CloseButton1,shade:this.props.shade,size:this.props.size})));};f.exports=c('PureRenderComponent.atlas').create(l);},null);
__d('relativeTimeString.atlas',['fbt'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(j,k){var l=Date.now(),m='',n=null,o=Math.floor((j-l)/1000),p=o<0;o=Math.abs(o);if(o<60){if(k){m=p?h._("just now"):h._("now");}else m=p?h._("Just now"):h._("Now");}else if(o<60*2){m=p?h._("1 minute ago"):h._("1 minute");}else if(o<3600){n=Math.floor(o/60);m=p?h._("{number} minutes ago",[h.param('number',n)]):h._("{number} minutes",[h.param('number',n)]);}else if(o<3600*2){if(k){m=p?h._("about an hour ago"):h._("about an hour");}else m=p?h._("About an hour ago"):h._("About an hour");}else if(o<3600*24){n=Math.floor(o/3600);m=p?h._("{number} hours ago",[h.param('number',n)]):h._("{number} hours",[h.param('number',n)]);}else if(o<3600*24*2){if(k){m=p?h._("about a day ago"):h._("about a day");}else m=p?h._("About a day ago"):h._("About a day");}else if(o<3600*24*30){n=Math.floor(o/3600/24);m=p?h._("{number} days ago",[h.param('number',n)]):h._("{number} days",[h.param('number',n)]);}else if(o<3600*24*30*2){if(k){m=p?h._("about a month ago"):h._("about a month");}else m=p?h._("About a month ago"):h._("About a month");}else if(o<3600*24*30*12){n=Math.floor(o/3600/24/30);m=p?h._("{number} months ago",[h.param('number',n)]):h._("{number} months",[h.param('number',n)]);}else if(o<3600*24*30*24){if(k){m=p?h._("over a year ago"):h._("over a year");}else m=p?h._("Over a year ago"):h._("Over a year");}else{n=Math.floor(o/3600/24/365);m=p?h._("{number} years ago",[h.param('number',n)]):h._("{number} years",[h.param('number',n)]);}return m;}f.exports=i;},null);
__d('FBPaymentsCreditCardExpDateFormField.react',['fbt','ix','Image.react','FBPaymentsFormField.react','FBPaymentsFormFieldUtils','React'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'FBPaymentsCreditCardExpDateFormField',propTypes:{initiallyFocused:j.bool,name:j.string.isRequired,onChange:j.func.isRequired,showIcon:j.bool,showPlaceholder:j.bool},getDefaultProps:function(){return {showIcon:true,showPlaceholder:true};},getLimit:function(){return 5;},formatValue:function(l,m,n){var o=String.fromCharCode(n);l=l.replace(/[^0-9\/]+/g,'');var p=l.split('/'),q=p[0],r=p[1];if(r&&r.length===4)l=q+'/'+r.substr(-2);if(!/^\d+$/.test(o)&&n!==191&&n!==111)return l;l=c('FBPaymentsFormFieldUtils').stripNonDigits(l);if(/^\d$/.test(l)&&l!=='0'&&l!=='1'){l='0'+l+'/';}else if(l.length>=2&&l.indexOf('/')===-1)l=l.substr(0,2)+'/'+l.substr(2,2);return l;},validate:function(l){var m=l.split('/'),n=new Date(),o=parseInt(n.getFullYear().toString().substring(2),10),p=n.getMonth()+1,q=parseInt(m[0],10),r=parseInt(m[1],10);if(l.length!==5||!q||!r||isNaN(q)||isNaN(r)||q<1||q>12)return false;if(r<o||r===o&&q<p)return false;return true;},render:function(){var l,m,n;if(this.props.showLabel)m=h._("Expiration");if(this.props.showPlaceholder)l=h._("MM\/AA");if(this.props.showIcon)n={normal:c('React').createElement(c('Image.react'),{height:12,src:i('/images/p2p/events-grey_s.png'),width:12}),focused:c('React').createElement(c('Image.react'),{height:12,src:i('/images/p2p/events-blue_s.png'),width:12})};return (c('React').createElement(c('FBPaymentsFormField.react'),babelHelpers['extends']({autoCompleteName:'cc-exp',formatValue:this.formatValue,icon:n,label:m,limit:this.getLimit(),placeholder:l,ref:'input',validate:this.validate},this.props)));}});f.exports=k;},null);
__d('FBPaymentsCreditCardNumberFormField.react',['fbt','ix','Image.react','FBPaymentsFormField.react','FBPaymentsFormFieldUtils','PaymentMethodUtils','React'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'FBPaymentsCreditCardNumberFormField',propTypes:{allowCredit:j.bool,disabled:j.bool,shouldValidateBIN:j.bool,initiallyFocused:j.bool,name:j.string.isRequired,onChange:j.func.isRequired,showIcon:j.bool,showPlaceholder:j.bool,showSecondaryIcon:j.bool,value:j.string},getDefaultProps:function(){return {allowCredit:true,showIcon:true,showPlaceholder:true,showSecondaryIcon:false};},getInitialState:function(){return {errorMessage:null};},calculateLimit:function(l){return (c('PaymentMethodUtils').getCardType(l).digits+(this.getGrouping(l).length-2));},getGrouping:function(l){var m=[0,4,8,12,16],n=m;switch(c('PaymentMethodUtils').getCardType(l).name){case 'visa':case 'mc':case 'disc':n=m;break;case 'amex':n=[0,4,10,15];break;case 'diners':n=[0,4,10,14];break;default:n=m;break;}return n;},formatValue:function(l,m,n){return c('FBPaymentsFormFieldUtils').formatCardNumber(l,m,n,this.getGrouping(l),' ');},validate:function(l){var m=this.isValidCardType(l),n;if(!this.props.allowCredit){n=h._("Veuillez saisir une carte de d\u00e9bit. Les cartes de cr\u00e9dit ne sont pas accept\u00e9es.");}else n=h._("Saisissez un num\u00e9ro de carte de cr\u00e9dit ou de d\u00e9bit valable.");this.setState({errorMessage:!m?n:null});return !!(c('PaymentMethodUtils').isValidCCNumber(l)&&m&&!this.props.binError);},isValidCardType:function(l){var m=['mc','visa','unknown'];if(this.props.allowCredit)m.push('diners','disc','jcb','amex');var n=c('PaymentMethodUtils').getCardType(l),o=n?n.name:'',p=m.indexOf(o)>=0;return p;},getSaveError:function(){return this.props.binError||this.props.saveError;},getSecondaryIcon:function(l){var m,n;if(!this.props.showSecondaryIcon)return null;n=c('PaymentMethodUtils').getCardType(l).name;switch(n){case 'visa':m=i('/images/payments/icons/modularization/visa-cc.png');break;case 'mc':m=i('/images/payments/icons/modularization/mastercard-cc.png');break;case 'amex':m=i('/images/payments/icons/modularization/amex-cc.png');break;case 'disc':m=i('/images/payments/icons/modularization/discover-cc.png');break;case 'jcb':m=i('/images/payments/icons/modularization/jcb-cc.png');break;default:m=i('/images/payments/icons/modularization/CC.png');break;}return (c('React').createElement(c('Image.react'),{height:20,src:m,width:30}));},render:function(){var l=h._("Num\u00e9ro de carte"),m,n,o;if(this.props.showLabel){n=l;m='0000 0000 0000 0000';}else if(this.props.showPlaceholder)m=l;if(this.props.showIcon)o={normal:c('React').createElement(c('Image.react'),{height:12,src:i('/images/p2p/card-grey_s.png'),width:12}),focused:c('React').createElement(c('Image.react'),{height:12,src:i('/images/p2p/card-blue_s.png'),width:12})};return (c('React').createElement(c('FBPaymentsFormField.react'),babelHelpers['extends']({autoCompleteName:'cc-number',cursorPositionUpdater:c('FBPaymentsFormFieldUtils').getUpdatedCursorPosition,errorMessage:this.state.errorMessage,formatValue:this.formatValue,getSecondaryIcon:this.getSecondaryIcon,icon:o,label:n,limit:this.calculateLimit,placeholder:m,ref:'input',validate:this.validate,value:this.props.value},this.props,{saveError:this.getSaveError()})));}});f.exports=k;},null);
__d('FBPaymentsForm.react',['cx','FBPaymentsErrorNotice.react','React','getObjectValues'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'FBPaymentsForm',propTypes:{errorTitle:i.string,onValidation:i.func.isRequired,prefilledFormData:i.object,saveErrors:i.object,showIcons:i.bool,showLabels:i.bool,showPlaceholderOnFocus:i.bool,showSecondaryIcons:i.bool,useGutters:i.bool},getDefaultProps:function(){return {prefilledFormData:{},saveErrors:null,showIcons:true,showLabels:false,showPlaceholderOnFocus:false,showSecondaryIcons:false,useGutters:false};},getInitialState:function(){var k=this.props.prefilledFormData,l=this.props.children,m={};c('React').Children.forEach(l,function(n,o){m[n.props.name]={valid:!n.props.required,value:k?k[n.props.name]:''};});return {fields:m,isValid:false};},_fieldKeyOrder:[],handleFormValueChange:function(k,l,m,n){var o=this.state.fields;o[k]={valid:m,value:l};this.validateForm();if(this.props.autoTab===true&&n&&m){var p=this._fieldKeyOrder.indexOf(k);if(p!==-1){var q=this._fieldKeyOrder[p+1];if(q){var r=this.refs[q];r&&r.refs.input.focusInput();}}}},validateForm:function(){var k=true,l=this.state.fields;k=!c('getObjectValues')(l).some(function(m){return !m.valid;});this.setState({isValid:k});this.props.onValidation(k,this.serializeFormFields());},serializeFormFields:function(){var k=this.state.fields,l={};for(var m in k)if(k.hasOwnProperty(m))l[m]=k[m].value;return l;},getSaveError:function(k){var l='',m=this.props.saveErrors;if(m&&m.fields&&m.fields[k]){l=m.fields[k].message;if(l.__html)l=l.__html;}return l;},renderGeneralError:function(){var k=this.getGeneralError();if(k)return (c('React').createElement(c('FBPaymentsErrorNotice.react'),{error:k}));},getGeneralError:function(){if(this.props.saveErrors&&this.props.saveErrors.general)return this.props.saveErrors.general;return null;},renderFormFields:function(){var k=[],l=[],m=[],n=0,o=this.props.children,p=c('React').Children.count(o),q=[];c('React').Children.forEach(o,function(r,s){var t=s===p-1;if(!r)return null;var u=parseInt(r.props.width||'100',10),v=r.props.name;r=c('React').cloneElement(r,{key:v,onChange:this.handleFormValueChange,saveError:this.getSaveError(v),showIcon:this.props.showIcons,showLabel:this.props.showLabels,showPlaceholderOnFocus:this.props.showPlaceholderOnFocus,showSecondaryIcon:this.props.showSecondaryIcons,useGutter:this.props.useGutters,value:this.state.fields[v].value,ref:v});q.push(v);if(!r.props.ignoreStyling){if(Math.round(n)<100)k.push(r);n+=u;if(Math.round(n)===100||t){l.push(c('React').createElement('div',{className:(this.props.useGutters?"_284-":'')+(' '+"_284_")+(k.length>1?' '+"_2850":'')+(l.length===0?' '+"_2851":'')+(t?' '+"_2852":''),key:l.length},k));k=[];n=0;}}else m.push(r);}.bind(this));this._fieldKeyOrder=q;return m.concat(l);},render:function(){return (c('React').createElement('form',{className:"_2853"},this.renderGeneralError(),this.renderFormFields()));}});f.exports=j;},null);
__d('FBPaymentsCreditCardForm.react',['fbt','CreditCardFormParam','KappaWrapper','FBPaymentsCreditCardCVCFormField.react','FBPaymentsCreditCardExpDateFormField.react','FBPaymentsCreditCardNumberFormField.react','FBPaymentsCreditCardZipCodeFormField.react','FBPaymentsForm.react','React','emptyFunction'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'FBPaymentsCreditCardForm',propTypes:{allowCredit:i.bool,autoTab:i.bool,binError:i.string,compactMode:i.bool,cscMaxLength:i.number,editMode:i.bool,onValidation:i.func,prefilledFormData:i.object,saveErrors:i.object,showIcons:i.bool,showLabels:i.bool,showPlaceholderOnFocus:i.bool,showSecondaryIcons:i.bool,useGutters:i.bool},getDefaultProps:function(){return {autoTab:false,allowCredit:true,binError:'',compactMode:false,cscMaxLength:null,editMode:false,onValidation:c('emptyFunction'),prefilledFormData:{},saveErrors:null,showIcons:true,showSecondaryIcons:false,showLabels:false,showPlaceholderOnFocus:false,useGutters:false};},getInitialState:function(){return {formData:{},isValid:false};},componentWillMount:function(){c('KappaWrapper').start(6,3,0);},handleValidation:function(k,l){this.setState({formData:l,isValid:k});this.props.onValidation(k,l);},isCreditCardNumberMasked:function(){return this.props.editMode;},isCreditCardNumberFocused:function(){return !this.props.editMode;},isExpFocused:function(){return this.props.editMode;},getSaveErrors:function(){if(this.props.binError)return {general:{message:this.props.binError}};return this.props.saveErrors;},render:function(){var k=this.props.compactMode;return (c('React').createElement(c('FBPaymentsForm.react'),{autoTab:this.props.autoTab,errorTitle:h._("Probl\u00e8me d\u2019enregistrement de la carte"),prefilledFormData:this.props.prefilledFormData,onValidation:this.handleValidation,saveErrors:this.getSaveErrors(),showIcons:this.props.showIcons,showLabels:this.props.showLabels,showPlaceholderOnFocus:this.props.showPlaceholderOnFocus,showSecondaryIcons:this.props.showSecondaryIcons,useGutters:this.props.useGutters},c('React').createElement(c('FBPaymentsCreditCardNumberFormField.react'),{allowCredit:this.props.allowCredit,binError:this.props.binError,disabled:this.isCreditCardNumberMasked(),initiallyFocused:this.isCreditCardNumberFocused(),name:c('CreditCardFormParam').CARD_NUMBER,required:true,width:k?75:100}),c('React').createElement(c('FBPaymentsCreditCardExpDateFormField.react'),{initiallyFocused:this.isExpFocused(),name:c('CreditCardFormParam').CARD_EXPIRATION,required:true,width:k?25:50}),c('React').createElement(c('FBPaymentsCreditCardCVCFormField.react'),{creditCardNumber:this.state.formData[c('CreditCardFormParam').CARD_NUMBER],cscMaxLength:this.props.cscMaxLength,name:c('CreditCardFormParam').CSC,required:true,width:k?25:50}),c('React').createElement(c('FBPaymentsCreditCardZipCodeFormField.react'),{name:c('CreditCardFormParam').ZIP,required:true,width:k?30:100})));}});f.exports=j;},null);
__d("XMessengerPlatformContentSearchController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/messaging\/content_search\/",{q:{type:"String",defaultValue:""},qtype:{type:"Enum",defaultValue:0,enumType:0},resume:{type:"String",defaultValue:""}});},null);
__d('ChatContentSearch',['AsyncRequest','MessengerPlatformQueryType','XMessengerPlatformContentSearchController'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={getContentForQuery:function(i){var j=i.query,k=i.callback,l=i.resume,m=c('XMessengerPlatformContentSearchController').getURIBuilder().setString('q',j).setString('resume',l).getURI(),n=new (c('AsyncRequest'))().setURI(m).setHandler(k);n.send();return n;},getTrending:function(i,j){var k=c('XMessengerPlatformContentSearchController').getURIBuilder().setEnum('qtype',c('MessengerPlatformQueryType').TRENDING).setString('resume',j).getURI(),l=new (c('AsyncRequest'))().setURI(k).setHandler(i);l.send();return l;}};f.exports=h;},null);
__d('ChatContentSearchContextualDialog.react',['cx','ContextualLayerAutoFlipHorizontal','LayerHideOnEscape','ReactAbstractContextualDialog','ReactLayer'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('ReactLayer').createClass(c('ReactAbstractContextualDialog').createSpec({addedBehaviors:[c('ContextualLayerAutoFlipHorizontal'),c('LayerHideOnEscape')],displayName:'StickerXUIContextualDialog',theme:{wrapperClassName:"_53ii",arrowDimensions:{offset:47,length:16}}}));f.exports=i;},null);
__d('ChatContentSearchResult.react',['cx','Image.react','ReactComponentWithPureRenderMixin','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=274,k=137,l=c('React').createClass({displayName:'ChatContentSearchResult',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{isWide:i.bool.isRequired,onClick:i.func.isRequired,result:i.object.isRequired,src:i.string.isRequired},statics:{isWide:function(m){var n=m.media.preview;return n.width>n.height*1.2;},getScaledDimensions:function(m,n){var o=m.media.preview,p=o.height,q=o.width,r=(n?j:k)/q;p*=r;q*=r;return {height:p,width:q};}},render:function(){var m=l.getScaledDimensions(this.props.result,this.props.isWide);return (c('React').createElement(c('Image.react'),{className:"_358"+(this.props.isWide?' '+"_26n6":''),onClick:this._handleClick,src:this.props.src,style:m}));},_handleClick:function(m){m.stopPropagation();this.props.onClick(this.props.result);}});f.exports=l;},null);
__d('ChatContentSearchResults.react',['ChatContentSearch','ChatContentSearchResult.react','MercuryConfig','MessengerSpinner.react','ReactComponentWithPureRenderMixin','React','ScrollableArea.react','debounce','emptyFunction'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i={},j=c('React').createClass({displayName:'ChatContentSearchResults',_inflightRequest:undefined,_requestResults:c('emptyFunction'),_reset:c('emptyFunction'),_inflightTimeStart:undefined,mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{onResultsLoaded:h.func,onSelect:h.func.isRequired,query:h.string.isRequired},getInitialState:function(){return {isLoading:false,response:null,results:[]};},componentDidMount:function(){this._reset=c('debounce')(this._resetImpl,100);this._requestResults=c('debounce')(this._requestResultsImpl,200);this._requestResults();},componentWillUnmount:function(){this._cancelInflightRequest();},componentWillReceiveProps:function(k){if(k.query!==this.props.query)this._reset(this._requestResults);},render:function(){return (c('React').createElement(c('ScrollableArea.react'),{fade:true,onScroll:this._handleScroll,ref:'scrollable'},this._renderResults(),this._renderLoadingIndicator()));},_renderLoadingIndicator:function(){if(!this.state.isLoading)return null;return (c('React').createElement('div',{style:{marginTop:this.state.response?'10px':'140px',textAlign:'center'}},c('React').createElement(c('MessengerSpinner.react'),{color:'grey',size:c('MessengerSpinner.react').Sizes.SMALL})));},_requestResultsImpl:function(){this._cancelInflightRequest();this._inflightTimeStart=Date.now();if(this.state.response&&(!this.state.response.resultNextCursor||!this.props.query))return;var k;this.setState({isLoading:true});if(this.props.query){k=c('ChatContentSearch').getContentForQuery({query:this.props.query,resume:this.state.response?this.state.response.resultNextCursor:undefined,callback:this._handleAsyncResponse});}else k=c('ChatContentSearch').getTrending(this._handleAsyncResponse,this.state.response?this.state.response.resultNextCursor:undefined);this._inflightRequest=k;},_handleAsyncResponse:function(k){if(this._inflightRequest===k.request){i=babelHelpers['extends']({},i,k.payload.attribution);this.setState({isLoading:false,response:k.payload,results:k.payload.resultGroup[0]?this.state.results.concat(k.payload.resultGroup[0].results):this.state.results},function(){if(this._inflightTimeStart){if(this.props.onResultsLoaded)this.props.onResultsLoaded(Date.now()-this._inflightTimeStart);delete this._inflightTimeStart;}}.bind(this));delete this._inflightRequest;}},_cancelInflightRequest:function(){this.setState({isLoading:false});if(this._inflightRequest){this._inflightRequest.abort();delete this._inflightRequest;delete this._inflightTimeStart;}},_renderResults:function(){if(!this.state.response||!this.state.results.length)return null;return this.state.results.map(function(k,l){var m=c('ChatContentSearchResult.react').isWide(k);if(!m&&k.platformFBID.toString()!==c('MercuryConfig').MessengerAppID){var n=l-this._getPrevWideIndex(l),o=this._getNextWideIndex(l)-l;m=(n<=1||n%2!==0)&&o<=1;}return (c('React').createElement(c('ChatContentSearchResult.react'),{isWide:m,key:'result:'+l+':'+k.resultID,onClick:this._handleResultClick,result:k,src:k.media.preview.url}));}.bind(this));},_getPrevWideIndex:function(k){while(k>0){--k;if(c('ChatContentSearchResult.react').isWide(this.state.results[k]))return k;}return k;},_getNextWideIndex:function(k){var l=this.state.results.length;while(k<l-1){++k;if(c('ChatContentSearchResult.react').isWide(this.state.results[k]))return k;}return k;},_handleResultClick:function(k){this.props.onSelect(k,i[k.platformFBID]);},_handleScroll:function(){if(this._isScrolledNearBottom()&&!this._inflightRequest)this._requestResults();},_isScrolledNearBottom:function(){var k=this.refs.scrollable.getArea();return !!(k&&k.distanceToBottom()<=50);},_resetImpl:function(k){this.setState(this.getInitialState(),k);}});f.exports=j;},null);
__d('ChatContentSearchTrendingIndicator.react',['cx','fbt','ix','Image.react','React'],function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();k=babelHelpers.inherits(m,c('React').Component);l=k&&k.prototype;function m(n){l.constructor.call(this,n);}m.prototype.shouldComponentUpdate=function(n){return n.shown!==this.props.shown;};m.prototype.render=function(){return this.props.shown?c('React').createElement('div',{className:"_515"},c('React').createElement(c('Image.react'),{src:j('/images/chat/composer/composerSearchTrending.png')}),i._("Populaire")):null;};f.exports=m;},null);
__d('MessengerSearchInput.react',['cx','AbstractTextInput.react','ReactComponentWithPureRenderMixin','React','XUICloseButton.react','joinClasses'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MessengerSearchInput',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{isFocused:i.bool,onBlur:i.func,onChange:i.func,onClear:i.func,onEnter:i.func,onFocus:i.func,placeholder:i.string,value:i.string.isRequired},render:function(){return (c('React').createElement('div',{className:c('joinClasses')(this.props.className,"_5iwm"+(this.props.isFocused||!!this.props.value?' '+"_5iwn":'')),role:'search'},c('React').createElement(c('AbstractTextInput.react'),{className:"_3deo",onBlur:this.props.onBlur,onChange:this.props.onChange,onEnter:this.props.onEnter,onFocus:this.props.onFocus,placeholder:this.props.placeholder,ref:'inputField',value:this.props.value}),c('React').createElement(c('XUICloseButton.react'),{size:'small',onMouseDown:this.props.onClear,className:(this.props.value.length===0?"hidden_elem":'')+(' '+"_2xme")})));},focusInput:function(){this.refs.inputField.focusInput();}});f.exports=j;},null);
__d('ChatContentSearchFlyout.react',['cx','fbt','ChatContentSearchResults.react','ChatContentSearchTrendingIndicator.react','Keys','MessengerSearchInput.react','ReactComponentWithPureRenderMixin','React','MercuryShareAttachmentRenderLocations','XUITextInput.react'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=' ',l=/\s+/g,m=c('React').createClass({displayName:'ChatContentSearchFlyout',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{location:j.oneOf(c('MercuryShareAttachmentRenderLocations').getValues()),onEscKeyDown:j.func,onResultsLoaded:j.func,onSelect:j.func.isRequired,query:j.string},getInitialState:function(){return {query:this.props.query,viewerEnteredText:false};},componentWillReceiveProps:function(n){if(!this.state.viewerEnteredText)this.setState({query:n.query});},render:function(){var n=this._normalize(this.state.query);return (c('React').createElement('div',{className:"_1er4",onKeyDown:this._handleKeyDown},c('React').createElement('div',{className:"_3mtr"},this._renderTextInput()),c('React').createElement('div',{className:"_3mts"},c('React').createElement(c('ChatContentSearchResults.react'),{onResultsLoaded:this.props.onResultsLoaded,onSelect:this.props.onSelect,query:n}),c('React').createElement(c('ChatContentSearchTrendingIndicator.react'),{shown:n.length===0}))));},_renderTextInput:function(){var n=this.props.location===c('MercuryShareAttachmentRenderLocations').MESSENGER?c('MessengerSearchInput.react'):c('XUITextInput.react');return (c('React').createElement(n,{className:"_4qcs",isFocused:true,onChange:this._handleInputChange,onClear:function(){this.setState({query:'',viewerEnteredText:false});}.bind(this),placeholder:i._("Rechercher des GIF et des autocollants dans les apps..."),ref:'input',value:this.state.query||''}));},_handleInputChange:function(n){this.setState({query:n.target.value,viewerEnteredText:n.target.value.length>0});},_normalize:function(n){return (n||'').trim().replace(l,k).toLowerCase();},_handleKeyDown:function(n){if(n.keyCode===c('Keys').ESC&&this.props.onEscKeyDown)this.props.onEscKeyDown();}});f.exports=m;},null);
__d('ChatContentSearchButton.react',['cx','fbt','BanzaiLogger','ChatContentSearchFlyout.react','ContentSearchEvents','ChatContentSearchContextualDialog.react','Link.react','ReactComponentWithPureRenderMixin','React','ReactLayeredComponentMixin','MercuryShareAttachmentRenderLocations','joinClasses'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'ChatContentSearchButton',_clickGuard:false,mixins:[c('ReactComponentWithPureRenderMixin'),c('ReactLayeredComponentMixin')],propTypes:{ContextualDialogClass:j.func,flyoutAlignment:j.oneOf(['left','right']),getQuery:j.func.isRequired,location:j.oneOf(c('MercuryShareAttachmentRenderLocations').getValues()),onLoad:j.func,onSelect:j.func.isRequired},getDefaultProps:function(){return {flyoutAlignment:'left',location:c('MercuryShareAttachmentRenderLocations').CHAT};},getInitialState:function(){return {query:'',shown:false};},componentDidMount:function(){this.props.onLoad&&this.props.onLoad(this);},updateQuery:function(){this.setState({query:this.props.getQuery()});},hideFlyout:function(){this.setState(this.getInitialState());},render:function(){return (c('React').createElement(c('Link.react'),{className:c('joinClasses')(this.props.className,this.state.shown?"open":''),href:'#',onMouseDown:this._handleMouseDown,onClick:this._handleClick,role:'button',title:i._("Choisissez un gif ou un autocollant"),ref:'link'}));},renderLayers:function(){if(!this.state.shown)return {contextualDialog:null};var l=this.props.ContextualDialogClass||c('ChatContentSearchContextualDialog.react');return {contextualDialog:c('React').createElement(l,{alignment:this.props.flyoutAlignment,contextRef:function(){return this.refs.link;}.bind(this),onBlur:this.hideFlyout,onToggle:this._handleContextualDialogToggle,shown:this.state.shown,width:278},c('React').createElement(c('ChatContentSearchFlyout.react'),{location:this.props.location,onEscKeyDown:this.hideFlyout,onResultsLoaded:this._handleResultsLoaded,onSelect:this._handleSelect,query:this.state.query}))};},_handleMouseDown:function(l){this._clickGuard=this.state.shown;},_handleClick:function(l){l.stopPropagation();if(this.state.shown||this._clickGuard)return;this.setState({query:this.props.getQuery(),shown:!this.state.shown});c('BanzaiLogger').log('ContentSearchLoggerConfig',{event:c('ContentSearchEvents').OPEN_TRAY,query:this.state.query});},_handleSelect:function(l,m){this.props.onSelect(l,m);this.setState(this.getInitialState());c('BanzaiLogger').log('ContentSearchLoggerConfig',{event:c('ContentSearchEvents').RESULT_SENT,query:this.state.query,resultid:l.resultID});},_handleContextualDialogToggle:function(l){this.setState({shown:l});},_handleResultsLoaded:function(l){c('BanzaiLogger').log('ContentSearchLoggerConfig',{event:c('ContentSearchEvents').QUERY_RESULTS_LOADED,query:this.state.query,inflighttime:l});}});f.exports=k;},null);
__d('MessengerSignals',['EventEmitter'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=new (c('EventEmitter'))(),i='resize',j={resize:function(){h.emit(i);},onResize:function(k){return h.addListener(i,k);}};f.exports=j;},null);
__d('MessengerAttachmentImageBlock.react',['cx','React','joinClasses'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MessengerAttachmentImageBlock',propTypes:{attachment:i.object.isRequired},render:function(){return (c('React').createElement('div',{className:c('joinClasses')(this.props.className,this._computeClass())},this._renderImage(),c('React').createElement('div',{className:"_5swm"},this.props.children)));},_renderImage:function(){if(!this.props.attachment.media||!this.props.attachment.media.image)return null;var l=this._getDimensions(),m=l.height,n=l.width,o=m>n,p=k(m,n),q=m&&n?m/n*100:100,r=o||p?.2:1,s=o||p?q:52,t={backgroundImage:'url('+this.props.attachment.media.image+')',minHeight:'0px',paddingBottom:o&&q>150?'136px':s*r+'%'};if(this.props.attachment.description&&this.props.attachment.source)t.minHeight='112px';return (c('React').createElement('div',{className:"_3xn1",style:t}));},_computeClass:function(){if(!this.props.attachment.media||!this.props.attachment.media.image)return "_3xn3 _5swn";var l=this._getDimensions(),m=l.height,n=l.width,o=m>n,p=k(m,n);return "_3xn3"+(p&&!o?' '+"_3xn5":'')+(o?' '+"_3xn6":'')+(n>=m&&!p?' '+"_3xn7":'');},_getDimensions:function(){var l=this.props.attachment.properties||this.props.attachment.media.image_size||{},m=l.height,n=l.width;if(m&&n){m=parseInt(m,10);n=parseInt(n,10);return {height:m,width:n};}return {height:0,width:0};}});function k(l,m){return l<=300&&m<=300;}f.exports=j;},null);
__d('MessengerFlexArea.react',['Event','MessengerSignals','React','ReactDOM','ResponsiveBlock.react','Style','SubscriptionsHandler','Vector','getScrollPosition','throttle'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'MessengerFlexArea',propTypes:{beforeResize:h.func,onResize:h.func},_subscriptions:null,_onResizeTimeout:null,getInitialState:function(){return {height:0};},componentDidMount:function(){var j=new (c('SubscriptionsHandler'))();j.addSubscriptions(c('Event').listen(window,'resize',c('throttle')(this.recalculateHeight,51)),c('MessengerSignals').onResize(function(){this.recalculateHeight();}.bind(this)));this._subscriptions=j;this.recalculateHeight();},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();clearTimeout(this._onResizeTimeout);},render:function(){return (c('React').createElement(c('ResponsiveBlock.react'),{className:this.props.className,onResize:this._handleResponsiveBlockResize,style:{height:this.state.height+'px'}},this.props.children));},recalculateHeight:function(){if(!this.isMounted())return;var j=c('ReactDOM').findDOMNode(this),k=j.parentNode,l=this.state.height,m=c('Vector').getViewportDimensions().y,n=false;if(k&&c('Style').get(k,'display')==='none'){c('Style').set(k,'display','initial');n=true;}m-=c('Vector').getElementPosition(k||j).y;var o=c('getScrollPosition')(window);m+=o.y;if(k){Array.from(k.childNodes).forEach(function(p){if(p.nodeType===Node.COMMENT_NODE||c('Style').get(p,'position')==='absolute')return;m-=c('Vector').getElementDimensions(p).y;});m+=c('Vector').getElementDimensions(j).y;}if(n)c('Style').set(k,'display','');if(isNaN(m)||m<0)m=0;if(m!==l){this.props.beforeResize&&this.props.beforeResize();this.setState({height:m},this.props.onResize);}},_handleResponsiveBlockResize:c('throttle')(function(j,k){if(!this.isMounted())return;if(k===this.state.height){this.props.beforeResize&&this.props.beforeResize();clearTimeout(this._onResizeTimeout);if(this.props.onResize)this._onResizeTimeout=setTimeout(this.props.onResize,0);}},51)});f.exports=i;},null);
__d('MessengerScrollableArea.react',['cx','React','ReactDOM','ScrollableArea.react','Style','UserAgent','clearImmediate','joinClasses','setImmediate','throttle'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=20,k=c('React').createClass({displayName:'MessengerScrollableArea',propTypes:{onScroll:i.func,width:i.number},_resizeCallback:null,componentDidMount:function(){this._resizeCallback=c('setImmediate')(this._resize);},componentWillUnmount:function(){c('clearImmediate')(this._resizeCallback);},render:function(){return (c('React').createElement(c('ScrollableArea.react'),{className:c('joinClasses')("_5f0v",this.props.className),onScroll:this._handleScroll,ref:'scrollable',shadow:false,style:this.props.style,tabIndex:this.props.tabIndex,width:this.props.width},this.props.children));},_handleScroll:c('throttle')(function(){var l;this.props.onScroll&&(l=this.props).onScroll.apply(l,arguments);},50),_resize:function(){if(!c('UserAgent').isBrowser('IE'))return;var l=this.refs.scrollable.refs.wrap,m=this.refs.scrollable.refs.body;if(!m||!l)return;m=c('ReactDOM').findDOMNode(m);l=c('ReactDOM').findDOMNode(l);var n=l.offsetWidth-l.clientWidth;if(n>0)c('Style').set(m,'margin-right',-n+'px');},getArea:function(){return this.refs.scrollable.getArea();},scrollToBottom:function(){var l=this.getArea();if(l)this.scrollToPosition(l.getScrollHeight());},scrollToTop:function(l){var m=this.getArea();if(m)m.scrollToTop(!!l);},scrollToPosition:function(l){var m=this.getArea();if(!m)return;m.setScrollTop(l,false);},isScrolledToBottom:function(){return this.isScrolledToBottomWithHeight(0);},isScrolledToBottomWithHeight:function(l){var m=this.getArea();if(!m)return false;return m.getScrollTop()+m.getClientHeight()+l>=m.getScrollHeight()-j;},isScrolledToTop:function(){var l=this.getArea();if(!l)return true;return l.getScrollTop()<=j;},getScrollTop:function(){var l=this.getArea();if(!l)return 0;return l.getScrollTop();}});f.exports=k;},null);
__d('MessengerFlexScrollableArea.react',['MessengerFlexArea.react','MessengerScrollableArea.react','React'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'MessengerFlexScrollableArea',propTypes:{flexChildren:h.node,onScroll:h.func,shouldStickToBottom:h.bool},render:function(){return (c('React').createElement(c('MessengerFlexArea.react'),{beforeResize:this._prepareForResize,className:this.props.className,onResize:this._handleResize,ref:'flexArea'},this.props.flexChildren,c('React').createElement(c('MessengerScrollableArea.react'),{height:'100%',onScroll:this.props.onScroll,ref:'scrollable',tabIndex:this.props.tabIndex},this.props.children)));},getArea:function(){return this.refs.scrollable.getArea();},_prepareForResize:function(){this._wasScrolledToBottom=this.refs.scrollable.isScrolledToBottom();},_handleResize:function(){if(this._wasScrolledToBottom&&this.props.shouldStickToBottom)this.refs.scrollable.scrollToBottom();},handleResize:function(){this.refs.flexArea&&this.refs.flexArea.recalculateHeight();},scrollToBottom:function(){this.refs.scrollable.scrollToBottom();},scrollToTop:function(j){this.refs.scrollable.scrollToTop(j);},scrollToPosition:function(j){this.refs.scrollable.scrollToPosition(j);},isScrolledToBottom:function(){return this.refs.scrollable.isScrolledToBottom();},isScrolledToBottomWithHeight:function(j){return this.refs.scrollable.isScrolledToBottomWithHeight(j);},isScrolledToTop:function(){return this.refs.scrollable.isScrolledToTop();},getScrollTop:function(){return this.refs.scrollable.getScrollTop();}});f.exports=i;},null);
__d('MNCommerceBubbleImage.react',['cx','React','joinClasses'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MNCommerceBubbleImage',propTypes:{location:i.string,source:i.string.isRequired,width:i.number},render:function(){return (c('React').createElement('div',{className:c('joinClasses')("_4y9n",this.props.className),style:{backgroundImage:'url(\''+this.props.source+'\')'}}));}});f.exports=j;},null);
__d('MNCommerceAgentItemSuggestionMercuryAttachment.react',['ix','cx','fbt','Image.react','LeftRight.react','Link.react','LineClamp.react','MercuryShareAttachmentRenderLocations','MNCommerceAgenItemSuggestionReactShape','MNCommerceBubbleImage.react','React','ReactComponentWithPureRenderMixin'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=3,m=c('React').createClass({displayName:'MNCommerceAgentItemSuggestionMercuryAttachment',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{isPurchased:k.bool,itemSuggestion:c('MNCommerceAgenItemSuggestionReactShape').isRequired,location:k.oneOf(c('MercuryShareAttachmentRenderLocations').getValues()),onBuyClick:k.func,width:k.number},render:function(){var n=this.props.itemSuggestion,o=n.thumb_url?c('React').createElement('div',{className:"_522n"},c('React').createElement(c('MNCommerceBubbleImage.react'),{location:this.props.location,source:n.thumb_url,width:this.props.width})):null,p=null;if(n.desc)p=c('React').createElement(c('LineClamp.react'),{lines:l},n.desc);var q={};if(this.props.location===c('MercuryShareAttachmentRenderLocations').CHAT&&this.props.width)q.width=this.props.width;var r=c('React').createElement('div',{className:(!n.target_url?"_522-":'')+(this.props.location===c('MercuryShareAttachmentRenderLocations').WEB_INBOX?' '+"_1hf9":''),style:q},o,c('React').createElement('div',{className:"_522o"},c('React').createElement('div',{className:"_522p"},n.name),p,c('React').createElement('div',{className:"_522q"},n.merchant_name)),this._renderFooter());if(n.target_url)return (c('React').createElement(c('Link.react'),{className:"_522-",target:'_blank',href:{url:n.target_url,shimhash:n.shimhash}},r));return r;},_renderFooter:function(){var n=this.props.itemSuggestion.total_cost;if(!n||n.amount<=0)return null;var o;if(!this.props.isPurchased){o=c('React').createElement('div',{className:"_522s",onClick:this._onBuyClick},j._("Obtenir"));}else o=c('React').createElement('div',{className:"_1x98"},c('React').createElement(c('Image.react'),{className:"_1x99",src:h('/images/messaging/commerce/paid_check.png')}),j._("Pay\u00e9"));return (c('React').createElement(c('LeftRight.react'),{className:"_522r"},j._("Total\u00a0: {total cost}",[j.param('total cost',this.props.itemSuggestion.display_total_cost)]),o));},_onBuyClick:function(n){n.preventDefault();this.props.onBuyClick&&this.props.onBuyClick();}});f.exports=m;},null);
__d('MercuryFallbackShareAttachmentTextBlock.react',['cx','LineClamp.react','MercuryShareAttachmentRenderLocations','MercuryShareAttachmentReactShape','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MercuryFallbackShareAttachmentTextBlock',propTypes:{attachment:c('MercuryShareAttachmentReactShape'),location:i.oneOf(c('MercuryShareAttachmentRenderLocations').getValues())},render:function(){if(!this.props||!this.props.attachment)return c('React').createElement('div',{className:"__6j"});var k,l,m;if(c('MercuryShareAttachmentRenderLocations').MESSENGER===this.props.location){if(this.props.attachment.description)l=c('React').createElement('div',{className:"__6l"},c('React').createElement(c('LineClamp.react'),{customEllipsis:" ",lines:2,lineHeight:16},this.props.attachment.description));if(this.props.attachment.title)k=c('React').createElement('div',{className:"__6k"},c('React').createElement(c('LineClamp.react'),{customEllipsis:" ",lines:2,lineHeight:18},this.props.attachment.title));if(this.props.attachment.source)m=c('React').createElement('div',{className:"__6m"},this.props.attachment.source);return (c('React').createElement('div',{className:"__6j"},k,l,m));}if(this.props.attachment.title)k=c('React').createElement('div',{className:"__6k"},this.props.attachment.title);if(this.props.attachment.description)l=c('React').createElement('div',{className:"__6l"},this.props.attachment.description);if(this.props.attachment.source)m=c('React').createElement('div',{className:"__6m"},this.props.attachment.source);return (c('React').createElement('div',{className:"__6j"},k,l,m));}});f.exports=j;},null);
__d('MercuryShareImage.react',['cx','ChatImageArrowDirection','ChatImageWithArrow.react','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MercuryShareImage',propTypes:{height:i.number.isRequired,round:i.bool,source:i.string.isRequired,width:i.number.isRequired},render:function(){return (c('React').createElement('div',{className:"_4hsl"},c('React').createElement(c('ChatImageWithArrow.react'),{arrowDirection:c('ChatImageArrowDirection').BOTH,height:this.props.height,round:!!this.props.round,source:this.props.source,width:this.props.width})));}});f.exports=j;},null);
__d('MercuryFallbackShareAttachmentContent.react',['cx','Image.react','ImageBlock.react','MercuryFallbackShareAttachmentTextBlock.react','MercuryShareAttachmentRenderLocations','MercuryShareAttachmentReactShape','MercuryShareImage.react','MessengerAttachmentImageBlock.react','React','URI','joinClasses'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=72,k=c('React').createClass({displayName:'MercuryFallbackShareAttachmentContent',propTypes:{attachment:c('MercuryShareAttachmentReactShape'),location:i.oneOf(c('MercuryShareAttachmentRenderLocations').getValues())},render:function(){var l=this.props.attachment,m=this.props.location,n=(c('MercuryShareAttachmentRenderLocations').CHAT===m?"_49or":'')+(c('MercuryShareAttachmentRenderLocations').WEB_INBOX===m?' '+"__nm":'')+(c('MercuryShareAttachmentRenderLocations').CHAT_PREVIEW===m?' '+"_324d":'')+(c('MercuryShareAttachmentRenderLocations').CHAT!==m?' '+"_tih":'')+(!(l&&l.media.image)?' '+"_49ou":'');if(l.media&&l.media.image){if(c('MercuryShareAttachmentRenderLocations').CHAT===m||c('MercuryShareAttachmentRenderLocations').CHAT_PREVIEW===m){return (c('React').createElement(c('ImageBlock.react'),{className:n,spacing:'medium'},c('React').createElement(c('MercuryShareImage.react'),{height:j,source:l.media.image,width:j}),c('React').createElement('div',{style:{display:'flex',justifyContent:'center',flexDirection:'column',height:j}},c('React').createElement(c('MercuryFallbackShareAttachmentTextBlock.react'),this.props))));}else if(c('MercuryShareAttachmentRenderLocations').MESSENGER===m)return (c('React').createElement(c('MessengerAttachmentImageBlock.react'),{className:n,attachment:l},c('React').createElement(c('MercuryFallbackShareAttachmentTextBlock.react'),this.props),this.props.children));return (c('React').createElement(c('ImageBlock.react'),{className:c('joinClasses')(this.props.className,n)},c('React').createElement(c('Image.react'),{className:"__6n",src:l.media.image,width:j}),c('React').createElement(c('MercuryFallbackShareAttachmentTextBlock.react'),this.props),this.props.children));}return (c('React').createElement('div',{className:c('joinClasses')(this.props.className,n)},c('React').createElement(c('MercuryFallbackShareAttachmentTextBlock.react'),this.props),this.props.children));}});f.exports=k;},null);
__d('MercuryFallbackShareAttachment.react',['cx','Link.react','MercuryFallbackShareAttachmentContent.react','MercuryShareAttachmentRenderLocations','MercuryShareAttachmentReactShape','MessengerAdsWebTypedLogger','MNAdsLoggerEventEnum','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'MercuryFallbackShareAttachment',propTypes:{attachment:c('MercuryShareAttachmentReactShape'),isSponsored:i.bool,location:i.oneOf(c('MercuryShareAttachmentRenderLocations').getValues()),messageID:i.string,pageID:i.string},renderLink:function(k){if(c('MercuryShareAttachmentRenderLocations').isPreview(this.props.location))return k;return (c('React').createElement(c('Link.react'),{className:"_5rw4",href:this.props.attachment.uri,onClick:this._onClick,target:'_blank'},k));},render:function(){return this.renderLink(c('React').createElement(c('MercuryFallbackShareAttachmentContent.react'),this.props));},_onClick:function(event){if(this.props.isSponsored){var k=this.props.attachment&&this.props.attachment.subattachments;if(!k)return;for(var l=k,m=Array.isArray(l),n=0,l=m?l:l[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var o;if(m){if(n>=l.length)break;o=l[n++];}else{n=l.next();if(n.done)break;o=n.value;}var p=o;new (c('MessengerAdsWebTypedLogger'))().setEvent(c('MNAdsLoggerEventEnum').LINK_CLICK).setIsSponsored(this.props.isSponsored).setItemID(p&&p.id).setMessageID(this.props.messageID).setPageID(this.props.pageID).log();}}}});f.exports=j;},null);
__d('P2PCreditCardForm.react',['CreditCardFormParam','FBPaymentsCreditCardForm.react','MessengerPaymentProductType','P2PAPIUtils','P2PAPI','React','getObjectValues'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'P2PCreditCardForm',propTypes:{asyncRequestState:h.object,onValidation:h.func.isRequired,productType:h.oneOf(c('getObjectValues')(c('MessengerPaymentProductType')))},getDefaultProps:function(){return {asyncRequestState:{},productType:c('MessengerPaymentProductType').P2P};},getInitialState:function(){return {binError:'',previousBINNumber:'',validateBINRequestID:''};},componentWillReceiveProps:function(j){var k=j.asyncRequestState,l=k?k[this.state.validateBINRequestID]:null;if(l){this.setState({validateBINRequestID:''});if(l.error){this.handleValidateBINNumberError(l.error);}else this.handleValidateBINNumberSuccess();}},handleValidateBINNumberSuccess:function(){this.setState({binError:''});},handleValidateBINNumberError:function(j){var k=j.message;this.setState({binError:k});},validateBIN:function(j){var k,l;j=j.replace(/ /g,'');k=j.substr(0,6);if(k!==this.state.previousBINNumber&&k.length>=6){l=c('P2PAPIUtils').genRequestID();this.setState({validateBINRequestID:l});c('P2PAPI').validateBINNumber({binNumber:k,requestID:l});}else if(k.length<6)this.setState({binError:'',validateBINRequestID:''});this.setState({previousBINNumber:k});},handleValidation:function(j,k){var l=k[c('CreditCardFormParam').CARD_NUMBER];if(!this.props.editMode&&this.props.productType===c('MessengerPaymentProductType').P2P&&l)this.validateBIN(l);this.props.onValidation(j,k);},render:function(){return (c('React').createElement(c('FBPaymentsCreditCardForm.react'),babelHelpers['extends']({},this.props,{allowCredit:this.props.productType===c('MessengerPaymentProductType').MESSENGER_COMMERCE,binError:this.state.binError,onValidation:this.handleValidation})));}});f.exports=i;},null);
__d('P2PAddCreditCardDialog.react',['cx','fbt','CurrentEnvironment','Link.react','MessengerPaymentProductType','P2PAPI','P2PAPIUtils','P2PCreditCardStore','P2PCreditCardForm.react','P2PLoadingMask.react','P2PLogger','P2PPaymentLoggerEvent','P2PLinkConstants','React','P2PButton.react','P2PDialog.react','P2PDialogTitle.react','P2PDialogBody.react','P2PDialogFooter.react','P2PText.react','emptyFunction','getObjectValues'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k='fbP2PAddCreditCardDialog_learnMoreSentenceID',l=c('React').createClass({displayName:'P2PAddCreditCardDialog',propTypes:{cancelButtonText:j.string,eventFlow:j.string.isRequired,loggingData:j.object,loggingObjectID:j.string,onCancel:j.func,onSuccess:j.func,productType:j.oneOf(c('getObjectValues')(c('MessengerPaymentProductType'))),saveButtonText:j.string,showCancelButton:j.bool,text:j.string,title:j.string},getDefaultProps:function(){var m;if(c('CurrentEnvironment').messengerdotcom){m=480;}else m=430;return {cancelButtonText:i._("Annuler"),loggingData:{},onCancel:c('emptyFunction'),onSuccess:c('emptyFunction'),productType:c('MessengerPaymentProductType').P2P,saveButtonText:i._("Enregistrer"),showCancelButton:true,text:i._("Veuillez saisir une carte de d\u00e9bit. Les cartes de cr\u00e9dit ne sont pas accept\u00e9es."),title:i._("Ajouter une carte de d\u00e9bit"),width:m};},getInitialState:function(){return {isValid:false,formData:{},loading:false,requestID:'',saveErrors:null};},onCreditCardStoreChange:function(){var m=c('P2PCreditCardStore').getAsyncRequestState(),n=m[this.state.requestID];this.setState({asyncRequestState:m});if(n){this.setState({requestID:''});if(n.error){this.handleOnSaveError(n.error);}else this.handleOnSaveSuccess(n);}},componentDidMount:function(){this.log(c('P2PPaymentLoggerEvent').UI_ACTN_INITIATE_ADD_CARD);this.creditCardStoreSub=c('P2PCreditCardStore').addListener('change',this.onCreditCardStoreChange);},componentWillUnmount:function(){if(this.creditCardStoreSub){this.creditCardStoreSub.remove();this.creditCardStoreSub=null;}},log:function(m,n){c('P2PLogger').log(m,babelHelpers['extends']({www_event_flow:this.props.eventFlow,object_id:this.props.loggingObjectID},this.props.loggingData,n));},onSaveClick:function(){var m=c('P2PAPIUtils').genRequestID();this.setState({loading:true,requestID:m,saveErrors:null});this.log(c('P2PPaymentLoggerEvent').UI_ACTN_CONFIRM_CARD_DETAILS);c('P2PAPI').addCreditCard(babelHelpers['extends']({requestID:m,product_type:this.props.productType},this.state.formData));},handleOnSaveSuccess:function(m){this.props.onSuccess(m);this.log(c('P2PPaymentLoggerEvent').UI_ACTN_ADD_CARD_SUCCESS);},handleOnSaveError:function(m){this.setState({loading:false,saveErrors:m});this.log(c('P2PPaymentLoggerEvent').UI_ACTN_ADD_CARD_FAIL,{message:m&&m.general?m.general.message:''});},handleValidation:function(m,n){this.setState({isValid:m,formData:n});},isSaveButtonDisabled:function(){return this.state.loading||!this.state.isValid;},onToggle:function(m){if(!m){this.props.onCancel();this.log(c('P2PPaymentLoggerEvent').UI_ACTN_CANCEL_ADD_CARD);}},onCancelClicked:function(){this.onToggle(false);},renderAddCardForm:function(){var m,n=this.props.title;if(this.props.showCancelButton)m=c('React').createElement(c('P2PButton.react'),{use:'default',size:'medium',label:this.props.cancelButtonText,disabled:this.state.loading,onClick:this.onCancelClicked});return (c('React').createElement('div',null,c('React').createElement(c('P2PDialogTitle.react'),null,n),c('React').createElement(c('P2PDialogBody.react'),null,c('React').createElement(c('P2PText.react'),{type:'primary',className:"_3-96"},this.props.text),c('React').createElement(c('P2PCreditCardForm.react'),{asyncRequestState:this.state.asyncRequestState,compactMode:true,onValidation:this.handleValidation,productType:this.props.productType,saveErrors:this.state.saveErrors,showIcons:false,showLabels:true,showPlaceholderOnFocus:true,showSecondaryIcons:true,useGutters:true}),c('React').createElement(c('P2PText.react'),{className:"_3-8y",id:k,type:'secondary'},i._("Vos informations de paiement sont stock\u00e9es de mani\u00e8re s\u00e9curis\u00e9e."),c('React').createElement('div',null,c('React').createElement(c('Link.react'),{'aria-describedby':k,href:c('P2PLinkConstants').addDebitCardHelpURI,target:'_blank'},i._("En savoir plus"))))),c('React').createElement(c('P2PDialogFooter.react'),{leftContent:this.props.leftContent},m,c('React').createElement(c('P2PButton.react'),{use:'confirm',size:'medium',label:this.props.saveButtonText,disabled:this.isSaveButtonDisabled(),onClick:this.onSaveClick}))));},render:function(){return (c('React').createElement(c('P2PDialog.react'),{behaviors:this.props.behaviors,layerHideOnBlur:false,ref:'dialog',onToggle:this.onToggle,repositionOnUpdate:true,shown:true,width:this.props.width},this.renderAddCardForm(),c('React').createElement(c('P2PLoadingMask.react'),{visible:this.state.loading})));}});f.exports=l;},null);
__d('P2PChooseCreditCardDialog.react',['cx','fbt','CurrentEnvironment','P2PButton.react','P2PChooseCreditCardForm.react','P2PCreditCard','P2PDialog.react','P2PDialogBody.react','P2PDialogFooter.react','P2PDialogTitle.react','P2PLoadingMask.react','P2PText.react','React'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('CurrentEnvironment').messengerdotcom,k=c('React').PropTypes,l=c('React').createClass({displayName:'P2PChooseCreditCardDialog',propTypes:{addCardOptionText:k.string,cancelButtonText:k.string,creditCards:k.arrayOf(k.instanceOf(c('P2PCreditCard'))).isRequired,onAddDebitCardOptionSelected:k.func.isRequired,onClose:k.func.isRequired,onSelected:k.func.isRequired,saveButtonText:k.string.isRequired,selectedCreditCard:k.instanceOf(c('P2PCreditCard')).isRequired,showCancelButton:k.bool,showLoading:k.bool,text:k.string,title:k.string,width:k.number},getDefaultProps:function(){return {cancelButtonText:i._("Annuler"),showCancelButton:false,text:i._("Vous pouvez utiliser une carte de d\u00e9bit d\u00e9j\u00e0 ajout\u00e9e \u00e0 Facebook ou en ajouter une autre."),title:i._("S\u00e9lectionner une carte de d\u00e9bit")};},getInitialState:function(){return {loading:false,selectedCreditCard:this.props.selectedCreditCard};},handleAddDebitCardOptionClicked:function(){this.props.onAddDebitCardOptionSelected();},handleCreditCardSelected:function(m){this.setState({selectedCreditCard:m});},handleSelected:function(){this.setState({loading:true});this.props.onSelected(this.state.selectedCreditCard);},handleToggle:function(m){if(!m)this.props.onClose();},render:function(){var m;if(this.props.showCancelButton)m=c('React').createElement(c('P2PButton.react'),{disabled:this.props.showLoading,label:this.props.cancelButtonText,onClick:this.props.onClose,size:'medium',use:'default'});return (c('React').createElement(c('P2PDialog.react'),{behaviors:this.props.behaviors,className:j?"_auz":'',onToggle:this.handleToggle,width:this.props.width},c('React').createElement(c('P2PDialogTitle.react'),null,this.props.title),c('React').createElement(c('P2PDialogBody.react'),{className:"_383d"},c('React').createElement(c('P2PText.react'),{type:'primary',className:"_au_"},this.props.text),c('React').createElement(c('P2PChooseCreditCardForm.react'),{addCardOptionText:this.props.addCardOptionText,className:"_2pi4",creditCards:this.props.creditCards,onAddDebitCardOptionSelected:this.handleAddDebitCardOptionClicked,onChange:this.handleCreditCardSelected,selectedCard:this.props.selectedCreditCard,showAddDebitCardOption:true})),c('React').createElement(c('P2PDialogFooter.react'),null,m,c('React').createElement(c('P2PButton.react'),{disabled:this.props.showLoading,label:this.props.saveButtonText,onClick:this.handleSelected,size:'medium',use:'confirm'})),c('React').createElement(c('P2PLoadingMask.react'),{visible:this.props.showLoading})));}});f.exports=l;},null);
__d('P2PEditCreditCardDialog.react',['cx','fbt','CreditCardFormParam','CurrentEnvironment','Link.react','React','P2PAPI','P2PAPIUtils','P2PCreditCard','P2PCreditCardForm.react','P2PLoadingMask.react','P2PLinkConstants','P2PDialog.react','P2PDialogTitle.react','P2PDialogBody.react','P2PDialogFooter.react','P2PButton.react','P2PText.react'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j='fbP2PEditCreditCardDialog_learnMoreSentenceID',k=c('React').PropTypes,l=c('React').createClass({displayName:'P2PEditCreditCardDialog',propTypes:{asyncRequestState:k.object.isRequired,creditCard:k.instanceOf(c('P2PCreditCard')).isRequired,onCancel:k.func.isRequired,onSuccess:k.func.isRequired,saveButtonText:k.string,showCancelButton:k.bool},getInitialState:function(){return {formData:{},isValid:false,loading:false,requestID:'',saveErrors:null};},getDefaultProps:function(){return {saveButtonText:i._("Enregistrer"),showCancelButton:true,width:c('CurrentEnvironment').messengerdotcom?350:300};},componentWillReceiveProps:function(m){var n=m.asyncRequestState?m.asyncRequestState[this.state.requestID]:null;if(n){this.setState({requestID:''});if(n.error){this.handleOnSaveError(n.error);}else this.handleOnSaveSuccess(n);}},clearSaveErrors:function(){this.setState({saveErrors:null});},onSaveClick:function(m){var n={},o=c('P2PAPIUtils').genRequestID();n[c('CreditCardFormParam').CREDENTIAL_ID]=this.props.creditCard.getCredentialId();this.clearSaveErrors();this.setState({loading:true,requestID:o});c('P2PAPI').updateCreditCard(babelHelpers['extends']({requestID:o},n,this.state.formData));},handleOnSaveSuccess:function(m){this.props.onSuccess(m);},onCancelClick:function(m){this.props.onCancel();},handleOnSaveError:function(m){this.setState({loading:false,saveErrors:m});},isSaveDisabled:function(){return !this.state.isValid||this.state.loading;},isCancelDisabled:function(){return this.state.loading;},handleValidation:function(m,n){this.setState({isValid:m,formData:n});},getPrefilledFormData:function(){var m={};m[c('CreditCardFormParam').CARD_NUMBER]=this.props.creditCard.getCreditCardNumberMask();m[c('CreditCardFormParam').CARD_EXPIRATION]=this.props.creditCard.getExpFormattedShort();m[c('CreditCardFormParam').ZIP]=this.props.creditCard.getZipCode();return m;},handleErrorDialogOKClick:function(){this.clearSaveErrors();},onToggle:function(m){if(!m)this.props.onCancel();},render:function(){var m,n=this.props.text;if(!n)n=i._("Veuillez mettre \u00e0 jour la date d\u2019expiration de votre carte se terminant par {card numbers}.",[i.param('card numbers',this.props.creditCard.getCreditCardNumber())]);if(this.props.showCancelButton)m=c('React').createElement(c('P2PButton.react'),{use:'default',size:'medium',label:i._("Annuler"),disabled:this.isCancelDisabled(),onClick:this.onCancelClick});return (c('React').createElement(c('P2PDialog.react'),{behaviors:this.props.behaviors,layerHideOnBlur:false,onToggle:this.onToggle,repositionOnUpdate:true,shown:true,width:this.props.width},c('React').createElement(c('P2PDialogTitle.react'),null,i._("Mettre \u00e0 jour la carte de d\u00e9bit")),c('React').createElement(c('P2PDialogBody.react'),null,c('React').createElement(c('P2PText.react'),{className:"_3-96",type:'primary'},n),c('React').createElement(c('P2PCreditCardForm.react'),{onValidation:this.handleValidation,saveErrors:this.state.saveErrors,editMode:true,prefilledFormData:this.getPrefilledFormData(),cscMaxLength:this.props.creditCard.getMaxCSCLength()}),c('React').createElement(c('P2PText.react'),{className:"_3-8y",id:j,type:'secondary'},i._("Vos informations de paiement sont stock\u00e9es de mani\u00e8re s\u00e9curis\u00e9e. {Learn more about p2p link}",[i.param('Learn more about p2p link',c('React').createElement(c('Link.react'),{'aria-describedby':j,href:c('P2PLinkConstants').addDebitCardHelpURI,target:'_blank'},i._("En savoir plus.")))]))),c('React').createElement(c('P2PDialogFooter.react'),null,m,c('React').createElement(c('P2PButton.react'),{use:'confirm',size:'medium',label:this.props.saveButtonText,disabled:this.isSaveDisabled(),onClick:this.onSaveClick})),c('React').createElement(c('P2PLoadingMask.react'),{visible:this.state.loading})));}});f.exports=l;},null);
__d('P2PMoneypennyCheckoutDialog.react',['cx','fbt','ix','CurrentEnvironment','Link.react','MNCommerceAgenItemSuggestionReactShape','P2PBigAmount.react','P2PButton.react','P2PCreditCard','P2PDialog.react','P2PDialogBody.react','P2PDialogFooter.react','P2PDialogTitle.react','P2PLoadingMask.react','P2PMoneypennyProductItemDetails.react','P2PText.react','React','ReactComponentWithPureRenderMixin'],function a(b,c,d,e,f,g,h,i,j){'use strict';if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=c('React').createClass({displayName:'P2PMoneypennyCheckoutDialog',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{cancelButtonText:k.string,item:c('MNCommerceAgenItemSuggestionReactShape').isRequired,leftContentText:k.string,onClose:k.func.isRequired,onChangeCreditCard:k.func.isRequired,onNextClicked:k.func.isRequired,onPurchaseClicked:k.func.isRequired,selectedCreditCard:k.instanceOf(c('P2PCreditCard')),showCancelButton:k.bool,showLoading:k.bool},getDefaultProps:function(){return {cancelButtonText:i._("Annuler"),leftContentText:i._("Vous ajouterez ensuite une carte de d\u00e9bit."),showCancelButton:false,width:360};},handleToggle:function(m){if(!m)this.props.onClose();},renderPaymentDetails:function(){var m=this.props.selectedCreditCard;if(!m)return null;return (c('React').createElement(c('P2PText.react'),{className:"_1t0k",shade:'light',size:'small',type:'secondary'},m.getDetailsFormatted()+' \u00b7 ',c('React').createElement(c('Link.react'),{className:"_1t0l",onClick:this.props.onChangeCreditCard,href:'#'},i._("Modifier"))));},renderFooter:function(){var m,n,o;if(!this.props.selectedCreditCard){m=c('React').createElement(c('P2PText.react'),{className:"_1t0n",type:'secondary'},this.props.leftContentText);n=c('React').createElement(c('P2PButton.react'),{label:i._("Suivant"),onClick:this.props.onNextClicked,size:'medium',type:'primary',use:'default'});}else n=c('React').createElement(c('P2PButton.react'),{label:i._("Payer"),onClick:this.props.onPurchaseClicked,size:'medium',type:'primary',use:'confirm'});if(this.props.showCancelButton)o=c('React').createElement(c('P2PButton.react'),{use:'default',size:'medium',label:this.props.cancelButtonText,disabled:this.props.showLoading,onClick:this.props.onClose});return (c('React').createElement(c('P2PDialogFooter.react'),{leftContent:m},o,n));},renderAmountSection:function(){return (c('React').createElement('div',{className:"_1t0o"},c('React').createElement('div',{className:"_4qbr"},c('React').createElement(c('P2PBigAmount.react'),{amount:this.props.item.raw_amount,size:'large'})),this.renderPaymentDetails(),c('React').createElement(c('P2PText.react'),{className:"_1wb1",shade:'light',size:'small',type:'secondary'},'We',"'",'ll place your order with the business when we receive your payment.')));},render:function(){var m;if(!c('CurrentEnvironment').messengerdotcom)m=c('React').createElement(c('P2PDialogTitle.react'),null,i._("Paiement"));return (c('React').createElement(c('P2PDialog.react'),{layerHideOnBlur:false,onToggle:this.handleToggle,shown:true,width:this.props.width},m,c('React').createElement(c('P2PDialogBody.react'),null,c('React').createElement('div',{className:"_b0z"},c('React').createElement(c('P2PMoneypennyProductItemDetails.react'),{item:this.props.item})),this.renderAmountSection()),this.renderFooter(),c('React').createElement(c('P2PLoadingMask.react'),{visible:this.props.showLoading})));}});f.exports=l;},null);
__d('P2PMoneypennyStore',['P2PActionConstants','EventEmitter','ImmutableObject','P2PDispatcher'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j,k,l;function m(p,q){if(p)l[p]=new (c('ImmutableObject'))(q);}function n(p,q){if(p)l[p]={error:q};}h=babelHelpers.inherits(o,c('EventEmitter'));i=h&&h.prototype;function o(){i.constructor.call(this);l={};k=[];j=c('P2PDispatcher').register(this.onEventDispatched.bind(this));}o.prototype.onEventDispatched=function(p){var q=p.data,r=p.type;switch(r){case c('P2PActionConstants').MONEYPENNY_TRANSFER_CREATED:this.handleMoneypennyTransferCreated(q);this.emit('change');break;case c('P2PActionConstants').MONEYPENNY_TRANSFER_CREATED_ERROR:this.handleMoneypennyTransferCreatedError(q);this.emit('change');break;}};o.prototype.getAsyncRequestState=function(){return l;};o.prototype.handleMoneypennyTransferCreated=function(p){var q;m(p.requestID,p);q=k.filter(function(r){return (r.payment_id===p.payment_id);})[0];if(!q)k.push(new (c('ImmutableObject'))(p));};o.prototype.handleMoneypennyTransferCreatedError=function(p){n(p.requestID,p.error);};o.prototype.getTransferByID=function(p){return k.filter(function(q){return q.item_id===p;})[0];};f.exports=new o();},null);
__d('P2PPasswordProtectionNUXDialog.react',['cx','fbt','CurrentEnvironment','Link.react','P2PAPI','P2PErrorDialog.react','P2PLinkConstants','P2PLoadingMask.react','P2PLogger','P2PPaymentLoggerEvent','P2PPaymentLoggerEventFlow','P2PPasswordProtectionParam','P2PPasswordProtectionStatusTypes','React','P2PButton.react','P2PDialog.react','P2PDialogTitle.react','P2PDialogBody.react','P2PDialogFooter.react','P2PText.react','emptyFunction'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'P2PPasswordProtectionNUXDialog',propTypes:{onComplete:j.func},getDefaultProps:function(){return {onComplete:c('emptyFunction'),width:c('CurrentEnvironment').messengerdotcom?320:300};},getInitialState:function(){return {saveErrorObject:null,loading:false};},componentWillMount:function(){this.log(c('P2PPaymentLoggerEvent').UI_ACTN_INITIATE_PASSWORD_PROTECTION_NUX);},log:function(l,m){c('P2PLogger').log(l,babelHelpers['extends']({www_event_flow:c('P2PPaymentLoggerEventFlow').UI_FLOW_P2P_SETTINGS},m));},onSaveClick:function(){this.setState({loading:true,saveErrorObject:null});this.setPasswordProtection(c('P2PPasswordProtectionStatusTypes').ENABLED);this.log(c('P2PPaymentLoggerEvent').UI_ACTN_OPT_IN_PASSWORD_PROTECTION_NUX);},setPasswordProtection:function(l){var m={};m[c('P2PPasswordProtectionParam').STATUS]=l;c('P2PAPI').setPasswordProtectionSetting({formData:m,success:this.handleOnSaveSuccess,error:this.handleOnSaveError});},handleOnSaveSuccess:function(){this.setState({loading:false});this.props.onComplete();},handleOnSaveError:function(l){this.setState({loading:false,saveErrorObject:l});},isSaveButtonDisabled:function(){return this.state.loading;},isCancelButtonDisabled:function(){return this.state.loading;},onCancelClick:function(){this.setState({loading:true,saveErrorObject:null});this.setPasswordProtection(c('P2PPasswordProtectionStatusTypes').DISABLED);this.log(c('P2PPaymentLoggerEvent').UI_ACTN_OPT_OUT_PASSWORD_PROTECTION_NUX);},handleErrorBackClick:function(){this.setState({saveErrorObject:null});},handleErrorOKClick:function(){this.setState({saveErrorObject:null});this.props.onComplete();},render:function(){if(this.state.saveErrorObject)return (c('React').createElement(c('P2PErrorDialog.react'),{allowBack:true,title:i._("Probl\u00e8me d\u2019enregistrement"),onBackClick:this.handleErrorBackClick,onOKClick:this.handleErrorOKClick,error:this.state.saveErrorObject}));return (c('React').createElement(c('P2PDialog.react'),{className:c('CurrentEnvironment').messengerdotcom?"_-el":'',behaviors:{LayerFadeOnShow:false},layerHideOnBlur:false,shown:true,width:this.props.width},c('React').createElement(c('P2PDialogTitle.react'),{showCloseButton:false},i._("Utiliser un mot de passe\u00a0?")),c('React').createElement(c('P2PDialogBody.react'),null,c('React').createElement(c('P2PText.react'),{className:"_5sor",type:'primary'},i._("Pour plus de s\u00e9curit\u00e9, vous pouvez saisir votre mot de passe Facebook pour envoyer de l\u2019argent. Vous pouvez toujours le mettre \u00e0 jour dans {link}.",[i.param('link',c('React').createElement(c('Link.react'),{href:c('P2PLinkConstants').settingsWWWURI,target:'_blank'},i._("Param\u00e8tres")))]))),c('React').createElement(c('P2PDialogFooter.react'),null,c('React').createElement(c('P2PButton.react'),{className:"_5sov",disabled:this.isCancelButtonDisabled(),label:i._("Plus tard"),onClick:this.onCancelClick,size:'medium',use:'default'}),c('React').createElement(c('P2PButton.react'),{className:"_5sox",disabled:this.isSaveButtonDisabled(),label:i._("Utiliser un mot de passe"),onClick:this.onSaveClick,size:'medium',use:'confirm'})),c('React').createElement(c('P2PLoadingMask.react'),{visible:this.state.loading})));}});f.exports=k;},null);
__d('P2PSuccessDialog.react',['fbt','ix','CurrentEnvironment','Image.react','LayerSlowlyFadeOnShow','P2PConfirmationDialog.react','React','emptyFunction'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'P2PSuccessDialog',propTypes:{allowBack:j.bool,buttonLabel:j.node,buttonUse:j.string,onOKClick:j.func,onSecondaryClick:j.func,showCloseButton:j.bool,showSecondaryButton:j.bool,secondaryButtonLabel:j.node,secondaryButtonUse:j.string,title:j.string.isRequired,width:j.number},getDefaultProps:function(){return {allowBack:false,buttonLabel:h._("OK"),buttonUse:'default',onOKClick:c('emptyFunction'),showCloseButton:false,width:c('CurrentEnvironment').messengerdotcom?350:300};},getImage:function(){if(c('CurrentEnvironment').messengerdotcom){return (c('React').createElement(c('Image.react'),{height:62,width:62,src:i('/images/p2p/checkmark-messenger.png')}));}else return (c('React').createElement(c('Image.react'),{height:56,width:56,src:i('/images/p2p/check_mark-sm.png')}));},render:function(){var l=this.getImage();return (c('React').createElement(c('P2PConfirmationDialog.react'),{behaviors:babelHelpers['extends']({LayerSlowlyFadeOnShow:c('LayerSlowlyFadeOnShow')},this.props.behaviors),allowBack:this.props.allowBack,buttonLabel:this.props.buttonLabel,buttonUse:this.props.buttonUse,centered:this.props.centered,image:l,onOKClick:this.props.onOKClick,onSecondaryClick:this.props.onSecondaryClick,showCloseButton:this.props.showCloseButton,showSecondaryButton:this.props.showSecondaryButton,secondaryButtonLabel:this.props.secondaryButtonLabel,secondaryButtonUse:this.props.secondaryButtonUse,title:this.props.title,width:this.props.width},this.props.children));}});f.exports=k;},null);
__d('P2PMoneypennyCheckoutDialogContainer.react',['cx','fbt','Arbiter','CreditCardFormParam','CurrentEnvironment','MessengerPaymentProductType','MNCommerceAgenItemSuggestionReactShape','P2PAPI','P2PAPIUtils','P2PAddCreditCardDialog.react','P2PChooseCreditCardDialog.react','P2PCreditCardStore','P2PEditCreditCardDialog.react','P2PErrorDialog.react','P2PGKValues','P2PLogger','P2PMoneypennyCheckoutDialog.react','P2PMoneypennyStore','P2PPaymentLoggerEvent','P2PPaymentLoggerEventFlow','P2PPasswordProtectionNUXDialog.react','P2PPasswordProtectionStatusTypes','P2PSuccessDialog.react','P2PText.react','P2PVerifyCreditCardDialog.react','React','setImmediate'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=i._("Payer"),k={LayerFadeOnShow:false},l=360,m=c('P2PPaymentLoggerEventFlow').UI_FLOW_MONEYPENNY_CHECKOUT,n=c('React').PropTypes,o=c('React').createClass({displayName:'P2PMoneypennyCheckoutDialogContainer',propTypes:{item:c('MNCommerceAgenItemSuggestionReactShape').isRequired,onClose:n.func.isRequired},getInitialState:function(){var p=this.getCards();return {addCreditCardDialogShown:false,editCreditCardDialogShown:false,creditCards:p,creditCardAsyncRequestState:c('P2PCreditCardStore').getAsyncRequestState(),chooseCreditCardDialogShown:false,loading:false,moneypennyAsyncRequestState:c('P2PMoneypennyStore').getAsyncRequestState(),p2pPasswordProtectionNUXDialogShown:false,transferErrors:null,transferRequestID:'',selectedCreditCard:p[0],successDialogPending:false,successDialogShown:false,verifyCreditCardDialogShown:false};},componentWillMount:function(){this.log(c('P2PPaymentLoggerEvent').UI_ACTN_INITIATE_MONEYPENNY_ORDER,{});this.creditCardStoreSub=c('P2PCreditCardStore').addListener('change',this.onCreditCardStoreChange);this.moneypennyTransferStoreSub=c('P2PMoneypennyStore').addListener('change',this.onMoneypennyStoreChange);},componentWillUnmount:function(){if(this.creditCardStoreSub){this.creditCardStoreSub.remove();this.creditCardStoreSub=null;}if(this.moneypennyTransferStoreSub){this.moneypennyTransferStoreSub.remove();this.moneypennyTransferStoreSub=null;}if(this.passwordCancelSubscribeToken!==null){c('Arbiter').unsubscribe(this.passwordCancelSubscribeToken);this.passwordCancelSubscribeToken=null;}},creditCardStoreSub:null,moneypennyTransferStoreSub:null,passwordCancelSubscribeToken:null,passwordNUXPending:false,successDialogPending:false,getProductType:function(){return c('MessengerPaymentProductType').MESSENGER_COMMERCE;},getCards:function(){return c('P2PCreditCardStore').getAll(this.getProductType());},log:function(p,q){c('P2PLogger').log(p,babelHelpers['extends']({raw_amount:this.props.item.raw_amount,currency:this.props.item.total_cost.currency,object_id:this.props.item.id,www_event_flow:m},q));},onCreditCardStoreChange:function(){var p=this.getCards(),q;if(this.state.selectedCreditCard)q=c('P2PCreditCardStore').getCreditCardByCredentialID(this.state.selectedCreditCard.getCredentialId());if(!q)q=p[0];this.setState({creditCards:p,creditCardAsyncRequestState:c('P2PCreditCardStore').getAsyncRequestState(),selectedCreditCard:q});},onMoneypennyStoreChange:function(){var p=c('P2PMoneypennyStore').getAsyncRequestState(),q=p[this.state.transferRequestID];this.setState({moneypennyAsyncRequestState:p});if(q){this.setState({transferRequestID:''});if(q.error){this.handleMoneypennyTransferError(q.error);}else this.handleMoneypennyTransferSuccess(q);}},handleChangeCreditCardClicked:function(){this.hideAllDialogs();if(this.state.creditCards.length>1){this.setState({chooseCreditCardDialogShown:true});this.log(c('P2PPaymentLoggerEvent').UI_ACTN_INITIATE_CHOOSE_CARD,{});}else this.setState({addCreditCardDialogShown:true});},handleAddDebitCardClicked:function(){this.hideAllDialogs();this.setState({addCreditCardDialogShown:true});},handleCreditCardSelected:function(p){this.setState({selectedCreditCard:p},function(){this.purchase();}.bind(this));},purchase:function(){var p;if(!this.state.selectedCreditCard.getIsVerified()){this.log(c('P2PPaymentLoggerEvent').UI_ACTN_VERIFY_CSC,{});this.hideAllDialogs();this.setState({verifyCreditCardDialogShown:true});return;}else if(this.state.selectedCreditCard.isExpired()){this.log(c('P2PPaymentLoggerEvent').UI_ACTN_EDIT_CARD,{});this.hideAllDialogs();this.setState({editCreditCardDialogShown:true});return;}this.passwordCancelSubscribeToken=c('Arbiter').subscribeOnce('PasswordReauthDialogCancelClick',this.handlePasswordReauthDialogCancelClick);p=c('P2PAPIUtils').genRequestID();this.setState({loading:true,transferRequestID:p,transferErrors:null});c('P2PAPI').createMoneypennyTransfer({amount:this.props.item.raw_amount,credential_id:this.state.selectedCreditCard.getCredentialId(),item_id:this.props.item.id,external_request_id:c('P2PAPIUtils').genRequestID(),requestID:p});this.log(c('P2PPaymentLoggerEvent').UI_ACTN_CONFIRM_MONEYPENNY_ORDER,{});},handleMoneypennyTransferSuccess:function(p){this.hideAllDialogs();this.log(c('P2PPaymentLoggerEvent').UI_ACTN_MONEYPENNY_ORDER_SUCCESS,{});if(p.passwordProtection===c('P2PPasswordProtectionStatusTypes').NOT_SET)this.passwordNUXPending=true;if(this.successDialogPending){this.successDialogPending=false;this.setState({successDialogShown:true});}else this.handleCheckoutSuccess();},handleMoneypennyTransferError:function(p){this.hideAllDialogs();this.log(c('P2PPaymentLoggerEvent').UI_ACTN_MONEYPENNY_ORDER_FAIL,{});this.setState({loading:false,transferErrors:p});},handlePasswordReauthDialogCancelClick:function(){this.passwordCancelSubscribeToken=null;this.setState({loading:false});this.hideAllDialogs();},handleCheckoutSuccess:function(){this.hideAllDialogs();if(this.passwordNUXPending){this.passwordNUXPending=false;this.setState({p2pPasswordProtectionNUXDialogShown:true});}else c('setImmediate')(this.props.onClose);},handleAddCreditCardSuccess:function(p){this.successDialogPending=this.getCards().length===1;this.setState({selectedCreditCard:c('P2PCreditCardStore').getCreditCardByCredentialID(p[c('CreditCardFormParam').CREDENTIAL_ID])},function(){this.purchase();}.bind(this));},handleCheckoutCancel:function(){this.log(c('P2PPaymentLoggerEvent').UI_ACTN_MONEYPENNY_ORDER_CANCEL,{});this.props.onClose();},hideAllDialogs:function(){this.setState({addCreditCardDialogShown:false,editCreditCardDialogShown:false,chooseCreditCardDialogShown:false,successDialogShown:false,transferErrors:null,verifyCreditCardDialogShown:false,p2pPasswordProtectionNUXDialogShown:false});},render:function(){var p=this.props.item,q=c('CurrentEnvironment').messengerdotcom,r,s,t,u,v,w;if(this.getProductType()===c('MessengerPaymentProductType').MESSENGER_COMMERCE){r=i._("Saisissez une carte de cr\u00e9dit ou de d\u00e9bit pour acheter {Product name}.",[i.param('Product name',p.name)]);s=i._("Ajouter une carte");u=i._("S\u00e9lectionner une carte");t=i._("Vous pouvez d\u00e9sormais utiliser une carte que vous avez d\u00e9j\u00e0 ajout\u00e9e \u00e0 Facebook ou en ajouter une nouvelle pour acheter {Product name}.",[i.param('Product name',this.props.item.name)]);v=i._("Nouvelle carte");w=i._("Vous ajouterez ensuite une carte.");}else{r=i._("Veuillez entrer une carte de d\u00e9bit pour acheter {Product name}. Les cartes de cr\u00e9dit ne sont pas encore accept\u00e9es.",[i.param('Product name',p.name)]);t=i._("Vous pouvez utiliser une carte de d\u00e9bit que vous avez d\u00e9j\u00e0 ajout\u00e9e sur Facebook ou en ajouter une autre pour acheter {Product name}.",[i.param('Product name',this.props.item.name)]);}if(this.state.p2pPasswordProtectionNUXDialogShown){return (c('React').createElement(c('P2PPasswordProtectionNUXDialog.react'),{onComplete:this.props.onClose,width:l}));}else if(this.state.transferErrors){return (c('React').createElement(c('P2PErrorDialog.react'),{behaviors:k,error:this.state.transferErrors,onOKClick:this.handleCheckoutCancel,title:i._("Probl\u00e8me avec votre paiement"),width:l}));}else if(this.state.verifyCreditCardDialogShown){return (c('React').createElement(c('P2PVerifyCreditCardDialog.react'),{asyncRequestState:this.state.creditCardAsyncRequestState,behaviors:k,creditCard:this.state.selectedCreditCard,isPurchasing:true,purchaseName:this.props.item.name,onCancel:this.handleCheckoutCancel,onSuccess:this.purchase,saveButtonText:j,showCancelButton:q,width:l}));}else if(this.state.editCreditCardDialogShown){return (c('React').createElement(c('P2PEditCreditCardDialog.react'),{asyncRequestState:this.state.creditCardAsyncRequestState,behaviors:k,creditCard:this.state.selectedCreditCard,onCancel:this.handleCheckoutCancel,onSuccess:this.purchase,saveButtonText:j,showCancelButton:q,text:i._("Veuillez mettre \u00e0 jour la date d\u2019expiration de votre carte se terminant par {card numbers} pour acheter {Product name}.",[i.param('card numbers',this.state.selectedCreditCard.getCreditCardNumber()),i.param('Product name',this.props.item.name)]),width:l}));}else if(this.state.successDialogShown){return (c('React').createElement(c('P2PSuccessDialog.react'),{behaviors:babelHelpers['extends']({LayerSlowlyFadeOnShow:false},k),onOKClick:this.handleCheckoutSuccess,title:i._("Paiement envoy\u00e9"),width:l},c('React').createElement(c('P2PText.react'),{className:"_3-97",type:'primary'},i._("Nous avons re\u00e7u votre paiement et passons commande aupr\u00e8s de l\u2019entreprise.")),c('React').createElement(c('P2PText.react'),{type:'primary'},i._("{Bold text that says, Tip:} vous pouvez aussi utiliser {Credit card name and number} pour envoyer de l\u2019argent \u00e0 vos amis dans vos conversations.",[i.param('Bold text that says, Tip:',c('React').createElement(c('P2PText.react'),{display:'inline',type:'primary',weight:'bold'},i._("Conseil\u00a0:"))),i.param('Credit card name and number',this.state.selectedCreditCard.getDetailsFormatted())]))));}else if(this.state.chooseCreditCardDialogShown){return (c('React').createElement(c('P2PChooseCreditCardDialog.react'),{addCardOptionText:v,behaviors:k,creditCards:this.state.creditCards,onAddDebitCardOptionSelected:this.handleAddDebitCardClicked,onClose:this.handleCheckoutCancel,onSelected:this.handleCreditCardSelected,saveButtonText:j,selectedCreditCard:this.state.selectedCreditCard,showCancelButton:q,showLoading:this.state.loading,text:t,title:u,width:l}));}else if(this.state.addCreditCardDialogShown){return (c('React').createElement(c('P2PAddCreditCardDialog.react'),{behaviors:k,eventFlow:m,loggingData:{amount:p.raw_amount,object_id:p.id},onCancel:this.handleCheckoutCancel,onSuccess:this.handleAddCreditCardSuccess,productType:this.getProductType(),saveButtonText:j,showCancelButton:q,text:r,title:s,width:l}));}else return (c('React').createElement(c('P2PMoneypennyCheckoutDialog.react'),{item:this.props.item,leftContentText:w,onChangeCreditCard:this.handleChangeCreditCardClicked,onClose:this.handleCheckoutCancel,onNextClicked:this.handleAddDebitCardClicked,onPurchaseClicked:this.purchase,selectedCreditCard:this.state.selectedCreditCard,showCancelButton:q,showLoading:this.state.loading,width:l}));}});f.exports=o;},null);
__d('MNCommerceAgentItemSuggestionMercuryShareAttachment.react',['MercuryFallbackShareAttachment.react','MercuryShareAttachmentReactShape','MercuryShareAttachmentRenderLocations','MNCommerceAgentItemSuggestionMercuryAttachment.react','P2PActions','P2PMoneypennyCheckoutDialogContainer.react','P2PMoneypennyStore','React','ReactComponentWithPureRenderMixin','StoreAndPropBasedStateMixin'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'MNCommerceAgentItemSuggestionMercuryShareAttachment',mixins:[c('ReactComponentWithPureRenderMixin'),c('StoreAndPropBasedStateMixin')(c('P2PMoneypennyStore'))],propTypes:{attachment:c('MercuryShareAttachmentReactShape'),maxWidth:h.number,location:h.oneOf(c('MercuryShareAttachmentRenderLocations').getValues())},statics:{calculateState:function(j){var k=j.attachment&&j.attachment.target,l=!!(k&&k.payment_id);if(!l){var m=c('P2PMoneypennyStore').getTransferByID(k.id);l=!!(m&&m.payment_id);}return {isItemPurchased:l};}},_handleBuyClick:function(){c('P2PActions').showDialog(c('P2PMoneypennyCheckoutDialogContainer.react'),{item:this._getItem(),onClose:c('P2PActions').hideDialog});},_getItem:function(){var j=this.props.attachment;return j&&j.target;},render:function(){var j=this._getItem();if(!j)return c('React').createElement(c('MercuryFallbackShareAttachment.react'),this.props);return (c('React').createElement(c('MNCommerceAgentItemSuggestionMercuryAttachment.react'),{itemSuggestion:j,isPurchased:this.state.isItemPurchased,location:this.props.location,onBuyClick:this._handleBuyClick,width:this.props.maxWidth}));}});f.exports=i;},null);
__d('OzActions',['Reflux'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={};h.activateThread=c('Reflux').createAction();h.scrollThreadToTimestamp=c('Reflux').createAction();h.doneScrollingToTimestamp=c('Reflux').createAction();h.updateThreads=c('Reflux').createAction();h.maybeUpdateThreads=c('Reflux').createAction();h.clearReassignState=c('Reflux').createAction();h.updateMerchants=c('Reflux').createAction();h.deleteMerchants=c('Reflux').createAction();h.updateWitIntents=c('Reflux').createAction();h.updateReps=c('Reflux').createAction();h.replaceReps=c('Reflux').createAction();h.replaceHumans=c('Reflux').createAction();h.updateRequirements=c('Reflux').createAction();h.showDialog=c('Reflux').createAction();h.hideDialog=c('Reflux').createAction();h.updateComposer=c('Reflux').createAction();h.addBubble=c('Reflux').createAction();h.addAutopilot=c('Reflux').createAction();h.isActive=c('Reflux').createAction();h.isInactive=c('Reflux').createAction();h.sendPulse=c('Reflux').createAction();h.updateQueueFilters=c('Reflux').createAction();h.intentCreator=c('Reflux').createActions(['toggle','select','clear']);h.twilio=c('Reflux').createActions(['connect','endCall','hangUp','incoming','incomingAccept','incomingReject','mute','ready','setup','startCall','unmute','updateIncomingInfo','useIntent','updateRating','dialAgain']);h.twilio.changeTo=c('Reflux').createAction({sync:true});h.twilio.sendDigits=c('Reflux').createAction({sync:true});h.sendMessageStart=c('Reflux').createAction();h.sendMessageFinish=c('Reflux').createAction();h.addHandledEvents=c('Reflux').createAction();h.updateServerOffset=c('Reflux').createAction();h.updateLoadingState=c('Reflux').createAction();f.exports=h;},null);
__d('OzNotify',['cx','immutable','OzImmutablePureRenderMixin','React','ReactCSSTransitionGroup','Reflux','joinClasses'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').OrderedMap,j=c('immutable').Map,k={addNotif:c('Reflux').createAction({sync:true}),removeNotif:c('Reflux').createAction({sync:true})},l=c('Reflux').createStore({init:function(){this.data=i();this.listenTo(k.addNotif,this._onAddNotif);this.listenTo(k.removeNotif,this._onRemoveNotif);},getInitialState:function(){return this.data;},_onAddNotif:function(s){this.data=this.data.set(s.get('id'),s);this.trigger(this.data);},_onRemoveNotif:function(s){this.data=this.data['delete'](s);this.trigger(this.data);}}),m=j({info:"_4nqo",warn:"_4nqp",error:"_4nqq"}),n=c('React').createClass({displayName:'OzNotify',mixins:[c('Reflux').connect(l,'notifs'),c('OzImmutablePureRenderMixin')],render:function(){return (c('React').createElement(c('ReactCSSTransitionGroup'),{component:'div',transitionName:'oz-fade-in-out',className:"_4nqr",transitionEnterTimeout:500,transitionLeaveTimeout:500},this.state.notifs.reverse().map(function(s,t){return (c('React').createElement('div',{key:t,className:c('joinClasses')("_4nqs",m.get(s.get('level')))},s.get('msg'),c('React').createElement('span',{className:"_ok9",onClick:function(){return k.removeNotif(t);}},'×')));}).valueSeq()));}}),o=7000,p=0;function q(s){return function(t){p+=1;k.addNotif(j({id:p,level:s,msg:t}));(function(u){window.setTimeout(function(v){return k.removeNotif(u);},o);})(p);};}var r={Component:n,info:q('info'),warn:q('warn'),error:q('error')};f.exports=r;},null);
__d('OzAPI',['invariant','OzHelpers','OzNotify','Arbiter','ChannelConstants','ChannelManager','immutable','OzActions','OzAJAX','OzConfig','OzStores','promiseFinally','RTISubscriptionManager'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').List,j=c('immutable').Map,k=c('OzAJAX').ajax,l=c('OzAJAX').beacon,m=c('OzAJAX').buildURI,n=c('OzStores').ActiveThreadStore;c('ChannelManager').getConfig;function o(y){if(y.attachment&&!y.attachments)y.attachments=[y.attachment];var z=c('immutable').fromJS(y);return z;}function p(y){return i(y.map(function(z){z=o(z);return [c('OzHelpers').msgID(z),z];})).fromEntrySeq().toMap();}function q(y){if(!y.messages)y.messages=(y['last-events']||[]).map(function(aa){aa.sender=aa.from;return aa;});y.messages=p(y.messages);var z=c('immutable').fromJS(y);return z;}function r(y){return i(y.map(q));}function s(y){var z=r([y]);c('OzActions').updateThreads(z);!(z.count()===1)?h(0):undefined;return z.first();}function t(y){!Number.isSafeInteger(y.offset)?h(0):undefined;!Number.isSafeInteger(y.limit)?h(0):undefined;return k({type:'GET',url:m('threads',c('OzConfig').getStaticConfig('PAGE_ID')),params:y}).then(function(z){var aa=z.threads,ba=r(aa);c('OzActions').updateThreads(ba);return ba;});}function u(y){var z=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],aa=arguments.length<=2||arguments[2]===undefined?{}:arguments[2],ba=arguments.length<=3||arguments[3]===undefined?null:arguments[3];!(typeof y==='string')?h(0):undefined;!(typeof z==='object')?h(0):undefined;var ca,da=false;if(z instanceof FormData){ca=z;}else{ca=JSON.stringify(z);da=true;}var ea={type:'PUT',url:m('sync'),params:{t:y,'intent-id':ba||n.data.get('activeIntent'),page:c('OzConfig').getStaticConfig('PAGE_ID')},body:ca};ea=Object.assign(ea,aa);if(da){ea.headers=ea.headers||{};ea.headers['content-type']='application/json';}c('OzHelpers').info('[sync] '+y,z);return k(ea);}function v(y){return function(z){return u(y,{tid:z}).then(function(aa){var ba=q(aa);c('OzActions').updateThreads(i([ba]));return ba;});};}var w={_witIntentCSV:function(){w.witIntents().done(function(y){var z='data:text/csv;charset=utf-8,';y.forEach(function(aa){return z+='"'+aa.get('name')+'","'+aa.get('id')+'","'+aa.get('doc')+'"\n';});window.open(window.encodeURI(z));});},grab:v('grab'),release:v('release'),ready:v('ready'),notready:v('notready'),ack:v('ack'),lockThread:v('lock-thread'),unlockThread:function(y,z){return u('unlock-thread',{tid:y,'locked-at':z}).then(s);},assignTo:function(y,z){return u('assign-to',{tid:y,id:z});},escalate:function(y){return w.createTag(y,'escalated');},escalateTo:function(y,z){return w.escalate(y).then(function(){return w.assignTo(y,z);});},typing:function(y){return u('rep-typing',{tid:y});},createReminder:function(y,z){return u('create-reminder',babelHelpers['extends']({tid:y},z.toJS())).then(s);},createTask:function(y,z){return u('create-task',{tid:y,task:z.toJS()}).then(s);},completeTask:function(y,z){return u('complete-task',{tid:y,task:z.toJS()}).then(s);},editTask:function(y,z){return u('edit-task',{tid:y,task:z.toJS()}).then(s);},cancelTask:function(y,z){return u('cancel-task',{tid:y,task:z.toJS()}).then(s);},openTask:function(y,z){return u('open-task',{tid:y,task:z.toJS()}).then(s);},closeReminder:function(y,z,aa){return u('close-reminder',{tid:y,id:z,all:aa}).then(s);},editReminder:function(y,z){return u('edit-reminder',{tid:y,reminder:z.toJS()}).then(s);},snoozeReminder:function(y,z){return u('snooze-reminder',{tid:y,id:z}).then(s);},deleteIntentRequirement:function(y,z,aa){return u('delete-intent-requirement',{tid:y,'intent-id':z,'requirement-id':aa}).then(s);},deleteThreadRequirement:function(y,z){return u('delete-thread-requirement',{tid:y,'requirement-id':z}).then(s);},createIntentRequirement:function(y,z,aa){return u('create-intent-requirement',{tid:y,'intent-id':z,'requirement-name':aa}).then(s);},createThreadRequirement:function(y,z){return u('create-thread-requirement',{tid:y,'requirement-name':z}).then(s);},createIntent:function(y,z){return u('create-intent',babelHelpers['extends']({tid:y},z.toJS())).then(s);},openIntent:function(y,z){return u('open-intent',{tid:y,id:z},{},z).then(s);},closeIntent:function(y,z,aa){var ba={tid:y,id:z,'close-state':aa};return u('close-intent',ba,{},z).then(s);},blockIntent:function(y,z){return u('block-intent',{tid:y,id:z}).then(s);},unblockIntent:function(y,z){return u('unblock-intent',{tid:y,id:z}).then(s);},addPhoneNumber:function(y,z){return u('add-phone-number',{tid:y,'intent-id':z},{},z).then(s);},editIntent:function(y,z){return u('edit-intent',babelHelpers['extends']({tid:y},z.toJS()));},createTag:function(y,z){return u('add-thread-tag',{tid:y,tag:z}).then(s);},deleteTag:function(y,z){return u('remove-thread-tag',{tid:y,tag:z}).then(s);},view:v('create-subscription'),unview:v('delete-subscription'),updateMessage:function(y,z){return u('update-message',{tid:y,message:z.toJS()}).then(s);},everstoreUpload:function(y){var z=new FormData();y.forEach(function(aa,ba){return z.append(ba,aa);});return u('everstore-upload',z);},upload:function(y){var z=new FormData();y.forEach(function(aa,ba){return z.append(ba,aa);});return u('upload',z).then(function(aa){return c('immutable').fromJS(aa);});},sendMessage:function(y){var z=u('send',y).then(function(aa){return s({'user-id':y.tid,'last-events':aa});});c('promiseFinally')(z,function(aa){return c('OzActions').sendMessageFinish(y.tid);});window.setTimeout(function(){return c('OzActions').sendMessageStart(y.tid);},200);return z;},scheduleMessage:function(y){return u('schedule-send',y).then(s);},suggest:function(y){return u('suggest',y).then(s);},scheduleSuggest:function(y){return u('schedule-suggest',y).then(s);},deleteScheduled:function(y,z){return u('delete-scheduled',{tid:y,id:z}).then(s);},saveNote:function(y,z){var aa={tid:y,infos:{notes:z}};return u('update-infos',aa).then(s);},saveMeta:function(y,z){var aa={tid:y,infos:{'metadata-json':z.toJS()}};return u('update-infos',aa).then(s);},saveMuted:function(y,z){var aa={tid:y,infos:{muted:z}};return u('update-infos',aa).then(s);},createMerchant:function(y){return u('create-merchant',y.toJS()).then(function(z){var aa=i([j(z)]);c('OzActions').updateMerchants(aa);return aa;});},editMerchant:function(y){return u('edit-merchant',y.toJS()).then(function(z){var aa=i([j(z)]);c('OzActions').updateMerchants(aa);return aa;});},deleteMerchant:function(y){return u('delete-merchant',y.toJS()).then(function(z){if(z&&z.id){var aa=i([z.id]);c('OzActions').deleteMerchants(aa);return aa;}else c('OzHelpers').warn('[api] unexpected delete-merchant response',z);});},sendEmail:function(y){return u('send-email',y.toJS());},sendInvite:function(y){return u('send-calendar',y.toJS());},everstoreURI:function(y){return u('everstore-uri',{handle:y});},witIntents:function(){return k({type:'GET',url:m('wit-intents',c('OzConfig').getStaticConfig('PAGE_ID'))}).then(function(y){var z=c('immutable').fromJS(y);c('OzActions').updateWitIntents(z);return z;});},merchants:function(){return k({type:'GET',url:m('merchants')}).then(function(y){c('OzActions').updateMerchants(i(y).map(function(z){return j(z);}));});},repsSync:function(){return k({type:'GET',url:m('reps-sync')});},requirements:function(){return k({type:'GET',url:m('requirements')}).then(function(y){c('OzActions').updateRequirements(c('immutable').fromJS(y));});},AIModules:function(){return k({type:'GET',url:m('ai-modules')}).then(function(y){return i(y);});},authorFeedback:function(y){return k({type:'GET',url:m('author-feedback'),params:{author_id:y}}).then(function(z){return j(z.map(function(aa){aa=c('immutable').fromJS(aa);return [c('OzHelpers').msgID(aa),aa];}));});},myThreads:function(){var y=c('OzConfig').getStaticConfig('PAGE_ID');return k({type:'GET',params:{page:y},url:m('mythreads')}).then(function(z){var aa=z.mythreads;c('OzActions').updateThreads(r(aa));});},allThreads:function(y,z,aa,ba){var ca={all:true,first_tags:y.toJS(),last_tags:z.toJS(),offset:aa,limit:ba};if(y.has('ready')){y=y['delete']('ready');ca.ready=true;}else if(z.has('ready')){z=z['delete']('ready');ca.ready=false;}return t(ca);},thread:function(y){return k({type:'GET',url:m('threads',c('OzConfig').getStaticConfig('PAGE_ID'),y)}).then(s);},handledEvents:function(y){return k({type:'GET',params:{'intent-id':y},url:m('handled-events')}).then(function(z){c('OzActions').addHandledEvents(c('immutable').fromJS(z['handled-events']));});},history:function(y,z,aa){return k({type:'GET',params:{timestamp:z,limit:aa},url:m('threads',c('OzConfig').getStaticConfig('PAGE_ID'),y,'history')}).then(function(ba){var ca=s({'user-id':y,messages:ba});return ca.get('messages');});},topIntents:function(){return k({type:'GET',url:m('top-intents')}).then(function(y){return c('immutable').fromJS(y);});},intentsDashboard:function(y){return k({type:'GET',params:y,url:m('dashboard','intent',c('OzConfig').getStaticConfig('PAGE_ID'))}).then(function(z){return c('immutable').fromJS(z);});},aiDashboard:function(y){return k({type:'GET',params:y,url:m('dashboard','ai',c('OzConfig').getStaticConfig('PAGE_ID'))}).then(function(z){return c('immutable').fromJS(z);});},statsDashboard:function(y){return k({type:'GET',params:y,url:m('dashboard','trainer',y['trainer-id'])}).then(function(z){return c('immutable').fromJS(z);});},teamStatsDashboard:function(y){return k({type:'GET',params:y,url:m('dashboard','trainer-team-stats')}).then(function(z){return c('immutable').fromJS(z);});},humans:function(){return k({type:'GET',url:m('humans')}).then(function(y){return c('OzActions').replaceHumans(c('immutable').fromJS(y));});},search:function(y){return k({params:y,type:'GET',url:m('search')}).then(function(z){return c('immutable').fromJS(z).flatten(true);});},requestAutopilot:function(y){window.postMessage(y,'*');},notifyExtension:function(y){c('OzHelpers').debug('[oz-ext] notifying toto',y);window.postMessage(babelHelpers['extends']({type:'notification'},{data:y}),'*');},recordActivity:function(y,z){return u('activity',babelHelpers['extends']({tid:y},{activity:z}));},sendPulse:function(y,z){return k({type:'POST',url:m('pulse'),headers:{'content-type':'application/json'},params:{page:c('OzConfig').getStaticConfig('PAGE_ID'),duration:y},body:JSON.stringify(z)});},sendDisconnectPulse:function(y,z){return l({url:m('pulse'),params:{page:c('OzConfig').getStaticConfig('PAGE_ID'),duration:y},body:JSON.stringify(z)});},threadFocus:function(y,z){return u('thread-focus',babelHelpers['extends']({tid:y},{intentID:z}));},away:function(y){return u('away',{away:y});},coachMode:function(y){return u('coach-mode',{'coach-mode':y});},timestamp:function(){var y=Date.now();return k({type:'POST',url:m('timestamp')}).then(function(z){var aa=z.timestamp,ba=Date.now();if(ba-y>1000){c('OzHelpers').warn('[oz-api] timestamp took over 1 second, not updating offset');}else{var ca=ba-(aa+(ba-y)/2);c('OzActions').updateServerOffset({offsetMs:ca});}});},init:function(){return k({type:'GET',url:m('init')}).then(function(y){y['twilio-token']&&c('OzActions').twilio.setup(y['twilio-token']);c('OzConfig').updateConfig(c('immutable').fromJS(y));});},realTime:function(y,z){var aa,ba=60000,ca=function(){var ha=Date.now();clearInterval(aa);aa=setInterval(function(ia){var ja=Math.round((Date.now()-ha)/1000);c('OzHelpers').warn('[rti] no payload in '+ja+'seconds');c('OzNotify').warn('We have not received anything from the server in '+ja+'           seconds. You may want to refresh the page.');},ba);},da={repsVersion:-1},ea=function(ha,ia){var ja=ia.payload,ka=ia.topic;!(ha==='sky'||ha==='msg')?h(0):undefined;ca();var la,ma,na=ha==='sky'?ha+' '+ka+' ->':ha,oa=ja.type,pa=oa||'';c('OzHelpers').debug('[rti] '+na+' '+pa,ja);if(!ja.data){c('OzHelpers').error('[sky] got sky event without data',ja,ka);return;}ma=ja.data['page-id'];if(ma&&ma!==c('OzConfig').getStaticConfig('PAGE_ID')){c('OzHelpers').debug('[sky] junk event on '+ka,ja);return;}switch(oa){case 'thread':la=ja.data;s(la);break;case 'maybe-thread':la=ja.data;c('OzActions').maybeUpdateThreads(r([la]));break;case 'delivered':case 'seen':la=ja.data;s({'user-id':la['user-id'],'last-seen':la['last-seen']});break;case 'presence':la=ja.data;s({'user-id':la['user-id'],'last-presence':la['last-presence']});break;case 'carebear':(function(){var qa=ja.data,ra=qa.type,sa=qa.tid,ta={'user-id':sa};ta['ui-'+ra]=true;s(ta);})();break;case 'inactive':c('OzActions').isInactive();break;case 'updated-merchant':c('OzActions').updateMerchants(i([j(ja.data)]));break;case 'deleted-merchant':c('OzActions').deleteMerchants(i([ja.data.id]));break;case 'phone-call':c('OzActions').twilio.updateIncomingInfo(c('immutable').fromJS(ja.data));break;case 'humans':c('OzActions').replaceHumans(c('immutable').fromJS(ja.data));break;case 'reps-sync':da=babelHelpers['extends']({},da,{repsVersion:ja.version});c('OzActions').replaceReps(c('immutable').fromJS(ja.data));break;case 'reps-diff':if(da.repsVersion!==ja.version-1){c('OzHelpers').warn('[api] reps version out of sync',{'our-version':da.repsVersion,'next-version':ja.version});da=babelHelpers['extends']({},da,{repsVersion:-1});w.repsSync();}else{da.repsVersion=ja.version;c('OzActions').updateReps(c('immutable').fromJS(ja.data));}break;case 'handled-events':c('OzActions').addHandledEvents(c('immutable').fromJS(ja.data));break;case 'config':c('OzConfig').updateConfig(c('immutable').fromJS(ja.data));break;default:c('OzHelpers').debug('[sky] unk type',oa,ja);}},fa=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('msg'),function(ha,ia){ea('msg',ia.obj);}),ga=x(function(){c('Arbiter').unsubscribe(fa);c('RTISubscriptionManager').unsubscribeAll();});c('RTISubscriptionManager').subscribe(y,ea.bind(this,'sky'),null,x(function(ha){var ia=ha.data,ja=ha.error;if(ja){ga();z(ja,ia);}else{ca();z(null,ia,fa);}}));return ga;}};function x(y){var z,aa,ba=this;return function(){if(!z){aa=y.apply(ba,arguments);z=true;}return aa;};}f.exports=w;},null);
__d('OzHelpers',['BanzaiScuba','DatePickerRestraints','ErrorUtils','getURLRanges','immutable','LogHistory','OzConstants','OzImmutablePureRenderMixin','React','URI','OzConfig','OzServerTime'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('immutable').List,i=c('immutable').Map,j=c('immutable').Set,k=c('immutable').OrderedMap,l=c('OzConstants').AUTHOR_TYPES,m=c('OzConstants').REMINDERS,n=/^image\//,o={blobURI:function(y){return window.URL.createObjectURL(y);},blobFromDataURI:function(y){var z=y.split(','),aa=atob(z[1]),ba=z[0].split(':')[1].split(';')[0],ca=new ArrayBuffer(aa.length),da=new Uint8Array(ca);for(var ea=0;ea<aa.length;ea++)da[ea]=aa.charCodeAt(ea);return new Blob([ca],{type:ba});},toLocaleDate:function(y){return new Date(y).toLocaleDateString();},toLocaleTime:function(y){return new Date(y).toLocaleTimeString();},hasCmdOrCtrl:function(y){return y.getModifierState('Meta')||y.getModifierState('Control');},keysIn:function(){var y=j(arguments);return function(z,aa){return y.has(aa);};},safeParse:function(y){var z={};try{z=JSON.parse(y);}catch(aa){o.info('invalid json',y);}return z;},safeURI:function(y){var z=null;try{z=c('URI').isValidURI(y)&&new (c('URI'))(y)||null;}catch(aa){o.info('invalid uri',y);}return z;},pure:r,memoize:s,values:function(y){return Object.keys(y).map(function(z){return y[z];});},debug:u('debug',false),info:u('info',true),warn:u('warn',true),error:u('error',true),isImageType:function(y){return n.test(y);},dateRestraints:t,threadID:function(y){return y.get('user-id');},isNew:function(y){return !o.intents(y).find(o.isClosedIntent);},hasOwner:function(y){return y.getIn(['owner','id']);},hasAllTags:function(y,z){return z.every(function(aa){return o.hasTag(y,aa);});},hasSomeTag:function(y,z){return z.some(function(aa){return o.hasTag(y,aa);});},hasTag:function(y,z){return y.get('tags')&&y.get('tags').contains(z);},isEscalated:function(y){return o.hasTag(y,'escalated');},hasEngage:function(y){return !!y.get('engagement-type');},photo:function(y){return y.getIn(['user-vcard','photo'])||y.getIn(['user-vcard','picture']);},compareNums:function(y,z){if(y&&z){return z-y;}else if(y){return -1;}else if(z){return 1;}else return 0;},compareBools:function(y,z){if(y&&z){return 0;}else if(y){return -1;}else if(z)return 1;},getIncomingThreads:function(y){return y.filter(function(z){return z.get('ready')&&!o.hasOwner(z);}).sort(o.threadComparator);},threadComparator:function(y,z){var aa=o.compareBools(o.hasTag(y,'vip'),o.hasTag(z,'vip')),ba=o.compareBools(o.hasTag(y,'urgent'),o.hasTag(z,'urgent')),ca=o.compareNums(o.urgentReminders(y).getIn([0,'scheduled-time']),o.urgentReminders(z).getIn([0,'scheduled-time'])),da=o.compareNums(y.get('last-event-at'),z.get('last-event-at'));return (aa||ba||ca||da);},lastEvents:function(y){return y.get('last-events',h()).sortBy(function(z){return z.get('timestamp');});},lastUserMessage:function(y){var z=o.lastEvents(y).reverse();return z.find(function(aa){return o.authorType(aa)===l.USER;})||z.first();},shortDesc:function(y){var z=y.getIn(['attachments',0,'mime_type']),aa=y.getIn(['attachments',0,'sticker_id']);return y.get('text')||aa&&'sent a sticker.'||z&&(z.match(/video/i)&&'sent a video.'||z.match(/audio/i)&&'sent an audio clip.'||z.match(/image/i)&&'sent an image');},preferredName:function(y){return (y.getIn(['metadata-json','preferred-name'])||y.getIn(['user-vcard','first-name']));},userEmail:function(y){return (y.getIn(['metadata-json','email']));},intents:function(y){return y.get('intents',h()).sortBy(function(z){return z.get('created-at');});},isOwner:function(y,z){var aa=y.getIn(['owner','id']);return aa&&z&&aa==z;},wasOwner:function(y,z){var aa=y.getIn(['last-owner','id']);return aa&&z&&aa==z;},isLocker:function(y,z){return y.get('locked')&&y.get('locker-id')===z;},nameOrId:function(y){return y&&(y.get('name')||y.get('id'))||'';},isSubscriber:function(y,z){return !!y.get('subscriptions',h()).find(function(aa){return aa===z;});},hasUnblockedIntents:function(y){return y.get('intents',h()).some(function(z){return !o.isBlockedIntent(z);});},hasOpenIntents:function(y){return y.get('intents',h()).some(function(z){return o.isOpenIntent(z);});},openIntents:function(y){return o.intents(y).filter(o.isOpenIntent);},closedIntents:function(y){return o.intents(y).filterNot(o.isOpenIntent);},isBlockedIntent:function(y){return y.get('blocked');},intentName:function(y){return y.get('name')||'Unknown intent';},isOpenIntent:function(y){return y.get('state')==='open';},isClosedIntent:function(y){var z=y.get('state');return z!=='open'&&z!=='deleted';},getName:function(y){return y.getIn(['user-vcard','name'],'Unknown user');},lastPresence:function(y){return Math.max(y.get('last-seen')||0,y.get('last-presence')||0);},timeSpent:function(y){if(y.get('ready')&&y.get('last-ready-at'))return o.serverNow()-y.get('last-ready-at');},locationLastSeen:function(y){if(y.getIn(['location','last-seen']))return new Date(y.getIn(['location','last-seen']));},serverNow:function(){return c('OzServerTime').serverNow();},repName:function(y,z){var aa=z.get(y);return aa&&aa.get('name')||y||null;},authorType:function(y){var z=l.BOT,aa=l.USER,ba=l.TRAINER,ca=y.get('sender')||y.get('from'),da=y.get('author-type');return (da===z&&z||(da===ba||ca===c('OzConfig').getStaticConfig('PAGE_ID'))&&ba||aa);},msgID:function(y){return y.get('offline-threading-id')||y.get('mid')||o.warn('[msgID] had to resort to timestamp',y)&&null||y.get('timestamp');},isActivePulse:function(y){var z=y&&y.get('pulse-data');if(!z)return false;return !z.get('away?')&&z.get('inactive-ms',Infinity)<30000;},urgentReminders:function(y){return y.get('reminders',h()).sortBy(function(z){return z.get('scheduled-time');}).filter(o.isUrgentReminder);},paidReminders:function(y){return o.urgentReminders(y).filter(o.isPaidReminder);},isUrgentReminder:function(y){var z=y.get('state');return z==='active'||z==='active-snoozed';},isPaidReminder:function(y){return !!y.getIn(['body','suggestion']);},isSnoozedReminder:function(y){var z=y.get('state');return z==='snoozed'||z==='active-snoozed';},isUrgentTask:function(y){var z=y.get('state');return z==='dispatched'&&y.get('deadline')<o.serverNow();},isPaidTask:function(y){return !!y.getIn(['data','suggestion']);},isClosedTask:function(y){return j(['completed','canceled']).contains(y.get('state'));},isUnread:function(y){return y.get('read-state')==='unread';},hasPaid:function(y){return !!o.paidReminders(y).size;},hasReminder:function(y){return !!o.urgentReminders(y).size;},minAge:function(y){var z=+y.getIn(['user-vcard','age-range','min']);return Number.isSafeInteger(z)?z:0;},shimURI:function(y){return new (c('URI'))('https://l.facebook.com/l.php').setQueryData({u:y,h:c('OzConfig').getStaticConfig('shimhash')}).toString();},uiSuggestion:function(y){var z=y.has('amount')?'$'+(y.get('amount')/100).toFixed(2):'';return {id:y.get('item-id')||'-1',name:y.get('name'),desc:y.get('description'),thumb_url:y.get('thumb-url'),merchant_name:y.get('merchant-name')||'',total_cost:y.get('amount')?i({amount:y.get('amount')}):null,display_total_cost:z,target_url:o.shimURI(y.get('target-url')),payment_id:y.get('payment-id'),expiration_time:y.get('expiration-time')};},parsePhoneNumber:function(y){if(!y)return '';if(y.length==12&&y[0]=='+')y=y.substr(1);if(y.length==11&&y[0]=='1')y=y.substr(1);switch(y.length){case 10:return '('+y.substr(0,3)+') '+y.substr(3,3)+'-'+y.substr(6,4);case 7:return y.substr(0,3)+'-'+y.substr(3,4);default:return y;}},validateURL:function(y){return (!!y&&typeof y==='string'&&c('getURLRanges')(y).length&&c('URI').isValidURI(y));},normalizeMerchant:function(y){return y.updateIn(['website'],function(z){if(!z)return z;var aa=c('getURLRanges')(z);if(!aa||aa.length===0)return z;return aa[0].entity.url;}).updateIn(['page-id'],function(z){if(Number.isFinite(z)||typeof z==='string')return parseInt(z,10);return null;});},validateMerchant:function(y){var z=j(['name-dba','country']),aa=j(['address','website','page-id']),ba={},ca=y.get('website','');if(ca&&!this.validateURL(ca))ba.website='Website is an invalid URL';var da=y.get('page-id',null);if(da!=null&&!Number.isFinite(da))ba['page-id']='FB Page must be a number';z.map(function(fa){if(!y.get(fa))ba[fa]='This field is required';});if(j(y.filter(function(fa){return fa;}).keys()).intersect(aa).isEmpty()){var ea='At least one of '+aa.join(', ')+' is required';aa.forEach(function(fa){ba[fa]=ea;});}return i(ba);},isDaytime:function(y){var z=(Date.now()+y)%(24*60*60*1000),aa=z/(60*60*1000);return aa>=6;},fullThreadData:function(y,z,aa){var ba=y.get(aa);if(!ba)return null;return ba.update('intents',function(ca){return ca.map(function(da){var ea=p(z,da),fa=q(ba,ea);return fa;});});},threadPath:function(y){var z=y.threadid,aa=y.intentid,ba=y.taskid,ca=aa?'/intent/'+aa:'',da=ba?'/task/'+ba:'';return '/inbox/'+z+ca+da;},updateInWhen:function(y,z,aa){var ba={};if(y.getIn(z,ba)!==ba)return y.updateIn(z,aa);return y;}};function p(y,z){var aa=y.getIn(['byIntent',z.get('id')],i());return z.set('events',aa);}function q(y,z){var aa=y.getIn(['tasks-by-intent',z.get('id')]);return z.set('tasks',aa);}function r(y){var z=arguments.length<=1||arguments[1]===undefined?'OzPureComponent':arguments[1];return (c('React').createClass({displayName:z,mixins:[c('OzImmutablePureRenderMixin')],render:function(){return y(this.props);}}));}function s(y,z){var aa=arguments.length<=2||arguments[2]===undefined?1000:arguments[2],ba=k();return function(){for(var ca=arguments.length,da=Array(ca),ea=0;ea<ca;ea++)da[ea]=arguments[ea];var fa=z.apply(this,da);if(ba.get(fa)){return ba.get(fa);}else{var ga=y.apply(this,da);ba=ba.set(fa,ga).takeLast(aa);return ga;}}.bind(this);}function t(){var y=new Date(),z=new Date(Date.UTC(y.getFullYear(),y.getMonth(),y.getDate())),aa=new Date(+z);aa.setFullYear(z.getFullYear()+m.RANGE_IN_YEARS);return {dateRestraints:[c('DatePickerRestraints').enforceDateIsNoEarlierThan(z),c('DatePickerRestraints').enforceDateIsNoLaterThan(aa)]};}c('ErrorUtils').addListener(function(y){var z=x({level:'error',message:'[unhandled-error]['+y.name+'] '+y.message,data:'--stack\n'+y.stack+'\n\n--originalError\n'+y._originalError});w(z);v(z);});function u(y,z){return function(){for(var aa=arguments.length,ba=Array(aa),ca=0;ca<aa;ca++)ba[ca]=arguments[ca];var da=ba[0],ea=ba.slice(1);window.console.log(y,da,ea);var fa=x({level:y,message:da,data:ea});w(fa);z&&v(fa);};}function v(y){var z=new (c('BanzaiScuba'))(c('OzConfig').getStaticConfig('scubaCategory'));Object.entries(y).forEach(function(aa){var ba=aa[0],ca=aa[1];Number.isSafeInteger(ca)?z.addInteger(ba,ca):z.addNormal(ba,ca);});z.post();}function w(y){var z=c('LogHistory').getInstance('oz-logger');(z[y.level]||z.debug).call(z,y.message,'');}function x(y){return babelHelpers['extends']({},y,{uid:c('OzConfig').getStaticConfig('uid'),public_name:c('OzConfig').getStaticConfig('publicName'),rev:c('OzConfig').getStaticConfig('rev'),timestamp:o.serverNow()});}f.exports=o;},null);
__d('OzStores',['invariant','OzHelpers','immutable','OzActions','Reflux'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').List,j=c('immutable').Map,k=c('immutable').OrderedMap,l=c('immutable').OrderedSet,m=c('immutable').Set,n=c('Reflux').createStore({init:function(){this.data=j();this.listenTo(c('OzActions').updateRequirements,this._onUpdateRequirements);},getInitialState:function(){return this.data;},_onUpdateRequirements:function(ja){this.data=this.data.withMutations(function(ka){ja.forEach(function(la){var ma=la.get('name'),na=ka.get(ma,j()).merge(la).update('wit-intent-uuids',function(oa){return oa&&oa.toSet()||m();});ka.set(ma,na);});});c('OzHelpers').debug('[oz] updated RequirementStore');this.trigger(this.data);}}),o=c('Reflux').createStore({init:function(){this.data=l();this.listenTo(c('OzActions').addBubble,this._onAddBubble);},getInitialState:function(){return this.data;},_onAddBubble:function(ja){!j.isMap(ja)?h(0):undefined;this.data=this.data.add(ja).takeLast(100);this.trigger(this.data);}}),p=c('Reflux').createStore({init:function(){this.data=k();this.listenTo(c('OzActions').addAutopilot,this._onAddAutopilot);},getInitialState:function(){return this.data;},_onAddAutopilot:function(ja){!j.isMap(ja)?h(0):undefined;this.data=this.data.set(ja.get('id'),ja.get('data')).takeLast(100);this.trigger(this.data);}}),q='id',r=c('Reflux').createStore({init:function(){this.data=j();this.listenTo(c('OzActions').updateWitIntents,this._onUpdateWitIntents);},getInitialState:function(){return this.data;},_onUpdateWitIntents:function(ja){!c('immutable').List.isList(ja)?h(0):undefined;this.data=this.data.withMutations(function(ka){return ja.reduce(function(la,ma){return la.set(ma.get(q),ma);},ka);});this.trigger(this.data);}}),s=c('Reflux').createStore({init:function(){this.data=j();this.listenTo(c('OzActions').activateThread,this._onActivateThread);},getInitialState:function(){return this.data;},_onActivateThread:function(ja){var ka=ja.threadID,la=ja.intentID,ma=ja.taskID;c('OzHelpers').info('[store/activeThread] set active thread: ',{threadID:ka,intentID:la,taskID:ma});this.data=this.data.set('oldThreadID',this.data.get('threadID')).set('threadID',ka).set('activeIntent',la).set('activeTask',ma);this.trigger(this.data);}}),t='user-id',u=function(ja,ka){!(j.isMap(ja)&&j.isMap(ka))?h(0):undefined;var la=ja.reduce(function(ma,na,oa){ma[na.get('offline-threading-id')]=na;return ma;},{});return ja.withMutations(function(ma){return ka.valueSeq().filterNot(function(na){var oa=na.get('attachments');if(oa)return oa.first()&&oa.first().getIn(['xma','body'])===null;return false;}).reduce(function(na,oa){var pa=oa.get('offline-threading-id'),qa=pa&&la[pa]||na.get(c('OzHelpers').msgID(oa));if(qa){na=na['delete'](c('OzHelpers').msgID(qa));oa=qa.merge(oa);}return na.set(c('OzHelpers').msgID(oa),oa);},ma);});},v=function(ja,ka,la){if(la==='messages'){return u(ja,ka);}else return ka;},w=function(ja){return ja.set('tasks-by-intent',ja.get('tasks',i()).groupBy(function(ka){return ka.get('intent-id');}));},x=function(ja){!(typeof ja==='function')?h(0):undefined;return function(ka,la){!(j.isMap(la)&&j.isMap(ka))?h(0):undefined;var ma=la.get(t),na=ka.get(ma,j()),oa=na.mergeWith(ja,la),pa=w(oa);return ka.set(ma,pa);};},y=c('Reflux').createStore({init:function(){this.data=j();this.updatedAt=Date.now();this.listenTo(c('OzActions').updateThreads,this._onUpdateThreads);this.listenTo(c('OzActions').maybeUpdateThreads,this._onMaybeUpdateThreads);this.listenTo(c('OzActions').clearReassignState,this._onClearReassignState);},getInitialState:function(){return this.data;},_onUpdateThreads:function(ja){!i.isList(ja)?h(0):undefined;this.data=this.data.withMutations(function(ka){return ja.reduce(x(v),ka);});this.updatedAt=Date.now();this.trigger(this.data);},_onMaybeUpdateThreads:function(ja){!i.isList(ja)?h(0):undefined;var ka=ja.filter(function(la){return this.data.has(la.get(t));}.bind(this));if(ka.isEmpty()){c('OzHelpers').debug('[threads] not updating partial threads');return;}this.data=this.data.withMutations(function(la){return ka.reduce(x(v),la);});this.updatedAt=Date.now();this.trigger(this.data);},_onClearReassignState:function(){this.data=this.data.map(function(ja){return (ja.get('ui-reassign')?ja['delete']('ui-reassign'):ja);});this.trigger(this.data);}}),z=c('Reflux').createStore({init:function(){this.data=this._make(null,null);this.listenTo(c('OzActions').showDialog,this._onShowDialog);this.listenTo(c('OzActions').hideDialog,this._onHideDialog);},getInitialState:function(){return this.data;},_make:function(ja,ka){return {dialogClass:ja,dialogProps:ka};},_onShowDialog:function(ja,ka){this.data=this._make(ja,ka);this.trigger(this.data);},_onHideDialog:function(){this.data=this._make(null,null);this.trigger(this.data);}}),aa=c('Reflux').createStore({init:function(){this.data=j();this.listenTo(c('OzActions').updateMerchants,this._onUpdateMerchants);this.listenTo(c('OzActions').deleteMerchants,this._onDeleteMerchants);},getInitialState:function(){return this.data;},_onUpdateMerchants:function(ja){!i.isList(ja)?h(0):undefined;this.data=this.data.withMutations(function(ka){return ja.reduce(function(la,ma){var na=ma.get('id'),oa=la.get(na,j()).merge(ma);return la.set(na,oa);},ka);});c('OzHelpers').debug('[oz] updated merchants',this.data.toJS());this.trigger(this.data);},_onDeleteMerchants:function(ja){!i.isList(ja)?h(0):undefined;this.data=ja.reduce(function(ka,la){return ka['delete'](la);},this.data);c('OzHelpers').debug('[oz] deleted merchants',this.data.toJS());this.trigger(this.data);}}),ba=c('Reflux').createStore({init:function(){this.data=j();this.listenTo(c('OzActions').updateReps,this._onUpdateReps);this.listenTo(c('OzActions').replaceReps,this._onReplaceReps);},getInitialState:function(){return this.data;},_onReplaceReps:function(ja){this.data=j().withMutations(function(ka){ja.reduce(function(la,ma){return la.set(ma.get('fbid'),ma);},ka);});this.trigger(this.data);},_onUpdateReps:function(ja){this.data=this.data.withMutations(function(ka){return ja.reduce(function(la,ma){return la.mergeIn([ma.get('fbid')],ma);},ka);});this.trigger(this.data);}}),ca=c('Reflux').createStore({init:function(){this.data=j();this.listenTo(c('OzActions').replaceHumans,this._onReplace);},getInitialState:function(){return this.data;},_onReplace:function(ja){this.data=ja;this.trigger(this.data);}}),da=c('Reflux').createStore({init:function(){this.data=j({queue:j({showTags:m(),hideTags:m()}),all:j({showTags:m(),hideTags:m()})});this.listenTo(c('OzActions').updateQueueFilters,this._onUpdateFilters);},getInitialState:function(){return this.data;},_onUpdateFilters:function(ja){this.data=this.data.merge(ja);this.trigger(this.data);}}),ea=c('Reflux').createStore({init:function(){this._data=j();this.listenTo(c('OzActions').sendMessageStart,this._onShiftSending.bind(this,1));this.listenTo(c('OzActions').sendMessageFinish,this._onShiftSending.bind(this,-1));},getInitialState:function(){return this._data;},_onShiftSending:function(ja,ka){this._data=this._data.update(ka,function(la){return (la||0)+ja;});this.trigger(this._data);}}),fa=c('Reflux').createStore({init:function(){this.data=j({byIntent:j(),byThread:j(),byId:j()});this.listenTo(c('OzActions').addHandledEvents,this._onAddHandledEvents);},getInitialState:function(){return this.data;},_onAddHandledEvents:function(ja){this.data=this.data.withMutations(function(ka){ja.reduce(function(la,ma){return (la.setIn(['byIntent',ma.get('intent-id'),ma.get('id')],ma).setIn(['byId',ma.get('id')],ma));},ka);});this.trigger(this.data);}}),ga=c('Reflux').createStore({init:function(){this.data=j({offsetMs:0});this.listenTo(c('OzActions').updateServerOffset,this._onUpdateServerOffset);},getInitialState:function(){return this.offsetMs;},_onUpdateServerOffset:function(ja){var ka=ja.offsetMs;this.data=this.data.set('offsetMs',ka);this.trigger(this.data);}}),ha=j({state:'loading',error:null,result:null,skip:false}),ia=c('Reflux').createStore({init:function(){this.data=j({'api-init':ha,skywalker:ha});this.listenTo(c('OzActions').updateLoadingState,this._onUpdateLoadingState);},getInitialState:function(){return this.data;},_onUpdateLoadingState:function(ja){var ka=ja.component,la=ja.state,ma=ja.error,na=ja.result,oa=ja.skip;this.data=this.data.set(ka,j({state:la,error:ma,result:na,skip:oa}));this.trigger(this.data);}});f.exports={ActiveThreadStore:s,BubbleStore:o,DialogStore:z,MerchantStore:aa,AutopilotStore:p,QueueFilterStore:da,RepStore:ba,HumanStore:ca,LoadingStore:ia,RequirementStore:n,ThreadStore:y,WitIntentStore:r,PendingMessageStateStore:ea,HandledEventsStore:fa,ServerOffsetStore:ga};},null);
__d('OzAJAX',['invariant','Promise','OzHelpers','OzNotify','OzConfig','URI'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={ajax:function(m){var n=m.type,o=m.headers,p=m.params,q=m.body,r=m.url;p=k(p);var s={type:n,url:r,headers:o,params:p,body:q};return j(s).then(function(t){return JSON.parse(t.responseText);},function(t){var u;try{u=JSON.parse(t.responseText);}catch(v){}l(u||{},t,s);throw u||t;});},beacon:function(m){!(window.navigator&&window.navigator.sendBeacon)?h(0):undefined;var n=m.params,o=m.body,p=m.url;n=k(n);return window.navigator.sendBeacon(new (c('URI'))(p).addQueryData(n).toString(),new Blob([o],{type:'application/json'}));},buildURI:function(){var m=c('OzConfig').getStaticConfig('API_PATH');!m?h(0):undefined;for(var n=arguments.length,o=Array(n),p=0;p<n;p++)o[p]=arguments[p];return [m].concat(o).join('/');}};function j(m){var n=m.type,o=m.headers,p=m.params,q=m.body,r=m.url;return new (c('Promise'))(function(s,t){var u=new XMLHttpRequest(),v=new (c('URI'))(r);if(p)v.addQueryData(p);u.open(n,v.toString(),true);if(o)for(var w=Object.keys(o),x=Array.isArray(w),y=0,w=x?w:w[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var z;if(x){if(y>=w.length)break;z=w[y++];}else{y=w.next();if(y.done)break;z=y.value;}var aa=z;u.setRequestHeader(aa,o[aa]);}u.onreadystatechange=function(){if(u.readyState!==4)return;if(u.status===200){s(u);}else t(u);};u.send(q);});}function k(m){!c('OzConfig').getStaticConfig('authToken')?h(0):undefined;!c('OzConfig').getStaticConfig('uid')?h(0):undefined;!c('OzConfig').getStaticConfig('API_VERSION')?h(0):undefined;return babelHelpers['extends']({xs:c('OzConfig').getStaticConfig('authToken'),c_user:c('OzConfig').getStaticConfig('uid'),rep_name:c('OzConfig').getStaticConfig('fullName'),v:c('OzConfig').getStaticConfig('API_VERSION')},m);}function l(m,n,o){c('OzHelpers').error('[oz-api] backend rejected',m,n,o);var p=m.error||'Something went wrong, the team has been notified already.';if(m.info){c('OzNotify').info(p);}else if(n.status===400){c('OzNotify').warn(p);}else if(n.status===0){c('OzNotify').error('Something went wrong. If this continues, please contact the Wit oncall');}else c('OzNotify').error(p);}f.exports=i;},null);
__d('OzEditorStateHelpers',['ContentState','OzHelpers','DraftModifier','EditorState','UnicodeUtils'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(s,t){var u=c('ContentState').createFromText(t),v=c('EditorState').push(s,u,'remove-range');v=c('EditorState').forceSelection(v,v.getSelection());return v;}function i(s){var t=s.getCurrentContent().getBlockMap(),u=s.getSelection().getStartKey();return t.get(u);}function j(s,t){return s.getCurrentContent().getPlainText().indexOf(t)>=0;}function k(s){var t=q(s,function(u){var v=u.getSelection();if(v.getStartOffset()===0)return r(u,1);var w=i(u).getText().length;return v.merge({anchorOffset:w,focusOffset:0,isBackward:true});},'backward');if(t===s.getCurrentContent())return s;return c('EditorState').push(s,t,'remove-range');}function l(s,t){var u=s.getCurrentContent(),v=i(s).getText(),w=s.getSelection().merge({anchorOffset:0,focusOffset:v.length}),x=c('DraftModifier').replaceText(u,w,t);c('OzHelpers').debug('[replaceLine]',t,v,x.getPlainText());if(x===u)return s;return c('EditorState').push(s,x,'remove-range');}function m(s,t){var u=s.getCurrentContent(),v=c('DraftModifier').insertText(u,u.getSelectionAfter(),t);if(v===u)return s;return c('EditorState').push(s,v,'insert-characters');}function n(s,t){var u=i(s).getText(),v=u.length;if(v===0)return false;t=Math.min(t,v-1);return u[t];}function o(s,t){var u=s.getSelection().merge({focusOffset:t,anchorOffset:t});return c('EditorState').forceSelection(s,u);}function p(s,t){var u=q(s,function(w){var x=w.getSelection(),y=w.getCurrentContent(),z=x.getAnchorKey(),aa=x.getAnchorOffset(),ba=y.getBlockForKey(z).getText().slice(aa-t,aa);return r(w,ba?c('UnicodeUtils').strlen(ba):1);},'backward');if(u===s.getCurrentContent())return s;u=u.set('selectionBefore',s.getSelection());var v=s.getSelection().isCollapsed()?'backspace-character':'remove-range';return c('EditorState').push(s,u,v);}function q(s,t,u){var v=s.getSelection(),w=s.getCurrentContent(),x=v;if(v.isCollapsed()){if(u==='forward'){if(s.isSelectionAtEndOfContent())return w;}else if(s.isSelectionAtStartOfContent())return w;x=t(s);if(x===v)return w;}return c('DraftModifier').removeRange(w,x,u);}function r(s,t){var u=s.getSelection(),v=s.getCurrentContent(),w=u.getStartKey(),x=u.getStartOffset(),y=w,z=0;if(t>x){var aa=v.getKeyBefore(w);if(aa==null){y=w;}else{y=aa;var ba=v.getBlockForKey(aa);z=ba.getText().length;}}else z=x-t;return u.merge({focusKey:y,focusOffset:z,isBackward:true});}f.exports={append:m,backspaceTimes:p,charAt:n,currentBlock:i,deleteCurrentLine:k,editorStateHas:j,forceCollapsedSelection:o,replaceContentWithText:h,replaceLine:l};},null);
__d('OzHistory',['invariant','immutable'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').List,j=c('immutable').OrderedMap,k='oz-history',l=10,m=100;function n(){return j(JSON.parse(localStorage.getItem(k)||'{}')).map(function(s){return i(s);});}function o(s){!j.isOrderedMap(s)?h(0):undefined;return localStorage.setItem(k,JSON.stringify(s));}function p(s){var t=n();if(t.has(s))return;o(t.set(s,[]).takeLast(l));}function q(s){var t={},u={items:function(){if(!t.items)t.items=n().get(s);return t.items;},persist:function(v){!i.isList(v)?h(0):undefined;o(n().set(s,v));t.items=v;u.resetPos();},resetPos:function(){t.pos=u.items().size;},pos:function(){if(!Number.isSafeInteger(t.pos))u.resetPos();return t.pos;},dec:function(){t.pos=Math.max(u.pos()-1,0);},inc:function(){t.pos=Math.min(u.pos()+1,u.items().size);},val:function(){return u.items().get(u.pos());}};return u;}function r(s){p(s);var t=q(s);return {up:function(){t.dec();return t.val();},down:function(){t.inc();return t.val();},push:function(v){var w=t.items();if(!v||w.last()===v)return;t.persist(w.push(v).takeLast(m));}};}f.exports=r;},null);
__d('OzHumans',['OzHelpers'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=60000,i=45000,j=-1;function k(s){return s.get('coach-mode?');}function l(s){return s.get('is-coach');}function m(s){return s.get('away?');}function n(s){return s&&!m(s)&&c('OzHelpers').serverNow()-s.get('at',0)<i;}function o(s){return n(s)&&s.get('inactive-ms',0)<h;}function p(s){return o(s)&&s.get('load',0)<=0&&s.get('team',j)!==j;}function q(s){return o(s)&&!k(s);}function r(s){var t=s.filter(q).count(),u=s.reduce(function(v,w){return v+w.get('load',0);},0);return u/t;}f.exports={inCoachMode:k,isCoach:l,isAway:m,isPresent:n,isActive:o,isIdle:p,isWorking:q,avgLoad:r};},null);
__d('OzInboxThreads',['OzHelpers'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='GRABBED',i='VIEWING',j='PAST';function k(m){var n=function(o){return o.get('locked-at')&&o.get('locker-id')===m;};return function(o,p){if(n(o)&&!n(p)){return -1;}else if(!n(o)&&n(p)){return 1;}else return c('OzHelpers').compareNums(o.get('last-event-at'),p.get('last-event-at'));};}var l=c('OzHelpers').memoize(function(m,n){var o=arguments.length<=2||arguments[2]===undefined?'':arguments[2],p=k(n);return m.filter(function(q){var r=c('OzHelpers').isOwner(q,n),s=c('OzHelpers').isLocker(q,n),t=c('OzHelpers').isSubscriber(q,n),u=c('OzHelpers').wasOwner(q,n),v=c('OzHelpers').hasOpenIntents(q);switch(o){case h:return ((r||q.get('ui-reassign')&&u)&&(q.get('ready')||v||s));case i:return t;case j:return (u||r&&!q.get('ready')&&!v);default:return r||t;}}).sort(p);},function(m,n){var o=arguments.length<=2||arguments[2]===undefined?'':arguments[2];return m.hashCode()+n+o;},3);f.exports={getInboxThreads:l,OZ_GRABBED_TAB:h,OZ_VIEWING_TAB:i,OZ_PAST_TAB:j};},null);
__d('OzBugNub.react',['cx','fbt','Link.react','OzImmutablePureRenderMixin','React','Tooltip','URI'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=1031744366845008,k='Error:\n\nExpected Result:\n\nSteps taken before error occurred:\n',l=c('React').createClass({displayName:'MessengerBugNub',mixins:[c('OzImmutablePureRenderMixin')],render:function(){var m=new (c('URI'))('/ajax/bugs/report').setQueryData({config_id:j,defaultText:k});return (c('React').createElement('div',{className:"_gml"},c('React').createElement(c('Link.react'),babelHelpers['extends']({href:'#',ajaxify:m,className:"_gmm",rel:'dialog'},c('Tooltip').propsFor(i._("Signaler un bogue"))),c('React').createElement('span',{className:"_gmn"}))));}});f.exports=l;},null);
__d('OzDialogContainer.react',['OzStores','React','ReactLayeredComponentMixin','Reflux'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('OzStores').DialogStore,i=c('React').createClass({displayName:'OzDialogContainer',mixins:[c('Reflux').connect(h,'dialog'),c('ReactLayeredComponentMixin')],renderLayers:function(){var j=this.state.dialog.dialogClass;if(j){var k=this.state.dialog.dialogProps||{};return {dialog:c('React').createElement(j,babelHelpers['extends']({ref:'dialog'},k))};}return {};},render:function(){return null;}});f.exports=i;},null);
__d('OzExtensionCheck.react',['cx','MessengerDialogHeader.react','MessengerDialogTitle.react','OzActions','React','ReloadPage','SUIAtlasTheme','SUINotice.react','XUIDialog.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'InstallDialog',propTypes:{onInstall:i.func.isRequired},render:function(){return (c('React').createElement(c('XUIDialog.react'),{width:544,shown:true,layerHideOnBlur:false,className:"_4ebx"},c('React').createElement('div',{className:"_4eby _2c9g _1-6z"},c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogTitle.react'),null,'The Oz Chrome Extension is missing')),c('React').createElement(c('SUINotice.react'),{theme:c('SUIAtlasTheme'),type:'error'},c('React').createElement('div',{className:"_4d80"},'Toto, the oz chrome extension that helps you manage your tabs, and record what was done for each task in the background is missing!',c('React').createElement('strong',null,c('React').createElement('a',{onClick:this.props.onInstall},' Click here to install it.')))))));}}),k=c('React').createClass({displayName:'OzExtensionCheck',componentDidMount:function(){var l=!!document.querySelector('#toto-installed');if(l)return;c('OzActions').showDialog(j,{onInstall:this._handleInstall});},render:function(){return null;},_handleInstall:function(){window.chrome.webstore.install(undefined,function(l){return c('ReloadPage').now();});}});f.exports=k;},null);
__d('OzLoading.react',['cx','MessengerFlexArea.react','MessengerSpinner.react','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'OzLoading',propTypes:{message:i.node,color:i.oneOf(["grey","blue"])},getDefaultProps:function(){return {color:"blue"};},render:function(){return (c('React').createElement('div',{className:"_30r7"},c('React').createElement(c('MessengerSpinner.react'),{color:this.props.color}),c('React').createElement('div',{className:"_30r8"},this.props.message)));}});j.Inline=c('React').createClass({displayName:'Inline',propTypes:{loading:i.bool.isRequired},render:function(){var k=this.props,l=k.loading,m=babelHelpers.objectWithoutProperties(k,['loading']);if(!l)return null;return (c('React').createElement('div',{className:"_nkb"},c('React').createElement(j,m)));}});j.Flex=c('React').createClass({displayName:'Flex',render:function(){return (c('React').createElement(c('MessengerFlexArea.react'),null,c('React').createElement(j,this.props)));}});f.exports=j;},null);
__d('OzButton.react',['cx','OzLoading.react','React','joinClasses'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').createClass({displayName:'OzButton',getInitialState:function(){return {loading:false};},render:function(){var j=this.props,k=j.children,l=j.className,m=j.disabled,n=j.onClick,o=j.use,p=babelHelpers.objectWithoutProperties(j,['children','className','disabled','onClick','use']),q=this.state.loading;return (c('React').createElement('a',babelHelpers['extends']({},p,{onClick:this._handleClick,className:c('joinClasses')(l,"_3e2t"+(q?' '+"_3e2u":'')+(o==='confirm'?' '+"_3e2v":'')+(m?' '+"_ysb":'')+(!m?' '+"_30yy":''))}),q?c('React').createElement(c('OzLoading.react'),{color:'blue',message:'Sending...'}):k));},_handleClick:function(j){var k=this.props.onClick;if(!k)return;if(k.length>1)this.setState({loading:true});k(j,this._done);},_done:function(){if(this.isMounted())this.setState({loading:false});}});f.exports=i;},null);
__d('OzReps',['OzHelpers'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=1000*60*60*8;function i(l){return !l||c('OzHelpers').serverNow()-l.get('updated-at',0)>h;}function j(l){var m=l.get('stats');return i(m)?0:m.get('closed-intents',0);}function k(l,m){var n=l.get('team');return m.reduce(function(o,p){return o+(p.get('team')===n?j(p):0);},0);}f.exports={closedIntentCount:j,teamClosedIntentCount:k};},null);
__d('OzTriSwitch.react',['cx','React','joinClasses'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(k){var l=k.className,m=k.value,n=k.onClick,o=k.label,p=k.animated,q=babelHelpers.objectWithoutProperties(k,['className','value','onClick','label','animated']);return (c('React').createElement('div',babelHelpers['extends']({},q,{className:c('joinClasses')(l,"_56de"+(q.reverseColors?' '+"_3tyl":'')+(p?' '+"_56df":'')+(m==='on'?' '+"_56dg":'')+(m==='off'?' '+"_56dh":'')+(m==='neutral'?' '+"_56di":'')),onClick:function(r){return n(j[m]);},role:'checkbox'}),c('React').createElement('div',{className:"_56dj",tabIndex:'0'},c('React').createElement('div',{className:"_56dk"})),o?c('React').createElement('span',{className:"_56dn"},o):null));}var j={on:'off',off:'neutral',neutral:'on'};i.toBoolean=function(k){if(k==='neutral')return undefined;if(k==='on')return true;if(k==='off')return false;throw new Error('OzTriSwitch: unknown state '+k);};i.fromBoolean=function(k){return k==null?'neutral':k?'on':'off';};f.exports=i;},null);
__d('OzSwitch.react',['OzImmutablePureRenderMixin','OzTriSwitch.react','React'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'OzSwitch',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{isAnimated:h.bool.isRequired,isOn:h.bool.isRequired,label:h.node.isRequired,onToggle:h.func.isRequired,reverseColors:h.bool},getDefaultProps:function(){return {isAnimated:false};},render:function(){var j=this.props,k=j.className,l=j.isAnimated,m=j.isOn,n=j.label,o=j.onToggle;return (c('React').createElement(c('OzTriSwitch.react'),{animated:l,className:k,reverseColors:!!this.props.reverseColors,label:n,onClick:function(){return o(!m);},value:c('OzTriSwitch.react').fromBoolean(m)}));}});f.exports=i;},null);
__d('OzTwilio',['cx','OzHelpers','immutable','Keys','MessengerButton.react','OzNotify','OzActions','OzConfig','OzDraggable.react','OzImmutablePureRenderMixin','React','Reflux','StarsInput.react'],function a(b,c,d,e,f,g,h){var i,j,k,l;if(c.__markCompiled)c.__markCompiled();var m=c('immutable').Record,n=c('immutable').Set,o=c('immutable').List,p=c('React').PropTypes,q=c('OzActions').twilio;function r(){var na=window.Twilio.Device,oa=function(pa,qa){return function(){c('OzHelpers').info('[twilio] '+pa,u.data.toJS());qa.apply(undefined,arguments);};};q.setup.listen(function(pa){na.setup(pa,{rtc:c('OzConfig').getInStaticConfig(['GK','webRTC']),debug:true});});q.hangUp.listen(function(pa){na.disconnectAll();q.endCall();});q.startCall.listen(oa('start-call',na.connect));na.ready(q.ready);na.error(function(pa){var qa=pa.message;c('OzNotify').error('VOIP is having issues. '+(qa?qa:'')+'. Please contact the wit oncall');c('OzHelpers').error('[twilio] had an error',pa);q.endCall();});na.connect(oa('connect',q.connect));na.disconnect(oa('disconnect',q.endCall));na.cancel(oa('cancel',q.endCall));na.incoming(oa('incoming',q.incoming));}r();i=babelHelpers.inherits(s,m({'intent-id':null,tid:null,extension:null}));j=i&&i.prototype;function s(){'use strict';i.apply(this,arguments);}k=babelHelpers.inherits(t,m({from:null,meta:new s(),muted:false,status:'pending',to:null,wasIncoming:null,rating:null,sentDigits:null,sentDigitsBuffer:o(),sentDigitsIntervalId:null}));l=k&&k.prototype;function t(){'use strict';k.apply(this,arguments);}var u=c('Reflux').createStore({init:function(){this.data=new t();this.listenToMany(q);},getInitialState:function(){return this.data;},onChangeTo:function(na){this._u(function(oa){return oa.set('to',na);});},onDialAgain:function(){this._conn=null;this._u(function(na){return new t({status:'dial',meta:na.get('meta'),from:na.get('from'),to:na.get('to')});});},onConnect:function(na){this._conn=na;},onEndCall:function(){this._conn=null;this._u(function(na){return na.merge({status:'ended'});});},onIncoming:function(na){this._conn=na;this._u(function(oa){return oa.mergeDeep({status:'incoming',to:na.parameters.From,wasIncoming:true});});},onIncomingAccept:function(){if(this._conn){this._conn.accept();this._u(function(na){return na.merge({status:'in-call'});});}},onIncomingReject:function(){if(this._conn){this._conn.reject();this._conn=null;}this.onEndCall();},onMute:function(){if(this._conn){this._conn.mute(true);this._u(function(na){return na.set('muted',true);});}},onReady:function(){this._u(function(na){return new t({status:'ready'});});},_sendDigitsFromBuffer:function(){var na=this.data.get('sentDigitsBuffer');if(!na.isEmpty()){this._conn.sendDigits(na.first());this._u(function(pa){return pa.update('sentDigitsBuffer',function(qa){return qa.shift();});});}else{var oa=this.data.get('sentDigitsIntervalId');clearInterval(oa);this._u(function(pa){return pa.set('sentDigitsIntervalId',null);});}},onSendDigits:function(na){if(this._conn){this._u(function(oa){return oa.update('sentDigits',function(pa){return (pa||'')+na;});});this._u(function(oa){return oa.update('sentDigitsBuffer',function(pa){return pa.concat(o(na.split('')));});});if(!Number.isInteger(this.data.get('sentDigitsIntervalId')))this._u(function(oa){return oa.set('sentDigitsIntervalId',setInterval(this._sendDigitsFromBuffer,1000));}.bind(this));}},onStartCall:function(){this._u(function(na){return na.set('status','in-call');});},onUnmute:function(){if(this._conn){this._conn.mute(false);this._u(function(na){return na.set('muted',false);});}},onUseIntent:function(na){if(this.data.get('status')!=='ready'){c('OzNotify').error('End your call before starting another one');return;}this._u(function(oa){return new t({status:'dial',from:na.get('phone-number'),meta:new s({tid:na.get('user-id'),'intent-id':na.get('id'),extension:na.get('phone-extension')})});});},onUpdateIncomingInfo:function(na){this._u(function(oa){return oa.merge({meta:new s({tid:na.get('user-id'),'intent-id':na.get('intent-id'),extension:na.get('phone-extension')}),from:na.get('to'),to:na.get('from')});});},onUpdateRating:function(na){this._u(function(oa){return oa.set('rating',na);});},_u:function(na){this.data=na(this.data);this.trigger(this.data);}}),v=c('React').createClass({displayName:'OzTwilio',mixins:[c('OzImmutablePureRenderMixin'),c('Reflux').connect(u,'store'),c('Reflux').connect(c('OzConfig').ConfigStore,'config')],contextTypes:{router:p.object.isRequired},componentDidMount:function(){var na=window.setInterval(function(oa){this.state.store.get('status')==='in-call'&&c('OzActions').isActive();}.bind(this),5000);this._cleanup=function(oa){return window.clearInterval(na);};},componentDidUpdate:function(na,oa){var pa=oa.store.get('status'),qa=this.state.store.get('status');if(pa==='in-call'&&qa==='ended')window.clearInterval(this._callDurationInterval);},componentWillUnmount:function(){this._cleanup();},render:function(){var na=this.state,oa=na.store,pa=na.callDuration;return (c('React').createElement('span',{className:"_221-"},w(oa)&&c('React').createElement(x,{callDuration:pa,onCallStart:this._handleStartCall,onDialAgain:q.dialAgain,onHangUp:this._handleHangUp,onIncomingAccept:this._handleIncomingAccept,onIncomingReject:q.incomingReject,onMute:q.mute,onRatingChange:this._handleRatingChange,onReady:q.ready,onSendDigits:q.sendDigits,onThreadClick:this._handleThreadClick,onToChange:q.changeTo,onUnmute:q.unmute,store:oa})));},_handleThreadClick:function(na){this.context.router.push('/inbox/'+na);},_handleStartCall:function(){var na=this.state.store;this._startDurationTimer();q.startCall(babelHelpers['extends']({},na.get('meta').toJS(),{from:na.get('from'),to:na.get('to'),page:this.state.config.get('PAGE_ID'),type:'outgoing'}));},_handleIncomingAccept:function(){this._startDurationTimer();q.incomingAccept();},_startDurationTimer:function(){var na=Date.now();clearInterval(this._callDurationInterval);this._callDurationInterval=setInterval(function(){this.setState({callDuration:Date.now()-na});}.bind(this),950);this.setState({callDuration:0});},_handleHangUp:function(){q.hangUp();clearInterval(this._callDurationInterval);},_handleRatingChange:function(na){c('OzHelpers').info('[twilio] rating='+na,this.state.store.toJS());q.updateRating(na);}});function w(na){return n(['dial','in-call','incoming','ended']).has(na.get('status'));}var x=c('OzHelpers').pure(function(na){return (c('React').createElement(c('OzDraggable.react'),{className:"_2221"},c('React').createElement(y,{store:na.store}),c('React').createElement(z,na)));}),y=c('OzHelpers').pure(function(na){var oa=na.store,pa=oa.get('status'),qa=oa.get('wasIncoming')?'Incoming':'Outgoing';return (c('React').createElement('h2',{className:"_1su5"},pa==='ended'&&qa+' Call End'||qa+' Phone Call'));}),z=c('OzHelpers').pure(function(na){switch(na.store.get('status')){case 'dial':return c('React').createElement(aa,na);case 'in-call':return c('React').createElement(ea,na);case 'incoming':return c('React').createElement(ja,na);case 'ended':return c('React').createElement(ka,na);default:c('OzHelpers').debug('[twilio] unknown status',na);return null;}}),aa=c('OzHelpers').pure(function(na){var oa=na.store,pa=na.onToChange,qa=na.onCallStart,ra=na.onReady;return (c('React').createElement('div',{className:"_3hon"},c('React').createElement(ma,{placeholder:'Type a phone number...',value:oa.get('to'),onChange:function(sa){return pa(sa.target.value);},onKeyDown:function(sa){return (sa.which===c('Keys').RETURN?ba(oa)&&qa():null);}}),c('React').createElement('div',{className:"_1su6"},da(oa)),c('React').createElement('div',{className:"_1su7"},c('React').createElement(c('MessengerButton.react'),{onClick:ra,type:'secondary',label:'Cancel'}),c('React').createElement(c('MessengerButton.react'),{disabled:!ba(oa),onClick:qa,type:'primary',label:'Call'}))));});function ba(na){return (na.get('from')&&na.get('to')&&na.get('to').length>=10);}var ca=function(na){var oa=60000,pa=Math.floor(na/oa);na%=oa;var qa=Math.floor(na/1000);if(pa<10)pa='0'+pa;if(qa<10)qa='0'+qa;return pa+':'+qa;},da=function(na){var oa=na.getIn(['meta','extension']);return 'My Number: '+c('OzHelpers').parsePhoneNumber(na.get('from'))+' ext. '+oa;},ea=c('OzHelpers').pure(function(na){var oa=na.callDuration,pa=na.onHangUp,qa=na.onMute,ra=na.onSendDigits,sa=na.onThreadClick,ta=na.onUnmute,ua=na.store;return (c('React').createElement('div',{className:"_2225"},c('React').createElement('div',{className:"_1su8"},ca(oa)),c('React').createElement('div',{className:"_1su9"},c('OzHelpers').parsePhoneNumber(ua.get('to'))),c('React').createElement(fa,{sentDigits:ua.get('sentDigits'),onSendDigits:ra}),c('React').createElement('div',{className:"_1su6"},ua.get('from')?da(ua):'Searching for our number...'),c('React').createElement('div',{className:"_1su7"},c('React').createElement(ia,{tid:ua.getIn(['meta','tid']),onThreadClick:sa}),ua.get('muted')?c('React').createElement(c('MessengerButton.react'),{onClick:ta,type:'secondary',use:'danger',label:'Unmute'}):c('React').createElement(c('MessengerButton.react'),{onClick:qa,type:'secondary',use:'default',label:'Mute'}),c('React').createElement(c('MessengerButton.react'),{onClick:pa,type:'primary',label:'End Call'}))));}),fa=c('OzHelpers').pure(function(na){var oa=na.onSendDigits,pa=na.sentDigits;return (c('React').createElement('div',null,c('React').createElement(ma,{placeholder:'Type numbers using keyboard',value:'',onChange:function(qa){var ra=ha(qa.target.value);ra&&oa(ra);}}),c('React').createElement('div',{className:"_538o"},pa)));}),ga=n(['1','2','3','4','5','6','7','8','9','0','#','*']);function ha(na){return na.split('').filter(function(oa){return ga.has(oa);}).join('');}var ia=c('OzHelpers').pure(function(na){var oa=na.onThreadClick,pa=na.tid;return pa?c('React').createElement(c('MessengerButton.react'),{onClick:function(){return oa(pa);},type:'secondary',label:'Go to Thread'}):null;}),ja=c('OzHelpers').pure(function(na){var oa=na.store,pa=na.onIncomingAccept,qa=na.onIncomingReject;return (c('React').createElement('div',{className:"_2226"},c('React').createElement('div',{className:"_1su9"},c('OzHelpers').parsePhoneNumber(oa.get('to'))),c('React').createElement('div',{className:"_1su6"},da(oa)),c('React').createElement('div',{className:"_1su7"},c('React').createElement(c('MessengerButton.react'),{onClick:qa,type:'secondary',label:'Ignore'}),c('React').createElement(c('MessengerButton.react'),{onClick:pa,type:'primary',label:'Answer'}))));}),ka=c('OzHelpers').pure(function(na){var oa=na.callDuration,pa=na.store,qa=na.onHideDialog,ra=na.onRatingChange,sa=na.onDialAgain,ta=na.onReady;return (c('React').createElement('div',{className:"_5gaw"},c('React').createElement('div',{className:"_1su8"},ca(oa)),c('React').createElement('div',{className:"_1su9"},c('OzHelpers').parsePhoneNumber(pa.get('to'))),c('React').createElement('div',{className:"_1su6"},da(pa)),c('React').createElement(la,{rating:pa.get('rating'),onRatingChange:ra}),c('React').createElement('div',{className:"_1su7"},c('React').createElement(c('MessengerButton.react'),{onClick:sa,type:'secondary',label:'New Call'}),c('React').createElement(c('MessengerButton.react'),{onClick:ta,type:'primary',label:'Close'}))));}),la=c('OzHelpers').pure(function(na){var oa=na.rating,pa=na.onRatingChange;return (c('React').createElement('div',{className:"_5rvp"},oa?c('React').createElement('h3',{className:"_5rvu"},'Thank you for rating!'):c('React').createElement('span',null,c('React').createElement('h3',{className:"_5rvu"},'How would you rate your experience?'),c('React').createElement(c('StarsInput.react'),{large:true,count:0,onClick:pa}))));}),ma=c('OzHelpers').pure(function(na){return (c('React').createElement('input',babelHelpers['extends']({},na,{className:"_1-i0 _2224"})));});f.exports=v;},null);
__d('OzHeader.react',['cx','OzHelpers','immutable','Layout.react','MessengerButton.react','OzButton.react','OzConfig','OzHumans','OzReps','OzStores','OzSwitch.react','OzTwilio','React','Reflux','ReactRouter','Tooltip'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('OzStores').RepStore,k=c('OzStores').HumanStore,l=c('ReactRouter').Link,m=c('React').PropTypes,n=c('React').createClass({displayName:'OzHeader',mixins:[c('Reflux').connect(k,'humans'),c('Reflux').connect(j,'reps'),c('Reflux').connect(c('OzConfig').ConfigStore,'config')],propTypes:{coachMode:m.bool.isRequired,rev:m.number.isRequired,version:m.string.isRequired,onAway:m.func.isRequired,onCoachModeToggle:m.func.isRequired,params:m.object.isRequired},contextTypes:{uid:m.string.isRequired,router:m.object.isRequired},render:function(){var p='/inbox/'+(this.props.params.threadid||''),q=this.state.humans.getIn([this.context.uid,'load'],0),r='Inbox'+(q?' ('+q+')':''),s=this.state.config.get('GK',i());return (c('React').createElement(c('Layout.react'),{className:"_2d86"},c('React').createElement('div',{className:"_2d87"},c('React').createElement(l,{to:'/',className:"_2d88"}),this._renderItem(r,p),this._renderItem('Merchants','/merchants'),this._renderItem('Feedback','/feedback'),this._renderItem('Stats','/stats'),s.get('supervisor')&&this._renderItem('Top','/top'),s.get('IntentDashboard')&&this._renderItem('Intents','/intents'),s.get('AIDashboard')&&this._renderItem('AI','/ai'),s.get('supervisor')&&this._renderItem('Trainers','/trainers'),this._renderItem('All Threads','/all')),c('React').createElement('div',{className:"_j6m"},c('React').createElement(o,{humans:this.state.humans,reps:this.state.reps,uid:this.context.uid}),c('React').createElement(c('OzTwilio'),null)),c('React').createElement(c('MessengerButton.react'),{label:'Away',className:"_4s9f",type:'primary',onClick:this.props.onAway}),s.get('supervisor')?c('React').createElement(c('OzSwitch.react'),{className:"_b8c",isAnimated:true,isOn:this.props.coachMode,label:'Coach Mode',onToggle:this.props.onCoachModeToggle}):null));},_renderItem:function(p,q){return (c('React').createElement(l,{activeClassName:'active',className:"_33os",to:q},c('React').createElement('span',null,p)));}}),o=c('OzHelpers').pure(function(p){var q=p.reps,r=p.humans,s=p.uid,t=q.get(s,i()),u=c('OzReps').closedIntentCount(t),v=c('OzReps').teamClosedIntentCount(t,q),w=Math.round(c('OzHumans').avgLoad(r)),x=r.filter(c('OzHumans').isWorking).count();return (c('React').createElement('div',null,c('React').createElement('span',babelHelpers['extends']({className:"_3fs"},c('Tooltip').propsFor('Your closed intents')),u),c('React').createElement('span',{className:"_4s9g"},'closed by you'),' ',c('React').createElement('span',babelHelpers['extends']({className:"_3fs"},c('Tooltip').propsFor('Closed intents for your entire team')),v),c('React').createElement('span',{className:"_4s9g"},'closed by team'),c('React').createElement('span',{className:"_3fs"},w),c('React').createElement('span',{className:"_4s9g"},'average load'),c('React').createElement('span',{className:"_3fs"},x),c('React').createElement('span',{className:"_4s9g"},x===1?'trainer':'trainers')));});f.exports=n;},null);
__d('OzUserImage.react',['cx','joinClasses','Image.react','immutable','OzImmutablePureRenderMixin','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('React').PropTypes,k=c('React').createClass({displayName:'OzUserImage',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{photo:j.object},render:function(){var l=c('joinClasses')(this.props.className,"_3c52 _3c53"),m=function(o){return c('React').createElement(c('Image.react'),{className:l,src:o});},n=this.props.photo||i();return (n.getIn(['data','url'])&&m(n.getIn(['data','url']))||n.get('data')&&m(n.get('mime_type')+','+n.get('data'))||c('React').createElement('span',{className:c('joinClasses')(l,"_3ejm")}));}});f.exports=k;},null);
__d('OzSuggestions',['OzHelpers','immutable','OzConstants'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('OzConstants').ATTS,i=c('immutable').List,j=c('immutable').Map;f.exports={toServer:function(m,n){return m.set('type',h.SUGG).update('data',function(o){return j({name:o.get('title'),description:o.get('description')||'','merchant-name':this.findMerchantName(o.get('merchant'),n),'thumb-url':o.get('images',i()).find(c('OzHelpers').validateURL)||null,'thumb-urls':o.get('images',i()).filter(c('OzHelpers').validateURL),'target-url':o.get('url'),'expiration-time':o.get('expiration-time'),currency:'USD',amount:o.has('price')?k(o.get('price')):null});}.bind(this));},findMerchantName:function(m,n){var o=n&&m&&n.find(function(p){return (p.get('name-dba')||'').toLowerCase()===m.toLowerCase();});if(o){c('OzHelpers').info('[sugg] found merchant',m,o);return o.get('name-dba');}return null;}};function k(m){return Math.round(100*parseFloat(l(m,'$'),10));}function l(m,n){if(!m||!m.startsWith(n))return m;return m.substr(n.length);}},null);
__d('Oz.react',['cx','OzAPI','OzHelpers','immutable','Layout.react','OzActions','OzBugNub.react','OzConfig','OzDialogContainer.react','OzExtensionCheck.react','OzHeader.react','OzLoading.react','OzFailed.react','OzNotify','OzSearch.react','OzStores','OzSuggestions','OzImmutablePureRenderMixin','React','Reflux','Run','XUIDialog.react','XUINotice.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('OzNotify').Component,j=c('OzStores').ActiveThreadStore,k=c('OzStores').MerchantStore,l=c('OzStores').LoadingStore,m=c('OzStores').RepStore,n=c('OzStores').RequirementStore,o=c('OzStores').ThreadStore,p=c('OzStores').WitIntentStore,q=c('React').PropTypes,r=c('immutable').Map,s=20000,t=60000,u=5000,v=c('React').createClass({displayName:'OzWrapper',mixins:[c('Reflux').connect(l,'loading')],propTypes:{rev:q.number.isRequired,uid:q.string.isRequired,version:q.string.isRequired,skipToto:q.bool,onUnmount:q.func.isRequired},render:function(){var da=this.state.loading.valueSeq().some(function(ea){return ea.get('state')!=='loaded'&&!ea.get('skip');});if(da)return c('React').createElement(w,null);return c('React').createElement(x,this.props);}}),w=c('React').createClass({displayName:'AppLoading',mixins:[c('Reflux').connect(c('OzConfig').ConfigStore,'config'),c('Reflux').connect(l,'loading')],render:function(){return (c('React').createElement('div',null,c('React').createElement(i,null),this._renderBody(),c('React').createElement(c('OzBugNub.react'),null)));},_renderBody:function(){var da=this.state.loading,ea=da.entrySeq().filter(function(ga){var ha=ga[0],ia=ga[1];return ia.get('state')==='failed'&&!ia.get('skip');}).map(function(ga){var ha=ga[0],ia=ga[1];return ha;});if(!ea.isEmpty())return c('React').createElement(c('OzFailed.react'),{message:'Oz couldn\'t load '+ea.join(', ')+'.'});var fa='Hello '+this.state.config.get('publicName')+'! Oz is connecting...';return c('React').createElement(c('OzLoading.react'),{message:fa});}}),x=c('React').createClass({displayName:'Oz',mixins:[c('Reflux').connect(k,'merchants'),c('Reflux').connect(m,'reps'),c('Reflux').connect(p,'witIntents'),c('Reflux').connect(n,'requirements')],propTypes:{rev:q.number.isRequired,uid:q.string.isRequired,version:q.string.isRequired,skipToto:q.bool,onUnmount:q.func.isRequired},childContextTypes:{uid:q.string.isRequired,merchants:q.instanceOf(r).isRequired,reps:q.instanceOf(r).isRequired,witIntents:q.instanceOf(r).isRequired},getChildContext:function(){return {uid:this.props.uid,merchants:this.state.merchants,reps:this.state.reps,witIntents:this.state.witIntents};},getInitialState:function(){return {almostInactive:false,away:false,coachMode:false,inactive:false};},componentDidMount:function(){window.addEventListener('message',this._handleMessage);window.postMessage({type:'consolemounted'},'*');this.lastPulseAt=Date.now();var da=c('OzActions').sendPulse.listen(this._handlePulse),ea=c('OzActions').activateThread.listen(this._handleActivateIntent),fa=setInterval(c('OzActions').sendPulse,u);this.lastActiveAt=Date.now();window.addEventListener('mousemove',function(ia){return c('OzActions').isActive();});window.addEventListener('keydown',function(ia){return c('OzActions').isActive();});var ga=c('OzActions').isActive.listen(function(){this.lastActiveAt=Date.now();if(this.state.almostInactive||this.state.inactive)this.setState({almostInactive:false,inactive:false});}.bind(this));c('OzActions').updateThreads.preEmit=aa.bind(null,this.props.uid);var ha=c('OzActions').isInactive.listen(function(ia){if(Date.now()-this.lastActiveAt>u)this.setState({almostInactive:false,inactive:true});}.bind(this));c('Run').onBeforeUnload(function(){c('OzAPI').sendDisconnectPulse(Math.floor((Date.now()-this.lastPulseAt)/1000),this._buildPulse(true));this.props.onUnmount();}.bind(this));this._cleanup=function(){window.removeEventListener('message');da();ea();clearInterval(fa);window.removeEventListener('mousemove');ga();ha();};},componentWillUnmount:function(){this._cleanup();},render:function(){return (c('React').createElement(c('Layout.react'),{className:"_3_ps _li",onKeyPress:this._handleKeyPress},c('React').createElement(i,null),!this.props.skipToto&&c('React').createElement(c('OzExtensionCheck.react'),null),this.state.away?c('React').createElement(y,{onClick:this._handleAway,shown:this.state.away,text:'You\'re currently away.',className:"_1tir"}):this.state.almostInactive?c('React').createElement(z,{lastActiveAt:this.lastActiveAt,onZero:this._handleZero}):this.state.inactive?c('React').createElement(y,{shown:this.state.inactive,text:'You\'re currently inactive.',className:"_4da6"}):null,c('React').createElement(c('OzHeader.react'),{away:this.state.away,coachMode:!!this.state.coachMode,onAway:this._handleAway,onCoachModeToggle:this._handleCoachModeToggle,rev:this.props.rev,version:this.props.version,reps:this.state.reps,params:this.props.params}),c('React').cloneElement(this.props.children,{witIntents:this.state.witIntents,requirements:this.state.requirements,merchants:this.state.merchants,reps:this.state.reps}),c('React').createElement(c('OzBugNub.react'),null),c('React').createElement(c('OzDialogContainer.react'),null),c('React').createElement(c('OzSearch.react'),null)));},_handleKeyPress:function(){c('OzActions').isActive();},_handlePulse:function(){var da=Date.now(),ea=Math.round((da-this.lastPulseAt)/1000),fa=this._buildPulse();c('OzAPI').sendPulse(ea,fa);ca(j.data,o.data);this.lastPulseAt=da;if(!this.state.almostInactive&&!this.state.inactive&&fa.get('inactive-ms')>=t-s)this.setState({almostInactive:true});},_handleActivateIntent:function(da){var ea=da.intentID;if(ea)c('OzAPI').handledEvents(ea);},_handleMessage:function(da){if(da.source!==window)return;if(!da.data)return;switch(da.data.type){case 'active':c('OzActions').isActive();break;case 'recordactivity':var ea=j.data,fa=da.data.data,ga=ea.get('threadID');c('OzHelpers').debug('[oz-ext] received activity',fa);if(!ga){c('OzHelpers').debug('[oz-ext] skipping event, no threadID');return;}c('OzAPI').recordActivity(ga,fa);break;case 'bubble':c('OzHelpers').debug('[toto] got bubble',da.data);c('OzActions').addBubble(c('OzSuggestions').toServer(c('immutable').fromJS(da.data),this.state.merchants));break;case 'autopilot-data':c('OzHelpers').debug('[toto] got autopilot',da.data);if(da.data)c('OzActions').addAutopilot(c('immutable').fromJS(da.data));break;}},_handleAway:function(da){c('OzAPI').away(!this.state.away).done(function(ea){this.setState({away:!!ea});}.bind(this));},_handleCoachModeToggle:function(da){c('OzAPI').coachMode(da).done(function(){this.setState({coachMode:da});}.bind(this));},_handleZero:function(){this.setState({almostInactive:false,inactive:true});},_buildPulse:function(da){return ba(this.props.uid,j.data,o.data,this.lastActiveAt,this.state.away||da||false,this.state.coachMode);}});function y(da){var ea=da.shown,fa=da.onClick,ga=da.text,ha=da.className;return (c('React').createElement(c('XUIDialog.react'),{width:544,shown:ea,layerHideOnBlur:false},c('React').createElement('div',{className:"_1tip"},c('React').createElement('div',{className:ha}),c('React').createElement('div',{className:"_1tis"},ga),fa?c('React').createElement('a',{className:"_1tit _57lt _30yy",onClick:fa},'I\'m back :)'):null)));}var z=c('React').createClass({displayName:'OzCountdownDialog',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{lastActiveAt:q.number.isRequired,onZero:q.func.isRequired},getInitialState:function(){return {countdown:Math.floor((t-(Date.now()-this.props.lastActiveAt))/1000)};},componentDidMount:function(){this._interval=setInterval(function(){this.setState({countdown:Math.max(this.state.countdown-1,0)});}.bind(this),1000);},componentDidUpdate:function(){if(this.state.countdown===0){clearInterval(this._interval);this.props.onZero();}},componentWillUnmount:function(){clearInterval(this._interval);},render:function(){return (c('React').createElement(c('XUIDialog.react'),{width:544,shown:true,layerHideOnBlur:false},c('React').createElement('div',{className:"_1tip"},c('React').createElement('div',{className:"_4da6"}),c('React').createElement(c('XUINotice.react'),{use:'warn'},'You\'ll be inactive (and your threads will be reassigned) in approximately ',this.state.countdown,' seconds...'))));}});function aa(da,ea){var fa=o.data;if(fa.isEmpty())return;ea.filter(function(ga){return ((c('OzHelpers').isOwner(ga,da)||c('OzHelpers').isSubscriber(ga,da))&&(ga.get('ready')||c('OzHelpers').isUnread(ga)||c('OzHelpers').hasPaid(ga)||c('OzHelpers').hasReminder(ga)));}).forEach(function(ga){var ha=c('OzHelpers').isUnread(ga)&&c('OzHelpers').shortDesc(c('OzHelpers').lastUserMessage(ga))||c('OzHelpers').hasPaid(ga)&&'Payment received.'||c('OzHelpers').hasReminder(ga)&&'Reminder triggered.';if(!ha)return;var ia=c('OzHelpers').threadID(ga),ja=fa.getIn([ia,'last-event-at']);if(ga.get('last-event-at')===ja)return;var ka=c('OzHelpers').photo(ga),la=ka?ka.getIn(['data','url'])||ka.get('mime_type')+','+ka.get('data'):null;c('OzAPI').notifyExtension({action:'show',title:c('OzHelpers').getName(ga),desc:ha,picture:la,id:c('OzHelpers').threadID(ga)});});}function ba(da,ea,fa,ga,ha,ia){var ja=ea.get('threadID'),ka=ja&&fa.get(ja),la=r();if(ja)la=la.merge({tid:ja});if(ka)la=la.merge({'intent-id':ea.get('activeIntent'),'owner-id':ka.getIn(['owner','id']),'user-name':ka.getIn(['user-vcard','name'])});if(Number.isFinite(ga))la=la.set('inactive-ms',Date.now()-ga);la=la.set('load',fa.toSeq().filter(function(ma){return c('OzHelpers').isOwner(ma,da)&&ma.get('ready');}).count());la=la.set('away?',ha);la=la.set('coach-mode?',ia);return la;}function ca(da,ea){var fa=da.get('threadID'),ga=fa&&ea.get(fa),ha=r();if(ga)ha=ha.merge({tid:fa,'intent-id':da.get('activeIntent'),'user-vcard':ga.get('user-vcard')});window.postMessage({type:'consolepulse',data:ha.toJS()},'*');}f.exports=v;},null);
__d('OzAIDashboardFilters.react',['cx','immutable','InputLabel.react','OzImmutablePureRenderMixin','React','XUISingleSelector.react'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('immutable').List,j=c('immutable').Map,k=c('React').PropTypes,l=c('XUISingleSelector.react').Option,m=c('React').createClass({displayName:'OzAIDashboardFilters',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{intentMetas:k.instanceOf(j).isRequired,modules:k.instanceOf(i).isRequired,isReversed:k.bool.isRequired,onIsReversedChange:k.func.isRequired,onSortByChange:k.func.isRequired,onUUIDChange:k.func.isRequired,onModuleChange:k.func.isRequired,sortBy:k.string,sortableFields:k.instanceOf(j).isRequired,uuid:k.string,selectedModule:k.string},render:function(){return (c('React').createElement('ul',{className:"_1bo-"},c('React').createElement('li',null,this._renderModuleFilter()),c('React').createElement('li',null,this._renderUUIDFilter()),c('React').createElement('li',null,this._renderSortByFilter()),c('React').createElement('li',null,this._renderIsReversedFilter())));},_renderModuleFilter:function(){return (c('React').createElement(c('XUISingleSelector.react'),{maxheight:400,onChange:this._handleModuleChange,value:this.props.selectedModule||'__none__'},c('React').createElement(l,{value:'__none__'},'Select a module'),this.props.modules.valueSeq().map(function(o){return (c('React').createElement(l,{key:o,value:o},o));})));},_renderUUIDFilter:function(){return (c('React').createElement(c('XUISingleSelector.react'),{maxheight:400,onChange:this._handleUUIDChange,value:this.props.uuid||'__none__'},c('React').createElement(l,{value:'__none__'},'Select an intent category'),this.props.intentMetas.sortBy(function(o){return o.get('name');}).valueSeq().map(function(o){return (c('React').createElement(l,{key:o.get('id'),value:o.get('id')},o.get('name')));})));},_renderIsReversedFilter:function(){return (c('React').createElement(c('InputLabel.react'),null,c('React').createElement('input',{checked:this.props.isReversed,onChange:function(o){this.props.onIsReversedChange(o.target.checked);}.bind(this),type:'checkbox'}),c('React').createElement('label',null,'Reversed?')));},_renderSortByFilter:function(){return (c('React').createElement(c('XUISingleSelector.react'),{maxheight:400,onChange:this._handleSortByChange,value:this.props.sortBy||'__none__'},c('React').createElement(l,{value:'__none__'},'Select a field to sort by'),this.props.sortableFields.map(function(o,p){return (c('React').createElement(l,{key:p,value:p},o));}).valueSeq()));},_handleSortByChange:function(o){this.props.onSortByChange(n(o.value));},_handleUUIDChange:function(o){this.props.onUUIDChange(n(o.value));},_handleModuleChange:function(o){this.props.onModuleChange(o.value);}});function n(o){return o!=='__none__'?o:undefined;}f.exports=m;},null);
__d('OzAIDashboardEventSuggestions.react',['cx','immutable','OzConstants','OzImmutablePureRenderMixin','React','XUITable.react'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('immutable').List,j=c('immutable').Map,k=c('OzConstants').ATTS,l=c('React').PropTypes,m=c('React').createClass({displayName:'OzAIDashboardEventSuggestions',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{gold:l.instanceOf(j).isRequired,guesses:l.instanceOf(i).isRequired},render:function(){return (c('React').createElement(c('XUITable.react'),{outerBorder:true},c('React').createElement('thead',null,c('React').createElement('tr',null,c('React').createElement('th',null,'Source'),c('React').createElement('th',null,'Guess'),c('React').createElement('th',null,'Class'),c('React').createElement('th',null,'Confidence'))),c('React').createElement('tbody',null,this._getSuggestions().map(this._renderRow))));},_buildGuess:function(n){switch(n.get('type')){case k.TEMPLATE:return (c('React').createElement('span',null,n.get('ui-body')||JSON.stringify(n.get('body'))));case k.SUGG:case 'bubble':return (c('React').createElement('a',{href:n.get('target-url'),target:'_blank'},n.get('name')));default:return c('React').createElement('span',null,JSON.stringify(n));}},_renderRow:function(n,o){var p=this.props.gold,q=n.get('source');return (c('React').createElement('tr',{className:p.get('source')===q&&p.get('position')===n.get('position')?"_31bp":'',key:o},c('React').createElement('td',null,q),c('React').createElement('td',null,this._buildGuess(n)),c('React').createElement('td',null,n.get('class')),c('React').createElement('td',null,n.get('confidence'))));},_getSuggestions:function(){return this.props.guesses.flatMap(function(n){return n.get('items')||[n].map(function(o){return o.merge(j({position:n.get('position'),confidence:n.get('confidence'),'class':n.get('class')}));});}).toSeq();}});f.exports=m;},null);
__d('OzAIDashboardEventsDialog.react',['cx','DialogFitHeight','immutable','InputLabel.react','OzAIDashboardEventSuggestions.react','OzImmutablePureRenderMixin','React','XUIDialog.react','XUIDialogBody.react','XUIDialogFooter.react','XUIDialogOkayButton.react','XUIDialogTitle.react','XUITable.react','formatDate'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('React').PropTypes,k=c('React').createClass({displayName:'OzAIDashboardEventsDialog',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{session:j.instanceOf(i).isRequired,onToggle:j.func.isRequired,shown:j.bool.isRequired},getInitialState:function(){return {isFiltered:true};},render:function(){return (c('React').createElement(c('XUIDialog.react'),{behaviors:{DialogFitHeight:c('DialogFitHeight')},onToggle:this.props.onToggle,shown:this.props.shown,width:800},c('React').createElement(c('XUIDialogTitle.react'),null,c('React').createElement('span',null,'Events for Session  ',this.props.session.get('id'))),c('React').createElement(c('XUIDialogBody.react'),null,c('React').createElement(c('InputLabel.react'),null,c('React').createElement('input',{checked:this.state.isFiltered,onChange:function(n){this.setState({isFiltered:n.target.checked});}.bind(this),type:'checkbox'}),c('React').createElement('label',null,'Filter Non-Message Events?')),this._renderTable()),c('React').createElement(c('XUIDialogFooter.react'),null,c('React').createElement(c('XUIDialogOkayButton.react'),{use:'confirm',action:'cancel'}))));},_renderTable:function(){return (c('React').createElement(c('XUITable.react'),{className:"_4p5_",outerBorder:true},c('React').createElement('thead',null,c('React').createElement('tr',null,c('React').createElement('th',null,'Time'),c('React').createElement('th',null,'Text/Data'),c('React').createElement('th',null,'Suggestions'),c('React').createElement('th',null,'Winner'))),c('React').createElement('tbody',null,this._getEvents().map(this._renderRow))));},_renderRow:function(event,n){var o=event.get('type'),p=event.getIn(['aiusage','guesses']),q=event.get('suggestion');return (c('React').createElement('tr',{key:n},c('React').createElement('td',{className:"_4p60"},l(event.get('time'))),c('React').createElement('td',{className:"_4p61"+(o!=='message'?' '+"_31bp":'')},event.get('text')||q&&m(q)),c('React').createElement('td',null,p?c('React').createElement(c('OzAIDashboardEventSuggestions.react'),{gold:event.getIn(['aiusage','gold'])||i(),guesses:p}):''),c('React').createElement('td',null,event.getIn(['aiusage','gold','source']))));},_getEvents:function(){var n=this.props.session.get('events').toSeq();if(this.state.isFiltered)n=n.filter(function(event){var o=event.get('type');return o==='send'||o==='message'||o==='suggest';});return n;}});function l(n){return c('formatDate')(n/1000,'M d, Y g:ia');}function m(n){return (c('React').createElement('a',{href:n.get('target-url'),target:'_blank'},n.get('name')));}f.exports=k;},null);
__d('OzAIDashboardRow.react',['immutable','ReactLayeredComponentMixin','OzAIDashboardEventsDialog.react','OzImmutablePureRenderMixin','React','formatDate'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('immutable').Map,i=c('React').PropTypes,j=c('React').createClass({displayName:'OzAIDashboardRow',mixins:[c('ReactLayeredComponentMixin'),c('OzImmutablePureRenderMixin')],propTypes:{session:i.instanceOf(h).isRequired,intentMeta:i.instanceOf(h),selectedModule:i.string},getInitialState:function(){return {isDialogOpen:false};},render:function(){var l=this.props,m=l.session,n=l.intentMeta,o=l.selectedModule;return (c('React').createElement('tr',null,c('React').createElement('td',null,m.get('id')),c('React').createElement('td',null,k(m.get('created-at'))),c('React').createElement('td',null,n&&n.get('name')),c('React').createElement('td',null,m.get('sends')||0),c('React').createElement('td',null,m.get('texts')||0),c('React').createElement('td',null,m.get('suggs')||0),c('React').createElement('td',null,m.get('humans')||0),c('React').createElement('td',null,m.getIn(['shown',o])||0),c('React').createElement('td',null,m.getIn(['won',o])||0),c('React').createElement('td',null,this._renderEventsLink())));},renderLayers:function(){if(!this.state.isDialogOpen)return {};return {dialog:c('React').createElement(c('OzAIDashboardEventsDialog.react'),{session:this.props.session,onToggle:this._handleDialogToggle,shown:this.state.isDialogOpen})};},_renderEventsLink:function(){var l=this.props.session.get('events');if(!l||l.isEmpty())return c('React').createElement('span',null,'None');return (c('React').createElement('a',{href:'#',onClick:this._handleEventsLinkClick},'Click to View'));},_handleDialogToggle:function(l){this.setState({isDialogOpen:l});},_handleEventsLinkClick:function(l){l.preventDefault();this.setState({isDialogOpen:true});}});function k(l){return c('formatDate')(l/1000,'M d, Y g:ia');}f.exports=j;},null);
__d('OzAIDashboard.react',['OzAPI','immutable','MessengerFlexScrollableArea.react','OzAIDashboardFilters.react','OzAIDashboardRow.react','OzImmutablePureRenderMixin','React','XUITable.react'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('immutable').List,i=c('immutable').Map,j=c('React').PropTypes,k=i({id:'ID','created-at':'Created At',sends:'Sends',texts:'Texts',suggs:'Suggs',humans:'Humans',shown:'Shown',won:'Won'}),l=c('React').createClass({displayName:'OzAIDashboard',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{intentMetas:j.instanceOf(i).isRequired,sessions:j.instanceOf(h).isRequired,isLoaded:j.bool.isRequired,isLoading:j.bool.isRequired,isReversed:j.bool.isRequired,onFetchRequest:j.func.isRequired,onIsReversedChange:j.func.isRequired,onSortByChange:j.func.isRequired,onUUIDChange:j.func.isRequired,onModuleChange:j.func.isRequired,selectedModule:j.string,sortBy:j.string,uuid:j.string},getInitialState:function(){return {modules:h()};},componentDidMount:function(){c('OzAPI').AIModules().done(function(m){if(!this.isMounted())return;this.setState({modules:m});if(m.size>0)this.props.onModuleChange(m.get(0));}.bind(this));},render:function(){return (c('React').createElement(c('MessengerFlexScrollableArea.react'),{onScroll:this._handleScroll,ref:'scrollable'},c('React').createElement(c('OzAIDashboardFilters.react'),{intentMetas:this.props.intentMetas,modules:this.state.modules,isReversed:this.props.isReversed,onIsReversedChange:this.props.onIsReversedChange,onSortByChange:this.props.onSortByChange,onUUIDChange:this.props.onUUIDChange,onModuleChange:this.props.onModuleChange,sortBy:this.props.sortBy,sortableFields:k,uuid:this.props.uuid,selectedModule:this.props.selectedModule}),this._renderTable(),this._renderLoadMoreLink()));},_renderTable:function(){var m=this.props,n=m.intentMetas,o=m.selectedModule;return (c('React').createElement(c('XUITable.react'),{outerBorder:false},c('React').createElement('thead',null,c('React').createElement('tr',null,c('React').createElement('th',null,'ID'),c('React').createElement('th',null,'Created At'),c('React').createElement('th',null,'Intent'),c('React').createElement('th',null,'Sends'),c('React').createElement('th',null,'Texts'),c('React').createElement('th',null,'Suggs'),c('React').createElement('th',null,'Humans'),c('React').createElement('th',null,'Shown'),c('React').createElement('th',null,'Won'),c('React').createElement('th',null,'Events'))),c('React').createElement('tbody',null,this.props.sessions.map(function(p){return (c('React').createElement(c('OzAIDashboardRow.react'),{session:p,intentMeta:n.get(p.get('wit-intent-uuid')),selectedModule:o,key:p.get('id')}));}))));},_renderLoadMoreLink:function(){if(this.props.isLoaded)return null;if(this.props.isLoading)return c('React').createElement('div',null,'Loading...');return (c('React').createElement('div',null,c('React').createElement('a',{href:'#',onClick:function(m){m.preventDefault();this.props.onFetchRequest();}.bind(this)},'Fetch More Sessions')));},_handleScroll:function(){if(!this.props.isLoading&&!this.props.isLoaded&&this.refs.scrollable&&this.refs.scrollable.isScrolledToBottom())this.props.onFetchRequest();}});f.exports=l;},null);
__d('OzAIDashboardContainer.react',['immutable','OzAPI','OzAIDashboard.react','React'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('immutable').List,i=c('immutable').Map,j=c('React').PropTypes,k=30,l={sessions:h(),isLoaded:false,offset:0},m=c('React').createClass({displayName:'OzAIDashboardContainer',propTypes:{witIntents:j.instanceOf(i).isRequired},getInitialState:function(){return babelHelpers['extends']({},l,{isLoading:false,isReversed:true,sortBy:'won',uuid:undefined,selectedModule:undefined});},componentDidMount:function(){this._handleFetchRequest();},render:function(){return (c('React').createElement(c('OzAIDashboard.react'),{intentMetas:this.props.witIntents,sessions:this.state.sessions,modules:this.state.modules,selectedModule:this.state.selectedModule,isLoaded:this.state.isLoaded,isLoading:this.state.isLoading,isReversed:this.state.isReversed,onFetchRequest:this._handleFetchRequest,onIsReversedChange:this._handleIsReversedChange,onSortByChange:this._handleSortByChange,onUUIDChange:this._handleUUIDChange,onModuleChange:this._handleModuleChange,sortBy:this.state.sortBy,uuid:this.state.uuid}));},_handleFetchRequest:function(){if(this.state.isLoading||this.state.isLoaded)return;this.setState({isLoading:true});c('OzAPI').aiDashboard({offset:this.state.offset,limit:k,uuid:this.state.uuid,reverse:this.state.isReversed||undefined,'sort-by':this.state.sortBy||undefined,module:this.state.selectedModule}).done(function(n){this.setState({sessions:this.state.sessions.concat(n),isLoaded:n.size<k,isLoading:false,offset:this.state.offset+n.size});}.bind(this));},_handleModuleChange:function(n){this.setState(babelHelpers['extends']({},l,{selectedModule:n}),this._handleFetchRequest);},_handleUUIDChange:function(n){this.setState(babelHelpers['extends']({},l,{uuid:n}),this._handleFetchRequest);},_handleIsReversedChange:function(n){this.setState(babelHelpers['extends']({},l,{isReversed:n}),this._handleFetchRequest);},_handleSortByChange:function(n){this.setState(babelHelpers['extends']({},l,{sortBy:n}),this._handleFetchRequest);}});f.exports=m;},null);
__d('OzDate.react',['cx','formatDate','joinClasses','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'OzDate',propTypes:{timestamp:i.number.isRequired},statics:{formatTimestamp:function(k){return c('formatDate')(new Date(k),{today:'g:ia',withinWeek:'D g:ia',thisYear:'M jS, g:ia',older:'m/d/Y g:ia'});}},render:function(){var k=this.constructor.formatTimestamp(this.props.timestamp);return (c('React').createElement('time',{className:c('joinClasses')("_2s4p",this.props.className)},k));}});f.exports=j;},null);
__d('OzLastEvent.react',['cx','OzHelpers','OzConstants','OzImmutablePureRenderMixin','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('OzConstants').AUTHOR_TYPES,j=c('React').PropTypes,k=c('React').createClass({displayName:'OzLastEvent',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{name:j.string.isRequired,lastEvent:j.object.isRequired},render:function(){var l=this.props.lastEvent,m=c('OzHelpers').authorType(l)===i.USER?this.props.name.split(' ')[0].substr(0,10):'M',n=l.get('text'),o=c('OzHelpers').shortDesc(l)||'did something',p=n&&m+': '+n||m+' '+o;return (c('React').createElement('div',{className:"_4-_6 _4-_7",title:p},this._renderText(m,o)));},_renderText:function(l,m){return (c('React').createElement('span',null,c('React').createElement('span',{className:"_3ikz"},l,': '),m));}});f.exports=k;},null);
__d('OzStrings',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();f.exports={NOTREADY_BUTTON:'I\'m waiting',IS_NOTREADY:'Currently waiting',READY_BUTTON:'The user is waiting for us!',USER_FILTER_ALL:'All users',USER_FILTER_PUBLIC:'Public only',USER_FILTER_EMPLOYEE:'Employee only',READY_FILTER_ALL:'All threads',READY_FILTER_ATTENTION:'Needs attention',READY_FILTER_WAITING:'I\'m waiting'};},null);
__d('OzThreadLabels.react',['cx','OzHelpers','OzAPI','ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','joinClasses','immutable','ReactLayeredComponentMixin','OzImmutablePureRenderMixin','React','ReactDOM','XUICloseButton.react','XUIContextualDialog.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('immutable').OrderedMap,k=c('immutable').List,l=c('React').PropTypes,m=c('React').createClass({displayName:'Label',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{noColor:l.bool,removable:l.bool,shade:l.oneOf(['dark','light']),thread:l.instanceOf(i).isRequired},getDefaultProps:function(){return {shade:'dark'};},render:function(){if(!this.props.shown)return null;return (c('React').createElement('div',{className:c('joinClasses')("_2yqb"+(this.props.noColor?' '+"_2yqc":'')+(' '+"_2yqd"),this.props.className)},this.props.text,this.props.removable&&this.props.onRemove?c('React').createElement(c('XUICloseButton.react'),{className:"_2yqe",onClick:this.props.onRemove,shade:this.props.shade}):null));}});function n(aa){return (c('React').createElement(m,babelHelpers['extends']({},aa,{className:"_2yqi",text:'REMINDER',shown:!c('OzHelpers').urgentReminders(aa.thread).isEmpty()})));}function o(aa){return (c('React').createElement(m,babelHelpers['extends']({},aa,{className:"_2yqj",text:'PAID',shown:!c('OzHelpers').paidReminders(aa.thread).isEmpty()})));}function p(aa){var ba=c('OzHelpers').minAge(aa.thread);return (c('React').createElement(m,babelHelpers['extends']({},aa,{className:"_2yqm",text:ba<18&&'UNDER 18'||ba<21&&'UNDER 21',shown:ba<21})));}function q(aa){return (c('React').createElement(m,babelHelpers['extends']({},aa,{className:"_2yql",text:'ENGAGE',shown:c('OzHelpers').hasEngage(aa.thread)})));}var r=j({OzVIPLabel:['vip',"_2yqf"],OzUrgentLabel:['urgent',"_2yqg"],OzAbuserLabel:['abuser',"_2yqh"],OzEscalatedLabel:['escalated',"_1jce"]}),s=j({OzEmployeeLabel:['employee',"_2yqk"]}),t=r.merge(s).map(function(aa){var ba=aa[0],ca=aa[1];return ba;}).toSet();function u(aa,ba,ca){return function(da){return (c('React').createElement(m,babelHelpers['extends']({},da,{className:ba,text:z(aa),shown:c('OzHelpers').hasTag(da.thread,aa),onRemove:function(){return c('OzAPI').deleteTag(c('OzHelpers').threadID(da.thread),aa);}})));};}var v=r.map(function(aa){return u.apply(undefined,aa);}),w=s.map(function(aa){return u.apply(undefined,aa);});function x(aa){var ba=aa.className,ca=aa.removable,da=aa.addable,ea=babelHelpers.objectWithoutProperties(aa,['className','removable','addable']);return (c('React').createElement('div',{className:ba},w.map(function(fa,ga){return c('React').createElement(fa,babelHelpers['extends']({key:ga},ea));}).valueSeq(),c('React').createElement(n,ea),v.map(function(fa,ga){return c('React').createElement(fa,babelHelpers['extends']({key:ga,removable:ca},ea));}).valueSeq(),(ea.thread.get('tags')||k()).filterNot(function(fa){return t.has(fa);}).sort().map(function(fa){var ga=u(fa,"_tch");return ga(babelHelpers['extends']({key:fa,removable:ca},ea));}),c('React').createElement(q,ea),c('React').createElement(o,ea),da?c('React').createElement(y,{thread:ea.thread}):null));}var y=c('React').createClass({displayName:'OzAddLabel',mixins:[c('OzImmutablePureRenderMixin'),c('ReactLayeredComponentMixin')],propTypes:{thread:l.instanceOf(i).isRequired},getInitialState:function(){return {shown:false};},render:function(){return (c('React').createElement('span',{ref:'add'},this._tags().isEmpty()?null:c('React').createElement('button',{className:"_1-hv _2yqb _2yqn _2yqo",onClick:function(){return this.setState({shown:true});}.bind(this)},'+')));},renderLayers:function(){var aa=this.state.shown;if(!aa)return null;var ba=this.props.thread;return {contextualDialog:c('React').createElement(c('XUIContextualDialog.react'),{behaviors:{ContextualLayerAutoFlip:c('ContextualLayerAutoFlip'),ContextualLayerUpdateOnScroll:c('ContextualLayerUpdateOnScroll')},position:'below',shown:aa,context:c('ReactDOM').findDOMNode(this.refs.add),onBlur:function(ca){return this.setState({shown:false});}.bind(this)},c('React').createElement('div',{className:"_2yqp"},this._tags().map(function(ca){var da=ca[0],ea=ca[1];return (c('React').createElement('button',{key:da,className:c('joinClasses')(ea,"_1-hv _2yqq"),onClick:function(){this.setState({shown:false});c('OzAPI').createTag(c('OzHelpers').threadID(ba),da);}.bind(this)},z(da)));}.bind(this))))};},_tags:function(){return r.filterNot(function(aa){var ba=aa[0],ca=aa[1];return c('OzHelpers').hasTag(this.props.thread,ba);}.bind(this)).valueSeq();}});function z(aa){return aa.split('m_experiment_').join('').toUpperCase();}f.exports={OzLabelList:x,OzUnderageLabel:p};},null);
__d('OzAllRow.react',['cx','OzStrings','OzHelpers','immutable','OzButton.react','OzConfig','OzConstants','OzDate.react','OzLastEvent.react','OzThreadLabels.react','OzUserImage.react','OzImmutablePureRenderMixin','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('immutable').List,k=c('OzConstants').AUTHOR_TYPES,l=c('React').PropTypes,m=c('OzThreadLabels.react').OzLabelList,n=c('OzHelpers').pure(function(w){var x=w.thread,y=w.witIntents,z=babelHelpers.objectWithoutProperties(w,['thread','witIntents']);return (c('React').createElement('div',{className:"_-66"},c('React').createElement(t,{width:'220px'},c('React').createElement(o,{thread:x})),c('React').createElement(t,{marginLeft:'10px',width:'250px'},c('React').createElement(p,{thread:x,witIntents:y})),c('React').createElement(t,{marginLeft:'10px',width:'350px'},c('React').createElement(q,{thread:x})),c('React').createElement(t,{marginLeft:'10px',width:'150px'},c('React').createElement(r,{thread:x})),c('React').createElement(t,{margineft:'10px',flex:'1',alignItems:'right'},c('React').createElement(s,babelHelpers['extends']({thread:x},z)))));}),o=c('OzHelpers').pure(function(w){var x=w.thread;return (c('React').createElement('div',{className:"_-67"},c('React').createElement(c('OzUserImage.react'),{photo:c('OzHelpers').photo(x)}),c('React').createElement('div',{className:"_-68"},c('React').createElement('h1',{className:"_-69"},c('OzHelpers').getName(x)),c('React').createElement(m,{className:"_-6a",thread:x}))));}),p=c('OzHelpers').pure(function(w){var x=w.thread,y=w.witIntents,z=c('OzHelpers').openIntents(x).toSeq().map(function(ba){return y.getIn([ba.get('wit-intent-uuid'),'name']);}).filter(function(ba){return ba;}).map(function(ba){return 'Intent: '+ba;}),aa=c('OzHelpers').urgentReminders(x).toSeq().map(function(ba){return ba.getIn(['body','description']);}).filter(function(ba){return ba;}).map(function(ba){return 'Reminder: '+ba;});return (c('React').createElement('div',{className:"_-6q"},c('React').createElement('div',{className:"_-6r"},z.concat(aa).map(function(ba,ca){return (c('React').createElement('div',{key:ca,className:"_4-_7 _-6s"},ba));}))));}),q=c('OzHelpers').pure(function(w){var x=w.thread;return (c('React').createElement('div',{className:"_-6u"},u(x).map(function(y){return (c('React').createElement('div',{key:c('OzHelpers').msgID(y),className:"_-6v"+(c('OzHelpers').authorType(y)!==k.USER?' '+"_-6w":'')},c('React').createElement('span',{className:"_4-_7 _-6x"},c('React').createElement(c('OzDate.react'),{timestamp:y.get('timestamp')})),c('React').createElement(c('OzLastEvent.react'),{key:c('OzHelpers').msgID(y),name:c('OzHelpers').getName(x),lastEvent:y})));})));}),r=c('OzHelpers').pure(function(w){var x=w.thread,y=x.getIn(['owner','name'])||'No owner',z=x.getIn(['last-owner','name']);return (c('React').createElement('div',{className:"_-6y"},c('React').createElement('div',{className:"_-6z"},y),z?c('React').createElement('div',{className:"_-6-"},'Last owner: ',z):null));}),s=c('React').createClass({displayName:'Actions',mixins:[c('OzImmutablePureRenderMixin')],contextTypes:{uid:l.string.isRequired},propTypes:{thread:l.instanceOf(i).isRequired,onThreadNotReady:l.func.isRequired,onThreadReady:l.func.isRequired,onThreadRelease:l.func.isRequired,onThreadView:l.func.isRequired},render:function(){return (c('React').createElement('div',{className:"_-6_"},v(babelHelpers['extends']({},this.props,{uid:this.context.uid})).map(function(w){var x=w.body,y=w.f;return (c('React').createElement(c('OzButton.react'),{key:x,onClick:function(z,aa){return y(this.props.thread,aa,z);}.bind(this)},x));}.bind(this))));}}),t=c('OzHelpers').pure(function(w){var x=w.children,y=babelHelpers.objectWithoutProperties(w,['children']);return (c('React').createElement('div',{className:"_-70",style:y},x));});function u(w){var x=c('OzHelpers').lastEvents(w).groupBy(c('OzHelpers').authorType);return j([x.get(k.USER),x.get(k.TRAINER),x.get(k.BOT)]).toSeq().filter(function(y){return y;}).map(function(y){return y.last();}).sortBy(function(y){return y.get('timestamp');});}function v(w){var x=w.onThreadNotReady,y=w.onThreadReady,z=w.onThreadRelease,aa=w.onThreadView,ba=w.thread,ca=w.uid,da=ba,ea=c('OzConfig').getInStaticConfig(['GK','supervisor']),fa=[];if(ea&&c('OzHelpers').hasOwner(da))fa.push({body:'Release',f:z});if(da.get('ready')){fa.push({body:c('OzStrings').NOTREADY_BUTTON,f:x});}else if(ea)fa.push({body:c('OzStrings').READY_BUTTON,f:y});if(da.getIn(['owner','id'])!==ca&&!c('OzHelpers').isSubscriber(da,ca))fa.push({body:'View',f:aa});return fa;}f.exports=n;},null);
__d('OzAll.react',['cx','OzStrings','OzAPI','OzHelpers','immutable','MessengerFlexScrollableArea.react','OzActions','OzAllRow.react','OzLoading.react','OzStores','promiseFinally','OzImmutablePureRenderMixin','React','Reflux','XUIButton.react','XUIRadioButtonGroup.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('OzLoading.react').Flex,k=c('OzLoading.react').Inline,l=c('OzStores').QueueFilterStore,m=c('OzStores').ThreadStore,n=c('React').PropTypes,o=c('React').createClass({displayName:'OzAll',mixins:[c('Reflux').connect(l,'filters'),c('Reflux').connect(m,'threads')],propTypes:{witIntents:n.instanceOf(i).isRequired},contextTypes:{router:n.object.isRequired},getInitialState:function(){return {clientLimit:y};},componentWillMount:function(){if(this.state.threads.size<y)this._fetchThreads();},componentDidUpdate:function(ca,da){var ea=da.filters.get('all'),fa=this.state.filters.get('all');if(!c('immutable').is(ea,fa))this._fetchThreads();},render:function(){var ca=this._getFilters(),da=ca[0],ea=ca[1],fa=this._threads();return (c('React').createElement('div',{className:"_3l5z"},c('React').createElement(q,{showTags:da,hideTags:ea,onChange:this._handleFilterChange}),c('React').createElement(p,{threads:fa,loading:!!w[aa(da,ea)],clientLimit:this.state.clientLimit,onScrollBottom:this._handleScrollBottom,onThreadNotReady:this._handleThreadNotReady,onThreadReady:this._handleThreadReady,onThreadRelease:this._handleThreadRelease,onThreadView:this._handleThreadView,witIntents:this.props.witIntents})));},_getFilters:function(){var ca=this.state.filters.get('all');return [ca.get('showTags'),ca.get('hideTags')];},_fetchThreads:function(){ba(this._getFilters());},_threads:function(){return t(s(this.state.threads),this._getFilters());},_handleFilterChange:function(ca){c('OzActions').updateQueueFilters(i({all:i(ca)}));this.setState({clientLimit:y});},_handleScrollBottom:function(){var ca=this.state.clientLimit,da=this._threads(),ea=ca+y;this.setState({clientLimit:ea});da.slice(ca,ea).size||this._fetchThreads();},_handleThreadNotReady:function(ca,da){c('OzAPI').notready(c('OzHelpers').threadID(ca)).done(da,da);},_handleThreadReady:function(ca,da){c('OzAPI').ready(c('OzHelpers').threadID(ca)).done(da,da);},_handleThreadRelease:function(ca,da){c('OzAPI').release(c('OzHelpers').threadID(ca)).done(da,da);},_handleThreadView:function(ca,da,ea){var fa=c('OzHelpers').threadID(ca),ga=c('OzHelpers').hasCmdOrCtrl(ea);c('OzAPI').view(fa).done(function(ha){da();ga||this.context.router.push('/inbox/'+fa);}.bind(this),da);}}),p=c('React').createClass({displayName:'ThreadList',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{clientLimit:n.number.isRequired,loading:n.bool.isRequired,onScrollBottom:n.func.isRequired,onThreadNotReady:n.func.isRequired,onThreadReady:n.func.isRequired,onThreadRelease:n.func.isRequired,onThreadView:n.func.isRequired,threads:n.instanceOf(i).isRequired,witIntents:n.instanceOf(i).isRequired},render:function(){var ca=this.props,da=ca.loading,ea=ca.threads,fa=ca.clientLimit;if(da&&!ea.count())return c('React').createElement(j,null);return (c('React').createElement(c('MessengerFlexScrollableArea.react'),{ref:'scrollable',onScroll:this._handleScroll},c('React').createElement('div',{className:"_3l5-"},ea.take(fa).map(function(ga){return (c('React').createElement(c('OzAllRow.react'),{key:c('OzHelpers').threadID(ga),thread:ga,witIntents:this.props.witIntents,onThreadNotReady:this.props.onThreadNotReady,onThreadReady:this.props.onThreadReady,onThreadRelease:this.props.onThreadRelease,onThreadView:this.props.onThreadView}));}.bind(this)).valueSeq()),c('React').createElement(k,{loading:da})));},_handleScroll:function(){var ca=this.refs.scrollable;ca&&ca.isScrolledToBottom()&&this.props.onScrollBottom();}}),q=c('OzHelpers').pure(function(ca){var da,ea,fa=ca.showTags,ga=ca.hideTags,ha=ca.onChange,ia=function(ja){var ka=ja.tagName,la=ja.value,ma=v({tagName:ka,value:la,showTags:fa,hideTags:ga});ha(ma);};return (c('React').createElement('div',{className:"_3l5_"},c('React').createElement(r,{tagName:'employee',value:u('employee',fa,ga),onChange:ia,buttons:(da={},da[u.NEUTRAL]=c('OzStrings').USER_FILTER_ALL,da[u.OFF]=c('OzStrings').USER_FILTER_PUBLIC,da[u.ON]=c('OzStrings').USER_FILTER_EMPLOYEE,da)}),c('React').createElement(r,{tagName:'ready',value:u('ready',fa,ga),onChange:ia,buttons:(ea={},ea[u.NEUTRAL]=c('OzStrings').READY_FILTER_ALL,ea[u.OFF]=c('OzStrings').READY_FILTER_ATTENTION,ea[u.ON]=c('OzStrings').READY_FILTER_WAITING,ea)})));}),r=c('OzHelpers').pure(function(ca){var da=ca.tagName,ea=ca.value,fa=ca.buttons,ga=ca.onChange;return (c('React').createElement('div',{key:da,className:"_3l60"},c('React').createElement(c('XUIRadioButtonGroup.react'),{selectedValue:ea,selectedUse:'confirm',onValueChange:function(ha){ga({tagName:da,value:ha});}},Object.keys(fa).map(function(ha){return c('React').createElement(c('XUIButton.react'),{key:ha,value:ha,label:fa[ha]});}))));});function s(ca){return ca.sortBy(function(da){return -da.get('last-event-at');});}function t(ca,da){var ea=da[0],fa=da[1];return ca.filter(function(ga){var ha=true;if(ea.size)ha=c('OzHelpers').hasAllTags(ga,ea);if(fa.size)ha=!c('OzHelpers').hasSomeTag(ga,fa);return ha;});}var u=function(ca,da,ea){return da.has(ca)?u.ON:ea.has(ca)?u.OFF:u.NEUTRAL;};u.ON='on';u.OFF='off';u.NEUTRAL='neutral';function v(ca){var da=ca.tagName,ea=ca.value,fa=ca.showTags,ga=ca.hideTags,ha,ia;switch(ea){case u.ON:ha=fa.add(da);ia=ga.remove(da);break;case u.OFF:ha=fa.remove(da);ia=ga.add(da);break;default:ha=fa.remove(da);ia=ga.remove(da);break;}return {showTags:ha,hideTags:ia};}var w={},x={},y=20,z=2*y;function aa(ca,da){var ea=ca.toJS().join('-'),fa=da.toJS().join('-');return 'show['+ea+']hide['+fa+']';}function ba(ca){var da=ca[0],ea=ca[1],fa=aa(da,ea),ga=w[fa];c('OzHelpers').debug('[oz-all] fetchThreads',fa);if(ga){c('OzHelpers').debug('[oz-all] abort fetchthreads : loading',fa);return;}var ha=x[fa]||0;w[fa]=true;c('promiseFinally')(c('OzAPI').allThreads(da,ea,ha,z),function(ia){return w[fa]=false;}).done(function(ia){return x[fa]=ha+z;});}f.exports=o;},null);
__d('OzMessage.react',['cx','getURLRanges','OzHelpers','Image.react','immutable','Link.react','MNCommerceAgentItemSuggestionMercuryShareAttachment.react','OzExpirationCountdown.react','OzImmutablePureRenderMixin','React','TextWithEntities.react','XStickerAssetController'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('immutable').List,k=c('React').PropTypes,l=c('React').createClass({displayName:'OzMessage',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{message:k.instanceOf(i).isRequired},render:function(){var ia=this.props.message,ja=ia.get('attachments')||j(),ka=j([ia.get('text')&&ga(ia.get('text'))]).concat(ja.map(function(la){var ma=t(la)&&u(la)||aa(la)&&ca(ba(la))||z(la)&&ca(la.get('uri'))||x(la)&&y(la)||v(la)&&w(la)||q(la)&&r(la)||m(la)&&p(o(la.get('metadata')))||n(la)&&p(c('OzHelpers').uiSuggestion(la.get('suggestion')))||da(la)&&ea(la.getIn(['xma','link']))||la.get('uri')&&ea(la.get('uri'));if(ma){return ma;}else{c('OzHelpers').error('could not render attachment',la.toJS(),ia.toJS());return ha('Oops. We could not render this attachment.');}})).filter(function(la){return !!la;}).map(function(la,ma){return (c('React').createElement('span',{key:ma,className:"_15_n"},la));});if(ka.size){return c('React').createElement('span',null,ka);}else{c('OzHelpers').error('no text or attachments',ia.toJS());return ha('Oops. We did not get text or attachments.');}}}),m=function(ia){return ia.hasIn(['metadata','target_url']);},n=function(ia){return ia.has('suggestion');},o=function(ia){if(!i.isMap(ia.get('total_cost'))&&ia.has('raw_amount'))ia=ia.set('total_cost',i({amount:+ia.get('raw_amount')}));return ia.update('target_url',c('OzHelpers').shimURI).toJS();};function p(ia){return (c('React').createElement('div',{className:"_53qw"},ia.expiration_time?c('React').createElement('div',{className:"_4jjz"},c('React').createElement(c('OzExpirationCountdown.react'),{endTime:ia.expiration_time*1000})):null,c('React').createElement('div',{className:"_4jj-"},c('React').createElement(c('MNCommerceAgentItemSuggestionMercuryShareAttachment.react'),{attachment:{target:ia}}))));}var q=function(ia){var ja=ia.get('metadata');return ja&&ja.get('location')&&ja.get('url')&&ja.get('image_url');};function r(ia){return ca(ia.getIn(['metadata','image_url']),ia.getIn(['metadata','url']));}var s=function(ia){var ja=ia.get('uri'),ka=ia.get('sticker_id');if(ka)ja=c('XStickerAssetController').getURIBuilder().setInt('sticker_id',ka).getURI().toString();return ja;},t=function(ia){return ia.get('sticker_id')&&s(ia);};function u(ia){return (c('React').createElement(c('Image.react'),{className:"__vl",src:s(ia)}));}var v=function(ia){return (/video/.test(ia.get('mime_type'))&&ia.get('uri'));};function w(ia){return (c('React').createElement('video',{controls:true,height:'300',width:'300'},c('React').createElement('source',{src:ia.get('uri'),type:ia.get('mime_type')})));}var x=function(ia){return (/audio/.test(ia.get('mime_type'))&&ia.get('uri'));};function y(ia){return (c('React').createElement('audio',{className:"_1d86",controls:true},c('React').createElement('source',{src:ia.get('uri'),type:ia.get('mime_type')})));}var z=function(ia){var ja=/blob:/.test(ia.get('uri')),ka=/\.(jpg|gif|png)/.test(ia.get('uri'));return ia.get('uri')&&(c('OzHelpers').isImageType(ia.get('mime_type'))||ja||ka);},aa=function(ia){return (/base64/.test(ia.get('mime_type'))&&ia.get('data'));},ba=function(ia){return ia.get('mime_type')+','+ia.get('data');};function ca(ia,ja){return (c('React').createElement('a',{href:ja||ia,target:'_blank',className:"_4y6l",style:{backgroundImage:'url(\''+ia+'\')'}}));}var da=function(ia){return !!ia.getIn(['xma','link']);};function ea(ia){return (c('React').createElement('div',{className:"_4y6k"},c('React').createElement('a',{href:ia,target:'_blank'},'Attachment Link')));}function fa(ia,ja){return (c('React').createElement(c('Link.react'),{target:'_blank',href:c('OzHelpers').shimURI(ja.entity.url)},ia));}function ga(ia){return (c('React').createElement(c('TextWithEntities.react'),{className:"_4y6k",text:ia,interpolator:fa,ranges:c('getURLRanges')(ia),renderEmoticons:true,renderEmoji:true}));}function ha(ia){return (c('React').createElement('div',{className:"_4y6k _5kng"},ia));}f.exports=l;},null);
__d('OzSearchSource',['AbstractSearchSource'],function a(b,c,d,e,f,g){var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('AbstractSearchSource'));i=h&&h.prototype;function j(k){'use strict';i.constructor.call(this);this.$OzSearchSource1=k;}j.prototype.bootstrap=function(){'use strict';return this.$OzSearchSource1({});};j.prototype.suggest=function(k){'use strict';return this.$OzSearchSource1(k);};j.prototype.searchImpl=function(k,l){'use strict';return this.$OzSearchSource1({query:k}).then(function(m){return l(m,k);},function(m){return l([],k);});};f.exports=j;},null);
__d('OzFeedbackDashboard.react',['cx','Promise','OzAPI','OzHelpers','immutable','OzButton.react','OzConfig','OzMessage.react','OzSearchSource','OzImmutablePureRenderMixin','React','Reflux','SearchableDropdownInput.contrib','SearchableEntry','Stars.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('React').PropTypes,k=c('React').createClass({displayName:'OzFeedbackDashboard',mixins:[c('OzImmutablePureRenderMixin'),c('Reflux').connect(c('OzConfig').ConfigStore,'config')],propTypes:{reps:j.instanceOf(i).isRequired},contextTypes:{uid:j.string.isRequired,router:j.object.isRequired},getInitialState:function(){return {messages:i(),authorID:this.context.uid};},componentWillMount:function(){this._searchSource=new (c('OzSearchSource'))(function(aa){var ba=(aa.query||'').toLowerCase();return new (c('Promise'))(function(ca){return ca(this.props.reps.valueSeq().map(s).concat([s('autoresponse-bot'),s('survey-bot')]).sortBy(function(da){return da.getTitle();}).filter(function(da){return (da.getTitle()||'').toLowerCase().indexOf(ba)>-1;}).toJS());}.bind(this));}.bind(this));},componentDidMount:function(){this._fetchFeedback();},render:function(){return (c('React').createElement('div',{className:"_60f"},this.state.config.getIn(['GK','supervisor'])?c('React').createElement(l,{reps:this.props.reps,authorID:this.state.authorID,searchSource:this._searchSource,onSelect:function(aa){return this.setState({messages:i(),activeMessage:null,authorID:aa.getUniqueID()},this._fetchFeedback);}.bind(this)}):null,c('React').createElement(m,{messages:this.state.messages}),c('React').createElement(p,{messages:this.state.messages,reps:this.props.reps,activeMessage:this.state.activeMessage||this.state.messages.first(),onMessageClick:function(aa){return this.setState({activeMessage:aa});}.bind(this),onSeeThreadClick:function(aa){return this.context.router.push('/inbox/'+aa);}.bind(this)})));},_fetchFeedback:function(){c('OzAPI').authorFeedback(this.state.authorID).done(function(aa){aa=aa.sortBy(function(ba){return -ba.get('timestamp');});this.isMounted()&&this.setState({messages:aa});}.bind(this));}}),l=c('OzHelpers').pure(function(aa){var ba=aa.reps,ca=aa.authorID,da=aa.searchSource,ea=aa.onSelect;return (c('React').createElement('div',{className:"_5p66"},c('React').createElement('div',{className:"_wa_"},c('React').createElement(c('SearchableDropdownInput.contrib'),{value:s(ba.get(ca)||ca),onSelect:ea,placeholder:'Pick a rep',emptySearchResultsText:'No Rep found',searchSource:da}))));}),m=c('OzHelpers').pure(function(aa){var ba=aa.messages,ca=z(ba,-7,0),da=z(ba,-14,-7);return (c('React').createElement('div',{className:"_wb0"},c('React').createElement('div',{className:"_wb1"},c('React').createElement(n,{label:'OVERALL RATING'},y(ca),'%'),c('React').createElement(n,{label:'SINCE LAST WEEK'},c('React').createElement(o,{value:y(ca)-y(da)}))),c('React').createElement('div',{className:"_wb2"},c('React').createElement(n,{label:'TONE'},w(ca),'%'),c('React').createElement(n,{label:'RESPONSIVENESS'},v(ca),'%'),c('React').createElement(n,{label:'EXECUTION'},u(ca),'%'),c('React').createElement(n,{label:'POLICY'},x(ca),'%')),c('React').createElement('div',{className:"_3gch"},c('React').createElement(n,{label:'FEEDBACK GIVEN LAST WEEK'},ca.size))));}),n=c('OzHelpers').pure(function(aa){var ba=aa.label,ca=aa.children;return (c('React').createElement('div',{className:"_wb3"},c('React').createElement('span',{className:"_wb4"},ca),c('React').createElement('span',{className:"_wb5"},ba)));}),o=c('OzHelpers').pure(function(aa){var ba=aa.value;return (c('React').createElement('div',{className:(ba>0?"_wb6":'')+(ba<0?' '+"_wb7":'')},ba>0?'+':null,ba,'%'));}),p=c('OzHelpers').pure(function(aa){var ba=aa.messages,ca=aa.reps,da=aa.activeMessage,ea=aa.onMessageClick,fa=aa.onSeeThreadClick,ga=da&&da.get('reviews'),ha=da&&da.get('user-id');return (c('React').createElement('div',{className:"_wb8"},c('React').createElement('div',{className:"_wbc"},c('React').createElement('div',{className:"_4fj7"},ba.map(function(ia){return (c('React').createElement('div',{key:c('OzHelpers').msgID(ia),onClick:function(ja){return ea(ia);},className:"_wbf"+(ia===da?' '+"_wbg":'')},c('React').createElement(c('OzMessage.react'),{message:ia})));}).valueSeq())),c('React').createElement('div',{className:"_wbh"},c('React').createElement('div',{className:"_wbe"},ga?ga.map(function(ia){return (c('React').createElement(q,{key:ia.get('id'),rep:ca.get(ia.get('reviewer-id')),review:ia}));}).valueSeq():null)),c('React').createElement('div',{className:"_wbi"},ha?c('React').createElement(c('OzButton.react'),{onClick:function(ia){return fa(ha);}},'See Thread'):null)));}),q=c('OzHelpers').pure(function(aa){var ba=aa.review,ca=aa.rep;return (c('React').createElement('div',{className:"_wbj"},c('React').createElement('div',{className:"_wbk"},c('React').createElement('h2',{className:"_wbl"},ca&&ca.get('name')),ba.has('tone')?c('React').createElement(r,{label:'Tone'},c('React').createElement(c('Stars.react'),{count:ba.get('tone'),max:3,size:'large'})):null,ba.has('responsiveness')?c('React').createElement(r,{label:'Responsiveness'},c('React').createElement(c('Stars.react'),{count:ba.get('responsiveness'),max:3,size:'large'})):null,ba.has('execution')?c('React').createElement(r,{label:'Execution'},c('React').createElement(c('Stars.react'),{count:ba.get('execution'),max:3,size:'large'})):null,ba.has('followed-policy')?c('React').createElement(r,{label:'Followed Policy?'},c('React').createElement('div',{className:"_wbm"},ba.get('followed-policy')?'YES':'NO')):null),c('React').createElement('div',{className:"_wbn"},ba.get('body'))));}),r=c('OzHelpers').pure(function(aa){var ba=aa.label,ca=aa.children;return (c('React').createElement('div',{className:"_wbo"},ca,c('React').createElement('div',{className:"_wbp"},ba)));});function s(aa){var ba=function(ca){return new (c('SearchableEntry'))(ca);};return aa?aa.get?ba({title:aa.get('name'),uniqueID:aa.get('fbid')}):ba({title:aa,uniqueID:aa}):null;}function t(aa,ba){return function(ca){var da=ca.valueSeq().flatMap(function(ha){return ha.get('reviews');}).filter(function(ha){return ha&&ha.has(aa);}),ea=da.reduce(function(ha,ia){var ja=ha[0],ka=ha[1];return [ja+ba,ka+ia.get(aa)];},[0,0]),fa=ea[0],ga=ea[1];return fa?Math.round(ga/fa*100):0;};}var u=t('execution',3),v=t('responsiveness',3),w=t('tone',3),x=t('followed-policy',1);function y(aa){return Math.round((v(aa)+w(aa)+x(aa)+u(aa))/4);}function z(aa,ba,ca){var da=new Date().getDate(),ea=+new Date(Date.now()).setDate(da+ba),fa=+new Date(Date.now()).setDate(da+ca);return aa.filter(function(ga){var ha=+ga.get('timestamp');return ha>=ea&&ha<=fa;});}f.exports=k;},null);
__d('OzInboxThreadRow.react',['cx','OzHelpers','immutable','OzLastEvent.react','OzThreadLabels.react','OzUserImage.react','OzImmutablePureRenderMixin','React','Timestamp.react','Tooltip'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('OzThreadLabels.react').OzLabelList,k=c('React').PropTypes,l=c('React').createClass({displayName:'OzInboxThreadRow',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{thread:k.object.isRequired,locker:k.object.isRequired,selected:k.bool.isRequired,onClick:k.func.isRequired,onUnview:k.func.isRequired,witIntents:k.instanceOf(i).isRequired},contextTypes:{uid:k.string.isRequired},render:function(){var o=this.props,p=o.thread,q=o.locker,r=o.selected,s=o.subscribed,t=o.owned,u=o.onUnview,v=c('OzHelpers').getName(p),w=c('OzHelpers').photo(p),x=c('OzHelpers').lastEvents(p).last(),y=!t&&p.get('ui-reassign'),z=c('OzHelpers').hasPaid(p),aa=c('OzHelpers').hasReminder(p),ba=p.get('locked'),ca=ba?'Thread locked by '+q.get('name')+'\n       at '+new Date(p.get('locked-at')).toLocaleString():'',da=t&&(p.get('ready')||z||aa)&&!ba,ea=null,fa=t&&p.get('ui-ping')&&!p.get('ui-reassign'),ga=x&&x.get('timestamp');if(!t){var ha=p.get('ui-reassign')?'Reassigned to':'Grabbed by';ea=ha+' '+c('OzHelpers').nameOrId(p.get('owner'));}return (c('React').createElement('div',{onClick:this._handleClick,className:(fa?"_2q49":'')+(' '+"_2ic2")+(da?' '+"_2ic3":'')+(aa?' '+"_2ic5":'')+(z?' '+"_2ic6":'')+(r?' '+"_2ic7":'')+(y?' '+"_2q4a":'')},c('React').createElement('div',{className:"_2ic8"},c('React').createElement(c('OzUserImage.react'),{photo:w}),s?c('React').createElement('button',{className:"_1-hv _2ic9",onClick:function(ia){return u(p);}}):null),c('React').createElement('div',{className:"_2ica"},!t?c('React').createElement(m,{name:ea}):null,c('React').createElement('h1',{className:"_4-_7 _2ice"},v),c('React').createElement(n,{thread:p,witIntents:this.props.witIntents}),c('React').createElement('div',{className:"_2icb"},x?c('React').createElement(c('OzLastEvent.react'),{lastEvent:x,name:v}):null),c('React').createElement('div',{className:"_3lxn"},c('React').createElement(j,{className:"_2icc",thread:p}))),c('React').createElement('div',{className:"_6f"},ga?c('React').createElement('div',{className:"_2icf"},c('React').createElement(c('Timestamp.react'),{autoUpdate:true,shorten:true,time:ga/1000})):null,c('React').createElement('div',babelHelpers['extends']({className:ba?"_1hw":''},c('Tooltip').propsFor(ca))))));},_handleClick:function(){this.props.onClick(this.props.thread);}});function m(o){var p=o.name,q=o.lastEvent,r=q&&q.get('timestamp');return (c('React').createElement('div',{className:"_2icd"},c('React').createElement('h1',{className:"_4-_7 _2ice"},p),r?c('React').createElement('div',{className:"_2icf"},c('React').createElement(c('Timestamp.react'),{autoUpdate:true,shorten:true,time:r/1000})):null));}function n(o){var p=o.thread,q=o.witIntents,r=c('OzHelpers').openIntents(p).first(),s=r&&q.getIn([r.get('wit-intent-uuid'),'name']);return s?c('React').createElement('div',{className:"_2icg"},s):c('React').createElement('span',null);}f.exports=l;},null);
__d('OzInboxThreadList.react',['cx','OzHelpers','joinClasses','OzInboxThreadRow.react','immutable','OzLoading.react','OzImmutablePureRenderMixin','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('immutable').OrderedMap,k=c('React').PropTypes,l=c('OzLoading.react').Inline,m=c('React').createClass({displayName:'OzInboxThreadList',mixins:[c('OzImmutablePureRenderMixin')],contextTypes:{uid:k.string.isRequired},propTypes:{loading:k.bool.isRequired,onThreadClick:k.func.isRequired,onUnview:k.func.isRequired,threadGroups:k.instanceOf(j).isRequired,witIntents:k.instanceOf(i).isRequired,className:k.string,selectedThread:k.string},render:function(){return (c('React').createElement('div',{className:c('joinClasses')("_36ob",this.props.className)},this.props.threadGroups.map(this._renderRows).valueSeq(),this.props.threadGroups.some(function(o){return o.count();})?c('React').createElement(l,{key:'l',loading:this.props.loading}):c('React').createElement(n,null)));},_renderRows:function(o,p){var q=o.map(function(r){return (c('React').createElement(c('OzInboxThreadRow.react'),{key:c('OzHelpers').threadID(r),thread:r,locker:this.props.reps.get(r.get('locker-id'),i()),owned:c('OzHelpers').isOwner(r,this.context.uid),selected:c('OzHelpers').threadID(r)===this.props.selectedThread,subscribed:c('OzHelpers').isSubscriber(r,this.context.uid),onClick:this.props.onThreadClick,onUnview:this.props.onUnview,witIntents:this.props.witIntents}));}.bind(this)).valueSeq();return (c('React').createElement('span',{className:"_36oc",key:p},q));}});function n(){return (c('React').createElement('div',{className:"_725"},'You do not own any threads at the moment.',c('React').createElement('br',null)));}f.exports=m;},null);
__d('OzTabHeader.react',['cx','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(j){var k=j.tabs,l=j.onChange,m=j.active;return (c('React').createElement('div',{className:"_2j6l"},k.map(function(n){var o=n[0],p=n[1];return (c('React').createElement('button',{key:p,role:'button',className:"_1-hv"+(' '+"_2j6m")+(p===m?' '+"_2j6n":''),onClick:function(q){return l([o,p]);}},o));})));}f.exports=i;},null);
__d('OzInbox.react',['cx','OzAPI','OzHelpers','DataTransfer','immutable','OzActions','OzInboxThreadList.react','OzInboxThreads','OzStores','OzTabHeader.react','ReactComponentWithPureRenderMixin','React','Reflux','promiseFinally'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('immutable').OrderedMap,k=c('immutable').List,l=c('OzStores').HandledEventsStore,m=c('OzStores').HumanStore,n=c('OzStores').ThreadStore,o=c('React').PropTypes,p=c('OzInboxThreads').OZ_GRABBED_TAB,q=c('OzInboxThreads').OZ_VIEWING_TAB,r=c('OzInboxThreads').OZ_PAST_TAB,s=5000,t=30000,u=120*1000,v=p,w=c('React').createClass({displayName:'OzInbox',mixins:[c('ReactComponentWithPureRenderMixin'),c('Reflux').connect(n,'threads'),c('Reflux').connect(m,'humans'),c('Reflux').connect(l,'handledEvents')],propTypes:{requirements:o.instanceOf(i).isRequired,witIntents:o.instanceOf(i).isRequired,merchants:o.instanceOf(i).isRequired,reps:o.instanceOf(i).isRequired,params:o.object.isRequired},contextTypes:{uid:o.string.isRequired,router:o.object.isRequired},getInitialState:function(){return {activeTab:null,loading:false};},componentDidMount:function(){this._fetchThreads();var ca=window.setInterval(function(ea){var fa=Date.now()-n.updatedAt;if(fa>u){c('OzHelpers').warn('[oz] last thread update > '+u);this._fetchThreads();}}.bind(this),t),da=window.setInterval(function(){var ea=this.threads(this._getActiveTab());if(ea.some(function(fa){return fa.get('ui-reassign');}))c('OzActions').clearReassignState();}.bind(this),s);this._cleanup=function(){v=this._getActiveTab();window.clearInterval(da);window.clearInterval(ca);}.bind(this);},componentDidUpdate:function(ca,da){var ea=this.props.params.threadid;if(ea){var fa=!!this.state.threads.get(ea);c('OzHelpers').debug('[ozinbox] tid='+ea+' hasThread='+fa);fa||y(ea);}else{var ga=this.threads(),ha=c('OzStores').ActiveThreadStore.data.get('oldThreadID'),ia=ga.get(ha)||ga.first();c('OzHelpers').debug('[ozinbox] search for best thread, found:',ia);if(ia)this.context.router.push('inbox/'+c('OzHelpers').threadID(ia));}},componentWillUnmount:function(){this._cleanup();},render:function(){var ca=this._getActiveTab(),da=this.threads(ca),ea=this.state.humans.getIn([this.context.uid,'load'],0),fa=function(ga){return ga.preventDefault();};return (c('React').createElement('div',{className:"_4b5_",onDragStart:fa,onDragEnd:fa,onDragOver:fa,onDrop:function(ga){fa(ga);var ha=new (c('DataTransfer'))(ga.nativeEvent.dataTransfer);c('OzActions').updateComposer({files:ha.getFiles()});}},c('React').createElement(x,{threadGroups:aa(da,this.context.uid,ca),reps:this.props.reps,loading:this.state.loading,activeCount:ea,activeTab:ca,selectedThread:this.props.params.threadid,onTabChange:this._handleTabChange,onUnview:this._handleUnview,onThreadClick:this._handleThreadClick,witIntents:this.props.witIntents}),this._renderDetails()));},_getActiveTab:function(){var ca=this.state.threads.get(this.props.params.threadid);return this.state.activeTab||ca&&c('OzHelpers').isOwner(ca,this.context.uid)&&p||ca&&c('OzHelpers').isSubscriber(ca,this.context.uid)&&q||v||p;},_handleUnview:function(ca){this._callAPIAndShift('unview',ca);},_handleThreadClick:function(ca){this.context.router.push('/inbox/'+c('OzHelpers').threadID(ca));},_handleTabChange:function(ca){var da=ca[0],ea=ca[1];this.setState({activeTab:ea});},_callAPIAndShift:function(ca,da){var ea=z(this.threads(p),da),fa=function(ha){this.context.router.push('/inbox/'+c('OzHelpers').threadID(ha));}.bind(this),ga=c('OzAPI')[ca](c('OzHelpers').threadID(da));ea&&fa(ea);ga.done(null,function(ha){c('OzHelpers').error('[inbox] could not shift',ha);fa(da);});},_renderDetails:function(){var ca=this.props.params.threadid;if(this.threads().isEmpty())return this._renderFinished();var da=c('OzHelpers').fullThreadData(this.state.threads,this.state.handledEvents,ca);if(!da||!this.props.children)return null;return (c('React').cloneElement(this.props.children,{thread:da,witIntents:this.props.witIntents,requirements:this.props.requirements,merchants:this.props.merchants,humans:this.state.humans,reps:this.props.reps}));},_renderFinished:function(){return (c('React').createElement('div',{className:"_57l3"},c('React').createElement('div',{className:"_57l8"},c('React').createElement('div',{className:"_57lo"}),c('React').createElement('h2',null,'Congrats! You\'ve made a lot of people happy'),c('React').createElement('p',null,'Sit tight, new messages should be coming soon!'))));},_fetchThreads:function(){var ca=this.state.loading;if(ca)return;this.setState({loading:true});c('promiseFinally')(c('OzAPI').myThreads(),function(da){return this.isMounted()&&this.setState({loading:false});}.bind(this)).done();},threads:function(ca){return c('OzInboxThreads').getInboxThreads(this.state.threads,this.context.uid,ca);}}),x=c('React').createClass({displayName:'OzThreadListPanel',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:babelHelpers['extends']({activeTab:o.oneOf([p,q,r]).isRequired,onTabChange:o.func.isRequired},c('OzInboxThreadList.react').propTypes),render:function(){var ca=this.props,da=ca.activeTab,ea=ca.onTabChange,fa=ca.activeCount,ga=babelHelpers.objectWithoutProperties(ca,['activeTab','onTabChange','activeCount']),ha=fa?'Open ('+fa+')':'Open';return (c('React').createElement('div',{className:"_4b61"},c('React').createElement('div',{className:"_4cwh"},c('React').createElement(c('OzTabHeader.react'),{active:da,tabs:[[ha,p],['Viewing',q],['Closed',r]],onChange:ea})),c('React').createElement('div',{className:"_3_cz"},c('React').createElement('div',{className:"_4fj7"},c('React').createElement(c('OzInboxThreadList.react'),babelHelpers['extends']({className:da===p?"_2sav":''},ga))))));}}),y=c('OzHelpers').memoize(c('OzAPI').thread,function(ca){return ca;});function z(ca,da){var ea=c('OzHelpers').threadID(da),fa=ca.toList(),ga=fa.findIndex(function(ja){return c('OzHelpers').threadID(ja)===ea;}),ha=ga-1,ia=ga+1;if(ia<fa.count()){return fa.get(ia);}else if(ha>=0)return fa.get(ha);}function aa(ca,da,ea){var fa;switch(ea){case p:return ba(ca,da,ea);default:return j((fa={},fa[ea]=ca,fa));}}function ba(ca,da,ea){var fa='Needs Attention',ga='Up For Grabs',ha='Waiting',ia=function(ja){var ka=c('OzHelpers').isOwner(ja,da),la=ja.get('ready'),ma=c('OzHelpers').isLocker(ja,da),na=c('OzHelpers').hasOpenIntents(ja);return ka&&(ma||la&&na)?fa:la?ga:ha;};return j().withMutations(function(ja){ja.set(fa,[]);ja.set(ga,[]);ja.set(ha,[]);ca.forEach(function(ka){return ja.update(ia(ka),function(la){la.push(ka);return la;});});}).map(function(ja){return k(ja);});}f.exports=w;},null);
__d('OzPhotoCropper.react',['cx','OzHelpers','BasicVector','Photocrop2','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'OzPhotoCropper',propTypes:{src:i.string.isRequired},getInitialState:function(){return {imageSize:null};},componentDidMount:function(){this._image=new Image();this._image.src=this.props.src;this._image.onload=function(k){var l=new (c('BasicVector'))(this._image.width,this._image.height);this.setState({imageSize:l});this._photocrop=new (c('Photocrop2'))(this.refs.img,{},l);}.bind(this);},componentWillUnmount:function(){this._image=null;},render:function(){return (c('React').createElement('div',{className:"_3x2x"},c('React').createElement('canvas',{ref:'canvas',style:{display:'none'}}),c('React').createElement('img',{src:this.props.src,ref:'img',className:"_3x2y"})));},finalizeCrop:function(k){var l=this.refs.canvas,m=this._photocrop.done(k),n=m.x,o=m.y,p=m.height,q=m.width;l.width=q;l.height=p;l.getContext('2d').drawImage(this._image,Math.max(0,n),Math.max(0,o),q,p,0,0,q,p);return c('OzHelpers').blobFromDataURI(l.toDataURL());}});f.exports=j;},null);
__d('OzAttachmentCropper.react',['OzHelpers','DialogFitHeight','immutable','OzPhotoCropper.react','OzImmutablePureRenderMixin','React','XUIButton.react','XUIDialog.react','XUIDialogBody.react','XUIDialogFooter.react','XUIDialogTitle.react'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('immutable').Map,i=c('immutable').OrderedMap,j=c('React').PropTypes,k=c('React').createClass({displayName:'OzAttachmentCropper',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{attachment:j.instanceOf(h).isRequired,onSave:j.func.isRequired,onClose:j.func.isRequired},_handleSubmit:function(){var l=this.props,m=l.attachment,n=l.onSave,o=this.refs.photoCropper.finalizeCrop();n(m.set('ui-blob',o));},render:function(){return (c('React').createElement(c('XUIDialog.react'),{behaviors:{DialogFitHeight:c('DialogFitHeight')},onToggle:this.props.onClose,shown:true,width:900},c('React').createElement(c('XUIDialogTitle.react'),null,c('React').createElement('span',null,'Crop tool')),c('React').createElement(c('XUIDialogBody.react'),null,c('React').createElement(c('OzPhotoCropper.react'),{src:c('OzHelpers').blobURI(this.props.attachment.get('ui-blob')),ref:'photoCropper'})),c('React').createElement(c('XUIDialogFooter.react'),null,c('React').createElement(c('XUIButton.react'),{onClick:this._handleSubmit,label:'Crop'}))));}});f.exports=k;},null);
__d('OzAttachmentOverlay.react',['cx','joinClasses','OzLoading.react','OzImmutablePureRenderMixin','React','XUICloseButton.react','XUIEditButton.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'OzAttachmentOverlay',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{onClick:i.func,onEdit:i.func,onRemove:i.func,loading:i.bool},render:function(){var k=this.props,l=k.onClick,m=k.onEdit,n=k.onRemove,o=k.loading;return (c('React').createElement('div',{className:c('joinClasses')(this.props.className,"_18wc")},o?c('React').createElement(c('OzLoading.react'),null):null,c('React').createElement('div',{className:"_4xe8",onClick:l},m?c('React').createElement(c('XUIEditButton.react'),{className:"_1yll",type:'button',size:'medium',title:'Add Image',onClick:this._handleEdit}):null,n?c('React').createElement(c('XUICloseButton.react'),{type:'button',className:"_1ylm",size:'medium',shade:'dark',onClick:this._handleRemove}):null),this.props.children));},_handleEdit:function(k){k.stopPropagation();this.props.onEdit&&this.props.onEdit();},_handleRemove:function(k){k.stopPropagation();this.props.onRemove&&this.props.onRemove();}});f.exports=j;},null);
__d('OzBubbleImageSelector.react',['cx','Image.react','immutable','OzAttachmentOverlay.react','OzImmutablePureRenderMixin','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('immutable').List,j=c('React').PropTypes,k=c('React').createClass({displayName:'OzBubbleImageSelector',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{onImageAdd:j.func.isRequired,onImageSelect:j.func.isRequired,selectedURI:j.string,thumbURIs:j.instanceOf(i).isRequired},render:function(){var m=this.props,n=m.onImageSelect,o=m.selectedURI,p=m.thumbURIs;return (c('React').createElement('div',{className:"_1-i2"},p.map(function(q,r){return (c('React').createElement(l,{index:r,isSelected:q===o,key:r,onSelect:n,uri:q}));}),this._renderAddButton()));},_renderAddButton:function(){return (c('React').createElement('button',{type:'button',className:"_1-hv _1-i4",onClick:this.props.onImageAdd},'+'));}}),l=c('React').createClass({displayName:'Thumbnail',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{index:j.number.isRequired,isSelected:j.bool.isRequired,uri:j.string.isRequired},render:function(){return (c('React').createElement(c('OzAttachmentOverlay.react'),{className:this.props.isSelected?"_4-8e":'',onClick:this._handleSelect},c('React').createElement(c('Image.react'),{src:this.props.uri,className:"_1-i3",alt:'image thumb'})));},_handleSelect:function(){this.props.onSelect(this.props.uri);}});f.exports=k;},null);
__d('OzFormPreview.react',['cx','OzHelpers','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('OzHelpers').pure(function(k){var l=k.children;return (c('React').createElement('div',{className:"_5bwr"},l));}),j=c('OzHelpers').pure(function(k){var l=k.label,m=k.children;if(!m)return null;return (c('React').createElement('div',{className:"_5bws _5bwt"},c('React').createElement('div',{className:"_5bwv"},l),c('React').createElement('div',{className:"_5bx2"},m)));});i.Row=j;f.exports=i;},null);
__d('OzBubblePreview.react',['cx','OzAPI','OzHelpers','formatDate','AdsCurrencyFormatter','immutable','MessengerButton.react','OzFormPreview.react','OzStores','OzImmutablePureRenderMixin','React','Reflux','TextWithHighlights.atlas','XUIContextualDialog.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('immutable').List,k=c('React').PropTypes,l=c('OzFormPreview.react').Row,m=c('OzStores').AutopilotStore,n=c('React').createClass({displayName:'OzBubblePreview',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{bubble:k.instanceOf(i).isRequired,highlight:k.string,meta:k.instanceOf(i),source:k.string},render:function(){return ia(this.props)?c('React').createElement(s,this.props):c('React').createElement(o,this.props);}}),o=c('OzHelpers').pure(function(ra){var sa=ra.bubble,ta=ra.highlight,ua=null;if(Number.isSafeInteger(sa.get('amount')))ua=c('AdsCurrencyFormatter').formatCurrencyFullFormat(sa.get('currency'),sa.get('amount'));return (c('React').createElement(da,{thumbURL:sa.get('thumb-url')},c('React').createElement(fa,{text:sa.get('name'),highlight:ta}),c('React').createElement(ga,null,c('React').createElement(ha,{color:'grey',highlight:ta},sa.get('description')||'No Description')),c('React').createElement(ga,null,c('React').createElement(ha,null,sa.get('merchant-name')||'No Merchant')),c('React').createElement(ga,null,c('React').createElement(ha,{color:'blue',weight:'bold'},ua))));}),p='__overviewTab',q='__hoursTab',r='__moreInfoTab',s=c('React').createClass({displayName:'PlacesPreview',mixins:[c('OzImmutablePureRenderMixin'),c('Reflux').connect(m,'autopilot')],propTypes:{bubble:k.instanceOf(i).isRequired,meta:k.instanceOf(i).isRequired,highlight:k.string},getInitialState:function(){return {shown:false,activeTab:p};},_makeOpentableRequest:function(ra,sa){var ta=oa(ra);if(ta){var ua=ta.getIn(['data','id']),va=sa.get(ua);if(!va)c('OzAPI').requestAutopilot(ta.toJS());}},componentWillMount:function(){this._makeOpentableRequest(this.props.meta,this.state.autopilot);window.clearTimeout(this.timeout);},componentWillReceiveProps:function(ra){var sa=ra.meta;if(pa(sa)!==pa(this.props.meta))this._makeOpentableRequest(sa,this.state.autopilot);},_handleToggle:function(ra){window.clearTimeout(this.timeout);var sa=function(ta){return this.setState({shown:ra});}.bind(this);ra?sa():this.timeout=window.setTimeout(sa,100);},render:function(){var ra=this.props,sa=ra.bubble,ta=ra.meta,ua=ra.highlight,va=this.state,wa=va.shown,xa=va.activeTab,ya=va.autopilot;return (c('React').createElement('div',{ref:'root',tabIndex:'0',onMouseEnter:function(za){return this._handleToggle(true);}.bind(this),onMouseLeave:function(za){return this._handleToggle(false);}.bind(this)},c('React').createElement(da,{thumbURL:sa.get('thumb-url')},c('React').createElement(fa,{text:sa.get('name'),highlight:ua}),c('React').createElement(t,{rating:ta.get('rating')}),c('React').createElement(ga,null,c('React').createElement(ha,null,ta.get('cuisine')),' ',c('React').createElement(ha,null,ta.get('price'))),c('React').createElement(ga,null,c('React').createElement(u,{meta:ta,autopilot:ya}))),c('React').createElement(v,babelHelpers['extends']({activeTab:xa,contextRef:function(za){return this.refs.root;}.bind(this),onTabChange:this._handleTabChange,shown:wa,onToggle:this._handleToggle,autopilot:ya},this.props))));},_handleTabChange:function(ra){this.setState({activeTab:ra});}}),t=c('OzHelpers').pure(function(ra){var sa=ra.rating;return sa?c('React').createElement(ga,null,c('React').createElement(ha,{weight:'500'},sa.get('value'),'/',sa.get('scale')),' ',c('React').createElement(ha,{color:'grey'},sa.get('rating-count')?'('+sa.get('rating-count')+' reviews)':null)):null;}),u=c('OzHelpers').pure(function(ra){var sa=ra.meta,ta=ra.autopilot,ua=oa(sa);if(!ua)return (c('React').createElement(ha,null,'No OT info'));var va=ta.get(ua.getIn(['data','id']));if(!va)return (c('React').createElement(ha,null,'Checking OT...'));if(va.size===0)return (c('React').createElement(ha,{color:'red'},'No Tables Available!'));return (c('React').createElement(ha,null,'Table at ',ma(sa,va)));}),v=c('OzHelpers').pure(function(ra){var sa=ra.activeTab,ta=ra.contextRef,ua=ra.meta,va=ra.onTabChange,wa=ra.onToggle,xa=ra.shown,ya=babelHelpers.objectWithoutProperties(ra,['activeTab','contextRef','meta','onTabChange','onToggle','shown']);return (c('React').createElement(c('XUIContextualDialog.react'),{contextRef:ta,hoverHideDelay:0,position:'above',shown:xa,hasActionableContext:true},c('React').createElement('div',{className:"_53qb",onMouseEnter:function(za){return wa(true);},onMouseLeave:function(za){return wa(false);}},c('React').createElement('div',{className:"_c38"},c('React').createElement(w,babelHelpers['extends']({meta:ua},ya)),c('React').createElement(ca,{tabs:[['Overview',p],['Hours',q],['More Info',r]],active:sa,onChange:va})),c('React').createElement(x,babelHelpers['extends']({activeTab:sa,meta:ua},ya)))));}),w=c('OzHelpers').pure(function(ra){var sa=ra.bubble,ta=ra.meta,ua=ra.highlight;return (c('React').createElement('div',{className:"_53qc"},c('React').createElement(ea,{url:sa.get('thumb-url')}),c('React').createElement('div',{className:"_53qd"},c('React').createElement(fa,{text:sa.get('name'),highlight:ua}),c('React').createElement(t,{rating:ta.get('rating')}),c('React').createElement(ga,null,c('React').createElement(ha,null,ta.get('cuisine'))),c('React').createElement(ga,null,c('React').createElement(ha,null,ta.get('price'))))));}),x=c('OzHelpers').pure(function(ra){var sa=ra.activeTab,ta=babelHelpers.objectWithoutProperties(ra,['activeTab']);return (c('React').createElement('div',{className:"_53qe"},sa===p&&c('React').createElement(y,ta)||sa===q&&c('React').createElement(aa,ta)||sa===r&&c('React').createElement(ba,ta)||null));}),y=c('OzHelpers').pure(function(ra){var sa=ra.bubble,ta=ra.highlight,ua=ra.meta,va=ra.autopilot,wa=(ua.getIn(['address','street'],'')+'\n     '+ua.getIn(['address','city'],'')+'\n    ').trim();return (c('React').createElement(c('OzFormPreview.react'),null,c('React').createElement(l,{label:'Address'},wa),c('React').createElement(l,{label:'Phone'},z(sa,ua)),c('React').createElement(l,{label:'Website'},c('React').createElement('a',{href:sa.get('target-url'),target:'_blank'},'Link')),c('React').createElement(l,{label:'OpenTable'},ja(ua,va)),c('React').createElement(l,{label:'Description'},sa.get('description'))));}),z=function(ra,sa){var ta=sa.get('phone');return ta?c('React').createElement(ha,{weight:'bold'},c('OzHelpers').parsePhoneNumber(ta)):null;},aa=c('OzHelpers').pure(function(ra){var sa=ra.meta;return (c('React').createElement(c('OzFormPreview.react'),null,la(sa.get('hours')||j()).map(function(ta,ua){return c('React').createElement(l,{key:ua,label:ua},ta);}).valueSeq()));}),ba=c('OzHelpers').pure(function(ra){var sa=ra.bubble,ta=ra.meta,ua=ta.get('payment'),va=ta.get('infos');if(ua&&ua.size||va&&va.size){var wa=function(){var xa=function(ya){return ya[0].toUpperCase()+ya.slice(1).toLowerCase();};return {v:c('React').createElement(c('OzFormPreview.react'),null,va.map(function(ya,za){return (c('React').createElement(l,{label:xa(za),key:za},ya));}).toList(),ua?c('React').createElement(l,{label:'Payments'},ua.map(xa).toJS().join(', ')):null)};}();if(typeof wa==="object")return wa.v;}else return c('React').createElement('div',null,'No additional info for this place...');}),ca=c('OzHelpers').pure(function(ra){var sa=ra.tabs,ta=ra.onChange,ua=ra.active;return (c('React').createElement('div',{className:"_c39"},sa.map(function(va){var wa=va[0],xa=va[1],ya=xa===ua?{weight:'bold',color:'blue'}:{color:'grey'};return (c('React').createElement('button',{key:xa,role:'button',className:"_1-hv",onClick:function(za){return ta(xa);}},c('React').createElement(ha,ya,wa)));})));}),da=c('OzHelpers').pure(function(ra){var sa=ra.children,ta=ra.thumbURL;return (c('React').createElement('div',{className:"_1q15 _5rxk"},c('React').createElement(ea,{url:ta}),c('React').createElement('div',{className:"_1q17"},sa)));}),ea=c('OzHelpers').pure(function(ra){var sa=ra.url;return sa?c('React').createElement('div',{className:"_1q16",style:{backgroundImage:'url(\''+sa+'\')'}}):null;}),fa=c('OzHelpers').pure(function(ra){var sa=ra.text,ta=ra.highlight;return (c('React').createElement(ga,null,c('React').createElement(ha,{weight:'bold',highlight:ta},sa||'No Title')));}),ga=c('OzHelpers').pure(function(ra){var sa=ra.children;return (c('React').createElement('div',{className:"_4-_7 _5rxl"},sa));}),ha=c('OzHelpers').pure(function(ra){var sa=ra.children,ta=ra.color,ua=ra.highlight,va=ra.size,wa=ra.weight,xa=wa===undefined?'normal':wa;return sa?c('React').createElement('span',{className:"_5rxm"+(va==='large'?' '+"_5rxn":'')+(ta==='blue'?' '+"_5ryf":'')+(ta==='grey'?' '+"_5ryk":'')+(ta==='red'?' '+"_5emd":'')+(ta==='green'?' '+"_5emf":''),style:{fontWeight:xa}},ua?c('React').createElement(c('TextWithHighlights.atlas'),{text:sa,highlight:ua}):sa):null;});function ia(ra){var sa=ra.meta,ta=ra.source;return ta==='places'&&sa;}function ja(ra,sa){var ta=ra.get('open-table');if(ta){var ua=sa.get(pa(ra));if(ua){var va;if(ua.size===0){va=c('React').createElement(ha,{color:'red'},'No tables available!');}else va=c('React').createElement(ha,null,'Tables available at '+qa(ua));}return (c('React').createElement('div',null,c('React').createElement('a',{href:ta.get('url'),target:'_blank'},'Link (',ta.get('area'),')'),c('React').createElement('br',null),va));}}var ka=j(['Sun','Mon','Tues','Wed','Thurs','Fri','Sat']);function la(ra){var sa=function(){var xa=new Date(c('OzHelpers').serverNow());xa.setHours(0,0,0,0);xa.setDate(xa.getDate()-xa.getDay()+1);return +xa;},ta=sa(),ua=function(xa){return new Date(ta+xa*60*1000);},va=function(xa){return c('formatDate')(xa,'h:i A',{skipPatternLocalization:true});},wa=function(xa){return xa.map(va).join(' - ');};return ra.map(function(xa){return xa.map(ua);}).groupBy(function(xa){return xa.get('start').getDay();}).mapKeys(function(xa){return ka.get(xa);}).map(function(xa){return xa.map(wa).join(', ');});}function ma(ra,sa){var ta=function(va){var wa=va.split(':'),xa=wa[0],ya=wa[1];return parseInt(ya,10)+parseInt(xa,10)*60;},ua=ta(ra.getIn(['open-table','availability','data','hour']));return na(sa.map(function(va){return va.get('hour');}).minBy(function(va){return Math.abs(ua-ta(va));}));}function na(ra){var sa=ra.split(':'),ta=sa[0],ua=sa[1];ta=parseInt(ta,10);if(ta===0){return '12:'+ua+'AM';}else if(ta<12){return ra+'AM';}else if(ta===12){return ra+'PM';}else return ta-12+':'+ua+'PM';}function oa(ra){return ra.getIn(['open-table','availability']);}function pa(ra){return ra.getIn(['open-table','availability','data','id']);}function qa(ra){return ra.map(function(sa){return na(sa.get('hour'));}).toJS().join(', ');}f.exports=n;},null);
__d('OzMerchantDialog.react',['cx','OzHelpers','immutable','Layout.react','MessengerDialog.react','MessengerDialogHeader.react','MessengerDialogTitle.react','OzActions','React','ReactDOM','XUIDatePicker.react','XUIError.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('Layout.react').Column,j=c('Layout.react').FillColumn,k=c('React').PropTypes,l=c('immutable').Map,m=c('immutable').Set,n=m(['name-dba','name-legal','website','phone','address','page-id','country','type','owner-name']),o=l({country:'US'}),p=c('React').createClass({displayName:'OzMerchantDialog',propTypes:{onMerchant:k.func.isRequired,title:k.string,initialMerchant:k.instanceOf(l)},getDefaultProps:function(){return {title:"Create a merchant",initialMerchant:l()};},getInitialState:function(){var q=this.props.initialMerchant,r=o.filterNot(function(s,t){return q.get(t);});return {inputs:r,errors:l()};},componentDidMount:function(){var q=c('ReactDOM').findDOMNode(this.refs['name-dba']);q&&q.focus();},render:function(){return (c('React').createElement(c('MessengerDialog.react'),{className:"_18w8",onToggle:this._handleToggle,ref:'dialog',type:'default',width:544},c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogTitle.react'),null,this.props.title)),this._renderFields(),c('React').createElement('div',null,this._renderDialogAction('Save',this._handleSave),this._renderDialogAction('Cancel',c('OzActions').hideDialog))));},_renderDialogAction:function(q,r){return c('React').createElement('button',{onClick:r,className:"_bx0 _3e2t _30yy"},q);},_renderFields:function(){return (c('React').createElement('div',{className:"_374d _18w9"},this._renderTextField('name-dba','Name *'),this._renderTextField('name-legal','Legal Name'),this._renderTextField('website','Website'),this._renderTextField('phone','Phone'),this._renderTextField('address','Address'),this._renderTextField('page-id','Facebook Page Id'),this._renderTextField('country','Country *'),this._renderTextField('type','Business Type'),this._renderTextField('owner-name','Owner Name'),this._renderDateField('owner-birth-date','Owner Birth Date')));},_renderTextField:function(q,r){var s=this.props.initialMerchant,t=this.state,u=t.inputs,v=t.errors;return (c('React').createElement(c('Layout.react'),{key:q},c('React').createElement(i,{className:"mrm _bx1"},r),c('React').createElement(j,null,c('React').createElement(c('XUIError.react'),{xuiError:v.get(q)||null},c('React').createElement('input',{ref:q,type:'text',className:"_7q5 _bx2",defaultValue:s.get(q),value:u.get(q),onChange:function(w){this.setState({inputs:u.set(q,w.target.value),errors:l()});}.bind(this)})))));},_renderDateField:function(q,r){var s={},t=this.props.initialMerchant,u=t.get('owner-birth-date');if(u)s.initialTime=u;return (c('React').createElement(c('Layout.react'),{key:q},c('React').createElement(i,{className:"mrm _bx1"},r),c('React').createElement(i,null,c('React').createElement(c('XUIDatePicker.react'),babelHelpers['extends']({ref:q,shouldSetDefaultDate:false},s)))));},_handleSave:function(){var q=this._validateData();if(q){q.id=this.props.initialMerchant.get('id');this.props.onMerchant(q);}},_handleToggle:function(q){if(!q)c('OzActions').hideDialog();},_validateData:function(){var q=l(),r=this.props.initialMerchant,s=function(v){var w=this.state.inputs.get(v,undefined);if(w===undefined)return r.get(v);return w||null;}.bind(this);q=l(n.map(function(v){return [v,s(v)];})).set('id',r.get('id'));var t=this.refs['owner-birth-date'].state.selectTime;q=q.set('owner-birth-date',t);q=c('OzHelpers').normalizeMerchant(q);var u=c('OzHelpers').validateMerchant(q);this.setState({errors:u});if(!u.isEmpty())return null;return q;}});f.exports=p;},null);
__d('OzSetPicURLDialog.react',['cx','getURLRanges','OzHelpers','Image.react','Keys','MessengerDialog.react','MessengerDialogHeader.react','MessengerDialogTitle.react','OzImmutablePureRenderMixin','React','ReactDOM'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'OzSetPicURLDialog',mixins:[c('OzImmutablePureRenderMixin')],PropTypes:{onURL:i.func.isRequired,onEscape:i.func},componentDidMount:function(){var k=c('ReactDOM').findDOMNode(this.refs.url);k&&k.focus();},getInitialState:function(){return {errors:[],url:''};},render:function(){return (c('React').createElement(c('MessengerDialog.react'),{className:"_18w8",onToggle:this._handleToggle,ref:'dialog',type:'default',width:544},c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogTitle.react'),null,'Enter a URL for your picture')),this._renderImage(),this._renderErrors(),c('React').createElement('div',{className:"_374d _18w9"},c('React').createElement('input',{onChange:this._handleChange,onKeyDown:this._handleKeyDown,ref:'url',type:'text',className:"_7q5",placeholder:'URL to picture'})),c('React').createElement('div',{className:"_18wa"},'Press Enter when you\'re done.')));},_renderImage:function(){var k=this.state.url,l=this.state.errors||[];if(l.length>0||!k||k.length===0)return null;return (c('React').createElement(c('Image.react'),{className:"_24p-",src:k}));},_renderErrors:function(){var k=this.state.errors;if(!k||k.length===0)return null;return (c('React').createElement('div',{key:'errors',className:"_1yln"},k.map(function(l){var m=l[0],n=l[1];return (c('React').createElement('div',{key:m,className:"_1ylp"},n));})));},_handleChange:function(k){if(k.target.value.length&&!c('getURLRanges')(k.target.value).length){this.setState({errors:[['invalid_url','You must provide a valid uri']]});return;}var l=k.target.value.length?c('getURLRanges')(k.target.value)[0].entity.url:'';this.setState({errors:[],url:l});},_handleKeyDown:function(k){if(k.keyCode===c('Keys').ESC){var l=this.props.onEscape;if(l)l(k);return;}var m=this.state.errors||[];if(m.length===0&&k.keyCode===c('Keys').RETURN){k.preventDefault();var n=k.target.value.length?c('getURLRanges')(k.target.value)[0].entity.url:'';this.props.onURL(n);}return;},_handleToggle:function(){c('OzHelpers').debug('[OzSetPicURLDialog] toggled',arguments);}});f.exports=j;},null);
__d('OzBubbleEditor.react',['cx','Promise','OzAPI','getURLRanges','OzHelpers','OzNotify','AdsCurrencyInput.react','immutable','Keys','OzActions','OzBubbleImageSelector.react','OzBubblePreview.react','OzConfig','OzMerchantDialog.react','OzSearchSource','OzSetPicURLDialog.react','OzImmutablePureRenderMixin','React','Reflux','SearchableDropdownInput.contrib','SearchableEntry','XUICloseButton.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').List,j=c('immutable').Map,k=c('React').PropTypes,l=['thumb-url'],m=['thumb-urls'],n=q('No Merchant'),o=69,p=c('React').createClass({displayName:'OzBubbleEditor',mixins:[c('OzImmutablePureRenderMixin'),c('Reflux').connect(c('OzConfig').ConfigStore,'config')],propTypes:{merchants:k.instanceOf(j).isRequired,seedBubble:k.instanceOf(j).isRequired,onSave:k.func.isRequired,onClose:k.func.isRequired},getInitialState:function(){return {newData:j()};},componentWillMount:function(){this._searchSource=new (c('OzSearchSource'))(function(u){var v=u.query||'',w=this.props.merchants.valueSeq().filter(function(x){return x.get('name-dba').toLowerCase().indexOf(v.toLowerCase())>-1;}).map(function(x){return q(x.get('name-dba'));}).take(15).toArray();return c('Promise').resolve(this._data().get('merchant-name')?[n].concat(w):w);}.bind(this));},componentDidMount:function(){this.focus('Title');},focus:function(u){this.refs[u]&&this.refs[u].focus&&this.refs[u].focus();},render:function(){return (c('React').createElement('div',{className:"_1-ht"},c('React').createElement('div',{className:"_2zfj"},this._renderSection('Preview',this._renderPreview)),c('React').createElement('form',{className:"_2zfk",onKeyDown:function(u){u.keyCode===c('Keys').ESC&&this.props.onClose(this._bubble());}.bind(this),onSubmit:function(u){u.stopPropagation();u.preventDefault();this._handleSubmit();}.bind(this)},c('React').createElement(c('XUICloseButton.react'),{className:"_1-hu",shade:'dark',size:'medium',onClick:function(u){return this.props.onClose(this._bubble());}.bind(this)}),this._renderSection('Image',this._renderImage),this._renderSection('Title',this._renderInput.bind(this,['name'])),this._renderSection('Description',this._renderDescription),this._renderSection('URL',this._renderInput.bind(this,['target-url'])),this._renderSection('Merchant',this._renderMerchant),this._renderSection('Price',this._renderPrice),this._renderSubmit())));},_bubble:function(){return this.props.seedBubble.set('data',this._data()).deleteIn(['data','thumb-urls']);},_data:function(){var u=this.state.newData.updateIn(m,function(v){var w=this.props.seedBubble.getIn(['data'].concat(m));return (w||i()).concat(v);}.bind(this));return this.props.seedBubble.get('data').merge(u);},_handleSubmit:function(){var u=this._bubble(),v=u.get('data'),w=[[v.get('name'),'Please enter a title.'],[v.get('expires-in')||!v.get('expiration-time'),'Since this bubble is old, please re-enter the expiration time.'],[c('OzHelpers').validateURL(v.get('target-url')),'Please enter a valid url. Usually, you need to add "www."'],[c('OzHelpers').validateURL(v.get('thumb-url'))||!v.get('thumb-url'),'Please enter a valid url for your image.'],[v.get('merchant-name')||!v.get('amount'),'You need to specify a merchant if you\'ve listed a price.'],[v.get('amount')||!v.get('expires-in'),'You need to list a price if you\'ve set an expiration time.']].filter(function(x){var y=x[0],z=x[1];return !y;}).map(function(x){var y=x[0],z=x[1];return z;});if(w.length){c('OzNotify').error(w[0]);return;}this.props.onSave(u.updateIn(['data','target-url'],function(x){return (c('getURLRanges')(x)[0].entity.url);}));},_handleCreateMerchant:function(){c('OzActions').showDialog(c('OzMerchantDialog.react'),{onMerchant:function(u){c('OzAPI').createMerchant(u);var v=this.state.newData.set('merchant-name',u.get('name-dba'));this.setState({newData:v});c('OzActions').hideDialog();}.bind(this)});},_handleAddImage:function(){c('OzActions').showDialog(c('OzSetPicURLDialog.react'),{onEscape:function(u){c('OzActions').hideDialog();this.focus('Title');}.bind(this),onURL:function(u){c('OzActions').hideDialog();this.setState(function(v){return {newData:t(v.newData,u)};});this.focus('Title');}.bind(this)});},_handleSelectImage:function(u){this.setState(function(v){return {newData:v.newData.setIn(l,u)};});},_renderSubmit:function(){return (c('React').createElement('button',{type:'submit',className:"_1-hv _1-hw"},'DONE'));},_renderSection:function(u,v){return (c('React').createElement('div',{className:"_1-hx"},c('React').createElement('div',{className:"_1-hz",onClick:function(w){return this.focus(u);}.bind(this)},u),c('React').createElement('div',{className:"_1-h-"},v(u))));},_renderPrice:function(u){var v=this._data(),w=v.get('currency'),x=v.get('amount');return (c('React').createElement('div',{className:"_1-h_"},c('React').createElement(c('AdsCurrencyInput.react'),{placeholder:'(optional)',currency:w||'USD',value:Number.isSafeInteger(x)?x:null,onDataUpdate:function(y){this.setState({newData:v.set('amount',y)});}.bind(this),eventType:'change'}),this._renderExpiration()));},_renderExpiration:function(){if(!this.state.config.getIn(['GK','expirationDate']))return null;return (c('React').createElement('div',{className:"_51w3"},c('React').createElement('div',{className:"_1-hz"},'Expiration Time:'),c('React').createElement(s,{expiresIn:this._data().get('expires-in'),onChange:function(u){return this.setState({newData:this.state.newData.set('expires-in',u)});}.bind(this)})));},_renderInput:function(u,v){var w=this.state.newData;return (c('React').createElement('input',{ref:v,type:'text',className:"_1-i0 _1-i1",value:this._data().getIn(u),onChange:function(x){return this.setState({newData:w.setIn(u,x.target.value)});}.bind(this)}));},_renderImage:function(){var u=this._data(),v=u.getIn(l),w=r(u,v);return (c('React').createElement(c('OzBubbleImageSelector.react'),{onImageAdd:this._handleAddImage,onImageSelect:this._handleSelectImage,selectedURI:v,thumbURIs:w}));},_renderMerchant:function(){var u=this._data(),v=u.get('merchant-name'),w=v?q(v):null;return (c('React').createElement('div',{className:"_1-i5"},c('React').createElement('div',{className:"_1-i6"},c('React').createElement(c('SearchableDropdownInput.contrib'),{divClassName:"_1-i7",value:w,onSelect:function(x){var y=x.getUniqueID()===n.getUniqueID()?null:x.getTitle(),z=this.state.newData.set('merchant-name',y);this.setState({newData:z});}.bind(this),emptySearchResultsText:'No merchants found. Click + to add',placeholder:'Pick a Merchant (optional)',searchSource:this._searchSource})),c('React').createElement('div',{onClick:this._handleCreateMerchant,className:"_1-hv _4nd4 _1-i8"})));},_renderPreview:function(){return (c('React').createElement(c('OzBubblePreview.react'),{bubble:this._data()}));},_renderDescription:function(){var u=this._data(),v=u.get('description'),w=v&&v.length>o;return (c('React').createElement('div',null,c('React').createElement('input',{ref:'description',type:'text',className:"_1-i0 _1-i1",value:v,onChange:function(x){return this.setState({newData:u.set('description',x.target.value)});}.bind(this)}),c('React').createElement('text',{className:w?"_353q":''},o-(v?v.length:0)+' characters left')));}});function q(u){return new (c('SearchableEntry'))({title:u,uniqueID:u});}function r(u,v){return u.getIn(m,i()).toOrderedSet().add(v).toList().filter(function(w){return w;});}var s=c('OzHelpers').pure(function(u){var v=u.expiresIn,w=u.onChange,x="_1-i0 _3owv",y=v||j({hours:0,minutes:0}),z=function(ca){return Math.max(+ca,0);},aa=function(ca){return w(y.merge(j(ca)));},ba=function(ca,da){return (y.get(da)===1?ca:ca+'s');};return (c('React').createElement('div',{className:"_51wb"},c('React').createElement('label',{className:"_1-hz"},c('React').createElement('input',{className:x,onChange:function(ca){return aa({hours:z(ca.target.value)});},type:'number',value:v?v.get('hours'):null}),ba('hour','hours')),c('React').createElement('label',{className:"_1-hz"},c('React').createElement('input',{className:x,onChange:function(ca){return aa({minutes:z(ca.target.value)});},type:'number',value:v?v.get('minutes'):null}),ba('minute','minutes'))));});function t(u,v){return u.withMutations(function(w){w.updateIn(m,i(),function(x){return x.push(v);});w.setIn(l,v);});}f.exports=p;},null);
__d('OzComposerAI.react',['cx','ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','OzHelpers','joinClasses','immutable','Image.react','LayerHideOnBlur','MessengerSpinner.react','OzBubblePreview.react','OzConfig','OzConstants','OzImmutablePureRenderMixin','React','Reflux','TextWithHighlights.atlas','MessengerButton.react','formatDate','XUIContextualDialog.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('immutable').List,k=c('OzConstants').ATTS,l=c('React').PropTypes,m=c('React').createClass({displayName:'OzComposerAIList',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{filter:l.string,items:l.instanceOf(j).isRequired,onItemClick:l.func.isRequired},getInitialState:function(){return {};},render:function(){var y=this.props,z=y.items,aa=y.filter,ba=y.onItemClick,ca={filter:aa,onItemClick:ba};return !z.isEmpty()&&c('React').createElement('div',{className:"_4285"},z.map(function(da,ea){return (j.isList(da)?c('React').createElement('div',{key:ea,className:"_2961"},da.map(function(fa,ga){return (c('React').createElement(s,babelHelpers['extends']({key:ga,column:ga,line:ea,item:fa},ca)));})):c('React').createElement(n,babelHelpers['extends']({key:ea,line:ea,item:da,onToggleDebug:function(fa){return this.setState({debugLine:this.state.debugLine===ea?null:ea});}.bind(this),debugShown:this.state.debugLine===ea},ca)));}.bind(this)).reverse());}}),n=c('React').createClass({displayName:'ItemRow',mixins:[c('OzImmutablePureRenderMixin'),c('Reflux').connect(c('OzConfig').ConfigStore,'config')],propTypes:{onToggleDebug:l.func.isRequired,debugShown:l.bool.isRequired},render:function(){var y=this.props,z=y.item,aa=y.line,ba=y.onItemClick,ca=y.filter,da=i({line:aa,column:0}),ea=z.get('id'),fa=z.get('at'),ga=this.state.config.get('debugAI');return (c('React').createElement('div',{className:"_2962",onClick:function(ha){ha.preventDefault();ba(da);}},x(z)?c('React').createElement(r,{label:'AUTO-SENDING',at:fa}):null,c('React').createElement('div',{className:"_58jk",ref:'root'},c('React').createElement('div',{className:"_2964"},c('React').createElement(u,{item:z,filter:ca})),c('React').createElement('span',{className:"_58jl"},x(z)?c('React').createElement(c('MessengerButton.react'),{type:'secondary',label:'STOP'}):ea&&fa?c('formatDate')(fa/1000,'g:ia M j'):'⌘'+z.get('shortcut',aa+1),ga&&c('React').createElement(q,babelHelpers['extends']({contextRef:function(ha){return this.refs.root;}.bind(this)},this.props))))));}});function o(y,z,aa,ba,ca){var da='<span style="color: brown">',ea='<span style="color: navy">',fa='<span style="color: navy">',ga=z||'';if(aa)ga=ga+da+aa.replace(/[": ]/g,'')+'</span>: ';if(ba)ga=ga+(ba[0]=='"'?fa:ea)+ba+'</span>';return ga+(ca||'');}function p(y){var z=/^( *)("[\w]+": )?("[^"]*"|[\w.+-]*)?([,[{])?$/mg,aa={__html:JSON.stringify(y,null,3).replace(/&/g,'&amp;').replace(/\\"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(z,o)};return c('React').createElement('div',{dangerouslySetInnerHTML:aa});}var q=c('React').createClass({displayName:'DebugInfo',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{onToggleDebug:l.func.isRequired,debugShown:l.bool.isRequired},_handleToggleDebugInfo:function(event){this.props.onToggleDebug();event.stopPropagation();},render:function(){var y=this.props,z=y.contextRef,aa=y.item,ba=y.debugShown,ca=aa.get('source'),da=aa.get('debug');return (c('React').createElement('span',null,ca?' '+ca:'',da?' ':'',da&&c('React').createElement('span',null,c('React').createElement('a',{className:"_5ufb",onClick:this._handleToggleDebugInfo}),c('React').createElement(c('XUIContextualDialog.react'),{behaviors:{ContextualLayerAutoFlip:c('ContextualLayerAutoFlip'),ContextualLayerUpdateOnScroll:c('ContextualLayerUpdateOnScroll'),LayerHideOnBlur:c('LayerHideOnBlur')},contextRef:z,hoverHideDelay:0,onBlur:this.props.onToggleDebug,position:'right',shown:ba,hasActionableContext:true},c('React').createElement('div',{className:"_5ufd"},p(da.toJS()))))));}}),r=c('React').createClass({displayName:'TimeProgress',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{at:l.number.isRequired,label:l.string},componentDidMount:function(){this._start=Date.now();var y=window.setInterval(function(z){return this.forceUpdate();}.bind(this));this.unlisten=function(z){return window.clearInterval(y,1000);};},componentWillUnmount:function(){this.unlisten();},render:function(){var y=this.props,z=y.at,aa=y.label,ba=w(this._start,Date.now(),z);return (c('React').createElement('div',{className:"_58jn"},c('React').createElement('div',{className:"_16bc",style:{width:ba+'%'}}),c('React').createElement('div',{className:"_16bd"},aa)));}}),s=c('OzHelpers').pure(function(y){var z=y.column,aa=y.filter,ba=y.item,ca=y.line,da=y.onItemClick,ea=i({line:ca,column:z}),fa=ba.get('at');return (c('React').createElement('div',{className:"_2966",onClick:function(ga){ga.preventDefault();da(ea);}},x(ba)?c('React').createElement(r,{label:'AUTO-SENDING',at:fa}):null,c('React').createElement('div',{className:"_34mx"},x(ba)?c('React').createElement(c('MessengerButton.react'),{type:'secondary',label:'STOP'}):c('React').createElement('span',null,ba.get('id')&&fa?c('formatDate')(fa/1000,'g:ia M j'):'')),c('React').createElement(u,{className:"_34mz",item:ba,filter:aa})));}),t=c('OzHelpers').pure(function(y){var z=y.images;return (c('React').createElement('div',null,z.map(function(aa,ba){return (c('React').createElement(c('Image.react'),{key:ba,className:"_1q16",src:aa.get('url'),alt:aa.get('filename')}));})));}),u=c('OzHelpers').pure(function(y){var z=y.filter,aa=y.item,ba=y.className;switch(aa.get('type')){case k.COMMAND:return c('React').createElement(v,{command:aa,highlight:z});case k.SURVEY:case 'send':case k.TEMPLATE:var ca=aa.get('ui-body')&&'"'+aa.get('ui-body')+'"',da=aa.getIn(['data','images']);return (c('React').createElement('div',{className:ba},ca?c('React').createElement(c('TextWithHighlights.atlas'),{text:ca,highlight:z}):null,da?c('React').createElement(t,{images:da}):null));case 'suggest':case k.SUGG:return (c('React').createElement(c('OzBubblePreview.react'),{bubble:aa.get('data'),highlight:z,meta:aa.get('meta'),source:aa.get('source')}));default:c('OzHelpers').debug('[composerai] could not render item',aa);return null;}}),v=c('OzHelpers').pure(function(y){var z=y.command,aa=y.highlight;return (c('React').createElement('div',{className:"_2_he"},c('React').createElement('i',{className:c('joinClasses')("_2_hf",z.get('iconCl'))}),c('React').createElement(c('TextWithHighlights.atlas'),{text:z.get('text'),highlight:aa})));});function w(y,z,aa){var ba=z-y,ca=aa-y;return ba>=0&&ca>0?Math.min(100,Math.round(ba/ca*100)):0;}function x(y){var z=10000;return (y.get('id')&&y.get('at')&&c('OzHelpers').serverNow()+z>y.get('at'));}f.exports={OzComposerAIList:m};},null);
__d('OzComposerAttachments.react',['cx','OzHelpers','Image.react','immutable','MNCommerceAgentItemSuggestionMercuryAttachment.react','OzAttachmentOverlay.react','OzConstants','OzImmutablePureRenderMixin','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').OrderedMap,j=c('immutable').Map,k=c('OzConstants').ATTS,l=c('React').PropTypes,m=c('React').createClass({displayName:'OzComposerAttachments',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{attachments:l.instanceOf(i).isRequired,onAttachmentCrop:l.func.isRequired,onBubbleEdit:l.func.isRequired,onRemove:l.func.isRequired},render:function(){var o=this.props,p=o.attachments,q=o.onAttachmentCrop,r=o.onBubbleEdit,s=o.onRemove;if(p.isEmpty())return null;return (c('React').createElement('div',{className:"_18wb"},p.map(function(t,u){return (c('React').createElement(n,{key:u,id:u,attachment:t,onRemove:s,onBubbleEdit:r,onAttachmentCrop:q}));}).valueSeq()));}}),n=c('React').createClass({displayName:'Attachment',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{attachment:l.instanceOf(j).isRequired,id:l.number.isRequired,onAttachmentCrop:l.func.isRequired,onBubbleEdit:l.func.isRequired,onRemove:l.func.isRequired},render:function(){var o=this.props,p=o.attachment,q=o.id,r=o.onAttachmentCrop,s=o.onBubbleEdit,t=o.onRemove;switch(p.get('type')){case k.IMAGE:var u=p.get('url')||c('OzHelpers').blobURI(p.get('ui-blob'));return (c('React').createElement(c('OzAttachmentOverlay.react'),{key:q,onEdit:function(v){return r(p,q);},onRemove:function(v){return t(p,q);},loading:p.get('loading')},c('React').createElement(c('Image.react'),{className:"_4xee",onClick:function(v){return window.open(u);},src:u})));case k.SUGG:return (c('React').createElement(c('OzAttachmentOverlay.react'),{key:q,onRemove:function(v){return t(p,q);},onEdit:function(v){return s(p,q);}},c('React').createElement(c('MNCommerceAgentItemSuggestionMercuryAttachment.react'),{itemSuggestion:c('OzHelpers').uiSuggestion(p.get('data'))})));default:return (c('React').createElement(c('OzAttachmentOverlay.react'),{key:q},c('React').createElement('span',null,JSON.stringify(p))));}}});f.exports=m;},null);
__d('OzConfirmDialog.react',['cx','joinClasses','MessengerDialog.react','MessengerDialogBody.react','MessengerDialogButton.react','MessengerDialogCancelButton.react','MessengerDialogFooter.react','MessengerDialogHeader.react','OzActions','ReactComponentWithPureRenderMixin','React','ReactDOM'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'OzConfirmDialog',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{body:i.node.isRequired,confirmLabel:i.string,header:i.string.isRequired,onConfirm:i.func.isRequired,onCancel:i.func,width:i.number},componentDidMount:function(){c('ReactDOM').findDOMNode(this.refs.confirm).focus();},render:function(){var l=this.props,m=l.body,n=l.className,o=l.confirmLabel,p=l.header,q=l.onCancel,r=l.onConfirm,s=l.width,t=babelHelpers.objectWithoutProperties(l,['body','className','confirmLabel','header','onCancel','onConfirm','width']);return (c('React').createElement(c('MessengerDialog.react'),babelHelpers['extends']({className:c('joinClasses')("_1vdh",n),onToggle:k(q),width:s||500},t),c('React').createElement(c('MessengerDialogHeader.react'),null,p),c('React').createElement(c('MessengerDialogBody.react'),{className:"_1vdi"},m),c('React').createElement(c('MessengerDialogFooter.react'),null,c('React').createElement(c('MessengerDialogCancelButton.react'),{onClick:k(q)}),c('React').createElement(c('MessengerDialogButton.react'),{action:'confirm',label:o||'OK',onClick:k(r),ref:'confirm',type:'primary',use:'default'}))));}});function k(l){return function(m){c('OzActions').hideDialog();l&&l();};}f.exports=j;},null);
__d('OzSendLater.react',['cx','OzHelpers','React','XUIContextualDialog.react','OzImmutablePureRenderMixin','LayerHideOnBlur','XUIDateTimePicker.react','MessengerButton.react','Tooltip'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'OzSendLater',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{numScheduled:i.number.isRequired,onSendLater:i.func.isRequired,onTimeChange:i.func.isRequired,onToggle:i.func.isRequired,shown:i.bool.isRequired,timestamp:i.number,disabled:i.bool},render:function(){var k=this.props,l=k.shown,m=k.disabled,n=k.numScheduled,o=k.onToggle,p=k.onTimeChange,q=k.onSendLater;return (c('React').createElement('span',{className:"_40yd"},c('React').createElement('button',babelHelpers['extends']({ref:'btn',disabled:m,onClick:function(r){return o(true);}},m?c('Tooltip').propsFor('We can not schedule this message; '+'images are not supported yet'):null,{className:"_1-hv _40ye _30yy"}),c('React').createElement('div',null,c('React').createElement('i',{className:"_40yf"}),n?c('React').createElement('div',{className:"_2ism"},n):null)),c('React').createElement(c('XUIContextualDialog.react'),{position:'above',contextRef:function(r){return this.refs.btn;}.bind(this),className:"_40yg",shown:l,onToggle:o,behaviors:{LayerHideOnBlur:c('LayerHideOnBlur')}},c('React').createElement('div',{className:"_40yg"},c('React').createElement(c('XUIDateTimePicker.react'),babelHelpers['extends']({className:"_40yh",date:new Date(this.props.timestamp||c('OzHelpers').serverNow()),allowDuplicateDateSelection:true,onChange:function(r){return p(+r);}},c('OzHelpers').dateRestraints())),c('React').createElement(c('MessengerButton.react'),{onClick:q,label:'Send Later',type:'primary'})))));}});f.exports=j;},null);
__d('OzUpdateDateTime.react',['immutable','OzHelpers','React'],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h=c('immutable').Map,i=c('React').PropTypes,j=c('React').createClass({displayName:'OzUpdateDateTime',propTypes:{timezoneOffset:i.number.isRequired,locale:i.string.isRequired,options:i.instanceOf(h).isRequired},componentDidMount:function(){var k=setInterval(function(){this.forceUpdate();}.bind(this),60000);this.setState({timer:k});},componentWillUnmount:function(){if(this.state.timer)clearInterval(this.state.timer);},render:function(){var k=new Date(c('OzHelpers').serverNow()+this.props.timezoneOffset);return (c('React').createElement('span',null,k.toLocaleString(this.props.locale,this.props.options.set('timeZone','UTC').toJS())));}});f.exports=j;},null);
__d('OzComposer.react',['cx','fbt','invariant','Promise','OzAPI','OzEditorStateHelpers','formatDate','getDefaultKeyBinding','getEntityMatcher','getVisibleValueForContentState','OzHelpers','insertEmoticonIntoEditorState','OzNotify','promiseFinally','ChatContentSearchButton.react','ChatStickerButton.react','CompositeDraftDecorator','DraftEditor.react','DraftModifier','EditorState','EmoticonsList','EmoticonSpan.react','FileInput.react','immutable','KeyBindingUtil','Keys','MessengerContextualDialog.react','MercuryConfig','OzActions','OzAttachmentCropper.react','OzBubbleEditor.react','OzComposerAI.react','OzComposerAttachments.react','OzConfirmDialog.react','OzConstants','OzHistory','OzSendLater.react','OzStores','OzSuggestions','OzUpdateDateTime.react','React','Reflux','SelectionState','StickerActions','Timestamp.react'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('OzHistory')('composer-history'),l=c('immutable').Map,m=c('immutable').OrderedMap,n=c('immutable').List,o=c('React').PropTypes,p=c('OzComposerAI.react').OzComposerAIList,q=c('OzConstants').ATTS,r=c('OzConstants').TOKENS,s=c('OzStores').ActiveThreadStore,t=c('OzStores').BubbleStore,u=8*1024*1024,v={CREATE_BUBBLE:'CREATE_BUBBLE',CREATE_REMINDER:'CREATE_REMINDER',CREATE_INTENT:'CREATE_INTENT',CLOSE_INTENT:'CLOSE_INTENT',CLOSE_REMINDER:'CLOSE_REMINDER'},w=15*60*1000,x=c('React').createClass({displayName:'OzComposer',mixins:[c('Reflux').connect(t,'bubbles'),c('Reflux').connect(s,'activeThread')],propTypes:{thread:o.instanceOf(l).isRequired,merchants:o.instanceOf(l).isRequired,onResize:o.func},contextTypes:{uid:o.string.isRequired},getInitialState:function(){return ca(this.props.thread);},componentDidMount:function(){this._unlisten=c('OzActions').updateComposer.listen(this._onUpdateComposer);this._oldHeight=this.refs.root.offsetHeight;},componentWillReceiveProps:function(kb){if(c('OzHelpers').threadID(kb.thread)!==c('OzHelpers').threadID(this.props.thread)){da(this.tid(),this.state);this.setState(ca(kb.thread));}},componentDidUpdate:function(){window.setTimeout(function(kb){var lb=this.refs.root.offsetHeight;if(lb!==this._oldHeight)this.props.onResize&&this.props.onResize();this._oldHeight=lb;}.bind(this));},componentWillUnmount:function(){da(this.tid(),this.state);this._unlisten();},getValue:function(){return c('getVisibleValueForContentState')(this.e().getCurrentContent());},focusInput:function(){this.refs.input.focus();},render:function(){return (c('React').createElement('div',{ref:'root',className:"_5751 _19ib"},this._renderWidgets(),c('React').createElement('div',{className:"_5754"},c('React').createElement('div',{className:"_19id"},this._renderTextEditor()),this._renderActions())));},_renderTextEditor:function(){return (c('React').createElement(c('DraftEditor.react'),{ref:'input',editorState:this.e(),keyBindingFn:this._toKeyCommand,handleKeyCommand:this._handleKeyCommand,handleBeforeInput:this._handleBeforeInput,onChange:this._handleChange,onDownArrow:this._handleDownArrow,onUpArrow:this._handleUpArrow,onTab:this._handleTab,handleReturn:this._handleReturn,onFocus:this._handleFocus,handlePastedFiles:this._handleFiles,handleDroppedFiles:function(kb,lb){this._handleFiles(lb);}.bind(this),placeholder:i._("Type a message... (\u2318\u21a9 to send)"),spellCheck:true,textAlignment:'left'}));},_handleFocus:function(){this.setState({isAIOpen:true});},_onUpdateComposer:function(kb){var lb=kb.text,mb=kb.files;lb&&this._handleChange(c('OzEditorStateHelpers').append(this.e(),lb));mb&&this._handleFiles(mb);this.refs.input.focus();},_validateSend:function(){return new (c('Promise'))(function(kb,lb){var mb=[[pa(this.e().getCurrentContent()).length>0,'You have not filled in all the missing information.'],[this.state.attachments.some(function(nb){return nb.get('loading');}),'Your attachments are still loading. Please wait and send in a bit'],[!c('OzHelpers').isOwner(this.t(),this.context.uid),'You do not own this thread. Assign yourself to send messages']].find(function(nb){var ob=nb[0],pb=nb[1];return ob;});mb?lb(mb[1]):kb();}.bind(this));},_sendWith:function(kb,lb){this._validateSend().done(function(mb){var nb=c('OzHelpers').threadID(this.t()),ob=this.getValue().trim(),pb=this.state.attachments.groupBy(function(tb){return tb.get('type');}),qb=na(this.t(),this.state),rb=pb.get(q.IMAGE,n()).map(function(tb){return tb['delete']('ui-blob');}).toList(),sb=ob||!rb.isEmpty()?kb({tid:nb,images:rb,text:ob,aiusage:qb}):c('Promise').resolve();pb.get(q.SUGG,n()).reduce(function(tb,ub){return c('promiseFinally')(tb,function(vb){return lb({tid:nb,suggestion:ub.get('data'),aiusage:qb});});},sb);c('OzAPI').notifyExtension({action:'discard',id:nb});this._toHistory();this.setState(babelHelpers['extends']({},aa(),{editorState:c('OzEditorStateHelpers').replaceContentWithText(this.e(),''),seedBubble:this.state.seedBubble,isAIOpen:this.state.isAIOpen}));}.bind(this),c('OzNotify').error);},_handleMessageSend:function(){var kb=function(nb){return this._sendWith(c('OzAPI').sendMessage,c('OzAPI').suggest);}.bind(this),lb=this.getValue().trim(),mb=n([ha,ia]).map(function(nb){return nb(this.t(),lb);}.bind(this)).filter(function(nb){return !!nb;});mb.isEmpty()?kb():c('OzActions').showDialog(c('OzConfirmDialog.react'),{body:mb.size===1?mb.first():c('React').createElement('ul',null,mb.map(function(nb,ob){return c('React').createElement('li',{key:ob},nb);})),confirmLabel:'Send',header:'Are you sure you want to send this message?',onConfirm:kb});},_handleSendLater:function(){var kb=this.state.schedule.timestamp;kb?this._sendWith(function(lb){return c('OzAPI').scheduleMessage(babelHelpers['extends']({},lb,{at:kb}));},function(lb){return c('OzAPI').scheduleSuggest(babelHelpers['extends']({},lb,{at:kb}));}):c('OzNotify').error('You need to pick a time to send later');},_handleReturn:function(kb){if(c('OzHelpers').hasCmdOrCtrl(kb)){setTimeout(this._handleMessageSend);return true;}return false;},_handleFiles:function(kb){var lb=kb;if(lb.some(function(ob){return ob.size>=u;})){c('OzNotify').error('The file you are trying to add is too large.');return false;}if(!lb.length)return false;var mb=this.state.attachments.merge(lb.map(function(ob,pb){return [pb,l({type:q.IMAGE,'ui-blob':ob,loading:true})];}));this.setState({attachments:mb});var nb=function(ob){return (lb.reduce(function(pb,qb,rb){return pb['delete'](rb);},ob));};c('Promise').all(lb.map(function(ob){return c('OzAPI').upload(l({type:ob.type,blob:ob}));})).done(function(ob){!ob.every(function(pb){return pb.get('id');})?j(0):undefined;this.setState({attachments:ea(nb(this.state.attachments),ob.map(function(pb,qb){return pb.set('ui-blob',lb[qb]);}))});}.bind(this),function(ob){this.setState({attachments:nb(this.state.attachments)});}.bind(this));return true;},_handleStickerSelect:function(kb){c('StickerActions').hideStickerTray();this._validateSend().then(function(lb){c('OzAPI').sendMessage({tid:c('OzHelpers').threadID(this.t()),'sticker-id':kb});}.bind(this),c('OzNotify').error).done();},_handleContentSearchSelect:function(kb,lb){if(kb.platformFBID.toString()===c('MercuryConfig').MessengerAppID){this._handleStickerSelect(kb.resultID.toString());return;}this._validateSend().then(function(mb){c('OzAPI').upload(l({type:'image/url','attribution-app-id':kb.platformFBID,'image-url':kb.source.url})).done(function(nb){return c('OzAPI').sendMessage({tid:c('OzHelpers').threadID(this.t()),images:[nb]});}.bind(this));}.bind(this),c('OzNotify').error).done();},_handleEmoticonSelect:function(kb){var lb=c('EmoticonsList').symbols[kb];lb&&this._handleChange(c('insertEmoticonIntoEditorState')(lb,this.state.editorState));},_handleAttRemove:function(kb){this.setState({attachments:this.state.attachments['delete'](kb.get('id'))});},_handleBubbleEdit:function(kb){this.setState({seedBubble:kb});},_handleBubbleEditorSave:function(kb){this.setState({seedBubble:null,attachments:ea(this.state.attachments,[kb])},function(lb){return this.refs.input.focus();}.bind(this));},_handleBubbleEditorClose:function(kb){var lb={seedBubble:null},mb=kb.get('id');if(mb)lb.attachments=this.state.attachments['delete'](mb);this.setState(lb,function(nb){return this.refs.input.focus();}.bind(this));},_handleAttachmentCrop:function(kb){this.setState({cropAttachment:kb});},_handleAttCropperSave:function(kb){var lb=this.state.attachments['delete'](kb.get('id'));this.setState({cropAttachment:null,attachments:lb},function(mb){this._handleFiles([kb.get('ui-blob')]);this.refs.input.focus();}.bind(this));},_handleAttCropperClose:function(kb){this.setState({cropAttachment:null},function(lb){return this.refs.input.focus();}.bind(this));},_renderWidgets:function(){if(this.state.seedBubble)return (c('React').createElement(c('OzBubbleEditor.react'),{merchants:this.props.merchants,seedBubble:this.state.seedBubble,onSave:this._handleBubbleEditorSave,onClose:this._handleBubbleEditorClose}));if(this.state.cropAttachment)return (c('React').createElement(c('OzAttachmentCropper.react'),{attachment:this.state.cropAttachment,onSave:this._handleAttCropperSave,onClose:this._handleAttCropperClose}));return (c('React').createElement('div',null,c('React').createElement(p,{filter:this.getValue(),items:this._AIItems(),onItemClick:this._handleAIItemClick}),c('React').createElement(c('OzComposerAttachments.react'),{attachments:this.state.attachments,onRemove:this._handleAttRemove,onBubbleEdit:this._handleBubbleEdit,onAttachmentCrop:this._handleAttachmentCrop})));},_renderActions:function(){return (c('React').createElement('div',{className:"_575c"},c('React').createElement(c('ChatStickerButton.react'),{className:"_30yy"+(' '+"_1v3y"),flyoutAlignment:'right',flyoutClassName:"_293j",onStickerSelect:this._handleStickerSelect,onEmoticonSelect:this._handleEmoticonSelect}),c('React').createElement(c('FileInput.react'),{ref:'fileInput',display:'inline-block',accept:'*/*',multiple:true,onChange:function(kb){this._handleFiles([].slice.apply(kb.target.files));this.refs.fileInput.getFileInput().clear();}.bind(this)},c('React').createElement('a',{title:'add images',className:"_2e01 _30yy"})),c('React').createElement(c('ChatContentSearchButton.react'),{className:"_yht _30yy _592k",ref:'chatContentSearch',ContextualDialogClass:c('MessengerContextualDialog.react'),flyoutAlignment:'right',flyoutClassName:"_293j",flyoutWidth:285,onStickerSelect:this._handleStickerSelect,getInput:function(){return this.refs.input;}.bind(this),getQuery:this.getValue,onSelect:this._handleContentSearchSelect}),c('React').createElement(c('OzSendLater.react'),babelHelpers['extends']({},this.state.schedule,{numScheduled:this.props.thread.get('events')?this.props.thread.get('events').count():0,onTimeChange:this._handleScheduleTimeChange,onToggle:this._handleScheduleToggle,onSendLater:this._handleSendLater}))));},_handleChange:function(kb){var lb=this.e().getCurrentContent().getPlainText(),mb=kb.getCurrentContent().getPlainText();c('OzHelpers').debug('[composer] changed from',lb,mb);var nb={editorState:kb};if(!lb.length&&mb.length)fa(this.t());this.setState(nb);},_handleDownArrow:function(kb){if(c('OzHelpers').hasCmdOrCtrl(kb)&&this.e().isSelectionAtStartOfContent()){this._fromHistory('down');kb.preventDefault();return true;}},_handleUpArrow:function(kb){if(c('OzHelpers').hasCmdOrCtrl(kb)&&this.e().isSelectionAtStartOfContent()){this._fromHistory('up');kb.preventDefault();return true;}},_handleTab:function(kb){var lb=ra(this.e());if(lb){this.setState({editorState:c('EditorState').forceSelection(this.e(),lb)});kb.preventDefault();return true;}var mb=la(this._AIItems(),l({line:0,column:0}));if(mb){this._handleAISelect(mb);kb.preventDefault();return true;}},_toKeyCommand:function(kb){var lb=function(){var mb=kb.keyCode-c('Keys').ZERO;if(this.state.isAIOpen&&mb<=this._AIItems().size)return 'SELECT-AI-ITEM-'+(mb-1);}.bind(this);return (ja(kb)&&v.CREATE_BUBBLE||ma(kb)&&lb()||ka(kb)&&'PREFERRED-NAME'||c('getDefaultKeyBinding')(kb));},_handleKeyCommand:function(kb){switch(kb){case 'SELECT-AI-ITEM-0':case 'SELECT-AI-ITEM-1':case 'SELECT-AI-ITEM-2':case 'SELECT-AI-ITEM-3':case 'SELECT-AI-ITEM-4':case 'SELECT-AI-ITEM-5':case 'SELECT-AI-ITEM-6':case 'SELECT-AI-ITEM-7':case 'SELECT-AI-ITEM-8':case 'SELECT-AI-ITEM-9':this._handleAIItemClick(l({line:+kb.slice(-1),column:0}));return true;case 'PREFERRED-NAME':this._handleChange(c('EditorState').push(this.e(),c('DraftModifier').replaceText(this.e().getCurrentContent(),this.e().getSelection(),c('OzHelpers').preferredName(this.t()))));return true;case v.CREATE_BUBBLE:this.setState({seedBubble:ga()});return true;}return false;},_AIItems:function(kb){return ua(this.state.isAIOpen,this.props.thread,this.state.bubbles,this.props.merchants,this.getValue());},_handleAISelect:function(kb){this.setState({lastAIPick:kb,lastAIGuesses:this.t().get('guesses')},function(){var lb=kb.get('id');if(xa(kb)){c('OzAPI').deleteScheduled(c('OzHelpers').threadID(this.t()),lb);this._handleScheduleTimeChange(kb.get('at'));}switch(kb.get('type')){case q.COMMAND:if(!xa(kb))switch(kb.get('action')){case v.CREATE_REMINDER:this._handleCreateReminder(kb);break;case v.CLOSE_REMINDER:this._handleCloseReminder(kb);break;case v.CREATE_INTENT:this._handleCreateIntent(kb);break;case v.CLOSE_INTENT:this._handleCloseIntent(kb);break;default:this._handleKeyCommand(kb.get('action'));}break;case q.SURVEY:case 'send':case q.TEMPLATE:var mb=kb.get('f'),nb=mb&&mb()||kb.get('ui-body'),ob=kb.getIn(['data','images']),pb=c('OzEditorStateHelpers').replaceLine(this.e(),nb+' '),qb=ra(pb);if(nb)this._handleChange(qb?c('EditorState').forceSelection(pb,qb):pb);if(ob)this.setState({attachments:ea(this.state.attachments,ob.toArray())});break;case 'suggest':case q.SUGG:this.setState({seedBubble:kb});break;}}.bind(this));this.focusInput();},_handleAIItemClick:function(kb){this._handleAISelect(la(this._AIItems(),kb));},_handleCreateReminder:function(kb){c('OzAPI').createReminder(this.tid(),l({body:kb.get('body'),'scheduled-time':kb.get('scheduled-time')}));},_handleCloseReminder:function(kb){c('OzAPI').closeReminder(this.tid(),kb.get('id')||kb.get('reminder-id'),false);},_handleCreateIntent:function(kb){c('OzAPI').createIntent(this.tid(),l({'wit-intent-uuid':kb.get('wit-intent-uuid'),name:kb.get('name'),metadata:kb.get('metadata'),params:kb.get('params'),actions:kb.get('actions'),notes:kb.get('notes'),requirements:kb.get('requirements')}));},_handleCloseIntent:function(kb){c('OzAPI').closeIntent(this.tid(),kb.get('id'));},_toHistory:function(){var kb=this.state.attachments,lb=kb.filter(function(nb){return nb.get('type')===q.SUGG;}),mb=this.getValue();k.push(JSON.stringify({bubbles:lb,text:mb}));},_fromHistory:function(kb){var lb=c('OzHelpers').safeParse(k[kb]()),mb=lb.bubbles,nb=lb.text;nb&&this._handleChange(c('OzEditorStateHelpers').replaceContentWithText(this.e(),nb));mb&&this.setState({attachments:m(mb).mapEntries(function(ob){return c('immutable').fromJS(ob);}).mapKeys(function(ob){return +ob;})});},_handleScheduleToggle:function(kb){var lb=this.state.schedule;lb.shown===kb?null:this.setState({schedule:babelHelpers['extends']({},lb,{shown:kb})});},_handleScheduleTimeChange:function(kb){this.setState({schedule:babelHelpers['extends']({},this.state.schedule,{timestamp:kb})});},e:function(){return this.state.editorState;},t:function(){return this.props.thread;},tid:function(){return c('OzHelpers').threadID(this.t());}});function y(){var kb=new (c('CompositeDraftDecorator'))([{strategy:function(lb,mb){pa(lb.getText()).map(function(nb){return mb.apply(undefined,nb);});},component:ta},{strategy:c('getEntityMatcher')(function(lb){return lb.getType()==='EMOTICON';}),component:c('EmoticonSpan.react')}]);return c('EditorState').createEmpty(kb);}function z(){return {shown:false,timestamp:null};}function aa(){return {attachments:m(),editorState:y(),seedBubble:null,isAIOpen:false,lastAIPick:null,lastAIGuesses:null,schedule:z()};}var ba={};function ca(kb){return ba[c('OzHelpers').threadID(kb)]||aa();}function da(kb,lb){var mb=babelHelpers['extends']({},lb);delete mb.bubbles;delete mb.activeThread;mb.isAIOpen=false;ba[kb]=mb;}function ea(kb,lb){!m.isOrderedMap(kb)?j(0):undefined;!Array.isArray(lb)?j(0):undefined;return kb.withMutations(function(mb){return lb.reduce(function(nb,ob){ob=ob.set('id',ob.get('id')||ob.hashCode());return nb.set(ob.get('id'),ob);},mb);});}function fa(kb){var lb=c('OzHelpers').threadID(kb);if(kb.get('read-state')==='unread')c('OzAPI').ack(lb);return c('OzAPI').typing(lb);}function ga(){return c('immutable').fromJS({data:{currency:'USD'},type:q.SUGG});}function ha(kb,lb){var mb=l({hour:'numeric',minute:'numeric'}),nb=kb.getIn(['location','timezone-offset']),ob=c('OzHelpers').preferredName(kb),pb=c('OzHelpers').lastPresence(kb);if(nb&&!c('OzHelpers').isDaytime(nb)&&pb&&c('OzHelpers').serverNow()-pb>w)return (c('React').createElement('span',null,'It\'s ',c('React').createElement('strong',null,c('React').createElement(c('OzUpdateDateTime.react'),{locale:'en-US',options:mb,timezoneOffset:nb||0})),' at ',ob,'\'s last known location and they haven\'t interacted with us since ',c('React').createElement('strong',null,c('React').createElement(c('Timestamp.react'),{autoUpdate:true,time:pb/1000})),'.'));}function ia(kb,lb){var mb=n([[/ +/g,function(nb){return nb.length>1;},'a bunch of spaces in a row'],[/^ | $/gm,function(nb){return true;},'whitespace at the beginning or end of a line']]).map(function(nb){var ob=nb[0],pb=nb[1],qb=nb[2];return n(lb.match(ob)).some(pb)&&qb;}).filter(function(nb){return !!nb;});if(!mb.isEmpty())return (c('React').createElement('div',null,'Your text contains some weird formatting:',c('React').createElement('ul',null,mb.map(function(nb,ob){return c('React').createElement('li',{key:ob},nb);}))));}function ja(kb){return c('OzHelpers').hasCmdOrCtrl(kb)&&kb.which===66;}function ka(kb){return kb.getModifierState('Control')&&kb.which===78;}function la(kb,lb){var mb=kb.get(lb.get('line'));return n.isList(mb)?mb.get(lb.get('column')):mb;}function ma(kb){return (c('KeyBindingUtil').hasCommandModifier(kb)&&kb.keyCode>=c('Keys').ZERO+1&&kb.keyCode<=c('Keys').ZERO+9);}function na(kb,lb){var mb=lb.lastAIPick,nb=lb.lastAIGuesses,ob=nb||kb.get('guesses'),pb=c('OzHelpers').openIntents(kb).map(function(qb){return qb.filter(c('OzHelpers').keysIn('name','wit-intent-uuid'));});c('OzHelpers').debug('building ai usage',c('OzHelpers').threadID(kb));return l({gold:mb,guesses:ob,intents:pb});}var oa=/(@\[[^\]]+\])/g;function pa(kb){var lb=undefined,mb=[];while(lb=oa.exec(kb))mb.push([lb.index,lb.index+lb[0].length]);return mb;}function qa(kb){return '@['+kb+']';}function ra(kb){var lb=kb.getCurrentContent().getBlockMap().toSeq().map(function(ob){return [ob,pa(ob.getText())[0]];}).find(function(ob){var pb=ob[0],qb=ob[1];return !!qb;},null,[]),mb=lb[0],nb=lb[1];return mb&&nb?sa.apply(undefined,[mb.getKey()].concat(nb)):null;}function sa(kb,lb,mb){return new (c('SelectionState'))({anchorKey:kb,focusKey:kb,anchorOffset:lb,focusOffset:mb,hasFocus:true,isBackward:false});}var ta=c('OzHelpers').pure(function(kb){var lb=kb.offsetKey,mb=kb.children;return (c('React').createElement('span',{'data-offset-key':lb,className:"_a5n"},mb));});function ua(kb,lb,mb,nb,ob){var pb=wa(lb,nb,ob),qb=va(lb,pb,nb,mb,ob),rb=qb.groupBy(function(ub){return ub.get('ui-scheduled')?'scheduled':ub.get('type')===q.SUGG?q.SUGG:'rest';}),sb=rb.get('rest',n()).push(rb.get(q.SUGG)).filter(function(ub){return !!ub;}),tb=rb.get('scheduled',n());if(!kb){return tb.isEmpty()?n():n().push(tb);}else if(tb.isEmpty()){return sb;}else return sb.push(tb);}function va(kb,lb,mb,nb,ob){return (db(nb,ob).takeLast(1).concat(lb.concat(jb(kb,ob)).take(5)).concat(cb(ob)).concat(ya(kb,mb,ob)));}function wa(kb,lb,mb){return (kb.get('guesses')||n()).flatMap(function(nb){return nb.get('items')||[nb].map(function(ob){return ob.merge(l({position:nb.get('position'),confidence:nb.get('confidence'),'class':nb.get('class')}));});}).map(function(nb){switch(nb.get('type')){case q.TEMPLATE:var ob=eb(kb,nb.get('body'));return xa(nb)||ib(ob,mb)?nb.set('ui-body',ob):null;case 'bubble':return xa(nb)||hb(nb.get('data'),mb)?c('OzSuggestions').toServer(nb,lb):null;case 'close-intent':return ab(kb,nb);case 'create-intent':return za(kb,nb);case 'close-reminder':return bb(kb,nb);case 'reminder':var pb=nb.getIn(['body','description']),qb=nb.get('scheduled-time'),rb=c('formatDate')(qb/1000,'g:ia M j');return l({type:q.COMMAND,action:v.CREATE_REMINDER,text:'Create Reminder for '+rb+': "'+pb+'"',iconCl:"_3e_w",body:nb.get('body'),'scheduled-time':qb});}}).filter(function(nb){return !!nb;});}function xa(kb){return !!(kb.get('id')&&kb.get('at'));}function ya(kb,lb,mb){return (kb.get('events')||n()).concat(kb.get('scheduled')||n()).toSeq().map(function(nb){switch(nb.get('type')){case 'send':return nb.set('ui-body',nb.getIn(['data','text']));case 'suggest':return nb.set('type',q.SUGG).set('data',nb.getIn(['data','suggestion'])).updateIn(['data','merchant-name'],function(ob){return c('OzSuggestions').findMerchantName(ob,lb);});case 'create-intent':return za(kb,nb.get('data')).set('id',nb.get('id'));case 'close-intent':return ab(kb,nb.get('data')).set('id',nb.get('id'));case 'close-reminder':return bb(kb,nb.get('data')).merge({id:nb.get('id'),at:nb.get('at')});case q.SURVEY:case q.TEMPLATE:return nb.set('ui-body',eb(kb,nb.getIn(['data','body'])));case 'bubble':return c('OzSuggestions').toServer(nb.get('data'),lb).setIn(['data','amount'],+nb.getIn(['data','data','price'])).set('id',nb.get('id'));default:c('OzHelpers').debug('[oz-scheduled], unk scheduled',nb);}}).filter(function(nb){return !!nb;}).map(function(nb){return nb.set('ui-scheduled',true);}).sortBy(function(nb){return nb.get('at');});}function za(kb,lb){var mb=lb.get('name');return lb.set('type',q.COMMAND).set('action',v.CREATE_INTENT).set('text','Create intent '+mb).set('iconCl',"_3e_w");}function ab(kb,lb){var mb=lb.get('id'),nb=kb.get('intents').findLast(function(pb){return pb.get('id')===mb;}),ob=nb?nb.get('alias')||nb.get('name'):lb.get('source');return lb.set('type',q.COMMAND).set('action',v.CLOSE_INTENT).set('text','Close intent '+ob).set('iconCl',"_3e_w");}function bb(kb,lb){var mb=lb.get('id')||lb.get('reminder-id'),nb=kb.get('reminders').findLast(function(pb){return pb.get('id')===mb;}),ob=nb?nb.getIn(['body','description']):lb.get('source');return lb.set('type',q.COMMAND).set('action',v.CLOSE_REMINDER).set('text','Close reminder '+ob).set('iconCl',"_3e_w");}function cb(kb){return c('immutable').fromJS([{type:q.COMMAND,action:v.CREATE_BUBBLE,text:'Create Bubble',iconCl:"_3e_w",shortcut:'B'}]).filter(function(lb){return ib(lb.get('text'),kb);});}function db(kb,lb){var mb=kb.filter(function(nb){return hb(nb,lb);});return (mb.isEmpty()?kb:mb).toList();}function eb(kb,lb){if(typeof lb==='string')return lb;return lb&&lb.map(function(mb){if(typeof mb==='string')return mb;return gb(kb,mb);}).toJS().join('');}function fb(kb){var lb=kb.get('index');return qa(kb.get('type')+(lb?' '+lb:''));}function gb(kb,lb){if(lb.get('type')===r.USER_FIRST_NAME)return c('OzHelpers').preferredName(kb);return fb(lb);}function hb(kb,lb){var mb=kb.get('data',l());return ib(mb.get('name','')+'\n     '+mb.get('description','')+'\n     '+mb.get('target-url',''),lb);}function ib(kb,lb){return kb&&kb.toLowerCase().indexOf((lb||'').toLowerCase())>-1;}function jb(kb,lb){var mb=function(pb){return eb(kb,pb[Math.floor(pb.length*Math.random())]);},nb='\uD83D\uDC64',ob=n([eb(kb,c('immutable').fromJS([{type:r.USER_FIRST_NAME}])),[nb+' Who are you?',function(){return mb(["My name is M! I'm your personal assistant in Messenger.","My name is M! I'm your personal assistant. I can help you with things like making reservations, finding the perfect gift or planning your next vacation.","My name is M! I'm your personal assistant in Messenger. I'm here to help you do things better and faster.","My name is M! I'm here to help make your life easier."]);}],[nb+' What can you do for me?',function(){return mb(["I can help you with lots of things, like figuring out where to go to dinner, finding a great gift for someone, or planning your weekend. Just ask!","I can help you with lots of things. Just ask and I'll let you know if it's something I can't do.","In general, I can help you with anything that's not illegal. Just ask and I'll let you know if there's something I can't do."]);}],['Sent the wrong info',function(){return 'Sorry! It looks like I sent you the wrong info. @[Right info]';}],[nb+' How did you pick this?',function(){return "I look at a variety of things and try to find the info that's best for you. Would you like me to send you some other options?";}],[nb+' What does M stand for?',function(){return mb(["M is just my name! ","Just M!","I'm just M, like Messenger."]);}],[nb+' Do you have a partnership with X?',function(){return "No, I just try to find the best info for you. Do you want me to send you some other options?";}],["Storing contact info",function(){return mb(["Thanks! I'll remember this for next time."]);}],["Don't have an opinion",function(){return "I don't have an opinion about that, but...@[point to resources]";}],['Not my area of expertise',function(){return "I'm not a @[lawyer, financial adviser, etc.] so I can't give you @[legal, financial, etc.] advice, but I can do some research for you. ";}],[nb+' What\'s your favorite sticker?',function(){return mb(["I can't pick a favorite!","They're all great!","I love all of the stickers equally!"]);}],["General redirect",function(){return "I'm not really sure how to answer that, but can I help you with something else?";}],["Bugs redirect",function(){return "You can actually report things like this right from Facebook. Here's how: https://www.facebook.com/help/326603310765065/ ";}],["Facebook support redirect",function(){return mb(["I'm not an expert, so I'd recommend checking out the Help Center: www.facebook.com/help (http://www.facebook.com/)","I'm not an expert in that, so I'd recommend going here: www.facebook.com/help (http://www.facebook.com/)"]);}],[nb+' What languages do you support?',function(){return "Right now I can only chat in English. Sorry for the inconvenience!";}],["Trolling (abusing M/the agents)",function(){return mb(["Is there anything I can help you with?","Unfortunately I won't be able to chat with you if you say things like that."]);}],["Generic don't support message",function(){return mb(["Unfortunately I can't do that. Is there anything else I can help you with?","Unfortunately I can't help you with that. @[Sorry for the inconvenience.] Is there anything else I can do for you?","Unfortunately I can't support this type of request. Is there anything else I can help you with?"]);}],[nb+' What are you? Are you human?',function(){return mb(["I'm M! I use artificial intelligence, but people help train me to so I'll get better and better over time.","I'm M! I use artificial intelligence, but people help train me."]);}],[nb+' What gender are you?',function(){return "I don't have a gender. I'm just M.";}],[nb+' How old are you?',function(){return "I don't have an age. Maybe 42?";}],[nb+' Who made you? Where did you come from?',function(){return mb(["I was designed by the Messenger Team.","I was created by the Messenger Team."]);}],[nb+' What do you look like?',function(){return "That's me in the picture next to this message.";}],[nb+' Can you talk or just type?',function(){return "I can send you messages here in Messenger. ";}],[nb+' Where do you live?',function(){return "Right here in Messenger.";}],[nb+' Can you call/message/email my friend?',function(){return "Unfortunately I can't do that. Is there anything else I can help you with?";}],["Medical redirect",function(){return "Unfortunately I can't support this type of request right now. Is there anything else I can help you with?";}],"I'm a little busier than usual right now. I want to give you my full attention, so I'll get back to you as soon as I can. In the meantime, feel free to send me any extra info about your request.","I'm on it!",["You're welcome.",function(){return mb(["You're welcome.","You're welcome! Let me know if there's anything else I can help you with.","You're welcome! Let me know if you need anything else.","You're welcome! Let me know if I can help you with anything else."]);}],["Anything else",function(){return mb(["Let me know if there's anything else I can help you with.","Let me know if I can help with anything else.","Great! Let me know if there's anything else I can help you with.","Let me know if there's anything else I can help you with today."]);}],"How does this look?",["I'm on it",function(){return mb(["Sure, I'm on it!","I'll look into that for you.","I'll look into that for you!","I'll do some research."]);}],"How can I help you today?","How about this?","Is this what you're looking for?","I'll take care of it!","What email should I use for the invite?","Where should I send the invite?","When would you like to dine and how many people will be joining you?",["Save phone number",mb(["Would you like me to save your phone number for future requests?","What phone number would you like me to use for the reservation?"])],"Do you have a price range in mind?","Here are some options:"]).map(function(pb){return (Array.isArray(pb)?l({'ui-body':pb[0],type:q.TEMPLATE,f:pb[1]}):l({'ui-body':pb,type:q.TEMPLATE}));}).filter(function(pb){return ib(pb.get('ui-body'),lb);});return ob;}f.exports=x;},null);
__d('OzMessageCommentDialog.react',['cx','invariant','ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','MessengerButton.react','React','XUIContextualDialog.react'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('React').PropTypes,k=c('React').createClass({displayName:'OzMessageCommentDialog',propTypes:{contextRef:j.func.isRequired,feedback:j.string,onBlur:j.func,onFeedbackChange:j.func.isRequired,onSave:j.func.isRequired},render:function(){return (c('React').createElement(c('XUIContextualDialog.react'),{behaviors:{ContextualLayerAutoFlip:c('ContextualLayerAutoFlip'),ContextualLayerUpdateOnScroll:c('ContextualLayerUpdateOnScroll')},contextRef:this.props.contextRef,shown:true,position:'below',onBlur:this.props.onBlur},c('React').createElement('div',{className:"_2bxg"},c('React').createElement('textarea',{className:"_1-i0",maxLength:'200',value:this.props.feedback,onChange:this._handleFeedbackChange,placeholder:'Give a few words for detail'}),c('React').createElement('div',{className:"_2bxh"},c('React').createElement(c('MessengerButton.react'),{type:'primary',label:'Save',onClick:this.props.onSave})))));},_handleFeedbackChange:function(l){!(l.target instanceof HTMLTextAreaElement)?i(0):undefined;this.props.onFeedbackChange(l.target.value);}});f.exports=k;},null);
__d('OzCheckboxInput.react',['cx','invariant','AbstractCheckboxInput.react','OzImmutablePureRenderMixin','React','joinClasses'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('React').createClass({displayName:'OzCheckboxInput',mixins:[c('OzImmutablePureRenderMixin')],render:function(){return (c('React').createElement(c('AbstractCheckboxInput.react'),babelHelpers['extends']({},this.props,{className:c('joinClasses')(this.props.className,"_55sg _4k1t"),onChange:this._handleChange})));},_handleChange:function(k){var l=k.target;!(l instanceof HTMLInputElement)?i(0):undefined;this.props.onChange&&this.props.onChange(l.checked);}});f.exports=j;},null);
__d('OzMessageFeedbackDialog.react',['cx','ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','InputLabel.react','OzButton.react','OzCheckboxInput.react','React','StarsInput.react','XUIContextualDialog.react','XUIContextualDialogBody.react'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=['Poor','Average','Great'],k=c('React').createClass({displayName:'OzMessageFeedbackDialog',propTypes:{contextRef:i.func.isRequired,executionRating:i.oneOf([0,1,2,3]),followedPolicy:i.bool,onClose:i.func,onExecutionRatingChange:i.func,onFollowedPolicyChange:i.func,onResponsivenessRatingChange:i.func,onSave:i.func,onToneRatingChange:i.func,responsivenessRating:i.oneOf([0,1,2,3]),toneRating:i.oneOf([0,1,2,3])},render:function(){return (c('React').createElement(c('XUIContextualDialog.react'),{behaviors:{ContextualLayerAutoFlip:c('ContextualLayerAutoFlip'),ContextualLayerUpdateOnScroll:c('ContextualLayerUpdateOnScroll')},contextRef:this.props.contextRef,shown:true},c('React').createElement(c('XUIContextualDialogBody.react'),{className:"_5dx"},c('React').createElement('h3',null,'Tone'),c('React').createElement(c('StarsInput.react'),{count:this.props.toneRating,large:true,onClick:this.props.onToneRatingChange,starLabels:j}),c('React').createElement('h3',null,'Execution'),c('React').createElement(c('StarsInput.react'),{count:this.props.executionRating,large:true,onClick:this.props.onExecutionRatingChange,starLabels:j}),c('React').createElement('h3',null,'Responsiveness'),c('React').createElement(c('StarsInput.react'),{count:this.props.responsivenessRating,large:true,onClick:this.props.onResponsivenessRatingChange,starLabels:j}),c('React').createElement('h3',null,'Followed Policy'),c('React').createElement('div',null,c('React').createElement(c('InputLabel.react'),null,c('React').createElement(c('OzCheckboxInput.react'),{checked:this.props.followedPolicy===true,onChange:this._handleYesClick}),c('React').createElement('label',null,'Yes')),c('React').createElement(c('InputLabel.react'),null,c('React').createElement(c('OzCheckboxInput.react'),{checked:this.props.followedPolicy===false,onChange:this._handleNoClick}),c('React').createElement('label',null,'No'))),c('React').createElement('div',{className:"_5dy"},c('React').createElement(c('OzButton.react'),{onClick:this.props.onClose},'Cancel'),c('React').createElement(c('OzButton.react'),{className:"_5dz",onClick:this.props.onSave,use:'confirm'},'Save')))));},_handleYesClick:function(){var l=this.props.onFollowedPolicyChange;l&&l(true);},_handleNoClick:function(){var l=this.props.onFollowedPolicyChange;l&&l(false);}});f.exports=k;},null);
__d('OzMessageFeedback.react',['cx','OzHelpers','joinClasses','ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','immutable','ReactLayeredComponentMixin','MessengerButton.react','OzMessageCommentDialog.react','OzMessageFeedbackDialog.react','OzImmutablePureRenderMixin','React','XUIContextualDialog.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('React').PropTypes,k='comment_dialog',l='feedback_dialog',m='no_dialog',n=c('React').createClass({displayName:'OzMessageFeedback',mixins:[c('ReactLayeredComponentMixin'),c('OzImmutablePureRenderMixin')],propTypes:{message:j.instanceOf(i).isRequired,onSave:j.func.isRequired},getInitialState:function(){return babelHelpers['extends']({currentDialog:m},p(this.props.message));},componentWillReceiveProps:function(r){if(r.message!==this.props.message)this.setState(p(r.message));},render:function(){var r=this.props,s=r.message,t=r.onSave,u=this.state,v=u.currentDialog,w=u.feedback,x=q(this.state);return (c('React').createElement('div',{className:"_2bxa"+(' '+"_2bxb")+(x?' '+"_2bxc":'')+(v!==m?' '+"_2bxd":'')},c('React').createElement(o,{className:"_2bxe",onClick:function(y){return this.setState({currentDialog:k});}.bind(this),isActive:!!w||v===k,ref:'comment'}),c('React').createElement(o,{className:"_2bxf",onClick:function(y){return this.setState({currentDialog:l});}.bind(this),isActive:x||v===l,ref:'flag'})));},renderLayers:function(){switch(this.state.currentDialog){case k:return {contextualDialog:this._renderCommentDialog()};case l:return {contextualDialog:this._renderFeedbackDialog()};default:return null;}},_renderFeedbackDialog:function(){return (c('React').createElement(c('OzMessageFeedbackDialog.react'),{contextRef:function(){return this.refs.flag;}.bind(this),executionRating:this.state.executionRating,followedPolicy:this.state.followedPolicy,onClose:this._handleDialogClose,onExecutionRatingChange:function(r){this.setState({executionRating:r});}.bind(this),onFollowedPolicyChange:function(r){this.setState({followedPolicy:r});}.bind(this),onResponsivenessRatingChange:function(r){this.setState({responsivenessRating:r});}.bind(this),onSave:this._handleFeedbackSave,onToneRatingChange:function(r){this.setState({toneRating:r});}.bind(this),responsivenessRating:this.state.responsivenessRating,toneRating:this.state.toneRating}));},_renderCommentDialog:function(){return (c('React').createElement(c('OzMessageCommentDialog.react'),{contextRef:function(){return this.refs.comment;}.bind(this),feedback:this.state.feedback,onBlur:this._handleDialogClose,onFeedbackChange:function(r){this.setState({feedback:r});}.bind(this),onSave:this._handleCommentSave}));},_handleFeedbackSave:function(){this.props.onSave(i({execution:this.state.executionRating,'followed-policy':this.state.followedPolicy,mid:this.props.message.get('mid'),responsiveness:this.state.responsivenessRating,tone:this.state.toneRating}));this._handleDialogClose();},_handleCommentSave:function(){this.props.onSave(i({feedback:this.state.feedback,mid:this.props.message.get('mid')}));this._handleDialogClose();},_handleDialogClose:function(){this.setState({currentDialog:m});}}),o=c('React').createClass({displayName:'FeedbackButton',render:function(){var r=this.props,s=r.className,t=r.onClick,u=r.isActive;return (c('React').createElement('button',{role:'button',className:c('joinClasses')("_1-hv"+(' '+"_2bxi")+(u?' '+"_2bxj":''),s),onClick:t}));}});function p(r){return {executionRating:r.get('execution'),feedback:r.get('feedback'),followedPolicy:r.get('followed-policy'),responsivenessRating:r.get('responsiveness'),toneRating:r.get('tone')};}function q(r){return !!(r.executionRating||r.followedPolicy!==undefined||r.responsivenessRating||r.toneRating);}f.exports=n;},null);
__d('OzInboxMessage.react',['cx','OzAPI','OzHelpers','immutable','OzActions','OzConfig','OzConstants','OzMessage.react','OzMessageFeedback.react','OzImmutablePureRenderMixin','React','Reflux'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('OzConstants').AUTHOR_TYPES,k=c('React').PropTypes,l=c('React').createClass({displayName:'OzInboxMessage',mixins:[c('OzImmutablePureRenderMixin'),c('Reflux').connect(c('OzConfig').ConfigStore,'config')],propTypes:{authorType:k.oneOf(c('OzHelpers').values(j)),isActive:k.bool.isRequired,message:k.instanceOf(i).isRequired,threadID:k.string.isRequired},render:function(){var m=this.props,n=m.message,o=m.authorType,p=m.threadID,q=m.isActive,r=!!n.get('author'),s=this.state.config;return (c('React').createElement('div',{className:"clearfix"+(' '+"_4y6j")+(q?' '+"_4qv0":'')+(o===j.TRAINER?' '+"_2ij4":'')+(o===j.BOT?' '+"_2ij5":'')+(o===j.USER?' '+"_2p0":'')+(s.getIn(['GK','supervisor'])?' '+"_1w52":'')},c('React').createElement('div',{className:"_2pf"},c('React').createElement(c('OzMessage.react'),{message:n}),o===j.USER?c('React').createElement('button',{onClick:function(){return c('OzActions').intentCreator.toggle();},className:"_1-hv _30yy _4nd4 _ftb"}):null),r?c('React').createElement(c('OzMessageFeedback.react'),{message:n,onSave:function(t){return c('OzAPI').updateMessage(p,t);}}):null));}});f.exports=l;},null);
__d('OzInboxMessageGroup.react',['cx','OzHelpers','immutable','OzConstants','OzDate.react','OzInboxMessage.react','OzUserImage.react','OzImmutablePureRenderMixin','React','Tooltip'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('React').PropTypes,k=c('OzConstants').AUTHOR_TYPES,l=c('React').createClass({displayName:'OzInboxMessageGroup',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{activeMsgID:j.string,authorID:j.string,authorType:j.oneOf(c('OzHelpers').values(k)),messages:j.array.isRequired,repNames:j.instanceOf(i).isRequired,thread:j.object.isRequired,timestamp:j.number.isRequired},scrollMessageIntoViewIfNeeded:function(m){var n=this.refs[m];n?n.scrollIntoViewIfNeeded():c('OzHelpers').error('[inboxgroup] message id '+m+' not in group');},render:function(){return (c('React').createElement('div',{className:"_528w"},this._renderGroup()));},_renderGroup:function(){var m=this.props.authorType,n=k.BOT,o=k.TRAINER,p=k.USER;switch(m){case o:case n:return (c('React').createElement('div',{className:(m===n?"_4m3p":'')+(m===o?' '+"_4m3r":'')},this._renderMessages(),this._renderBottomMeta()));case p:return (c('React').createElement('div',{className:"_4m3u"},c('React').createElement('div',{className:"_2wyu"},this._renderPhoto()),c('React').createElement('div',{className:"_2wyv"},this._renderMessages(),this._renderBottomMeta())));default:c('OzHelpers').error('got unk author type',this.props);return null;}},_renderPhoto:function(){var m=c('OzHelpers').photo(this.props.thread),n=c('OzHelpers').getName(this.props.thread),o=c('OzHelpers').lastPresence(this.props.thread),p=c('OzDate.react').formatTimestamp(o);return (c('React').createElement('div',{className:"_528y"},c('React').createElement('span',c('Tooltip').propsFor('Seen by '+n+' at '+p,'left'),c('React').createElement(c('OzUserImage.react'),{photo:m}))));},_renderSeen:function(){return (c('React').createElement('div',{className:"_40ue"},this._renderPhoto()));},_renderMessages:function(){var m=this.props,n=m.messages,o=m.authorType,p=m.thread,q=m.activeMsgID;return (c('React').createElement('div',{className:"_528z"},n.map(function(r){return (c('React').createElement('div',{key:c('OzHelpers').msgID(r),ref:c('OzHelpers').msgID(r)},c('React').createElement(c('OzInboxMessage.react'),{authorType:o,isActive:c('OzHelpers').msgID(r)===q,message:r,threadID:c('OzHelpers').threadID(p)}),r.get('ui-seen')?this._renderSeen():null));}.bind(this))));},_renderBottomMeta:function(){var m=this.props,n=m.authorID,o=m.repNames,p=m.timestamp;return (c('React').createElement('div',{className:"_4m3v"},c('React').createElement('span',{className:"_4m3w"},o.get(n)||n||null),c('React').createElement(c('OzDate.react'),{className:"_4m3x",timestamp:p})));}});f.exports=l;},null);
__d('OzInboxMessageList.react',['cx','OzHelpers','immutable','OzConstants','OzInboxMessageGroup.react','OzLoading.react','OzImmutablePureRenderMixin','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('React').PropTypes,k=c('OzLoading.react').Inline,l=20,m=c('React').createClass({displayName:'OzGroupList',propTypes:{activeMsgID:j.string,messages:j.instanceOf(i).isRequired,repNames:j.instanceOf(i).isRequired,thread:j.instanceOf(i).isRequired},shouldComponentUpdate:function(t,u){return !(this.props.activeMsgID===t.activeMsgID&&c('immutable').is(this.props.thread,t.thread)&&c('immutable').is(this.props.repNames,t.repNames)&&c('immutable').is(this.props.messages,t.messages));},scrollToMessage:function(t){return i(this.refs).find(function(u){return u.props.messages.some(function(v){return c('OzHelpers').msgID(v)===t;});}).scrollMessageIntoViewIfNeeded(t);},render:function(){var t=this.props.messages.reduceRight(p.bind(null,this.props.thread),{groupsList:[],nextTimestamp:null}).groupsList.map(this._renderGroup);return c('React').createElement('frag',null,t);},_renderGroup:function(t,u){var v=this.props.thread,w=t[0],x=t[t.length-1],y=w.get('sender'),z=w.get('author'),aa=w.get('timestamp'),ba=x.get('timestamp'),ca=y+aa;return (c('React').createElement(c('OzInboxMessageGroup.react'),{authorID:z,authorType:c('OzHelpers').authorType(w),activeMsgID:this.props.activeMsgID,key:ca,messages:t,ref:ca,repNames:this.props.repNames,thread:v,timestamp:ba}));}}),n=c('React').createClass({displayName:'OzInboxMessageList',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{activeMsgID:j.string,clientLimit:j.number.isRequired,loading:j.bool.isRequired,messages:j.instanceOf(i).isRequired,onScrollTop:j.func.isRequired,repNames:j.instanceOf(i).isRequired,thread:j.instanceOf(i).isRequired},componentDidMount:function(){s(this.refs.scrollable);},componentWillUpdate:function(){this._wasScrolledToBottom=r(this.refs.scrollable);this._originalScrollHeight=this.refs.scrollable.scrollHeight;this._originalScrollTop=this.refs.scrollable.scrollTop;this._originalActiveMsgID=this._visiblyActiveMsgID();},componentDidUpdate:function(t){var u=this._visiblyActiveMsgID();if(u&&u!==this._originalActiveMsgID){c('OzHelpers').debug('[messagelist] scrolling to active msg id '+u);this.refs.groupList.scrollToMessage(u);}else if(this._wasScrolledToBottom||q(t.messages,this.props.messages)||c('OzHelpers').threadID(t.thread)!==c('OzHelpers').threadID(this.props.thread)){c('OzHelpers').debug('[messagelist] scrolling bottom');s(this.refs.scrollable);}else{var v=this.refs.scrollable.scrollHeight-this._originalScrollHeight+this._originalScrollTop;this.refs.scrollable.scrollTop=v;}},resize:function(){this.componentDidUpdate(this.props);},_visibleMessages:function(){var t=this.props,u=t.messages,v=t.clientLimit;return u.takeLast(v);},_visiblyActiveMsgID:function(){var t=this.props.activeMsgID,u=this._visibleMessages();if(u.some(function(v){return c('OzHelpers').msgID(v)===t;}))return t;if(t)c('OzHelpers').debug('[messagelist] msg '+t+' not visible',u.toJS());return null;},render:function(){var t=this.props,u=t.loading,v=t.sending,w=t.thread;return (c('React').createElement('div',{onScroll:this._handleScroll,className:"_4fj7",ref:'scrollable'},c('React').createElement(k,{loading:u}),c('React').createElement(m,{activeMsgID:this.props.activeMsgID,thread:w,messages:this._visibleMessages(),ref:'groupList',repNames:this.props.repNames}),c('React').createElement(k,{loading:v})));},_handleScroll:function(){if(this.refs.scrollable.scrollTop<l)this.props.onScrollTop();}});function o(t,u,v){var w=t.get('timestamp'),x=function(z){var aa=z>=w,ba=!v||z<v;return aa&&ba;},y=u.get('last-seen');if(x(y))t=t.set('ui-seen',true);return t;}function p(t,u,v){var w=u.groupsList,x=u.nextTimestamp;v=o(v,t,x);var y=v.get('author'),z=v.get('timestamp'),aa=c('OzHelpers').authorType(v),ba=w[0],ca=ba&&ba[ba.length-1],da=ca&&ca.get('author'),ea=ca?ca.get('timestamp'):Infinity,fa=ca&&c('OzHelpers').authorType(ca);if(da!==y||ea-z>60000||fa!==aa){w.unshift([v]);}else ba.unshift(v);return {groupsList:w,nextTimestamp:z};}function q(t,u){var v=t.last(),w=u.last();return w.get('timestamp')>v.get('timestamp');}function r(t){return t.scrollHeight-t.scrollTop===t.clientHeight;}function s(t){t.scrollTop=t.scrollHeight;}f.exports=n;},null);
__d('OzInboxShow.react',['cx','Promise','OzStrings','OzAPI','OzHelpers','immutable','OzNotify','relativeTimeString.atlas','OzActions','OzButton.react','OzComposer.react','OzConfig','OzConfirmDialog.react','OzConstants','OzInboxMessageList.react','OzIntentCreator.react','OzStores','OzThreadLabels.react','OzUpdateDateTime.react','promiseFinally','OzImmutablePureRenderMixin','React','Reflux','Tooltip'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').List,j=c('immutable').Map,k=c('React').PropTypes,l=c('OzConstants').AUTHOR_TYPES,m=c('OzStores').PendingMessageStateStore,n=c('OzThreadLabels.react').OzLabelList,o=c('OzConfig').ConfigStore,p=c('Reflux').createAction(),q=c('Reflux').createStore({init:function(){this._data=j();this.listenTo(p,this._onUpdateFetchState);},getInitialState:function(){return this._data;},_onUpdateFetchState:function(aa,ba){this._data=this._data.update(aa,function(ca){return (ca||j()).merge(ba);});this.trigger(this._data);}}),r='NO_OWNER',s=25,t=25,u=100,v=10000,w=c('React').createClass({displayName:'OzInboxShow',mixins:[c('OzImmutablePureRenderMixin'),c('Reflux').connect(q,'fetchStates'),c('Reflux').connect(m,'pendingMessageState'),c('Reflux').connect(o,'config')],contextTypes:{uid:k.string.isRequired,router:k.object.isRequired},propTypes:{thread:k.instanceOf(j).isRequired,witIntents:k.instanceOf(j).isRequired,requirements:k.instanceOf(j).isRequired,merchants:k.instanceOf(j).isRequired,reps:k.instanceOf(j).isRequired,humans:k.instanceOf(j).isRequired,params:k.object.isRequired},getInitialState:function(){return z();},componentDidMount:function(){this._init(this.props);var aa=c('OzActions').scrollThreadToTimestamp.listen(this._scrollToTimestamp);this._unlisten=function(){aa();};},componentWillReceiveProps:function(aa){if(c('OzHelpers').threadID(aa.thread)!==c('OzHelpers').threadID(this.props.thread)){c('OzHelpers').debug('[inboxshow] thread changed');this._init(aa);}},_init:function(aa){var ba=aa.thread;c('OzActions').updateThreads(i([ba.set('ui-ping',false)]));if(!this.props.params.intentid){var ca=c('OzHelpers').openIntents(ba).sortBy(function(da){return da.get('created-at');}).reverse().first();if(ca)this.context.router.replace(c('OzHelpers').threadPath({threadid:c('OzHelpers').threadID(ba),intentid:ca.get('id')}));}this._sendThreadFocus();this.setState(z(),function(da){if(x(aa.thread).size<s)this._fetchMessages();}.bind(this));},componentWillUnmount:function(){this._unlisten();},render:function(){var aa=this.state,ba=aa.fetchStates,ca=aa.pendingMessageState,da=aa.clientLimit,ea=aa.activeMsgID,fa=this.props,ga=fa.reps,ha=fa.thread,ia=fa.merchants,ja=fa.witIntents,ka=x(ha),la=c('OzHelpers').threadID(ha),ma=ca.get(la,0)>0,na=ga.map(function(pa){return pa.get('name');});if(ea)c('OzHelpers').debug('[inboxshow] Rendering with active msg id '+ea);var oa={humans:this.props.humans,onOwnerChange:this._handleOwnerChange,repNames:na,reps:ga,requirements:this.props.requirements,thread:ha,witIntents:this.props.witIntents};return (c('React').createElement('div',{className:"_1x8x"+(c('OzHelpers').hasTag(ha,'employee')?' '+"_1yyg":'')+(c('OzHelpers').hasEngage(ha)?' '+"_1fi":'')},c('React').createElement(c('OzIntentCreator.react'),{thread:ha,witIntents:ja}),c('React').createElement('div',{className:"_1x8y"},this._renderHistoryHeader(),c('React').createElement('div',{className:"_1x96"},c('React').createElement(c('OzInboxMessageList.react'),{activeMsgID:ea,clientLimit:da,loading:!!ba.getIn([la,'loading']),onScrollTop:this._fetchMessages,messages:ka,ref:'messageList',repNames:na,sending:ma,thread:ha})),c('React').createElement('div',{className:"_237y"},c('React').createElement(c('OzComposer.react'),{merchants:ia,onResize:this._handleResize,thread:ha}))),c('React').cloneElement(this.props.children,oa)));},_sendThreadFocus:function(){var aa=this.props.thread,ba=c('OzHelpers').threadID(aa),ca=c('OzHelpers').openIntents(aa).getIn([0,'id']);ba&&ca&&c('OzAPI').threadFocus(ba,ca);},_scrollToTimestamp:function(aa){var ba=c('OzHelpers').threadID(this.props.thread);c('OzHelpers').debug('[inboxshow] received request to scroll to ts '+aa);this.setState({activeMsgID:null});this._backloadHistoryUntil(ba,aa)['catch'](function(ca){return c('OzActions').doneScrollingToTimestamp(aa,true);}).then(function(ca){c('OzActions').doneScrollingToTimestamp(aa);if(c('OzHelpers').threadID(this.props.thread)!==ba){c('OzHelpers').debug('[inboxshow] aborting scroll because thread changed');}else{this.setState({clientLimit:this.state.clientLimit+ca.size});var da=ca.isEmpty()?x(this.props.thread):ca,ea=c('OzHelpers').msgID(da.filter(function(fa){return c('OzHelpers').authorType(fa)===l.USER;}).findLast(function(fa){return fa.get('timestamp')<=aa;}));this._activateAndScrollToMsg(ea);}}.bind(this)).done();},_backloadHistoryUntil:function(aa,ba){var ca=function(ga,ha){return (c('OzAPI').history(aa,ga,u).then(function(ia){var ja=y(ia,ga);if(ja===ga||ia.isEmpty())throw ja;var ka=ha.merge(ia);c('OzHelpers').debug('[inboxshow] got '+ka.size+'; dt='+(ja-ba));var la=ia.filter(function(ma){return c('OzHelpers').authorType(ma)===l.USER;});return la.some(function(ma){return ma.get('timestamp')<=ba;})?ka:ca(ja,ha.merge(ia));}));},da=this.state.fetchStates.getIn([aa,'timestamp']),ea=this._unseenButLoadedMessages(),fa=x(this.props.thread).filter(function(ga){return c('OzHelpers').authorType(ga)===l.USER;}).some(function(ga){return ga.get('timestamp')<=ba;});if(fa){c('OzHelpers').debug('[inboxshow] desired timestamp '+ba+' already loaded');return new (c('Promise'))(function(ga){return ga(ea);});}c('OzHelpers').debug('[inboxshow] backloading to ts '+ba+' from '+da);return this._withFetchState(aa,da,ca(da,j())).then(function(ga){return ga.merge(ea).sortBy(function(ha){return ha.get('timestamp');});});},_activateAndScrollToMsg:function(aa){this.setState({activeMsgID:aa},function(ba){window.setTimeout(function(){if(this.state.activeMsgID===aa){c('OzHelpers').debug('[inboxshow] CLEARING ACTIVE MSG ID');this.setState({activeMsgID:null});}}.bind(this),v);}.bind(this));},_withFetchState:function(aa,ba,ca){var da=this.state.fetchStates.get(aa,j());if(da.get('loading')||da.get('fetchedAll')){c('OzHelpers').debug('[inboxshow] already loading or at beginning of time');return new (c('Promise'))(function(ea){return ea();});}c('OzHelpers').debug('[inboxshow] performing load');p(aa,j({loading:true}));return c('promiseFinally')(ca,function(ea){return p(aa,j({loading:false}));}).then(function(ea){var fa=y(ea,ba||Infinity);c('OzHelpers').debug('[inboxshow] loaded '+ea.size+'; ts='+fa);p(aa,j({fetchedAll:ea.isEmpty()||fa===ba,timestamp:fa}));return ea;});},_unseenButLoadedMessages:function(){return x(this.props.thread).skipLast(this.state.clientLimit);},_fetchMessages:function(){var aa=c('OzHelpers').threadID(this.props.thread),ba=this.state.fetchStates.getIn([aa,'timestamp']);this.setState({clientLimit:this.state.clientLimit+s});if(!this._unseenButLoadedMessages().isEmpty()){c('OzHelpers').debug('[inboxshow] using client cache instead of fetch');return;}this._withFetchState(aa,ba,c('OzAPI').history(aa,ba,t)).done();},_handleGrab:function(){c('OzAPI').grab(c('OzHelpers').threadID(this.props.thread));},_handleResize:function(){this.refs.messageList.resize();},_handleOwnerChange:function(aa){var ba=aa.value;if(ba&&ba!==r){var ca=this.props.reps.get(ba),da=this.props.thread,ea=c('OzHelpers').threadID(da);if(ca.get('is-coach')&&!c('OzHelpers').isEscalated(da)){c('OzAPI').escalateTo(ea,ba);}else c('OzAPI').assignTo(ea,ba);if(!ca.get('is-coach')&&c('OzHelpers').isEscalated(da)){var fa='Please remove the "Escalated" tag to prevent the '+'thread from getting reassigned to a coach';c('OzNotify').warn(fa);}}},_renderHistoryHeader:function(){var aa=this.props.thread,ba=c('OzHelpers').threadID(aa),ca=c('OzHelpers').hasTag(aa,'employee')||c('OzHelpers').hasEngage(aa)?'light':'dark',da=function(ha,ia){return c('React').createElement(c('OzButton.react'),{onClick:ia},ha);},ea=function(ha){return function(ia){c('OzHelpers').isOwner(aa,this.context.uid)?ha():c('OzActions').showDialog(c('OzConfirmDialog.react'),{onConfirm:ha,body:'You don\'t own this thread. If you proceed, the user '+'may be forgotten until they message us again.',header:'Are you sure this user doesn\'t need to be engaged?'});}.bind(this);}.bind(this),fa=c('OzHelpers').locationLastSeen(aa),ga=j({hour:'numeric',minute:'numeric'});return (c('React').createElement('div',{className:"_1q4l"},c('React').createElement('div',{className:"_4l-w"},c('React').createElement('h2',{className:"_1q4m"},c('OzHelpers').getName(aa)),c('React').createElement('div',{className:"_29x1"},aa.getIn(['location','timezone'])?c('React').createElement('span',c('Tooltip').propsFor('at the user\'s last known location, updated '+c('relativeTimeString.atlas')(+fa,true),'below'),c('React').createElement(c('OzUpdateDateTime.react'),{locale:'en-US',options:ga,timezoneOffset:aa.getIn(['location','timezone-offset'],0)}),' ('+aa.getIn(['location','timezone'])+')'):c('React').createElement('span',null,'(location unknown)'))),c('React').createElement('div',{className:"_1q4n"},c('React').createElement(n,{className:"_1q4o",thread:aa,shade:ca,removable:true,addable:true}),c('React').createElement('div',{className:"_1q4p"},c('OzHelpers').hasEngage(aa)&&da('No need to engage',ea(function(ha){return c('OzAPI').notready(ba);}))||aa.get('ready')&&c('React').createElement(c('OzButton.react'),{disabled:'true'},c('OzStrings').READY_BUTTON)||c('React').createElement(c('OzButton.react'),{disabled:'true'},c('OzStrings').IS_NOTREADY)))));}}),x=c('OzHelpers').memoize(function(aa){return aa.get('messages').sortBy(function(ba){return ba.get('timestamp');});},function(aa){return aa.get('messages').hashCode();});function y(aa,ba){return aa.map(function(ca){return ca.get('timestamp');}).reduce(function(ca,da){return Math.min(ca,da);},ba);}function z(){return {activeMsgID:null,clientLimit:s};}f.exports=w;},null);
__d('OzIntentDashboardFilters.react',['cx','immutable','InputLabel.react','OzIntentDashboardCategoryFilter.react','OzTriSwitch.react','OzImmutablePureRenderMixin','React','XUISingleSelector.react'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('React').PropTypes,k=c('XUISingleSelector.react').Option,l=c('OzTriSwitch.react').fromBoolean,m=c('OzTriSwitch.react').toBoolean,n=c('React').createClass({displayName:'OzIntentDashboardFilters',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{intentMetas:j.instanceOf(i).isRequired,isEmployee:j.bool,isReversed:j.bool.isRequired,onIsEmployeeChange:j.func.isRequired,onIsReversedChange:j.func.isRequired,onSortByChange:j.func.isRequired,onCategoryChange:j.func.isRequired,sortBy:j.string,sortableFields:j.instanceOf(i).isRequired,category:j.string},render:function(){return (c('React').createElement('ul',{className:"_1bo-"},c('React').createElement('li',null,this._renderCategoryFilter()),c('React').createElement('li',null,this._renderSortByFilter()),c('React').createElement('li',null,this._renderIsReversedFilter()),c('React').createElement('li',null,this._renderIsEmployeeFilter())));},_renderCategoryFilter:function(){return (c('React').createElement(c('OzIntentDashboardCategoryFilter.react'),{intentMetas:this.props.intentMetas,onCategoryChange:this.props.onCategoryChange,category:this.props.category}));},_renderIsEmployeeFilter:function(){return (c('React').createElement(c('OzTriSwitch.react'),{animated:true,label:'Employee?',onClick:function(p){this.props.onIsEmployeeChange(m(p));}.bind(this),value:l(this.props.isEmployee)}));},_renderIsReversedFilter:function(){return (c('React').createElement(c('InputLabel.react'),null,c('React').createElement('input',{checked:this.props.isReversed,onChange:function(p){this.props.onIsReversedChange(p.target.checked);}.bind(this),type:'checkbox'}),c('React').createElement('label',null,'Reversed?')));},_renderSortByFilter:function(){return (c('React').createElement(c('XUISingleSelector.react'),{maxheight:400,onChange:this._handleSortByChange,value:this.props.sortBy||'__none__'},c('React').createElement(k,{value:'__none__'},'Select a field to sort by'),this.props.sortableFields.map(function(p,q){return (c('React').createElement(k,{key:q,value:q},p));}).valueSeq()));},_handleSortByChange:function(p){this.props.onSortByChange(o(p.value));}});function o(p){return p!=='__none__'?p:undefined;}f.exports=n;},null);
__d('ozFormatTime',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=3600,i=60;function j(k){var l=Math.floor(k/h);k%=h;var m=Math.floor(k/i);k%=i;var n=Math.round(k),o='';if(l)o+=l+'h ';if(m)o+=m+'m ';if(n)o+=n+'s';return o;}f.exports=j;},null);
__d('OzIntentDashboardRow.react',['OzHelpers','immutable','React','ReactRouter','formatDate','ozFormatTime'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('immutable').Map,i=c('ReactRouter').Link,j=c('React').PropTypes,k=c('React').createClass({displayName:'OzIntentDashboardRow',propTypes:{intent:j.instanceOf(h).isRequired},render:function(){var n=this.props.intent,o=n.get('user-vcard')||h();return (c('React').createElement('tr',null,c('React').createElement('td',null,n.get('intent-id')),c('React').createElement('td',null,c('React').createElement(i,{to:'/inbox/'+n.get('user-id')},o.get('name',n.get('user-id')))),c('React').createElement('td',null,m(o)),c('React').createElement('td',null,n.get('intent-category')),c('React').createElement('td',null,n.get('create-date')?l(n.get('create-date')):null),c('React').createElement('td',null,n.get('close-date')?l(n.get('close-date')):null),c('React').createElement('td',null,n.get('active-time-seconds')?c('ozFormatTime')(n.get('active-time-seconds')):null),c('React').createElement('td',null,c('React').createElement(i,{to:c('OzHelpers').threadPath({threadid:n.get('user-id'),intentid:n.get('intent-id')})},'Click to go to the thread'))));}});function l(n){return c('formatDate')(n/1000,'M d, Y g:ia');}function m(n){var o=n.get('is-employee');return o==null?'UNKNOWN':o?'YES':'NO';}f.exports=k;},null);
__d('OzIntentDashboard.react',['immutable','MessengerFlexScrollableArea.react','OzIntentDashboardFilters.react','OzIntentDashboardRow.react','OzImmutablePureRenderMixin','React','XUITable.react'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('immutable').Map,i=c('immutable').OrderedMap,j=c('React').PropTypes,k=h({id:'ID',close_date:'Closed At',create_date:'Created At',active_time_seconds:'Time Spent'}),l=c('React').createClass({displayName:'OzIntentDashboard',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{intentMetas:j.instanceOf(h).isRequired,intents:j.instanceOf(i).isRequired,isEmployee:j.bool,isLoaded:j.bool.isRequired,isLoading:j.bool.isRequired,isReversed:j.bool.isRequired,onFetchRequest:j.func.isRequired,onIsEmployeeChange:j.func.isRequired,onIsReversedChange:j.func.isRequired,onSortByChange:j.func.isRequired,onCategoryChange:j.func.isRequired,sortBy:j.string,uuid:j.string},render:function(){return (c('React').createElement(c('MessengerFlexScrollableArea.react'),{onScroll:this._handleScroll,ref:'scrollable'},c('React').createElement(c('OzIntentDashboardFilters.react'),{intentMetas:this.props.intentMetas,isEmployee:this.props.isEmployee,isReversed:this.props.isReversed,onIsEmployeeChange:this.props.onIsEmployeeChange,onIsReversedChange:this.props.onIsReversedChange,onSortByChange:this.props.onSortByChange,onCategoryChange:this.props.onCategoryChange,sortBy:this.props.sortBy,sortableFields:k,uuid:this.props.uuid}),this._renderTable(),this._renderLoadMoreLink()));},_renderTable:function(){return (c('React').createElement(c('XUITable.react'),{outerBorder:false},c('React').createElement('thead',null,c('React').createElement('tr',null,c('React').createElement('th',null,'ID'),c('React').createElement('th',null,'User Name'),c('React').createElement('th',null,'Employee?'),c('React').createElement('th',null,'Intent'),c('React').createElement('th',null,'Created At'),c('React').createElement('th',null,'Closed At'),c('React').createElement('th',null,'Time Spent'),c('React').createElement('th',null,'Events'))),c('React').createElement('tbody',null,this.props.intents.entrySeq().map(function(m){var n=m[0],o=m[1];return (c('React').createElement(c('OzIntentDashboardRow.react'),{intent:o,key:n}));}))));},_renderLoadMoreLink:function(){if(this.props.isLoaded)return null;if(this.props.isLoading)return c('React').createElement('div',null,'Loading...');return (c('React').createElement('div',null,c('React').createElement('a',{href:'#',onClick:function(m){m.preventDefault();this.props.onFetchRequest();}.bind(this)},'Fetch More Intents')));},_handleScroll:function(){if(!this.props.isLoading&&!this.props.isLoaded&&this.refs.scrollable&&this.refs.scrollable.isScrolledToBottom())this.props.onFetchRequest();}});f.exports=l;},null);
__d('OzIntentDashboardContainer.react',['immutable','OzAPI','OzIntentDashboard.react','React'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('immutable').Map,i=c('immutable').OrderedMap,j=c('React').PropTypes,k=30,l={intents:i(),isLoaded:false,offset:0},m=c('React').createClass({displayName:'OzIntentDashboardContainer',propTypes:{witIntents:j.instanceOf(h).isRequired},getInitialState:function(){return babelHelpers['extends']({},l,{isEmployee:undefined,isLoading:false,isReversed:false,sortBy:undefined,category:undefined});},componentDidMount:function(){this._handleFetchRequest();},render:function(){return (c('React').createElement(c('OzIntentDashboard.react'),{intentMetas:this.props.witIntents,intents:this.state.intents,isEmployee:this.state.isEmployee,isLoaded:this.state.isLoaded,isLoading:this.state.isLoading,isReversed:this.state.isReversed,onFetchRequest:this._handleFetchRequest,onIsEmployeeChange:this._handleIsEmployeeChange,onIsReversedChange:this._handleIsReversedChange,onSortByChange:this._handleSortByChange,onCategoryChange:this._handleCategoryChange,sortBy:this.state.sortBy,category:this.state.category}));},_handleFetchRequest:function(){if(this.state.isLoading||this.state.isLoaded)return;this.setState({isLoading:true});c('OzAPI').intentsDashboard({offset:this.state.offset,limit:k,'intent-category':this.state.category,reverse:this.state.isReversed||undefined,'sort-by':this.state.sortBy||undefined,'is-employee':this.state.isEmployee}).done(function(n){var o=n.reduce(function(p,q){return p.set(q.get('intent-id'),q);},this.state.intents);this.setState({intents:o,isLoaded:n.size===0,isLoading:false,offset:this.state.offset+n.size});}.bind(this));},_handleCategoryChange:function(n){this._setFilter({category:n});},_handleIsEmployeeChange:function(n){this._setFilter({isEmployee:n});},_handleIsReversedChange:function(n){this._setFilter({isReversed:n});},_handleSortByChange:function(n){this._setFilter({sortBy:n});},_setFilter:function(n){this.setState(babelHelpers['extends']({},l,n),this._handleFetchRequest);}});f.exports=m;},null);
__d('OzMerchantStatus.react',['cx','immutable','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('React').PropTypes,k=c('React').createClass({displayName:'OzMerchantStatus',propTypes:{merchant:j.instanceOf(i).isRequired},render:function(){var l=this.props.merchant,m=l.get('approved'),n=l.get('blacklisted');return (c('React').createElement('i',{className:"_4wc0"+(m?' '+"_4wbz":'')+(n?' '+"_4wb-":''),title:m&&'approved'||n&&'blacklisted'}));}});f.exports=k;},null);
__d('OzMerchantRow.react',['cx','OzAPI','OzHelpers','immutable','Layout.react','LeftRight.react','MessengerDialogHeader.react','MessengerDialogTitle.react','OzActions','OzButton.react','OzMerchantDialog.react','OzMerchantStatus.react','OzImmutablePureRenderMixin','React','SUIAtlasTheme','SUINotice.react','XUIDialog.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('Layout.react').Column,k=c('Layout.react').FillColumn,l=c('React').PropTypes,m=c('React').createClass({displayName:'DeleteMerchantDialog',propTypes:{merchant:l.object.isRequired,onConfirm:l.func.isRequired},render:function(){return (c('React').createElement(c('XUIDialog.react'),{width:544,shown:true,layerHideOnBlur:false,className:"_4ebx"},c('React').createElement('div',{className:"_4eby _2c9g"},c('React').createElement(c('MessengerDialogHeader.react'),null,c('React').createElement(c('MessengerDialogTitle.react'),null,'Delete merchant "'+this.props.merchant.get('name-dba')+'\"?')),c('React').createElement(c('SUINotice.react'),{theme:c('SUIAtlasTheme'),type:'error'},c('React').createElement('div',{className:"_4wby"},'This action is irreversible. Are you sure?'),c('React').createElement(c('LeftRight.react'),null,c('React').createElement(c('OzButton.react'),{onClick:c('OzActions').hideDialog},'Cancel'),c('React').createElement(c('OzButton.react'),{onClick:this.props.onConfirm},'Yes, permanently delete this merchant'))))));},_handleToggle:function(o){c('OzHelpers').debug('[merchantdialog] toggle',arguments);if(!o)c('OzActions').hideDialog();}}),n=c('React').createClass({displayName:'OzMerchantRow',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{merchant:l.instanceOf(i).isRequired},render:function(){var o=this.props.merchant,p=o.get('website'),q=function(s){return '$'+(s?(s/100).toFixed(2):0);},r=function(s){return s||0;};return (c('React').createElement(c('Layout.react'),{className:"_59hd"},c('React').createElement(j,{className:"mrm _728"},c('React').createElement(c('OzMerchantStatus.react'),{merchant:o})),this._renderMerchantInfo('name-dba'),this._renderMerchantInfo('name-legal'),this._renderMerchantInfo('phone'),this._renderMerchantInfo('cumulative-transaction-amount',q),this._renderMerchantInfo('cumulative-transaction-count',r),c('React').createElement(k,{className:"mrm _4wc2 _4wc3"},c('React').createElement('a',{target:'_blank',href:p},p)),this._renderActions()));},_renderMerchantInfo:function(o,p){var q=this.props.merchant,r=q.get(o);if(p)r=p(r);return (c('React').createElement(j,{className:"mrm _4wc2 _72a"},r));},_renderActions:function(){var o=this._getActions();if(!o)return null;var p=o.map(function(q){var r=q.f,s=q.body;return c('React').createElement(c('OzButton.react'),{key:s,onClick:r},s);});return (c('React').createElement(j,{className:"mrm _6w4"},p));},_getActions:function(){var o=[],p=this.props.merchant;o.push({body:'Edit',f:this._handleMerchantEdit()});o.push({body:'Delete',f:this._handleMerchantDelete()});if(p.get('blacklisted')===true){o.push({body:'Whitelist',f:this._handleMerchantBlacklist(false)});}else o.push({body:'Blacklist',f:this._handleMerchantBlacklist(true)});return o;},_handleMerchantEdit:function(){return function(o,p){var q=this.props.merchant;c('OzActions').showDialog(c('OzMerchantDialog.react'),{initialMerchant:q,title:'Edit merchant '+q.get('name-dba'),onMerchant:function(r){c('OzAPI').editMerchant(r);c('OzActions').hideDialog();}});p();}.bind(this);},_handleMerchantBlacklist:function(o){return function(p,q){var r=this.props.merchant;c('OzAPI').editMerchant(i({id:r.get('id'),blacklisted:o}));q();}.bind(this);},_handleMerchantDelete:function(){return function(o,p){var q=this.props.merchant;c('OzActions').showDialog(m,{merchant:this.props.merchant,onConfirm:function(){c('OzAPI').deleteMerchant(i({id:q.get('id')})).then(c('OzActions').hideDialog);}});p();}.bind(this);}});f.exports=n;},null);
__d('OzMerchants.react',['cx','OzAPI','immutable','Layout.react','MessengerFlexScrollableArea.react','OzActions','OzButton.react','OzMerchantDialog.react','OzMerchantRow.react','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('Layout.react').Column,j=c('Layout.react').FillColumn,k=c('immutable').Map,l=c('React').PropTypes,m=c('React').createClass({displayName:'OzMerchants',propTypes:{merchants:l.instanceOf(k).isRequired},getInitialState:function(){return {slice:25};},render:function(){if(this.props.merchants.isEmpty())return this._renderEmpty();return (c('React').createElement(c('Layout.react'),null,c('React').createElement(j,null,this._renderToolbar(),this._renderMerchants())));},_createMerchant:function(){c('OzActions').showDialog(c('OzMerchantDialog.react'),{onMerchant:function(n){c('OzAPI').createMerchant(n);c('OzActions').hideDialog();}});},_renderToolbar:function(){return (c('React').createElement(c('Layout.react'),{className:"_726"},c('React').createElement(i,{className:"mrm _727 _728"},'Status'),this._renderToolbarCell('Name'),this._renderToolbarCell('Legal Name'),this._renderToolbarCell('Phone'),this._renderToolbarCell('Transaction total'),this._renderToolbarCell('Transaction count'),c('React').createElement(j,{className:"mrm _727"},'Website'),c('React').createElement(i,{className:"mrm _729"},c('React').createElement(c('OzButton.react'),{onClick:this._createMerchant},'New merchant'))));},_renderToolbarCell:function(n){return (c('React').createElement(i,{className:"mrm _727 _72a"},n));},_renderMerchants:function(){var n=this.props.merchants.sortBy(function(o){return o.get('name-dba','').toLowerCase();}).toSeq().take(this.state.slice).map(function(o){return (c('React').createElement(c('OzMerchantRow.react'),{key:o.get('name-dba'),merchant:o}));}).valueSeq();return (c('React').createElement(c('MessengerFlexScrollableArea.react'),{className:"_72b",onScroll:this._handleScroll,ref:'scrollable'},n));},_renderEmpty:function(){return c('React').createElement('div',null,'No merchants to show');},_handleScroll:function(){if(this.refs.scrollable.isScrolledToBottom())this.setState(function(n){return {slice:n.slice+25};});}});f.exports=m;},null);
__d('OzStatsDashboardFilters.react',['cx','Promise','immutable','OzSearchSource','OzSwitch.react','OzImmutablePureRenderMixin','React','SearchableDropdownInput.contrib','SearchableEntry'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('React').PropTypes,k=c('React').createClass({displayName:'OzStatsDashboardFilters',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{onTeamViewChange:j.func.isRequired,onTrainerIDChange:j.func.isRequired,reps:j.instanceOf(i).isRequired,teamView:j.bool.isRequired,trainerID:j.string.isRequired},getInitialState:function(){return {searchSource:l(this.props.reps)};},componentWillReceiveProps:function(n){if(!c('immutable').is(n.reps,this.props.reps))this.setState({searchSource:l(n.reps)});},render:function(){var n=this.props,o=n.onTeamViewChange,p=n.onTrainerIDChange,q=n.reps,r=n.teamView,s=n.trainerID;return (c('React').createElement('div',{className:"_5p66"},c('React').createElement(c('OzSwitch.react'),{className:"_4vlt",isAnimated:true,isOn:r,label:'Team View',onToggle:o}),!r?c('React').createElement('div',{className:"_4vlu"},c('React').createElement(c('SearchableDropdownInput.contrib'),{value:m(q.get(s)),onSelect:function(t){return p(t.getUniqueID());},placeholder:'Select a trainer...',emptySearchResultsText:'No trainers found',searchSource:this.state.searchSource})):null));}});function l(n){return new (c('OzSearchSource'))(function(o){var p=(o.query||'').toLowerCase();return c('Promise').resolve(n.valueSeq().map(m).sortBy(function(q){return q.getTitle();}).filter(function(r){return (r.getTitle()||'').toLowerCase().indexOf(p)>-1;}).toJS());});}function m(n){return n&&new (c('SearchableEntry'))({title:n.get('name'),uniqueID:n.get('fbid')});}f.exports=k;},null);
__d('OzStatsDashboard.react',['cx','CandelaGroupScaleBuilder','immutable','BUIInsightsLegendChart.react','BUIInsightsLineAreaChart.react','MessengerFlexScrollableArea.react','OzButton.react','OzConfig','OzStatsDashboardFilters.react','OzImmutablePureRenderMixin','React','XUISingleSelector.react','formatDate','OzHelpers','ozFormatTime','Reflux','Timezone','XUITable.react'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('XUISingleSelector.react').Option,j=c('CandelaGroupScaleBuilder').group,k=c('immutable').List,l=c('immutable').Map,m=c('immutable').OrderedSet,n=c('immutable').Range,o=c('React').PropTypes,p=604800,q=c('React').createClass({displayName:'OzStatsDashboard',mixins:[c('OzImmutablePureRenderMixin'),c('Reflux').connect(c('OzConfig').ConfigStore,'config')],propTypes:{displayTime:o.number.isRequired,finalWeek:o.number.isRequired,isLoading:o.bool.isRequired,onDateChange:o.func.isRequired,onThreadSelect:o.func.isRequired,onTeamViewChange:o.func.isRequired,onTrainerIDChange:o.func.isRequired,reps:o.instanceOf(l).isRequired,stats:o.oneOfType([o.instanceOf(k),o.instanceOf(l)]).isRequired,teamView:o.bool.isRequired,trainerID:o.string.isRequired},render:function(){var ca=this.props,da=ca.displayTime,ea=ca.finalWeek,fa=ca.onDateChange,ga=ca.onThreadSelect,ha=ca.onTeamViewChange,ia=ca.onTrainerIDChange,ja=ca.reps,ka=ca.stats,la=ca.teamView,ma=ca.trainerID;return (c('React').createElement('div',{className:"_16u3"},this.state.config.getIn(['GK','supervisor'])?c('React').createElement(c('OzStatsDashboardFilters.react'),{onTeamViewChange:ha,onTrainerIDChange:ia,reps:ja,teamView:la,trainerID:ma}):null,c('React').createElement(r,{currentWeek:da,finalWeek:ea,onDateSelect:fa}),c('React').createElement('div',{className:"_16u4"},la?c('React').createElement(s,{stats:ka,displayTime:da}):c('React').createElement(t,{displayTime:da,onThreadSelect:ga,stats:ka,reps:ja,trainerID:ma}))));}}),r=c('OzHelpers').pure(function(ca){var da=ca.currentWeek,ea=ca.finalWeek,fa=ca.onDateSelect,ga=13,ha=n(ea,ea-ga*p,p).map(function(ia){var ja=c('formatDate')(ia,'M j');return (c('React').createElement(i,{key:ja,value:ia},ja));});return (c('React').createElement('div',{className:"_16-n"},'Stats for week starting ',c('React').createElement(c('XUISingleSelector.react'),{name:'OzStatsSelector',maxheight:240,onChange:fa,value:da},ha)));}),s=c('OzHelpers').pure(function(ca){var da=ca.displayTime,ea=ca.stats;return (c('React').createElement('div',null,c('React').createElement(u,{chartType:'CR',teamStats:ea,weekStart:da}),c('React').createElement(u,{chartType:'ER',teamStats:ea,weekStart:da})));}),t=c('OzHelpers').pure(function(ca){var da=ca.displayTime,ea=ca.onThreadSelect,fa=ca.stats,ga=ca.reps,ha=ca.trainerID;return (c('React').createElement('div',null,!fa.isEmpty()?c('React').createElement('div',null,c('React').createElement(z,{chartType:'CR',stats:fa,weekStart:da}),c('React').createElement(z,{chartType:'ER',stats:fa,weekStart:da})):c('React').createElement('div',null,'Stats loading...'),c('React').createElement('div',{style:{padding:'10px'}},fa.map(function(ia,ja){return (c('React').createElement(aa,{key:ja,onThreadSelect:ea,section:ia,reps:ga,trainerID:ha}));}))));}),u=c('OzHelpers').pure(function(ca){var da=ca.chartType,ea=ca.displayTime,fa=ca.teamStats,ga=da.toLowerCase(),ha=fa.map(function(ia,ja){return l({time:parseInt(ja,10),team1:ia.getIn(['1',ga])/ia.getIn(['1','n']),team2:ia.getIn(['2',ga])/ia.getIn(['2','n'])});}).toList().sortBy(function(ia){return ia.get('time');});return (fa.size?c('React').createElement(x,{data:ha,graphSchema:v,legendItems:w,yAxisTitle:da+' (mins)'}):null);}),v={time:{timezoneID:c('Timezone').PST8PDT,type:'time'},team1:{renderAs:'line',type:'number'},team2:{renderAs:'line',type:'number'}},w=m([{key:'team1',label:'Team 1'},{key:'team2',label:'Team 2'}]),x=c('OzHelpers').pure(function(ca){var da=ca.data,ea=ca.graphSchema,fa=ca.legendItems,ga=ca.yAxisTitle,ha=[j.apply(null,fa.map(function(ia){return ia.key;}).toJS())];return (c('React').createElement('div',{className:"_16-o"},c('React').createElement('div',{className:"_3aw3"},ga),c('React').createElement(c('BUIInsightsLegendChart.react'),{items:fa,layoutInterval:200,minItemWidthPercentage:.67},c('React').createElement(c('BUIInsightsLineAreaChart.react'),{axisMarkFormatterFactory:y,data:da.toJS(),height:300,width:800,schema:ea,plotX:j('time').from(da.first().get('time')).to(da.last().get('time')+1000),plotY:ha}))));}),y=function(ca,da){if(da==='vertical'){return function(ea){var fa=Math.floor(ea/60)+':';if(Math.floor(ea%60)<10)fa+='0';return fa+Math.floor(ea%60);};}else return function(ea){return c('formatDate')(ea.instant,'M j');};},z=c('OzHelpers').pure(function(ca){var da=ca.chartType,ea=ca.stats,fa=ca.weekStart,ga=ea.sortBy(function(la){return la.get('start-time');}).map(function(la){var ma=la.get('start-time'),na=la.getIn(['summary','n']),oa=na?la.getIn(['summary','er'])/na:null,pa=na?la.getIn(['summary','cr'])/na:null,qa=la.getIn(['all-agents','er'])/la.getIn(['all-agents','n']),ra=la.getIn(['all-agents','cr'])/la.getIn(['all-agents','n']);return l({er:oa,cr:pa,time:ma,avg_er:qa,avg_cr:ra});}),ha={time:{timezoneID:c('Timezone').PST8PDT,type:'time'}},ia=da.toLowerCase(),ja='avg_'+ia;ha[ia]={renderAs:'area',type:'number'};ha[ja]={renderAs:'line',type:'number'};var ka=m([{key:ia,label:da==='ER'?'Execution Responsiveness':'Conversational Responsiveness'},{key:ja,label:da==='ER'?'Avg. ER':'Avg. CR'}]);return (c('React').createElement(x,{data:ga,graphSchema:ha,legendItems:ka,yAxisTitle:da+' (mins)'}));}),aa=c('OzHelpers').pure(function(ca){var da=ca.onThreadSelect,ea=ca.section,fa=ca.reps,ga=ca.trainerID,ha=ea.get('summary'),ia=c('formatDate')(ea.get('start-time'),'M j');if(!ha.get('n'))return c('React').createElement('div',null);return (c('React').createElement('div',{className:"_16-v"},c('React').createElement('div',{className:"_16-w"},'Stats for ',c('React').createElement('strong',null,ia)),c('React').createElement('div',{className:"_16-y"},'Average ER: ',c('ozFormatTime')(ha.get('er')/ha.get('n')),', Average CR: ',c('ozFormatTime')(ha.get('cr')/ha.get('n'))),c('React').createElement(ba,{threads:ea.get('threads',k()),onThreadSelect:da,reps:fa,trainerID:ga})));}),ba=c('OzHelpers').pure(function(ca){var da=ca.threads,ea=ca.onThreadSelect,fa=ca.reps,ga=ca.trainerID;return (c('React').createElement(c('XUITable.react'),{outerBorder:true},c('React').createElement('thead',null,c('React').createElement('tr',null,c('React').createElement('th',{className:"_1ruu"},'User ID'),c('React').createElement('th',{className:"_1ruw"},'Intent'),c('React').createElement('th',{className:"_1rux"},'ER'),c('React').createElement('th',{className:"_1ruz"},'CR'),c('React').createElement('th',{className:"_1ru-"},'Start Time'),c('React').createElement('th',{className:"_1ru_"},'End Time'),c('React').createElement('th',{className:"_1rv0"},'Survey'),c('React').createElement('th',{className:"_1rv1"},'See Thread'))),c('React').createElement('tbody',null,da.map(function(ha,ia){return (c('React').createElement('tr',{key:ia},c('React').createElement('td',null,ha.get('user-id')),c('React').createElement('td',null,ha.get('intent-name')),c('React').createElement('td',null,c('ozFormatTime')(ha.get('er'))),c('React').createElement('td',null,c('ozFormatTime')(ha.get('cr'))),c('React').createElement('td',null,c('OzHelpers').toLocaleTime(ha.get('start-time')*1000)),c('React').createElement('td',null,c('OzHelpers').toLocaleTime(ha.get('end-time')*1000)),c('React').createElement('td',null,ha.get('survey')),c('React').createElement('td',null,c('React').createElement(c('OzButton.react'),{onClick:function(ja){return ea(c('OzHelpers').threadID(ha));}},'See Thread'))));}))));});f.exports=q;},null);
__d('OzStatsDashboardContainer.react',['immutable','OzAPI','OzStatsDashboard.react','React'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('immutable').List,i=c('immutable').Map,j=c('React').PropTypes,k=7,l=c('React').createClass({displayName:'OzStatsDashboardContainer',contextTypes:{uid:j.string.isRequired,router:j.object.isRequired},propTypes:{reps:j.instanceOf(i).isRequired},getInitialState:function(){var m=new Date();m.setDate(m.getDate()-m.getDay());m.setHours(0);m.setMinutes(0);m.setSeconds(0);m.setMilliseconds(0);return {displayTime:m.getTime()/1000,finalWeek:m.getTime()/1000,isLoading:false,stats:h(),summary:h(),teamView:false,trainerID:this.context.uid};},componentDidMount:function(){this._handleFetchRequest();},render:function(){return (c('React').createElement(c('OzStatsDashboard.react'),{displayTime:this.state.displayTime,finalWeek:this.state.finalWeek,isLoading:this.state.isLoading,onDateChange:this._handleDateChange,onTeamViewChange:this._handleTeamViewChange,onThreadSelect:this._handleThreadSelect,onTrainerIDChange:this._handleTrainerIDChange,reps:this.props.reps,stats:this.state.stats,teamView:this.state.teamView,trainerID:this.state.trainerID}));},_handleFetchRequest:function(){if(this.state.isLoading)return;this.setState({isLoading:true});if(this.state.teamView){c('OzAPI').teamStatsDashboard({start:this.state.displayTime,days:k}).done(function(m){this.setState({isLoading:false,stats:m});}.bind(this));}else c('OzAPI').statsDashboard({start:this.state.displayTime,days:k,'trainer-id':this.state.trainerID}).done(function(m){this.setState({isLoading:false,stats:m});}.bind(this));},_handleTeamViewChange:function(m){this.setState({stats:h(),teamView:m},this._handleFetchRequest);},_handleThreadSelect:function(m){this.context.router.push('inbox/'+m);},_handleTrainerIDChange:function(m){this.setState({stats:h(),trainerID:m},this._handleFetchRequest);},_handleDateChange:function(m){this.setState({displayTime:m.value,stats:h()},this._handleFetchRequest);}});f.exports=l;},null);
__d('OzIntentParams.react',['cx','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').createClass({displayName:'OzIntentParams',render:function(){return (c('React').createElement('div',{className:"_3-ue"},this.props.children));}});f.exports=i;},null);
__d('OzIntentParamsAbstractField.react',['cx','React','onlyChild'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'OzIntentParamsAbstractField',propTypes:{hasValue:i.bool,label:i.string},render:function(){return (c('React').createElement('div',{className:"_5nij"+(!this.props.hasValue?' '+"_2ez0":'')},this.props.label?c('React').createElement('label',{className:"_2230 ellipsis"},this.props.label):null,c('React').createElement('div',{className:"_2ulp"},c('onlyChild')(this.props.children))));}});f.exports=j;},null);
__d('OzIntentParamsTextField.react',['invariant','AbstractTextArea.react','DOMQuery','OzIntentParamsAbstractField.react','OzImmutablePureRenderMixin','React','ReactDOM','TextAreaControl'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'OzIntentParamsTextField',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{label:i.string,onAsk:i.func,onChange:i.func,question:i.string,value:i.string.isRequired},_control:null,componentDidMount:function(){var k=c('DOMQuery').find(c('ReactDOM').findDOMNode(this),'textarea');this._control=new (c('TextAreaControl'))(k);this._control.setAutogrow(true);this._control.onupdate();},componentDidUpdate:function(k,l){if(k.value!==this.props.value)this._control.onupdate();},render:function(){return (c('React').createElement(c('OzIntentParamsAbstractField.react'),{hasValue:!!this.props.value,onAsk:this.props.onAsk,question:this.props.question},c('React').createElement(c('AbstractTextArea.react'),{onChange:this._handleChange,placeholder:this.props.label,value:this.props.value})));},_handleChange:function(k){var l=k.target;!(l instanceof HTMLTextAreaElement)?h(0):undefined;this.props.onChange&&this.props.onChange(l.value);}});f.exports=j;},null);
__d('OzRequirementTokenizer.react',['cx','Promise','OzHelpers','immutable','OzSearchSource','OzImmutablePureRenderMixin','React','SearchableEntry','XUITokenizer.react','XUITokenizerToken.react','TypeaheadViewItem','TypeaheadViewPropTypes'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('immutable').List,k=c('React').PropTypes,l=c('React').createClass({displayName:'OzRequirementTokenizer',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{allRequirements:k.instanceOf(i).isRequired,onCreateRequirement:k.func.isRequired,onDeleteRequirement:k.func.isRequired,onQueryStringChange:k.func.isRequired,queryString:k.string.isRequired,selectedRequirements:k.instanceOf(j)},componentWillMount:function(){var s=this.props,t=s.allRequirements,u=s.witIntentUUID;this._searchSource=new (c('OzSearchSource'))(function(v){var w=v.query;return c('Promise').resolve(q(w,t,u));});},render:function(){var s=this.props.selectedRequirements||j();return (c('React').createElement('div',{className:"_59rt"},c('React').createElement(c('XUITokenizer.react'),{className:"_4s6a",placeholder:'Add a requirement...',entries:s.map(r).toJS(),presenter:p,queryString:this.props.queryString,searchSource:this._searchSource,onRemoveEntryAttempt:this.props.onDeleteRequirement,onAddEntryAttempt:this.props.onCreateRequirement,onQueryStringChange:this.props.onQueryStringChange})));}}),m=c('OzHelpers').pure(function(s){return (c('React').createElement(c('XUITokenizerToken.react'),babelHelpers['extends']({},s,{className:"_59ru"})));}),n=c('React').createClass({displayName:'OzTypeaheadViewItem',mixins:[c('TypeaheadViewItem').Mixin],propTypes:c('TypeaheadViewItem').propTypes,render:function(){var s=this.props.highlighted;return (c('React').createElement('li',{className:"_59rv"+(s?' '+"_59rw":''),'aria-selected':this.props.highlighted,onMouseDown:this._onSelect,onMouseEnter:this._onHighlight,role:this.props.role},this.props.entry.getTitle()));}}),o=c('React').createClass({displayName:'OzTypeaheadView',mixins:[c('OzImmutablePureRenderMixin')],propTypes:c('TypeaheadViewPropTypes'),_renderItem:function(s){var t=s===this.props.highlightedEntry;return (c('React').createElement(n,{key:s.getUniqueID(),entry:s,highlighted:t,onSelect:this.props.onSelect,onHighlight:this.props.onHighlight,onRenderHighlight:this.props.onRenderHighlight}));},render:function(){var s="_59rx"+(!this.props.entries.length?' '+"_599s":'');return (c('React').createElement('ul',{className:s,id:this.props.ariaOwneeID,role:this.props.role},this.props.entries.map(this._renderItem)));}}),p={ViewRenderer:o,TokenRenderer:m,useLayer:false};function q(){var s=arguments.length<=0||arguments[0]===undefined?'':arguments[0],t=arguments[1],u=arguments[2];if(!s)return [];var v=function(x){var y=x.get('wit-intent-uuids').has(u)?100000:0;return -(y+x.get('used-count',0));},w=t.filter(function(x){return x.get('name').indexOf(s)>=0;}).sortBy(v).map(r).take(10).toList();return s&&!t.has(s)?w.push(r(i({name:s,id:s}))).toJS():w.toJS();}function r(s){return new (c('SearchableEntry'))({title:s.get('name'),uniqueID:s.get('id')});}f.exports=l;},null);
__d('OzSidebarItemHeader.react',['cx','OzHelpers','Keys','OzCheckboxInput.react','OzDate.react','OzTimestampScrolling.react','OzImmutablePureRenderMixin','React','Tooltip','XUIAbstractGlyphButton.react','FBButtonMenuCombo.react','joinClasses'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('FBButtonMenuCombo.react').Item,j=c('React').PropTypes,k=c('React').createClass({displayName:'OzSidebarItemHeader',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{alias:j.string,closedAt:j.number,createdAt:j.number,creator:j.string,isExpanded:j.bool,isClosed:j.bool.isRequired,isBlocked:j.bool,onChangeAlias:j.func,onClose:j.func,onIsExpandedToggle:j.func,onToggle:j.func,subtitle:j.node,title:j.string.isRequired,closeState:j.string,skipScrollToTimestamp:j.bool},getInitialState:function(){return {isEditing:false};},render:function(){var n=this.props,o=n.alias,p=n.className,q=n.closedAt,r=n.createdAt,s=n.creator,t=n.isClosed,u=n.isExpanded,v=n.isBlocked,w=n.onClose,x=n.onIsExpandedToggle,y=n.onToggle,z=n.subtitle,aa=n.title,ba=n.closeState,ca=n.skipScrollToTimestamp,da=t?q:r,ea=s?'Created by '+s:null;return (c('React').createElement('div',{className:c('joinClasses')(p,"_31gu"+(u?' '+"_31gx":'')+(t?' '+"_31gy":'')+(v?' '+"_27qc":''))},y?c('React').createElement(c('OzCheckboxInput.react'),{checked:t,className:"_31gz",onChange:y,tooltip:ba}):null,c('React').createElement('div',{className:"_31g-"},c('React').createElement('div',null,c('React').createElement('span',null,da?ca?c('React').createElement(c('OzDate.react'),{className:"_56sd",timestamp:da}):c('React').createElement(c('OzTimestampScrolling.react'),{timestamp:da},c('React').createElement(c('OzDate.react'),{className:"_56sd",timestamp:da})):null),c('React').createElement(m,{alias:o,isEditing:this.state.isEditing,name:aa,onChange:this._handleChangeAlias,onStartEditing:this._handleStartEditing,onCancelEditing:this._handleCancelEditing,tooltip:ea})),c('React').createElement('span',{className:"_31h0"},z)),c('React').createElement('div',{className:"_3_41"},this.props.children,x?c('React').createElement(c('XUIAbstractGlyphButton.react'),{className:"_31h1",onClick:x}):null,t||!w?null:c('React').createElement('div',{className:"_31h2"},c('React').createElement(c('FBButtonMenuCombo.react'),{size:'small',numberOfButtons:0,onClick:w},c('React').createElement(i,{value:'unfulfilled',label:'Was not able to fulfill the user request'}),c('React').createElement(i,{value:'alternate',label:'Fulfilled the user request via alternate options'}),c('React').createElement(i,{value:'deleted',label:'Delete'}))))));},_handleStartEditing:function(){this.props.onChangeAlias&&this.setState({isEditing:true});},_handleCancelEditing:function(){this.setState({isEditing:false});},_handleChangeAlias:function(n){var o=this.props.onChangeAlias;if(n.which===c('Keys').RETURN){o&&o(n.target.value);this.setState({isEditing:false});}}}),l=function(n){if(n.setSelectionRange){var o=n.value.length;n.setSelectionRange(o,o);}},m=c('OzHelpers').pure(function(n){var o=n.name,p=n.isEditing,q=n.alias,r=n.tooltip,s=n.onChange,t=n.onStartEditing,u=n.onCancelEditing;return (p?c('React').createElement('textarea',{className:"_31g_"+(' '+"_1p0b"),onKeyDown:s,placeholder:o,defaultValue:q,onBlur:u,ref:function(v){if(v){v.focus();l(v);}}}):c('React').createElement('span',babelHelpers['extends']({className:"_31g_",onClick:t},c('Tooltip').propsFor(r)),q||o));});f.exports=k;},null);
__d('OzGenericIntent.react',['cx','invariant','OzHelpers','immutable','OzConfig','OzFormPreview.react','OzIntentParams.react','OzRequirementTokenizer.react','OzSidebarItemHeader.react','OzImmutablePureRenderMixin','React','Reflux','SearchableEntry','OzIntentParamsTextField.react','Tooltip'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('OzFormPreview.react').Row,k=c('immutable').Map,l=c('React').PropTypes,m=c('React').createClass({displayName:'OzGenericIntent',mixins:[c('OzImmutablePureRenderMixin'),c('Reflux').connect(c('OzConfig').ConfigStore,'config')],propTypes:{intent:l.instanceOf(k).isRequired,notes:l.string.isRequired,onChangeAlias:l.func.isRequired,onClose:l.func.isRequired,onNotesChange:l.func.isRequired,onOpen:l.func.isRequired,onIsBlockedToggle:l.func.isRequired,requirements:l.instanceOf(k).isRequired,onCreateRequirement:l.func,onDeleteRequirement:l.func,repNames:l.instanceOf(k).isRequired,userEmail:l.string},getInitialState:function(){return {requirementQuery:''};},render:function(){var o=this.props,p=o.intent,q=o.repNames,r=p.get('creator-fbid'),s=q.get(r,r),t=p.get('blocked'),u=c('OzHelpers').intentName(p)+(t?' (Waiting)':'');return (c('React').createElement('div',null,c('React').createElement(c('OzSidebarItemHeader.react'),{alias:p.get('alias'),className:"_a2q",isClosed:c('OzHelpers').isClosedIntent(p),closeState:p.get('state'),isBlocked:t,onChangeAlias:this._handleChangeAlias,onClose:this._handleClose,onToggle:this._handleToggle,title:u,createdAt:p.get('created-at'),closedAt:p.get('closed-at'),creator:s}),this._renderBody()));},_renderBody:function(){var o=this.props.intent;return (c('React').createElement('div',{ref:'body'},c('React').createElement(n,{blocked:o.get('blocked'),onIsBlockedToggle:this._handleIsBlockedToggle}),c('React').createElement(c('OzIntentParams.react'),null,this.props.children),c('React').createElement('div',{className:"_1x-e"},c('React').createElement(c('OzRequirementTokenizer.react'),{allRequirements:this.props.requirements,onCreateRequirement:this._handleCreateRequirement,onDeleteRequirement:this._handleDeleteRequirement,onQueryStringChange:this._handleQueryStringChange,queryString:this.state.requirementQuery,selectedRequirements:o.get('requirements')})),c('React').createElement(c('OzIntentParams.react'),null,c('React').createElement('div',{className:"_19ny"},c('React').createElement(c('OzIntentParamsTextField.react'),{label:'Add notes about this task...',onChange:this.props.onNotesChange,value:this.props.notes})))));},_handleChangeAlias:function(o){var p=this.props,q=p.intent,r=p.onChangeAlias;r&&r(q,o);},_handleClose:function(o){var p=this.props,q=p.intent,r=p.onClose;r&&r(q.get('id'),o);},_handleIsBlockedToggle:function(){var o=this.props,p=o.intent,q=o.onIsBlockedToggle;q(p);},_handleCreateRequirement:function(o){var p=this.props,q=p.intent,r=p.onCreateRequirement;if(r)r(q.get('id'),o.getTitle());this.setState({requirementQuery:''});},_handleDeleteRequirement:function(o){var p=this.props,q=p.intent,r=p.onDeleteRequirement;if(r)r(q.get('id'),o.getUniqueID());},_handleQueryStringChange:function(o){var p=o.target;!(p instanceof HTMLInputElement)?i(0):undefined;this.setState({requirementQuery:p.value});},_handleToggle:function(){var o=this.props,p=o.intent,q=o.onOpen,r=o.onClose,s=c('OzHelpers').isClosedIntent(p);this.setState({isExpanded:s},function(t){return ((s?q:r)(p.get('id')));});}}),n=c('OzHelpers').pure(function(o){var p=o.blocked,q=o.onIsBlockedToggle,r='Check when blocked by an external factor (not load)',s=c('React').createElement('span',c('Tooltip').propsFor(r),'Waiting?');return (c('React').createElement('div',{className:"_5xr7"},c('React').createElement(j,{label:s},c('React').createElement('input',{type:'checkbox',checked:p,onChange:q}))));});f.exports=m;},null);
__d('OzIntentParamsDateTimeField.react',['OzIntentParamsAbstractField.react','OzImmutablePureRenderMixin','React','XUIDateTimePicker.react'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'OzIntentParamsDateTimeField',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{label:h.string,onChange:h.func,value:h.instanceOf(Date)},render:function(){return (c('React').createElement(c('OzIntentParamsAbstractField.react'),{hasValue:!!this.props.value,label:this.props.label},c('React').createElement(c('XUIDateTimePicker.react'),{date:this.props.value,dateIcon:null,datePlaceholder:this.props.label,onChange:this.props.onChange,shouldSetDefaultDate:false})));}});f.exports=i;},null);
__d('OzIntentParamsEnumField.react',['immutable','OzIntentParamsAbstractField.react','OzImmutablePureRenderMixin','React','XUISingleSelector.react'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('XUISingleSelector.react').Option,i=c('React').PropTypes,j=c('immutable').List,k=c('React').createClass({displayName:'OzIntentParamsEnumField',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{label:i.string,onChange:i.func,onSave:i.func,placeholder:i.string,values:i.arrayOf(i.string).isRequired,value:i.string},getInitialState:function(){return {value:this.props.value||''};},render:function(){var l=j(this.props.values).map(function(m){return (c('React').createElement(h,{key:m,value:m},m));}).unshift(c('React').createElement(h,{key:this.props.placeholder,value:''},this.props.placeholder));return (c('React').createElement(c('OzIntentParamsAbstractField.react'),{hasValue:!!this.state.value,label:this.props.label},c('React').createElement(c('XUISingleSelector.react'),{maxHeight:240,onChange:this._handleChange,value:this.state.value},l)));},_handleChange:function(l){this.props.onChange&&this.props.onChange(l.value);this.setState({value:l.value},this._save);},_save:function(){if(this.props.onSave)this.props.onSave(this.state.value);}});f.exports=k;},null);
__d('OzIntentParamsNumberField.react',['cx','FBNumberInput.react','OzIntentParamsAbstractField.react','OzImmutablePureRenderMixin','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'OzIntentParamsNumberField',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{label:i.string,onChange:i.func,placeholder:i.string,value:i.number},render:function(){return (c('React').createElement(c('OzIntentParamsAbstractField.react'),{hasValue:this.props.value!=null,label:this.props.label},c('React').createElement(c('FBNumberInput.react'),{className:"_3dag",onValueChange:this.props.onChange,placeholder:this.props.placeholder,value:this.props.value})));}});f.exports=j;},null);
__d('OzIntentParamsPriceRangeField.react',['cx','OzIntentParamsAbstractField.react','OzImmutablePureRenderMixin','React'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=[1,2,3,4],k=c('React').createClass({displayName:'OzIntentParamsPriceRangeField',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{label:i.string,onChange:i.func,value:i.oneOf(j)},render:function(){var l=this.props.value;return (c('React').createElement(c('OzIntentParamsAbstractField.react'),{hasValue:!!l,label:this.props.label},c('React').createElement('span',{className:"_8l3"},j.map(function(m){return (c('React').createElement('span',{className:"_8l4"+(l&&m<=l?' '+"_8l6":''),key:m,onClick:function(n){return this._handleDollarClick(n,m);}.bind(this)},'$'));}.bind(this)))));},_handleDollarClick:function(l,m){l.preventDefault();var n=this.props.value==m?null:m;this.props.onChange&&this.props.onChange(n);}});f.exports=k;},null);
__d('OzIntentParamsStringField.react',['invariant','AbstractTextInput.react','OzIntentParamsAbstractField.react','OzImmutablePureRenderMixin','React','debounce'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'OzIntentParamsStringField',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{label:i.string,onChange:i.func,onSave:i.func,placeholder:i.string,value:i.string},getInitialState:function(){return {value:this.props.value||''};},componentWillMount:function(){this._save=c('debounce')(this._save,750,this,true);},render:function(){return (c('React').createElement(c('OzIntentParamsAbstractField.react'),{hasValue:!!this.state.value,label:this.props.label},c('React').createElement(c('AbstractTextInput.react'),{onChange:this._handleChange,placeholder:this.props.placeholder,type:'text',value:this.state.value})));},_handleChange:function(k){var l=k.target;!(l instanceof HTMLInputElement)?h(0):undefined;this.props.onChange&&this.props.onChange(l.value);this.setState({value:l.value},this._save);},_save:function(){if(this.props.onSave)this.props.onSave(this.state.value);}});f.exports=j;},null);
__d('OzIntentFactoryHelpers',['immutable','React','OzIntentParamsStringField.react','OzIntentParamsNumberField.react','OzIntentParamsPriceRangeField.react','OzIntentParamsEnumField.react','OzIntentParamsDateTimeField.react'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('immutable').Map,i={makeStateUpdater:function(l){return function(m){var n;this._setStateAndSave((n={},n[l]=m,n));};},makeStateExtractor:function(l){return function(m){var n=m.get('params')||h(),o={};for(var p=l,q=Array.isArray(p),r=0,p=q?p:p[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var s;if(q){if(r>=p.length)break;s=p[r++];}else{r=p.next();if(r.done)break;s=r.value;}var t=s,u=t.name,v=t.type,w=j(n,u);switch(v){case 'string':case 'enum':o[u]=''+(w||'');break;case 'number':case 'pricerange':o[u]=+w||null;break;case 'datetime':o[u]=w&&new Date(w);}}return babelHelpers['extends']({},o,{notes:m.get('notes')||''});};},makeParamsUpdater:function(l){return function(m,n){return (m||h()).withMutations(function(o){for(var p=l,q=Array.isArray(p),r=0,p=q?p:p[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var s;if(q){if(r>=p.length)break;s=p[r++];}else{r=p.next();if(r.done)break;s=r.value;}var t=s,u=t.name,v=t.type;switch(v){case 'datetime':var w=n[u],x=w?{value:w.toISOString(),grain:'minute'}:undefined;k(o,u,x);break;default:k(o,u,{value:n[u]});break;}}});};},makeFieldRenderer:function(l){return function(){return l.map(function(m){var n=m.label,o=m.name,p=m.placeholder,q=m.type,r=m.values,s=i.getFieldComponent(q);return (c('React').createElement(s,{key:o,label:n,onChange:this._changeHandlers.get(o),placeholder:p||n,value:this.state[o],values:r}));}.bind(this));};},getFieldComponent:function(l){switch(l){case 'string':return c('OzIntentParamsStringField.react');case 'number':return c('OzIntentParamsNumberField.react');case 'pricerange':return c('OzIntentParamsPriceRangeField.react');case 'enum':return c('OzIntentParamsEnumField.react');case 'datetime':return c('OzIntentParamsDateTimeField.react');default:throw new Error('OzIntentFactoryHelpers: Unknown field type '+l+'.');}}};function j(l,m){var n=l.get(m);if(n&&!n.isEmpty())return n.first().get('value');return null;}function k(l,m,n){l.set(m,c('immutable').fromJS([n]));}f.exports=i;},null);
__d('OzIntentSchemas',[],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h={get:function(z){switch(z){case 'restaurant':return j;case 'reminder':return k;case 'nonmedical_appointment':return l;case 'local_search':return m;case 'good_purchase':return n;case 'customer_service_general':return o;case 'weather_forecast':return p;case 'hotel_and_accommodation':return q;case 'activities_things_to_do':return r;case 'ticket_purchase':return s;case 'food_purchase':return t;case 'utility':return u;case 'vehicle_service':return v;case 'traffic':return w;case 'navigation':return x;case 'flight_request':return y;default:return i;}}},i={name:'Generic',fields:[]},j={name:'Restaurant',fields:[{type:'enum',name:'request_type',label:'Action',placeholder:'Pick one...',values:['reservation','availability','cancel','change','info','location','option','price','receipt','time','schedule']},{type:'string',name:'restaurant_name',label:'Name',placeholder:'Restaurant Name'},{type:'string',name:'restaurant_cuisine',label:'Cuisine'},{type:'string',name:'location',label:'Location'},{type:'number',name:'people_number',label:'Guests',placeholder:'Number of guests'},{type:'datetime',name:'datetime',label:'Date/Time'},{type:'pricerange',name:'amount_of_money',label:'Price Range'}]},k={name:'reminder',fields:[{type:'datetime',name:'datetime',label:'Reminder Time'},{type:'string',name:'reminder',label:'About'}]},l={name:'NonMedicalAppt',fields:[{type:'enum',name:'appt_action',label:'Action',placeholder:'Pick one...',values:['availability','cancel','move','confirm','book']},{type:'string',name:'appt_type',label:'Appt Type',placeholder:'Type of appointment'},{type:'string',name:'location',label:'Location',placeholder:'Location of appointment'},{type:'datetime',name:'datetime',label:'Datetime',placeholder:'Date and time of the appointment'},{type:'string',name:'local_search_query',label:'Name',placeholder:'Name of the place'}]},m={name:'LocalSearch',fields:[{type:'string',name:'local_query',label:'Query',placeholder:'Search query like yoga class...'},{type:'string',name:'location',label:'Location',placeholder:''},{type:'string',name:'local_name',label:'Name',placeholder:'Name of the place or business...'},{type:'datetime',name:'datetime',label:'Datetime',placeholder:''}]},n={name:'GoodPurchase',fields:[{type:'string',name:'good',label:'Good',placeholder:''},{type:'string',name:'provider',label:'Merchant',placeholder:''},{type:'string',name:'amount_of_money',label:'Price'},{type:'number',name:'good_number',label:'Items #',placeholder:'Number of Items'},{type:'string',name:'location',label:'Location',placeholder:''},{type:'datetime',name:'datetime',label:'Datetime'}]},o={name:'CustomerService',fields:[{type:'string',name:'provider',label:'Merchant'},{type:'string',name:'order_number',label:'Order #'}]},p={name:'Weather',fields:[{type:'string',name:'location',label:'Location'},{type:'datetime',name:'datetime',label:'Datetime'},{type:'string',name:'weather_type',label:'Type of forecast',placeholder:'temperature, snow, tide...'},{type:'string',name:'temperature_metric',label:'Metric',placeholder:'Celsius or Fahrenheit'}]},q={name:'Hotel',fields:[{type:'enum',name:'hotel_query_type',label:'Action',placeholder:'Pick one...',values:['reservation','availability','cancel','change','contact','extend','receipt']},{type:'string',name:'location',label:'Location'},{type:'datetime',name:'datetime',label:'Check in',placeholder:'Date and time of the appointment'},{type:'number',name:'night_number',label:'Nights #',placeholder:'Number of Nights'},{type:'number',name:'people',label:'People',placeholder:'Number of Guests'},{type:'string',name:'amount_of_money',label:'Price'},{type:'string',name:'hotel_name',label:'Hotel Name'}]},r={name:'Activities',fields:[{type:'string',name:'reservation_type',label:'Activity'},{type:'string',name:'location',label:'Location'},{type:'datetime',name:'datetime',label:'Datetime'},{type:'string',name:'amount_of_money',label:'Price'},{type:'number',name:'people_number',label:'People',placeholder:'Number of People'}]},s={name:'Tickets',fields:[{type:'enum',name:'request_type',label:'Action',placeholder:'Pick one...',values:['reservation','availability','cancel','change','info','location','option','price','receipt','time','schedule']},{type:'string',name:'event_type',label:'Type',placeholder:'Movie, show, concert...'},{type:'string',name:'event',label:'Name'},{type:'string',name:'event_venue',label:'Venue'},{type:'string',name:'location',label:'Location'},{type:'datetime',name:'datetime',label:'Datetime'},{type:'string',name:'amount_of_money',label:'Price'},{type:'number',name:'people_number',label:'Tickets #',placeholder:'Number of Tickets'}]},t={name:'FoodPurchase',fields:[{type:'string',name:'order',label:'Order',placeholder:''},{type:'string',name:'food_type',label:'Food Type',placeholder:''},{type:'string',name:'food_place',label:'Place'},{type:'enum',name:'delivery_type',label:'Delivery',placeholder:'Pick one...',values:['deliver','takeout']},{type:'string',name:'location',label:'Location',placeholder:''},{type:'datetime',name:'datetime',label:'Datetime'}]},u={name:'Utility',fields:[{type:'enum',name:'request_type',label:'Action',placeholder:'Pick one...',values:['reservation','availability','cancel','change','info','location','option','price','receipt','time','schedule']},{type:'string',name:'utility_provider',label:'Name',placeholder:'Name of the utility company'},{type:'string',name:'location',label:'Location',placeholder:''},{type:'string',name:'account_nbr',label:'Account #',placeholder:''}]},v={name:'Vehicle',fields:[{type:'enum',name:'hotel_query_type',label:'Action',placeholder:'Pick one...',values:['reservation','availability','cancel','change','info','location','option','price','receipt','time','schedule']},{type:'string',name:'from',label:'From'},{type:'string',name:'to',label:'To'},{type:'datetime',name:'datetime',label:'Datetime',placeholder:'Date and time of the ride'},{type:'string',name:'car_type',label:'Car Type',placeholder:'Type of car (limo, uber, lift...)'},{type:'string',name:'people_number',label:'People',placeholder:'Number of Guests'},{type:'string',name:'vehicle_provider',label:'Rental Name',placeholder:'Car rental name like Hertz, Avis..'}]},w={name:'Traffic',fields:[{type:'string',name:'from',label:'Starting Point'},{type:'string',name:'to',label:'Destination'},{type:'datetime',name:'datetime',label:'Date/Time',placeholder:'Intended departure time (not supported by automation)'}]},x={name:'Navigation',fields:[{type:'string',name:'from',label:'Starting Point'},{type:'string',name:'to',label:'Destination'},{type:'datetime',name:'datetime',label:'Date/Time',placeholder:'Intended departure time (not supported by automation)'}]},y={name:'flight_request',fields:[{type:'enum',name:'flight_query_type',label:'Action',placeholder:'Pick one...',values:['book','price','upgrade','flight_status','cancel','change']},{type:'string',name:'from',label:'From'},{type:'string',name:'to',label:'To'},{type:'datetime',name:'departure',label:'Departure'},{type:'datetime',name:'arrival',label:'Arrival'},{type:'string',name:'carrier',label:'Carrier'},{type:'string',name:'reference',label:'Reference Number'},{type:'number',name:'passenger_num',label:'Passenger Number'}]};f.exports=h;},null);
__d('OzIntentFactory',['immutable','Map','OzAPI','OzGenericIntent.react','OzIntentFactoryHelpers','OzIntentSchemas','OzImmutablePureRenderMixin','React','debounce'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=new (c('Map'))(),j={get:function(l){var m=c('OzIntentSchemas').get(l);if(!i.has(l))i.set(l,k(m));return i.get(l);}};function k(l){var m=c('immutable').Map,n=l.name,o=l.fields,p=10000,q=c('OzIntentFactoryHelpers').makeStateExtractor(o),r=c('OzIntentFactoryHelpers').makeFieldRenderer(o),s=c('OzIntentFactoryHelpers').makeParamsUpdater(o);return c('React').createClass({displayName:'Oz'+n+'DynamicIntent',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{intent:h.instanceOf(m).isRequired,onChangeAlias:h.func,onClose:h.func.isRequired,onOpen:h.func.isRequired,onIsBlockedToggle:h.func.isRequired,requirements:h.instanceOf(m).isRequired,repNames:h.instanceOf(m).isRequired,onCreateRequirement:h.func,onDeleteRequirement:h.func,userEmail:h.string},getInitialState:function(){return babelHelpers['extends']({isEditing:false},q(this.props.intent));},componentWillMount:function(){this._saveIntent=c('debounce')(this._saveIntent,500,this,true);this._changeHandlers=m().withMutations(function(t){for(var u=o,v=Array.isArray(u),w=0,u=v?u:u[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var x;if(v){if(w>=u.length)break;x=u[w++];}else{w=u.next();if(w.done)break;x=w.value;}var y=x;t.set(y.name,c('OzIntentFactoryHelpers').makeStateUpdater(y.name).bind(this));}}.bind(this));},componentWillReceiveProps:function(t){var u=this.state.isEditing;if(c('immutable').is(t.intent,this.props.intent)||u)return;this.setState(q(t.intent));},componentWillUnmount:function(){window.clearTimeout(this._editingTimeout);},render:function(){return (c('React').createElement(c('OzGenericIntent.react'),babelHelpers['extends']({},this.props,{notes:this.state.notes,onNotesChange:this._handleNotesChange}),this._renderFields()));},_renderFields:r,_handleNotesChange:function(t){this._setStateAndSave({notes:t});},_saveIntent:function(){var t=this.props.intent;c('OzAPI').editIntent(t.get('user-id'),m({id:t.get('id'),params:s(t.get('params'),this.state),notes:this.state.notes}));},_setStateAndSave:function(t){window.clearTimeout(this._editingTimeout);this.setState(babelHelpers['extends']({isEditing:true},t),this._saveIntent);this._editingTimeout=window.setTimeout(function(u){return this.setState({isEditing:false});}.bind(this),p);}});}f.exports=j;},null);
__d('OzIntent.react',['OzAPI','OzHelpers','immutable','OzIntentFactory','OzImmutablePureRenderMixin','React'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('immutable').Map,i=c('React').PropTypes,j=c('React').createClass({displayName:'OzIntent',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{intent:i.instanceOf(h).isRequired,requirements:i.instanceOf(h).isRequired,repNames:i.instanceOf(h).isRequired},render:function(){var k=this.props,l=k.intent,m=k.intentMeta,n=k.repNames,o=k.requirements,p=k.location,q=c('OzIntentFactory').get(c('OzHelpers').intentName(l));return (c('React').createElement(q,{intent:l,intentMeta:m,onChangeAlias:this._handleChangeAlias,onClose:this._handleClose,onCreateRequirement:this._handleCreateRequirement,onDeleteRequirement:this._handleDeleteRequirement,onOpen:this._handleOpen,onIsBlockedToggle:this._handleIsBlockedToggle,repNames:n,requirements:o,location:p}));},_handleClose:function(k,l){c('OzAPI').closeIntent(this.props.threadID,k,l);},_handleOpen:function(k){c('OzAPI').openIntent(this.props.threadID,k);},_handleDeleteRequirement:function(k,l){c('OzAPI').deleteIntentRequirement(this.props.threadID,k,l);},_handleCreateRequirement:function(k,l){c('OzAPI').createIntentRequirement(this.props.threadID,k,l);},_handleChangeAlias:function(k,l){c('OzAPI').editIntent(k.get('user-id'),h({id:k.get('id'),alias:l}));},_handleIsBlockedToggle:function(k){k.get('blocked')?c('OzAPI').unblockIntent(this.props.threadID,k.get('id')):c('OzAPI').blockIntent(this.props.threadID,k.get('id'));}});f.exports=j;},null);
__d('OzIntentEvents.react',['cx','Promise','OzAPI','OzHelpers','OzNotify','ozFormatTime','CajaHTMLSanitizer','CIWebmailValidator','ContextualLayerAutoFlip','ContextualLayerUpdateOnScroll','FileInput.react','immutable','ReactLayeredComponentMixin','OzActions','OzConfig','OzDate.react','OzDraggable.react','OzReminderTaskEditor.react','OzTimestampScrolling.react','promiseFinally','OzImmutablePureRenderMixin','React','Reflux','Tooltip','XUICloseButton.react','XUIDateTimePicker.react','XUIError.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('CIWebmailValidator').isValidEmail,j=c('immutable').Map,k=c('immutable').List,l=c('React').PropTypes,m=c('React').createClass({displayName:'OzIntentEvents',mixins:[c('Reflux').connect(c('OzConfig').ConfigStore,'config')],propTypes:{intent:l.instanceOf(j).isRequired,userEmail:l.string,location:l.instanceOf(j).isRequired},getInitialState:function(){return {composerEmail:ka,composerInvite:ma(this.props.userEmail),emailShown:false,inviteShown:false,emailErrors:j(),inviteErrors:j(),reminderShown:false,emailDisabled:false,uploadSem:0};},render:function(){var za=this.props,ab=za.intent,bb=za.location,cb=(ab.get('events')||k()).toList(),db=cb.filter(function(gb){return gb.get('type')==='completed-call';}),eb=cb.filter(function(gb){return (gb.get('type')==='send-email'||gb.get('type')==='receive-email');}),fb=cb.filter(function(gb){return gb.get('type')==='send-calendar';});return (c('React').createElement('div',{className:"_4h0y"},c('React').createElement(p,{header:'Calls',events:db,onCallPlay:this._handleCallPlay}),c('React').createElement(p,{header:'Emails',events:eb,onEmailShow:function(gb){return this._handleEmail({email:gb.get('data'),disabled:true});}.bind(this),onEmailReply:function(gb){return this._handleEmail({email:gb.get('data')});}.bind(this)}),c('React').createElement(p,{header:'Invites',events:fb,onInviteShow:function(gb){return this._handleInvite({invite:gb.get('data'),disabled:true});}.bind(this)}),c('React').createElement('div',{className:"_4h0-"},c('React').createElement(n,{onCallClick:this._handleCallClick,onEmailClick:this._handleEmail,onInviteClick:this._handleInvite,onReminderClick:this._handleReminder}),c('React').createElement(v,{sign:'@'},va(ab)),c('React').createElement(v,{sign:'#'},wa(ab))),this.state.emailShown?c('React').createElement(w,{email:this.state.composerEmail,disabled:this.state.emailDisabled,errors:this.state.emailErrors,onChange:function(gb){return this.setState({composerEmail:gb});}.bind(this),onSend:this._handleSendEmail,onToggle:function(gb){return this.setState({emailShown:false,emailErrors:j()});}.bind(this),onUpload:this._handleUpload,onAttOpen:function(gb){return c('OzAPI').everstoreURI(gb.getIn(['body','everstore-handle'])).then(function(hb){return window.open(hb);});}}):null,this.state.inviteShown?c('React').createElement(da,{disabled:this.state.inviteDisabled,invite:this.state.composerInvite,errors:this.state.inviteErrors,onChange:function(gb){return this.setState({composerInvite:gb});}.bind(this),onClose:function(gb){return this.setState({inviteShown:false,inviteErrors:j()});}.bind(this),onSend:this._handleSendInvite}):null,this.state.reminderShown&&this.state.config.get('display-tasks')?c('React').createElement(ea,{onClose:this._handleCloseReminderTask,onCreate:this._handleCreateReminderTask,location:bb}):null));},_handleCloseReminderTask:function(){this.setState({reminderShown:false});},_handleCreateReminderTask:function(za){var ab=this.props.intent;return c('OzAPI').createTask(ab.get('user-id'),za.set('intent-id',ab.get('id'))).then(function(bb){return this.setState({reminderShown:false});}.bind(this));},_handleCallClick:function(){ya(this.props.intent).done(function(za){return c('OzActions').twilio.useIntent(za);});},_handleSendEmail:function(){var za=this.props.intent.get('id'),ab=this.state.composerEmail,bb=[[ab.getIn(fa),'Please select the to email address'],[ab.get('subject'),'Please write your subject'],[ab.getIn(ia),'Please write a message'],[this.state.uploadSem===0,'Your attachments are still uploading']].find(function(eb){var fb=eb[0],gb=eb[1];return !fb;});if(bb){c('OzNotify').error(bb[1]);return;}var cb=ab.set('intent-id',za).updateIn(fa,na).updateIn(ga,na).updateIn(ha,na),db=j({to:fa,cc:ga,bcc:ha}).map(function(eb){return pa(cb.getIn(eb));}).filter(function(eb){return eb;});if(!db.isEmpty()){this.setState({emailErrors:db});return;}c('OzAPI').sendEmail(cb);this.setState({composerEmail:ka,emailShown:false,emailErrors:j()});},_handleSendInvite:function(){var za=this.props.intent.get('id'),ab=this.state.composerInvite,bb=[[ab.get('to'),'Please select where to send the invite'],[ab.get('title'),'Please create a title'],[ab.get('start'),'Please select a start time'],[ab.get('end'),'Please select an end time'],[ab.get('start')>c('OzHelpers').serverNow(),'Event must start in the future'],[ab.get('end')>ab.get('start'),'Event must start before it ends']].find(function(eb){var fb=eb[0],gb=eb[1];return !fb;});if(bb){c('OzNotify').error(bb[1]);return;}var cb=ab.set('intent-id',za).update('to',na),db=j({to:'to'}).map(function(eb){return pa(cb.get(eb));}).filter(function(eb){return eb;});if(!db.isEmpty()){this.setState({inviteErrors:db});return;}c('OzAPI').sendInvite(cb);this.setState({composerInvite:ma(this.props.userEmail),inviteShown:false,inviteErrors:j()});},_handleUpload:function(za){var ab=function(cb){return this.setState({uploadSem:this.state.uploadSem+cb});}.bind(this);ab(1);var bb=c('OzAPI').everstoreUpload(j({blob:za})).then(function(cb){return sa(cb,za);}).then(function(cb){return this.state.composerEmail.update('body',function(db){return db.push(cb);});}.bind(this)).then(function(cb){return this.setState({composerEmail:cb});}.bind(this));c('promiseFinally')(bb,function(cb){return ab(-1);});},_handleEmail:function(){var za=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],ab=za.email?za.email.updateIn(fa,oa).updateIn(ga,oa).updateIn(ha,oa):ka;this.setState({emailShown:true,composerEmail:ab,emailDisabled:za.disabled});},_handleInvite:function(){var za=arguments.length<=0||arguments[0]===undefined?{}:arguments[0],ab=za.invite?za.invite.update('to',oa):ma(this.props.userEmail);this.setState({inviteShown:true,composerInvite:ab,inviteDisabled:za.disabled});},_handleReminder:function(){var za=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];this.setState({reminderShown:true});},_handleCallPlay:function(za){return c('OzAPI').everstoreURI(za).then(function(ab){return window.open(ab);});}}),n=c('React').createClass({displayName:'NewIntentEvent',mixins:[c('OzImmutablePureRenderMixin'),c('Reflux').connect(c('OzConfig').ConfigStore,'config')],getInitialState:function(){return {shown:false};},render:function(){var za=this.props,ab=za.onCallClick,bb=za.onEmailClick,cb=za.onInviteClick,db=za.onReminderClick,eb=this.state.config.get('display-tasks');return (c('React').createElement('div',{style:{display:'flex'}},[['call',ab],['email',bb],['invite',cb]].concat(eb?[['reminder',db]]:[]).map(function(fb){var gb=fb[0],hb=fb[1];return (c('React').createElement('button',{key:gb,className:"_1-hv _2jc3",onClick:function(){hb();}},'+',gb));})));}}),o=function(za){return -za.get('id');},p=c('OzHelpers').pure(function(za){var ab=za.header,bb=za.events,cb=za.onEmailShow,db=za.onEmailReply,eb=za.onCallPlay,fb=za.onInviteShow;return bb&&!bb.isEmpty()?c('React').createElement('details',{open:true},c('React').createElement('summary',{className:"_177e _3_lv"},ab,'... (',bb.count(),')'),c('React').createElement('div',{className:"_4h0z"},bb.map(function(event){return (c('React').createElement(q,{orderBy:o,event:event,key:event.get('id'),onEmailShow:cb,onEmailReply:db,onCallPlay:eb,onInviteShow:fb}));}))):null;}),q=c('OzHelpers').pure(function(za){var event=za.event,ab=za.onEmailShow,bb=za.onEmailReply,cb=za.onCallPlay,db=za.onInviteShow,eb=za.orderBy;event=xa(event);var fb=event.get('data');switch(event.get('type')){case 'send-email':return (c('React').createElement(u,{order:eb(event),sign:'@',subtitle:fb.get('subject'),actions:[['VIEW',function(gb){return ab(event);}],['REPLY',function(gb){return bb(ta(event));}]]},c('React').createElement(r,{data:fb,type:'to'})));case 'receive-email':return (c('React').createElement(u,{order:eb(event),sign:'@',subtitle:fb.get('subject'),actions:[['VIEW',function(gb){return ab(ua(event));}],['REPLY',function(gb){return bb(ta(ua(event)));}]]},c('React').createElement(r,{data:fb,type:'from'})));case 'send-calendar':return (c('React').createElement(u,{order:eb(event),sign:'@',subtitle:fb.get('title'),timestamp:fb.get('start'),actions:[['VIEW',function(gb){return db(event);}]]},c('React').createElement(s,{data:fb})));case 'completed-call':return (c('React').createElement(t,{event:event,onCallPlay:cb,orderBy:eb}));default:return null;}}),r=c('OzHelpers').pure(function(za){var ab=za.data,bb=za.type,cb=(bb==='to'?'Sent':'Received')+' at '+c('OzHelpers').toLocaleTime(ab.get('sent-at'))+' on '+c('OzHelpers').toLocaleDate(ab.get('sent-at')),db=bb==='from'?ab.get('from'):ab.get('to').join(', '),eb=bb==='to'?'To':'From';return (c('React').createElement('span',c('Tooltip').propsFor(cb),eb,' ',c('React').createElement('strong',null,db)));}),s=c('OzHelpers').pure(function(za){var ab=za.data,bb='Sent at '+c('OzHelpers').toLocaleTime(ab.get('sent-at'))+' on '+c('OzHelpers').toLocaleDate(ab.get('sent-at'));return (c('React').createElement('span',c('Tooltip').propsFor(bb),c('React').createElement('strong',null,ab.get('to').join(', '))));}),t=c('OzHelpers').pure(function(za){var event=za.event,ab=za.onCallPlay,bb=za.orderBy,cb=event.get('data'),db={'in':'Call from',out:'Call to',voicemail:'Voicemail from'}[cb.get('direction')],eb=c('OzHelpers').parsePhoneNumber(cb.get('remote-phone')),fb=cb.get('RecordingDuration'),gb=cb.get('recording-ev-handle'),hb=gb?[['PLAY',function(ib){return ab(gb);}]]:[];return (c('React').createElement(u,{order:bb(event),sign:'#',subtitle:c('ozFormatTime')(+fb),timestamp:event.get('timestamp'),actions:hb},c('React').createElement('span',null,db,' ',c('React').createElement('strong',null,eb))));}),u=c('OzHelpers').pure(function(za){var ab=za.sign,bb=za.children,cb=za.subtitle,db=za.actions,eb=za.timestamp,fb=za.order;return (c('React').createElement('div',{className:"_4h11",style:{order:fb}},c('React').createElement('div',{className:"_4h12"},ab),c('React').createElement('div',{className:"_4h18"},c('React').createElement('div',null,bb),c('React').createElement('div',null,cb,cb&&eb?c('React').createElement('span',null,' — '):null,eb?c('React').createElement(c('OzTimestampScrolling.react'),{timestamp:eb},c('React').createElement(c('OzDate.react'),{timestamp:eb,className:"_3_lw"})):null)),c('React').createElement('div',{className:"_4h19"},db.map(function(gb,hb){var ib=gb[0],jb=gb[1];return (c('React').createElement('button',{key:hb,className:"_1-hv _30yy _4h1a",onClick:jb},ib));}))));}),v=c('OzHelpers').pure(function(za){var ab=za.sign,bb=za.children;return bb?c('React').createElement('div',{className:"_4h1b"},c('React').createElement('span',{className:"_4h1c"},ab),bb):null;}),w=c('React').createClass({displayName:'EmailComposer',propTypes:{onToggle:l.func.isRequired,onSend:l.func,disabled:l.bool,email:l.instanceOf(j).isRequired,errors:l.instanceOf(j),onChange:l.func.isRequired,onUpload:l.func.isRequired,onAttOpen:l.func.isRequired},componentDidMount:function(){var za=['to','subject','body'].map(function(ab){return this.refs[ab];}.bind(this)).find(function(ab){return ab&&!ab.value;});za&&za.focus();},getInitialState:function(){return {showCC:false,showBCC:false};},render:function(){var za=this.props,ab=za.email,bb=za.errors,cb=za.onToggle,db=za.onUpload,eb=za.onAttOpen,fb=za.onChange,gb=za.disabled,hb=za.onSend,ib=this.state.showCC||gb&&ab.getIn(ga),jb=this.state.showBCC||gb&&ab.getIn(ha),kb=function(nb,ob,pb){return (c('React').createElement(c('XUIError.react'),{xuiError:bb.get(ob),xuiErrorPosition:'left'},c('React').createElement('input',{type:'text',className:"_1-i0 _4h1i",disabled:gb,placeholder:nb,ref:ob,value:ab.getIn(pb),onChange:function(qb){return fb(ab.setIn(pb,qb.target.value));}})));},lb=aa(ab,'text/plain');if(lb==-1)lb=0;var mb=['body',lb,'body','contents'];return (c('React').createElement(c('OzDraggable.react'),{className:"_4h1d"},c('React').createElement('div',{className:"_4h1e"},c('React').createElement(c('XUICloseButton.react'),{onClick:cb})),c('React').createElement('div',{className:"_1jg2"},kb('To','to',fa),!ib&&!gb?c('React').createElement('button',{className:"_1jg3",onClick:function(nb){return this.setState({showCC:true});}.bind(this)},'CC'):null,!jb&&!gb?c('React').createElement('button',{className:"_1jg3",onClick:function(nb){return this.setState({showBCC:true});}.bind(this)},'BCC'):null),ib?kb('Cc','cc',ga):null,jb?kb('Bcc','bcc',ha):null,kb('Subject','subject',['subject']),gb?c('React').createElement(x,{email:ab}):c('React').createElement('textarea',{disabled:gb,placeholder:'Write your masterpiece',ref:'body',className:"_1-i0 _4h1j",value:ab.getIn(mb),onChange:function(nb){return fb(ab.setIn(mb,nb.target.value));}}),c('React').createElement(ba,{email:ab,onChange:fb,onAttOpen:eb}),gb?null:c('React').createElement('div',{className:"_5l1v"},c('React').createElement('button',{onClick:hb,className:"_1-hv _30yy _4h1s"},'Send'),c('React').createElement(c('FileInput.react'),{ref:'fileInput',onChange:function(nb){db(nb.target.files[0]);this.refs.fileInput.getFileInput().clear();}.bind(this)},c('React').createElement('a',{title:'add images',className:"_5l1w _30yy"})))));}}),x=c('OzHelpers').pure(function(za){var ab=za.email,bb=z(ab,'text/html','text/plain');return (c('React').createElement('div',{className:"_3x40"},ra(bb)?c('React').createElement('div',{style:{whiteSpace:'pre-wrap'}},bb.getIn(['body','contents'])):c('React').createElement(y,{html:bb.getIn(['body','contents'])})));}),y=c('OzHelpers').pure(function(za){var ab=za.html,bb=babelHelpers.objectWithoutProperties(za,['html']);return (c('React').createElement('div',babelHelpers['extends']({},bb,{dangerouslySetInnerHTML:{__html:c('CajaHTMLSanitizer').sanitize(ab,function(cb){return cb;})}})));});function z(za){for(var ab=arguments.length,bb=Array(ab>1?ab-1:0),cb=1;cb<ab;cb++)bb[cb-1]=arguments[cb];var db=bb.map(function(eb){return aa(za,eb);}).find(function(eb){return eb>-1;});return Number.isSafeInteger(db)?za.getIn(['body',db]):null;}function aa(za,ab){return za.get('body').findIndex(function(bb){return bb.get('content-type').indexOf(ab)>-1;});}var ba=c('OzHelpers').pure(function(za){var ab=za.email,bb=za.onAttOpen,cb=za.onChange,db=ab.get('body').map(function(eb,fb){return qa(eb)?null:c('React').createElement(ca,{key:fb,part:eb,onClick:function(gb){return bb(eb);},onRemove:function(gb){return cb(ab.update('body',function(hb){return hb['delete'](fb);}));}});}).filter(function(eb){return !!eb;});return db.isEmpty()?null:c('React').createElement('div',{className:"_5l1-"},db);}),ca=c('OzHelpers').pure(function(za){var ab=za.part,bb=za.onClick,cb=za.onRemove;return (c('React').createElement('div',{className:"_5l26"},c('React').createElement('button',{className:"_1-hv",onClick:bb},ab.getIn(['body','filename'])),c('React').createElement(c('XUICloseButton.react'),{onClick:cb})));}),da=c('React').createClass({displayName:'InviteComposer',propTypes:{invite:l.instanceOf(j).isRequired,errors:l.instanceOf(j),onClose:l.func.isRequired,onChange:l.func.isRequired,onSend:l.func.isRequired,disabled:l.bool},componentDidMount:function(){var za=['title','description','location','to'].map(function(ab){return this.refs[ab];}.bind(this)).find(function(ab){return !ab.value;});za&&za.focus();},render:function(){var za=this.props,ab=za.disabled,bb=za.invite,cb=za.errors,db=za.onClose,eb=za.onChange,fb=za.onSend,gb=function(ib,jb){return (c('React').createElement(c('XUIError.react'),{xuiError:cb.get(jb),xuiErrorPosition:'left'},c('React').createElement('input',{type:'text',className:"_1-i0 _4h1i",disabled:ab,placeholder:ib,ref:jb,value:bb.get(jb),onChange:function(kb){return eb(bb.set(jb,kb.target.value));}})));},hb=function(ib,jb){return (c('React').createElement('div',null,ib+':',c('React').createElement(c('XUIDateTimePicker.react'),babelHelpers['extends']({className:"_pto",date:new Date(bb.get(jb)||c('OzHelpers').serverNow()),readOnly:ab,allowDuplicateDateSelection:true,onChange:function(kb){return eb(bb.set(jb,+kb));}},c('OzHelpers').dateRestraints()))));};return (c('React').createElement(c('OzDraggable.react'),{className:"_ptp"},c('React').createElement('div',{className:"_ptq"},'Calendar Invite',c('React').createElement(c('XUICloseButton.react'),{onClick:db})),gb('Title','title'),gb('Description','description'),gb('Location','location'),gb('Send to...','to'),hb('Start Time','start'),hb('End Time','end'),ab?null:c('React').createElement('div',{className:"_5l1v"},c('React').createElement('button',{onClick:fb,className:"_1-hv _30yy _ptu"},'Send'))));}}),ea=c('React').createClass({displayName:'ReminderComposer',propTypes:{onClose:l.func.isRequired,onCreate:l.func.isRequired},render:function(){var za=this.props,ab=za.onClose,bb=za.onCreate,cb=za.location;return (c('React').createElement(c('OzDraggable.react'),{className:"_2jc4"},c('React').createElement('div',{className:"_2jc5"},'Reminder',c('React').createElement(c('XUICloseButton.react'),{onClick:ab})),c('React').createElement(c('OzReminderTaskEditor.react'),{onSave:bb,location:cb})));}}),fa=['to'],ga=['cc'],ha=['bcc'],ia=['body',0,'body','contents'],ja=c('immutable').fromJS([{'content-type':'text/plain; charset=UTF-8',body:{contents:''}}]),ka=c('immutable').fromJS({to:'',cc:'',bcc:'',from:'',subject:'',body:ja}),la=c('immutable').fromJS({title:'',description:'',start:null,end:null,location:'',to:''});function ma(){var za=arguments.length<=0||arguments[0]===undefined?'':arguments[0];return (la.set('start',c('OzHelpers').serverNow()).set('end',c('OzHelpers').serverNow()).set('to',za));}function na(za){return za?za.split(/[, ]/).filter(function(ab){return ab.length;}):[];}function oa(za){return za&&za.join(', ');}function pa(za){za=k(za);var ab=za.filterNot(i);return ab.isEmpty()?null:'Invalid email address(es): '+ab.join(', ')+'.';}function qa(za){var ab=za.get('content-type');return (ab&&ab.indexOf('text/plain')>-1||ab.indexOf('text/html')>-1);}function ra(za){return za.get('content-type').indexOf('text/plain')>-1;}function sa(za,ab){return c('immutable').fromJS({'content-type':ab.type,body:{'everstore-handle':za,filename:ab.name}});}function ta(za){var ab=za.getIn(['data','subject']),bb=ab.toUpperCase().startsWith('RE:')?ab:'Re: '+ab;return za.setIn(['data','subject'],bb).setIn(['data','body'],ja);}function ua(za){var ab=za.get('data'),bb=ab.get('from'),cb=ab.getIn(fa);return za.setIn(['data','from'],cb).setIn(['data','to'],k([bb]));}function va(za){return za.get('email-address')?c('React').createElement('strong',null,za.get('email-address')):null;}function wa(za){var ab=c('OzHelpers').parsePhoneNumber(za.get('phone-number')),bb=za.get('phone-extension');return ab?c('React').createElement('span',null,c('React').createElement('strong',null,ab,' '),' ext. ',c('React').createElement('strong',null,bb)):null;}function xa(event){if(event.getIn(['data','recips'])){return event.setIn(['data','to'],event.getIn(['data','recips'])).deleteIn(['data','recips']);}else return event;}function ya(za){var ab=za.get('phone-number');return ab?c('Promise').resolve(za):c('OzAPI').addPhoneNumber(za.get('user-id'),za.get('id')).then(function(bb){return bb.get('intents').find(function(cb){return cb.get('id')===za.get('id');});});}f.exports=m;},null);
__d('OzIntentList.react',['cx','OzHelpers','immutable','OzIntentEvents.react','OzSidebarItemHeader.react','OzImmutablePureRenderMixin','React','ReactDOM','ReactRouter'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('ReactRouter').Link,k=c('React').createClass({displayName:'OzIntentList',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{activeIntentId:i.number,intents:i.instanceOf(c('immutable').List).isRequired,location:i.instanceOf(c('immutable').Map).isRequired,userEmail:i.string},componentDidMount:function(){var m=c('ReactDOM').findDOMNode(this.refs[this.props.activeIntentId]);m&&m.scrollIntoViewIfNeeded();},componentDidUpdate:function(m){var n=this.props,o=n.activeIntentId,p=n.isHistory,q=c('ReactDOM').findDOMNode(this.refs[o]);if(q&&(m.activeIntentId!==o||m.isHistory!==p))q.scrollIntoViewIfNeeded();},render:function(){return (c('React').createElement('div',null,this.props.intents.map(this._renderIntent)));},_renderIntent:function(m){var n=m.get('id'),o=this.props,p=o.activeIntentId,q=o.userEmail,r=o.location,s=p===n;return (c('React').createElement(l,{ref:n,key:n,intent:m,isExpanded:s,userEmail:q,location:r}));}}),l=c('OzHelpers').pure(function(m){var n=m.intent,o=m.isExpanded,p=m.userEmail,q=m.location;return (c('React').createElement('div',null,c('React').createElement(j,{className:"_qsr",to:c('OzHelpers').threadPath({threadid:n.get('user-id'),intentid:n.get('id')})},c('React').createElement(c('OzSidebarItemHeader.react'),{alias:n.get('alias'),className:"_qsu"+(o?' '+"_qsv":''),isClosed:c('OzHelpers').isClosedIntent(n),closeState:n.get('state'),isBlocked:n.get('blocked'),title:c('OzHelpers').intentName(n),createdAt:n.get('created-at'),closedAt:n.get('closed-at'),skipScrollToTimestamp:true})),o?c('React').createElement(c('OzIntentEvents.react'),{intent:n,userEmail:p,location:q}):null));});f.exports=k;},null);
__d('OzReminderNotesField.react',['OzIntentParamsTextField.react','OzImmutablePureRenderMixin','React','debounce'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('React').PropTypes,i=c('React').createClass({displayName:'OzReminderNotesField',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{seedNotes:h.string,onSave:h.func.isRequired},getInitialState:function(){return {notes:this.props.seedNotes||''};},componentWillMount:function(){this._save=c('debounce')(this._save,750,this,true);},render:function(){return (c('React').createElement(c('OzIntentParamsTextField.react'),{label:'Add notes about this reminder...',onChange:this._handleChange,value:this.state.notes}));},_handleChange:function(j){this.setState({notes:j},this._save);},_save:function(){this.props.onSave(this.state.notes);}});f.exports=i;},null);
__d('OzReminder.react',['cx','invariant','OzAPI','OzHelpers','Event','immutable','OzIntentParamsAbstractField.react','OzIntentParamsStringField.react','OzReminderEditor.react','OzReminderNotesField.react','OzSidebarItemHeader.react','OzImmutablePureRenderMixin','React','XUICloseButton.react','formatDate'],function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=c('immutable').List,k=c('immutable').Map,l=c('React').PropTypes,m=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],n=c('React').createClass({displayName:'OzReminder',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{onClose:l.func.isRequired,onEdit:l.func.isRequired,onOpen:l.func.isRequired,onSnooze:l.func.isRequired,reminder:l.instanceOf(k).isRequired,repNames:l.instanceOf(k).isRequired},getInitialState:function(){return {isExpanded:c('OzHelpers').isUrgentReminder(this.props.reminder)};},componentWillReceiveProps:function(p){if(p.reminder.get('id')===this.props.reminder.get('id')&&c('OzHelpers').isUrgentReminder(p.reminder)&&!c('OzHelpers').isUrgentReminder(this.props.reminder))this.setState({isExpanded:true});},render:function(){var p=this.props,q=p.onEdit,r=p.onSnooze,s=p.reminder,t=p.repNames,u=s.getIn(['body','description']),v=c('OzHelpers').isUrgentReminder(s),w=s.getIn(['body','suggestion']),x=s.get('state')==='closed',y=s.get('creator-fbid'),z=t.get(y,y);return (c('React').createElement('div',{className:"_wc0"+(v?' '+"_wc2":'')+(c('OzHelpers').isPaidReminder(s)?' '+"_3d-l":'')+(x?' '+"_3d-m":'')},c('React').createElement(c('OzSidebarItemHeader.react'),{className:"_1k8u",creator:z,isClosed:x,isExpanded:this.state.isExpanded,onIsExpandedToggle:this._handleIsExpandedToggle,onToggle:this._handleToggle,subtitle:c('OzHelpers').isSnoozedReminder(s)?'(snoozed)':null,title:u||o(w)},v?c('React').createElement('button',{className:"_1-hv _260v _260w",alt:'Snooze',onClick:function(aa){return r(s);}}):null,c('React').createElement(c('OzReminderEditor.react'),{onSave:q,seedReminder:s},c('React').createElement('a',{className:"_260y"},c('React').createElement('i',{className:"_5x82"})))),this._renderBody()));},_renderBody:function(){if(!this.state.isExpanded)return null;var p=this.props.reminder,q=p.get('scheduled-time'),r=p.get('last-fired'),s=p.get('state')==='closed',t=c('OzHelpers').isUrgentReminder(p),u=p.get('state')==='snoozed'&&r||q>c('OzHelpers').serverNow()&&q,v=(t||s)&&r,w=p.get('days');return (c('React').createElement('div',{className:"_wc3"},c('React').createElement('div',{className:"_1k8v _3-ue"},this._renderPayment(p),v?c('React').createElement(c('OzIntentParamsAbstractField.react'),{label:'Fired On'},c('React').createElement('span',null,c('formatDate')(new Date(v),'M jS, g:ia'))):null,u?c('React').createElement(c('OzIntentParamsAbstractField.react'),{label:'Will Fire On'},c('React').createElement('span',null,c('formatDate')(new Date(u),'M jS, g:ia'))):null,w&&!w.isEmpty()?c('React').createElement(c('OzIntentParamsAbstractField.react'),{label:'Recurs'},c('React').createElement('span',null,w.size===7?'Every Day':w.sort().map(function(x){return m[x%7];}).toArray().join(' '))):null,c('React').createElement(c('OzReminderNotesField.react'),{seedNotes:p.get('notes')||p.getIn(['body','description']),onSave:this._handleNotesSave}))));},_renderPayment:function(p){var q=p.getIn(['body','suggestion']);if(!q)return null;var r=p.getIn(['body','credit-card']),s=q.get('name');return (c('React').createElement('div',null,c('React').createElement(c('OzIntentParamsAbstractField.react'),{label:'Link'},c('React').createElement('div',{className:"_3d-q"},c('React').createElement('a',{className:"_3d-r",target:'_blank',href:q.get('target-url'),title:q.get('description')},'Click here to view ',s),r?c('React').createElement('a',{className:"_3d-s",href:'#',title:'Show credit card information',onClick:this._handlePaymentLinkClick}):null)),c('React').createElement(c('OzIntentParamsStringField.react'),{label:'Confirmation #',onSave:this._handleItemNumberSave,placeholder:'Confirmation number',value:p.getIn(['body','item-number'])||''})));},_handleIsExpandedToggle:function(){this.setState({isExpanded:!this.state.isExpanded});},_handleNotesSave:function(p){this.props.onEdit(this.props.reminder.set('notes',p));},_handleItemNumberSave:function(p){this.props.onEdit(this.props.reminder.setIn(['body','item-number'],p));},_handleToggle:function(p){var q=this.props,r=q.onClose,s=q.onOpen,t=q.reminder;p?r(t):s(t);},_handlePaymentLinkClick:function(p){var q=this.props.reminder.getIn(['body','credit-card']);if(!q)return;var r=this.props.reminder.getIn(['body','suggestion','amount'])/100,s=q.get('number'),t=q.get('cvv'),u=q.get('month'),v=q.get('year'),w=q.get('zip');c('OzAPI').notifyExtension({action:'show',title:'Temporary Credit Card Information',desc:'Amount: $'+r+' Number: '+s+' cvv: '+t+' zip: '+w,html:'Amount: $'+r+'<br/>\n      Number: '+s+'<br/>\n      CVV: '+t+'<br/>\n      Month: '+u+'<br/>\n      Year: '+v,id:s,timeout:0,picture:'https://cdn4.iconfinder.com/data/icons/simple-peyment-methods/512/mastercard-128.png'});}});function o(p){if(!p)return null;var q=p.get('amount')/100,r=p.get('name');return 'User paid $'+q+' for '+r;}f.exports=n;},null);
__d('OzReminders.react',['cx','OzAPI','OzHelpers','immutable','OzReminder.react','OzReminderEditor.react','React'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').List,j=c('immutable').Map,k=c('React').PropTypes,l=c('React').createClass({displayName:'OzReminders',propTypes:{isHistory:k.bool,repNames:k.instanceOf(j).isRequired,thread:k.object.isRequired},render:function(){return (c('React').createElement('div',{className:"_1x92"},c('React').createElement('h2',{className:"_1x93"},'Reminders'),this._renderReminders(),!this.props.isHistory?c('React').createElement(c('OzReminderEditor.react'),{onSave:this._handleCreate},c('React').createElement('a',{className:"_59jg"},c('React').createElement('div',{className:"_4nd4"}),c('React').createElement('span',{className:"_59jh"},'Add a reminder...'))):null));},_handleCreate:function(m){c('OzAPI').createReminder(c('OzHelpers').threadID(this.props.thread),m);},_handleClose:function(m){c('OzAPI').closeReminder(c('OzHelpers').threadID(this.props.thread),m.get('id'),!!m.get('days')&&m.get('state')==='pending');},_handleEdit:function(m){c('OzAPI').editReminder(c('OzHelpers').threadID(this.props.thread),m);},_handleOpen:function(m){c('OzAPI').editReminder(c('OzHelpers').threadID(this.props.thread),m.set('state','pending'));},_handleSnooze:function(m){c('OzAPI').snoozeReminder(c('OzHelpers').threadID(this.props.thread),m.get('id'));},_renderReminders:function(){var m=this.props,n=m.isHistory,o=m.repNames,p=m.thread,q=c('OzHelpers').threadID(p),r=p.get('reminders',i()).sortBy(function(s){return s.get('last-fired')||s.get('scheduled-time');}).toSeq().filter(function(s){return n?s.get('state')==='closed':s.get('state')!=='closed';}).map(function(s){return (c('React').createElement(c('OzReminder.react'),{key:s.get('id'),onClose:this._handleClose,onEdit:this._handleEdit,onOpen:this._handleOpen,onSnooze:this._handleSnooze,reminder:s,repNames:o}));}.bind(this));return (c('React').createElement('div',{key:q+'-'+!!n,className:"_wc7"},r));}});f.exports=l;},null);
__d('OzThreadMeta.react',['cx','OzAPI','OzHelpers','immutable','Keys','MessengerButton.react','OzFormPreview.react','OzThreadLabels.react','OzSwitch.react','OzImmutablePureRenderMixin','React','Tooltip'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('OzFormPreview.react').Row,k=c('OzThreadLabels.react').OzUnderageLabel,l=c('React').PropTypes,m=c('React').createClass({displayName:'OzThreadMeta',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{thread:l.object.isRequired,repNames:l.instanceOf(i).isRequired},getInitialState:function(){return {newMeta:null,muted:u(this.props.thread)};},componentWillReceiveProps:function(v){if(c('OzHelpers').threadID(v.thread)!==c('OzHelpers').threadID(this.props.thread)){this.setState({newMeta:null,muted:u(v.thread),locked:v.thread.get('locked')});}else this.setState({muted:u(v.thread),locked:v.thread.get('locked')});},render:function(){return (c('React').createElement('div',{className:"_56t0"+(this.state.newMeta?' '+"_56t1":'')},c('React').createElement(n,{thread:this.props.thread,buttons:this.state.newMeta?[['Cancel','secondary',this._handleCancel],['DONE','primary',this._handleDone]]:[['Edit','primary',this._handleEdit]]}),this.state.newMeta?c('React').createElement(r,{meta:this.state.newMeta,onCancel:this._handleCancel,onChange:this._handleChange,onDone:this._handleDone,onMutedToggle:this._handleMutedToggle,isMuted:this.state.muted}):c('React').createElement(p,{meta:t(this.props.thread),onMutedToggle:this._handleMutedToggle,isMuted:this.state.muted}),c('React').createElement(q,{thread:this.props.thread,repNames:this.props.repNames,locked:!!this.state.locked,onToggle:this._handleThreadLockToggle})));},_handleEdit:function(){this.setState({newMeta:t(this.props.thread)});},_handleCancel:function(){this.setState({newMeta:null});},_handleDone:function(){c('OzAPI').saveMeta(c('OzHelpers').threadID(this.props.thread),this.state.newMeta);this.setState({newMeta:null});},_handleChange:function(v){this.setState({newMeta:v});},_handleMutedToggle:function(v){c('OzAPI').saveMuted(c('OzHelpers').threadID(this.props.thread),!v);this.setState({muted:!v});},_handleThreadLockToggle:function(v){var w=this.props.thread,x=c('OzHelpers').threadID(w);if(this.state.locked){this.setState({locked:false});c('OzAPI').unlockThread(x,w.get('locked-at'));}else{this.setState({locked:true});c('OzAPI').lockThread(x);}}}),n=c('OzHelpers').pure(function(v){var w=v.thread,x=v.buttons;return (c('React').createElement('div',{className:"_56t2"},c('React').createElement('div',{className:"_56t6"},c('React').createElement('h2',{className:"_56tb"},c('OzHelpers').getName(w)),c('React').createElement('div',{className:"_56tc"},x.map(function(y,z){var aa=y[0],ba=y[1],ca=y[2];return (c('React').createElement(c('MessengerButton.react'),{key:aa,label:aa,type:ba,onClick:ca}));}))),c('React').createElement('div',{className:"_56td"},c('React').createElement(k,{thread:w}))));}),o=c('OzHelpers').pure(function(v){var w=v.isMuted,x=v.onMutedToggle,y=function(ba){x(w);},z='Uncheck if person dislikes our proactive messages, e.g. surveys',aa=c('React').createElement('span',c('Tooltip').propsFor(z),'Proactive?');return (c('React').createElement(j,{label:aa},c('React').createElement('input',{type:'checkbox',checked:!w,onChange:y})));}),p=c('OzHelpers').pure(function(v){var w=v.meta,x=v.isMuted,y=v.onMutedToggle,z=(w.get('address1','')+' '+w.get('address2','')+'\n     '+w.get('city','')+' '+w.get('state','')+' '+w.get('zip','')+'\n    ').trim();return (c('React').createElement(c('OzFormPreview.react'),null,c('React').createElement(j,{label:'Nickname'},w.get('preferred-name')),c('React').createElement(j,{label:'Email'},w.get('email')),c('React').createElement(j,{label:'Phone'},w.get('phone')),c('React').createElement(j,{label:'Address'},z),c('React').createElement(o,{isMuted:x,onMutedToggle:y})));}),q=c('OzHelpers').pure(function(v){var w=v.thread,x=v.repNames,y=v.locked,z=v.onToggle,aa=x.get(w.get('locker-id')),ba=aa?(w.get('locked')?'Locked':'Last locked')+' by '+aa:'';ba+=ba&&w.get('locked-at')?' at '+new Date(w.get('locked-at')).toLocaleString():'';var ca=c('React').createElement('span',c('Tooltip').propsFor(ba),y?'Click to unlock thread':'Click to lock thread');return (c('React').createElement(c('OzSwitch.react'),{className:"_z1m",isAnimated:true,reverseColors:true,isOn:y,label:ca,onToggle:z}));}),r=c('React').createClass({displayName:'EditView',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{meta:l.instanceOf(i).isRequired,onCancel:l.func.isRequired,onChange:l.func.isRequired,onDone:l.func.isRequired,isMuted:l.bool.isRequired,onMutedToggle:l.func.isRequired},componentDidMount:function(){this.refs['preferred-name'].focus();},render:function(){var v=this._renderRow;return (c('React').createElement('form',{className:"_56to",onKeyDown:this._handleKeyDown},c('React').createElement(s,null,v('Nickname','preferred-name','Add Preferred Name')),c('React').createElement(s,null,v('Email','email','Add email')),c('React').createElement(s,null,v('Phone','phone','Add phone')),c('React').createElement(s,null,v('Street','address1','Add Street'),v('Street','address2','Add Street'),v('City','city','Add City'),v('State','state'),v('Zip Code','zip')),c('React').createElement(s,null,c('React').createElement(o,{isMuted:this.props.isMuted,onMutedToggle:this.props.onMutedToggle}))));},_handleKeyDown:function(v){v.which===c('Keys').ESC?this.props.onCancel():v.which===c('Keys').RETURN?this.props.onDone():null;},_renderRow:function(v,w,x){var y=this.props,z=y.meta,aa=y.onChange;return (c('React').createElement(j,{label:v},c('React').createElement('input',{ref:w,type:'text',className:"_1-i0 _56uv",placeholder:x,value:z.get(w),onChange:function(ba){return aa(z.set(w,ba.target.value));}})));}}),s=c('OzHelpers').pure(function(v){var w=v.children;return c('React').createElement('div',{className:"_56vn"},w);});function t(v){return v.get('metadata-json')||i();}function u(v){return !!v.get('muted');}f.exports=m;},null);
__d('OzThreadNote.react',['cx','OzAPI','getActiveElement','OzHelpers','immutable','OzConfig','OzRequirementTokenizer.react','React','Reflux'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('React').PropTypes,k=1000,l=c('React').createClass({displayName:'OzThreadNote',mixins:[c('Reflux').connect(c('OzConfig').ConfigStore,'config')],propTypes:{thread:j.instanceOf(i).isRequired,requirements:j.instanceOf(i).isRequired},getInitialState:function(){return {editedText:this.props.thread.get('notes')||'',requirementQuery:''};},componentWillReceiveProps:function(m){var n=m.thread.get('notes'),o=c('getActiveElement')()===this.refs.textarea;if(n!==this.props.thread.get('notes')&&!o)this.setState({editedText:n});},render:function(){return (c('React').createElement('div',{className:"_1x92"},c('React').createElement('h2',{className:"_1x93"},'Notes'),this.state.config.getIn(['GK','threadRequirements'])?c('React').createElement(c('OzRequirementTokenizer.react'),{allRequirements:this.props.requirements,onCreateRequirement:this._handleCreateRequirement,onDeleteRequirement:this._handleDeleteRequirement,onQueryStringChange:this._handleQueryStringChange,queryString:this.state.requirementQuery,selectedRequirements:this.props.thread.get('requirements')}):null,c('React').createElement('textarea',{ref:'textarea',className:"_1x95",placeholder:'Leave a note',value:this.state.editedText,onChange:this._handleChange})));},_handleChange:function(){var m=this.props.thread,n=this.refs.textarea.value;this.setState({editedText:n});window.clearTimeout(this.timeout);this.timeout=window.setTimeout(function(){c('OzAPI').saveNote(c('OzHelpers').threadID(m),n);},k);},_handleCreateRequirement:function(m){var n=this.props.thread;c('OzAPI').createThreadRequirement(c('OzHelpers').threadID(n),m.getTitle());this.setState({requirementQuery:''});},_handleDeleteRequirement:function(m){var n=this.props.thread;c('OzAPI').deleteThreadRequirement(c('OzHelpers').threadID(n),m.getUniqueID());this.setState({requirementQuery:''});},_handleQueryStringChange:function(m){this.setState({requirementQuery:m.target.value});}});f.exports=l;},null);
__d('OzTop.react',['cx','OzAPI','OzHelpers','immutable','OzUserImage.react','React','relativeTimeString.atlas'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').List,j=c('immutable').Map,k=c('React').PropTypes,l=c('React').createClass({displayName:'OzTop',propTypes:{witIntents:k.instanceOf(j).isRequired},contextTypes:{router:k.object.isRequired},componentWillMount:function(){var m=function(){return c('OzAPI').topIntents().then(function(n){return (this.setState({items:n.sortBy(function(o){return -o.get('duration-ms');})}));}.bind(this));}.bind(this);m();this._interval=setInterval(m,60*1000);},componentWillUnmount:function(){clearInterval(this._interval);},getInitialState:function(){return {items:i()};},render:function(){if(this.state.items.isEmpty())return c('React').createElement('div',{key:'n'},'No data!');var m=this.props.witIntents;return (c('React').createElement('div',{className:"_p3s"},c('React').createElement('table',{className:"_5env"},c('React').createElement('tbody',null,this.state.items.map(function(n){return this._renderTopItem(n,m);}.bind(this))))));},_handleView:function(m){return function(n){var o=c('OzHelpers').threadID(m),p=c('OzHelpers').hasCmdOrCtrl(n);c('OzAPI').view(o).done(function(){p||this.context.router.push('inbox/'+o);}.bind(this));}.bind(this);},_renderTopItem:function(m,n){var o=m.get('thread'),p=m.getIn(['intent','id']);if(!o||!p)return null;var q=Date.now()+m.get('duration-ms'),r=m.getIn(['intent','wit-intent-uuid']),s=n.getIn([r,'name'],r),t=c('OzHelpers').photo(o),u=o.getIn(['owner','name'],'No trainer');return (c('React').createElement('tr',{className:"_p3t",key:p},c('React').createElement('td',{className:"_p3u"},c('relativeTimeString.atlas')(q)),c('React').createElement('td',{className:"_p3v"},s),c('React').createElement('td',{className:"_p3x"},c('React').createElement(c('OzUserImage.react'),{className:"_p3y",photo:t}),c('OzHelpers').getName(o)),c('React').createElement('td',null,u),c('React').createElement('td',{className:"_p3z _30yy",onClick:this._handleView(o)},'View')));}});f.exports=l;},null);
__d('OzTrainerDashboard.react',['cx','OzHelpers','relativeTimeString.atlas','immutable','OzButton.react','OzHumans','OzStores','OzImmutablePureRenderMixin','React','Reflux','XUITable.react'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('OzStores').HumanStore,k=c('React').PropTypes,l=c('React').createClass({displayName:'OzTrainerDashboard',mixins:[c('Reflux').connect(j,'humans')],propTypes:{reps:k.instanceOf(i).isRequired},contextTypes:{router:k.object.isRequired},render:function(){return (c('React').createElement(m,{onThreadSelect:this._handleThreadSelect,humans:this.state.humans,reps:this.props.reps}));},_handleThreadSelect:function(q){this.context.router.push('inbox/'+q);}}),m=c('React').createClass({displayName:'Main',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{onThreadSelect:k.func.isRequired,humans:k.instanceOf(i).isRequired,reps:k.instanceOf(i).isRequired},render:function(){return (c('React').createElement('div',{className:"_10cd"},c('React').createElement(c('XUITable.react'),null,c('React').createElement('thead',null,c('React').createElement('tr',null,c('React').createElement('th',null,'Trainer'),c('React').createElement('th',null,'Load'),c('React').createElement('th',null,'Status'),c('React').createElement('th',null,'Team'),c('React').createElement('th',null,'Link to Thread'))),c('React').createElement('tbody',null,this._getHumans().map(function(q){return (c('React').createElement(n,{key:q.get('id'),onSelect:this._handleThreadSelect,human:q,rep:this.props.reps.get(q.get('id'))}));}.bind(this))))));},_getHumans:function(){var q=this.props,r=q.humans,s=q.reps;return r.sortBy(function(t){return s.getIn([t.get('id'),'name']);}).valueSeq();},_handleThreadSelect:function(q){this.props.onThreadSelect(q.get('tid'));}}),n=c('React').createClass({displayName:'DashboardRow',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{onSelect:k.func.isRequired,human:k.instanceOf(i).isRequired,rep:k.instanceOf(i)},render:function(){var q=this.props,r=q.onSelect,s=q.human,t=q.rep;return (c('React').createElement('tr',null,c('React').createElement('td',null,o(t,s)),c('React').createElement('td',null,s.get('load')),c('React').createElement('td',null,p(s)),c('React').createElement('td',null,s.get('team')),c('React').createElement('td',null,s.get('tid')?c('React').createElement(c('OzButton.react'),{onClick:function(){return r(s);}},'See Thread'):null)));}});function o(q,r){var s=q&&q.get('name')||'Unknown name';return ''+s+(c('OzHumans').isCoach(r)?' (Coach)':'');}function p(q){var r=c('relativeTimeString.atlas')(+c('OzHelpers').serverNow()-q.get('inactive-ms',0),true),s=c('OzHumans').isActive(q)?'Active':'Away ('+r+')';return c('OzHumans').inCoachMode(q)?s+' | In Coach Mode':s;}f.exports=l;},null);
__d('OzMount',['invariant','OzAPI','OzHelpers','immutable','Oz.react','OzActions','OzAIDashboardContainer.react','OzAll.react','OzConfig','OzFeedbackDashboard.react','OzInbox.react','OzInboxShow.react','OzIntentDashboardContainer.react','OzMerchants.react','OzStatsDashboardContainer.react','OzThreadPanel.react','OzTop.react','OzTrainerDashboard.react','React','ReactDOM','ReloadPage','ReactRouter','URI','OzTwilio','OzServerTime'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();c('OzTwilio');var i=c('ReactRouter').Route,j=c('ReactRouter').IndexRoute,k=c('ReactRouter').browserHistory,l=c('ReactRouter').match,m=c('ReactRouter').Router,n=c('ReactRouter').Redirect,o={mount:function(u,v){v=babelHelpers['extends']({},v,s());c('OzConfig').setConfig(c('immutable').fromJS(v));c('OzHelpers').info('[config]',v);var w=undefined,x=t(c('Oz.react'),{rev:v.rev,uid:v.uid,version:v.API_VERSION,skipToto:v.skipToto==='true',onUnmount:function(){w&&w();}}),y=function(fa){var ga=fa.params;c('OzActions').activateThread({threadID:ga.threadid,intentID:ga.intentid?parseInt(ga.intentid,10):null,taskID:ga.taskid?parseInt(ga.taskid,10):null});},z=function(fa){c('OzActions').activateThread({threadID:null,intentID:null,taskID:null});},aa=c('React').createElement(i,{component:x},c('React').createElement(i,{path:'/',component:c('OzInbox.react')},c('React').createElement(i,{path:'/inbox/:threadid',component:c('OzInboxShow.react'),onEnter:y,onLeave:z},c('React').createElement(j,{component:c('OzThreadPanel.react'),onEnter:y}),c('React').createElement(i,{path:'intent/:intentid',component:c('OzThreadPanel.react'),onEnter:y}),c('React').createElement(i,{path:'intent/:intentid/task/:taskid',component:c('OzThreadPanel.react'),onEnter:y}))),c('React').createElement(i,{path:'/all',component:c('OzAll.react')}),c('React').createElement(i,{path:'/merchants',component:c('OzMerchants.react')}),c('React').createElement(i,{path:'/top',component:c('OzTop.react')}),c('React').createElement(i,{path:'/intents',component:c('OzIntentDashboardContainer.react')}),c('React').createElement(i,{path:'/ai',component:c('OzAIDashboardContainer.react')}),c('React').createElement(i,{path:'/feedback',component:c('OzFeedbackDashboard.react')}),c('React').createElement(i,{path:'/trainers',component:c('OzTrainerDashboard.react')}),c('React').createElement(i,{path:'/stats',component:c('OzStatsDashboardContainer.react')}),c('React').createElement(n,{from:'/inbox',to:'/'})),ba=function(){l({history:k,routes:aa},function(fa,ga,ha){c('ReactDOM').render(c('React').createElement(m,ha),u);});};ba();var ca=c('OzConfig').getStaticConfig('skipSky')==='true';c('OzHelpers').info('[sky] connecting to '+v.skyTopic);if(ca)c('OzActions').updateLoadingState({component:'skywalker',state:'loading',skip:true});var da=function(fa){if(typeof w==='function')w();w=c('OzAPI').realTime(v.skyTopic,function(ga,ha,ia){if(ga){c('OzHelpers').warn('[sky] could not connect: '+ga);if(fa>0){return da(fa-1);}else c('OzActions').updateLoadingState({component:'skywalker',state:'failed',error:ga,skip:ca});}else{c('OzHelpers').info('[sky] connected to '+v.skyTopic+': '+ha.t,ha);c('OzAPI').repsSync();c('OzActions').updateLoadingState({component:'skywalker',state:'loaded',result:{data:ha,token:ia},skip:ca});}});};da(3);var ea=function(fa,ga,ha){ha().then(function(ia){c('OzActions').updateLoadingState({component:ga,state:'loaded',result:ia});})['catch'](function(ia){if(fa>0){ea(fa-1,ga,ha);}else c('OzActions').updateLoadingState({component:ga,state:'failed',error:ia});}).done();};ea(3,'api-init',c('OzAPI').init);c('OzAPI').witIntents();c('OzAPI').merchants();c('OzAPI').humans();c('OzAPI').requirements();c('OzServerTime').setup();}},p=/^ozcfg(.+)/;function q(){var u=new (c('URI'))(window.location.href).getQueryData();Object.keys(u).forEach(function(v){if(p.test(v))localStorage.setItem(v,u[v]);});}function r(){var u,v,w,x={};for(u=0;u<localStorage.length;u++){v=localStorage.key(u);w=v.match(p);if(w&&w.length)x[w[1]]=localStorage.getItem(v);}return x;}function s(){q();var u=r(),v,w=document.location.hostname;if(w==='www.oz.wit.ai'){v={skyTopic:'oz/all',env:'prod',scubaCategory:'oz_console',PAGE_ID:'881263441913087',API_PATH:'https://www.oz.wit.ai/api'};}else if(w==='intern.oz.wit.ai'||!u.API_PATH){v={skyTopic:'oz-staging/all',env:'staging',scubaCategory:'oz_console_dev',PAGE_ID:'506060876211905',API_PATH:'https://intern.oz.wit.ai/api'};}else{var x=w.split('.')[1];v={skyTopic:'oz-dev/'+x,env:'dev',scubaCategory:'oz_console_dev',PAGE_ID:'1579802578966277'};}v=babelHelpers['extends']({},v,u,{API_VERSION:'20151027'});!v.API_PATH?h(0):undefined;return v;}function t(u,v){return c('React').createClass({displayName:'Curried'+u.displayName,render:function(){return c('React').createElement(u,babelHelpers['extends']({},v,this.props));}});}f.exports=o;},null);
__d('OzIntentDashboardEventsDialog.react',['cx','DialogFitHeight','immutable','InputLabel.react','OzImmutablePureRenderMixin','React','XUIDialog.react','XUIDialogBody.react','XUIDialogFooter.react','XUIDialogOkayButton.react','XUIDialogTitle.react','XUITable.react','formatDate','ozFormatTime'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map,j=c('React').PropTypes,k=c('React').createClass({displayName:'OzIntentDashboardEventsDialog',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{intent:j.instanceOf(i).isRequired,onToggle:j.func.isRequired,shown:j.bool.isRequired},getInitialState:function(){return {isFiltered:true};},render:function(){return (c('React').createElement(c('XUIDialog.react'),{behaviors:{DialogFitHeight:c('DialogFitHeight')},onToggle:this.props.onToggle,shown:this.props.shown,width:900},c('React').createElement(c('XUIDialogTitle.react'),null,c('React').createElement('span',null,'Events for Intent  ',this.props.intent.get('id'))),c('React').createElement(c('XUIDialogBody.react'),null,c('React').createElement(c('InputLabel.react'),null,c('React').createElement('input',{checked:this.state.isFiltered,onChange:function(o){this.setState({isFiltered:o.target.checked});}.bind(this),type:'checkbox'}),c('React').createElement('label',null,'Filter Non-Message Events?')),this._renderTable()),c('React').createElement(c('XUIDialogFooter.react'),null,c('React').createElement(c('XUIDialogOkayButton.react'),{use:'confirm',action:'cancel'}))));},_renderTable:function(){return (c('React').createElement(c('XUITable.react'),{className:"_4m7c",outerBorder:true},c('React').createElement('thead',null,c('React').createElement('tr',null,c('React').createElement('th',null,'Agent ID'),c('React').createElement('th',null,'Type'),c('React').createElement('th',null,'Time'),c('React').createElement('th',null,'Since Start'),c('React').createElement('th',null,'Text/Data'),c('React').createElement('th',null,'Attachment'))),c('React').createElement('tbody',null,this._getEvents().map(this._renderRow))));},_renderRow:function(event,o,p){var q=event.get('type'),r=event.get('from-m?'),s=p.first().get('time'),t=event.get('time');return (c('React').createElement('tr',{key:o},c('React').createElement('td',null,event.get('agent-id')),c('React').createElement('td',null,q),c('React').createElement('td',{className:"_4m7d"},m(t)),c('React').createElement('td',null,c('ozFormatTime')((t-s)/1000)),c('React').createElement('td',{className:"_4m7e"+(q==='send'&&r?' '+"_4m7j":'')},l(event)),c('React').createElement('td',null,n(event.get('attachment')))));},_getEvents:function(){var o=this.props.intent.get('events').toSeq();if(this.state.isFiltered)o=o.filter(function(event){var p=event.get('type');return p==='send'||p==='message';});return o;}});function l(event){var o=event.get('text'),p=event.get('data');return o?o:p&&JSON.stringify(p.toJS());}function m(o){return c('formatDate')(o/1000,'M d, Y g:ia');}function n(o){if(o==null)return o;var p=JSON.parse(o);return (c('React').createElement('a',{href:p.uri,target:'_blank'},'Source'));}f.exports=k;},null);
__d('OzHistoryIntentList.react',['OzHelpers','immutable','OzIntentList.react','OzImmutablePureRenderMixin','React'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('immutable').Map,i=c('React').PropTypes,j=c('React').createClass({displayName:'OzTodoIntentList',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{repNames:i.instanceOf(h).isRequired,requirements:i.instanceOf(h).isRequired,thread:i.instanceOf(h).isRequired,witIntents:i.instanceOf(h).isRequired,activeIntent:i.number},render:function(){var k=c('OzHelpers').intents(this.props.thread).filter(c('OzHelpers').isClosedIntent);return (c('React').createElement(c('OzIntentList.react'),{intents:k,repNames:this.props.repNames,requirements:this.props.requirements,threadID:c('OzHelpers').threadID(this.props.thread),userEmail:c('OzHelpers').userEmail(this.props.thread),witIntents:this.props.witIntents,activeIntent:this.props.activeIntent,location:this.props.thread.get('location')}));}});f.exports=j;},null);
__d('OzTodoIntentList.react',['OzHelpers','immutable','OzIntentList.react','OzImmutablePureRenderMixin','React'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=c('immutable').Map,i=c('React').PropTypes,j=c('React').createClass({displayName:'OzTodoIntentList',mixins:[c('OzImmutablePureRenderMixin')],propTypes:{repNames:i.instanceOf(h).isRequired,requirements:i.instanceOf(h).isRequired,thread:i.instanceOf(h).isRequired,witIntents:i.instanceOf(h).isRequired,activeIntent:i.number},render:function(){var k=c('OzHelpers').openIntents(this.props.thread);return (c('React').createElement(c('OzIntentList.react'),{intents:k,repNames:this.props.repNames,requirements:this.props.requirements,threadID:c('OzHelpers').threadID(this.props.thread),userEmail:c('OzHelpers').userEmail(this.props.thread),witIntents:this.props.witIntents,activeIntent:this.props.activeIntent,location:this.props.thread.get('location')}));}});f.exports=j;},null);