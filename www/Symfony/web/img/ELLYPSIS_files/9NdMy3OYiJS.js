/*!CK:3254885873!*//*1456774278,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["yHd42"]); }

__d("PagesMessagingHomePageletAction",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={CLICK_MESSAGE:"click_message",MARK_ARCHIVE:"mark_archive",MARK_READ:"mark_read",MARK_SPAM:"mark_spam",REPLY_MESSAGE:"reply_message",GO_TO_INBOX:"go_to_inbox",RENDER:"render"};},null);
__d('PagesMessagingLoadingRow.react',['cx','React','joinClasses'],function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('React').Component);j=i&&i.prototype;function k(l,m){'use strict';j.constructor.call(this,l,m);}k.prototype.render=function(){'use strict';var l="_5y2c"+(!this.props.useDarkVersion?' '+"_4a7c":'')+(this.props.useDarkVersion?' '+"_4a7d":'');l=c('joinClasses')(l,this.props.className);return (c('React').createElement('div',{className:l}));};f.exports=k;},null);
__d('PagesMessagingRelativeTimestamp.react',['React','LongLiveTimer'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=1000;h=babelHelpers.inherits(k,c('React').Component);i=h&&h.prototype;function k(l,m){i.constructor.call(this,l,m);this.state={relativeTime:this.$PagesMessagingRelativeTimestamp1(l.utcTimestamp,l.shouldShorternTime)};}k.prototype.componentWillReceiveProps=function(l){if(l.utcTimestamp!==this.props.utcTimestamp||l.shouldShorternTime!==this.props.shouldShorternTime)this.setState({relativeTime:this.$PagesMessagingRelativeTimestamp1(l.utcTimestamp,l.shouldShorternTime)});};k.prototype.render=function(){return (c('React').createElement('div',{className:this.props.className},c('React').createElement('abbr',{className:'livetimestamp','data-utime':this.props.utcTimestamp/j,'data-shorten':this.props.shouldShorternTime},this.state.relativeTime.text.toLowerCase())));};k.prototype.$PagesMessagingRelativeTimestamp1=function(l,m){return c('LongLiveTimer').renderRelativeTimeToServer(l/j,m);};f.exports=k;},null);
__d('PagesMessageSnippetFetcher',['invariant','immutable','MercuryFilters','MercuryOrderedThreadlist','MercuryPagesChannelHandler','MercuryParticipants','MercuryThreadInformer','MercuryThreads','MessagingTag','SubscriptionsHandler','XPagesManagerMessagesController'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('immutable').Map;j.getInboxURI=function(k,l){return c('XPagesManagerMessagesController').getURIBuilder().setString('page_token',k).setString('mercurythreadid',l).getURI();};function j(k,l,m){this.$PagesMessageSnippetFetcher3=k;this.$PagesMessageSnippetFetcher1=l;this.$PagesMessageSnippetFetcher2=m;c('MercuryPagesChannelHandler').getForFBID(k).turnOn();this.$PagesMessageSnippetFetcher5=c('MercuryOrderedThreadlist').getForFBID(k);this.$PagesMessageSnippetFetcher6=c('MercuryThreads').getForFBID(k);this.$PagesMessageSnippetFetcher8=c('MercuryThreadInformer').getForFBID(k);this.$PagesMessageSnippetFetcher7=new (c('SubscriptionsHandler'))();this.$PagesMessageSnippetFetcher9();this.$PagesMessageSnippetFetcher4=false;}j.prototype.$PagesMessageSnippetFetcher10=function(k){this.$PagesMessageSnippetFetcher7.addSubscriptions(this.$PagesMessageSnippetFetcher8.subscribe(k,function(l,m){return this.fetch();}.bind(this)));};j.prototype.$PagesMessageSnippetFetcher9=function(){this.$PagesMessageSnippetFetcher10('threadlist-updated');this.$PagesMessageSnippetFetcher10('threads-updated');this.$PagesMessageSnippetFetcher10('unread-updated');};j.prototype.fetch=function(){if(this.$PagesMessageSnippetFetcher4)return;this.$PagesMessageSnippetFetcher4=true;this.$PagesMessageSnippetFetcher5.getFilteredThreadlist(0,1,c('MessagingTag').INBOX,c('MercuryFilters').UNREAD,function(k){return this.$PagesMessageSnippetFetcher11(k);}.bind(this));};j.prototype.cleanup=function(){c('MercuryPagesChannelHandler').getForFBID(this.$PagesMessageSnippetFetcher3).turnOff();this.$PagesMessageSnippetFetcher7.release();};j.prototype.$PagesMessageSnippetFetcher11=function(k){if(!k||k.length===0){this.$PagesMessageSnippetFetcher2();this.$PagesMessageSnippetFetcher4=false;return;}var l=this.$PagesMessageSnippetFetcher6.getThreadMetaNow(k[0]);!l?h(0):undefined;var m='fbid:'+l.other_user_fbid;c('MercuryParticipants').get(m,function(n){this.$PagesMessageSnippetFetcher4=false;!l?h(0):undefined;this.$PagesMessageSnippetFetcher1({senderImageSrc:n.image_src,senderName:n.name,senderShortName:n.short_name,thread:l,participants:i(c('immutable').Seq(l.participants).map(function(o){return [o,c('MercuryParticipants').getOrFetch(o)];}))});}.bind(this));};f.exports=j;},null);
__d('PagesMessagingHomePageletLogger',['PagesHomepagePageletUsageTypedLogger'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i){this.$PagesMessagingHomePageletLogger1=i;}h.prototype.$PagesMessagingHomePageletLogger2=function(event,i){var j={is_embedded:this.$PagesMessagingHomePageletLogger1,event_name:event};if(i)j=Object.assign(j,i);var k=new (c('PagesHomepagePageletUsageTypedLogger'))();k.updateData(j).log();};h.prototype.logEvent=function(i){this.$PagesMessagingHomePageletLogger2(i,null);};h.prototype.logEventWithUserMessage=function(i,j){this.$PagesMessagingHomePageletLogger2(i,{user_message:j});};h.prototype.logReplyMessage=function(i,j,k){this.$PagesMessagingHomePageletLogger2(i,{user_message:j,admin_message:k});};f.exports=h;},null);
__d('PagesMessagingInboxOverviewActionMenu.react',['cx','fbt','ContextualDialogArrow','ContextualLayerAutoFlip','immutable','PagesMessengerActions','PopoverMenu.react','React','ReactXUIMenu','joinClasses'],function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('ReactXUIMenu').Item;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;function m(n,o){k.constructor.call(this,n,o);this.$PagesMessagingInboxOverviewActionMenu1=c('immutable').List([{key:c('PagesMessengerActions').MARK_AS_READ,label:i._("Marquer comme lu(s)"),href:'#'},{key:c('PagesMessengerActions').MARK_AS_SPAM,label:i._("Marquer comme ind\u00e9sirable"),href:'#'},{key:c('PagesMessengerActions').ARCHIVE,label:i._("Archiver"),href:'#'},{key:c('PagesMessengerActions').GO_TO_INBOX,label:i._("Acc\u00e9der \u00e0 la bo\u00eete aux lettres"),href:this.props.inboxUri}]);this.$PagesMessagingInboxOverviewActionMenu2=function(p,q){this.props.onActionTaken(q.item.getValue());}.bind(this);}m.prototype.render=function(){var n=c('joinClasses')(this.props.className,"_5p3k");return (c('React').createElement(c('PopoverMenu.react'),{alignh:'right',layerBehaviors:[c('ContextualDialogArrow'),c('ContextualLayerAutoFlip')],menu:this.$PagesMessagingInboxOverviewActionMenu3()},c('React').createElement('div',{className:n,'aria-label':i._("Afficher plus d\u2019options"),'data-hover':'tooltip','data-tooltip-content':i._("Afficher plus d\u2019options")})));};m.prototype.$PagesMessagingInboxOverviewActionMenu4=function(n){return (c('React').createElement(l,{className:"_539_",value:n.key,key:n.key,href:n.href,target:'_blank'},n.label));};m.prototype.$PagesMessagingInboxOverviewActionMenu3=function(){return (c('React').createElement(c('ReactXUIMenu'),{onItemClick:this.$PagesMessagingInboxOverviewActionMenu2},this.$PagesMessagingInboxOverviewActionMenu1.map(function(n){return this.$PagesMessagingInboxOverviewActionMenu4(n);}.bind(this))));};f.exports=m;},null);
__d('PagesMessageSender',['MercuryMessageActions','MercuryMessageObject','MercurySourceType'],function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();function h(i,j,k,l){this.__senderID=i;this.__threadID=j;this.__messageActions=c('MercuryMessageActions').getForFBID(i);this.__messageObject=c('MercuryMessageObject').getForFBID(i);this.__creatorInfo=l?l:null;this.__pageID=k;}h.prototype.__willSendMessage=function(i){};h.prototype.getTargetThreadID=function(){return this.__threadID;};h.prototype.sendMessage=function(i){this.__willSendMessage(i);var j=this.__messageObject.constructUserGeneratedMessageObject(i,c('MercurySourceType').TITAN_WEB,this.__threadID,null,this.__creatorInfo);this.__messageActions.send(j);};f.exports=h;},null);
__d('PagesMessagingInboxOverviewMessageProcessor',['MercuryPageThreadActions','PagesMessagingHomePageletAction','PagesMessagingHomePageletLogger','PagesMessageSender','PagesMessagingActionPlacement'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('PagesMessageSender'));i=h&&h.prototype;function j(k,l,m,n){i.constructor.call(this,l,n.thread.thread_id,l,k);this.$PagesMessagingInboxOverviewMessageProcessor1=m;this.$PagesMessagingInboxOverviewMessageProcessor2=n;this.$PagesMessagingInboxOverviewMessageProcessor3=c('MercuryPageThreadActions').getForFBID(l);this.$PagesMessagingInboxOverviewMessageProcessor4=new (c('PagesMessagingHomePageletLogger'))(m);}j.prototype.__willSendMessage=function(k){this.$PagesMessagingInboxOverviewMessageProcessor4.logReplyMessage(c('PagesMessagingHomePageletAction').REPLY_MESSAGE,this.$PagesMessagingInboxOverviewMessageProcessor2.thread.snippet,k);this.markAsRead();};j.prototype.$PagesMessagingInboxOverviewMessageProcessor5=function(k){this.$PagesMessagingInboxOverviewMessageProcessor4.logEventWithUserMessage(k,this.$PagesMessagingInboxOverviewMessageProcessor2.thread.snippet);};j.prototype.$PagesMessagingInboxOverviewMessageProcessor6=function(k){k.call(this.$PagesMessagingInboxOverviewMessageProcessor3,[this.__threadID],c('PagesMessagingActionPlacement').HOME_PAGE_PAGELET_INLINE_ACTION);};j.prototype.markAsSpam=function(){this.$PagesMessagingInboxOverviewMessageProcessor5(c('PagesMessagingHomePageletAction').MARK_SPAM);this.$PagesMessagingInboxOverviewMessageProcessor6(this.$PagesMessagingInboxOverviewMessageProcessor3.batchMarkSpam);};j.prototype.markAsRead=function(){this.$PagesMessagingInboxOverviewMessageProcessor5(c('PagesMessagingHomePageletAction').MARK_READ);this.$PagesMessagingInboxOverviewMessageProcessor6(this.$PagesMessagingInboxOverviewMessageProcessor3.batchMarkRead);};j.prototype.markAsArchive=function(){this.$PagesMessagingInboxOverviewMessageProcessor5(c('PagesMessagingHomePageletAction').MARK_ARCHIVE);this.$PagesMessagingInboxOverviewMessageProcessor6(this.$PagesMessagingInboxOverviewMessageProcessor3.batchArchive);};f.exports=j;},null);
__d('PagesMessagingMessageSnippet.react',['cx','fbt','Image.react','Layout.react','MercuryThreadSnippet.react','PagesMessagingLoadingRow.react','React','joinClasses'],function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('Layout.react').Column,m=c('Layout.react').FillColumn;j=babelHelpers.inherits(n,c('React').Component);k=j&&j.prototype;function n(o,p){'use strict';k.constructor.call(this,o,p);}n.prototype.render=function(){'use strict';var o=c('joinClasses')("_3sfn"+(!this.props.shouldShowFullView&&this.props.message?' '+"_3x9o":'')+(!this.props.shouldShowFullView?' '+"_3x9p":''),this.props.className),p=this.$PagesMessagingMessageSnippet1();if(this.props.shouldShowFullView)return (c('React').createElement('div',{className:o},p));return (c('React').createElement('div',{'data-hover':'tooltip','data-tooltip-content':i._("Cliquez pour lire et agir sur le message entier."),className:o,onClick:this.props.onBodyClicked},p));};n.prototype.$PagesMessagingMessageSnippet1=function(){'use strict';return (c('React').createElement(c('Layout.react'),null,c('React').createElement(l,null,this.$PagesMessagingMessageSnippet2()),c('React').createElement(m,null,this.$PagesMessagingMessageSnippet3())));};n.prototype.$PagesMessagingMessageSnippet2=function(){'use strict';if(!this.props.message)return (c('React').createElement(c('PagesMessagingLoadingRow.react'),{className:"_3sfo"}));return (c('React').createElement(c('Image.react'),{className:"_3sfo",src:this.props.message?this.props.message.senderImageSrc:''}));};n.prototype.$PagesMessagingMessageSnippet3=function(){'use strict';var o=this.props.message;if(!o)return (c('React').createElement('div',{className:"_3sfp"},c('React').createElement(c('PagesMessagingLoadingRow.react'),{className:"_3sfq"}),c('React').createElement(c('PagesMessagingLoadingRow.react'),{className:"_3sfr"})));var p=!this.props.shouldShowFullView;return (c('React').createElement('div',{className:"_3sfp"},c('React').createElement('div',{className:"_3sfs _3sg9"},o.senderName),c('React').createElement(c('MercuryThreadSnippet.react'),{className:"_3sga"+(p?' '+"_3sg9":''),participants:o.participants,shouldRenderYou:false,thread:o.thread,viewer:this.props.pageID})));};f.exports=n;},null);
__d('PagesMessagingInboxOverview.react',['cx','invariant','fbt','AbstractTextInput.react','Layout.react','LeftRight.react','PagesMessageSnippetFetcher','PagesMessagingHomePageletAction','PagesMessagingHomePageletLogger','PagesMessagingInboxOverviewActionMenu.react','PagesMessagingInboxOverviewMessageProcessor','PagesMessagingMessageSnippet.react','PagesMessagingRelativeTimestamp.react','PagesMessengerActions','React','emptyFunction'],function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l;if(c.__markCompiled)c.__markCompiled();var m=c('Layout.react').Column,n=c('Layout.react').FillColumn;k=babelHelpers.inherits(o,c('React').Component);l=k&&k.prototype;function o(p,q){l.constructor.call(this,p,q);this.$PagesMessagingInboxOverview1=this.$PagesMessagingInboxOverview8(p.pageInfo);this.$PagesMessagingInboxOverview3=new (c('PagesMessagingHomePageletLogger'))(this.props.isEmbedded);this.$PagesMessagingInboxOverview5=function(r){this.setState({replyMessage:r.target.value});}.bind(this);this.$PagesMessagingInboxOverview6=this.$PagesMessagingInboxOverview9.bind(this);this.$PagesMessagingInboxOverview4=this.$PagesMessagingInboxOverview4.bind(this);this.$PagesMessagingInboxOverview7=function(){this.setState({shouldShowFullView:true},function(){this.refs.input.focusInput();}.bind(this));this.$PagesMessagingInboxOverview3.logEventWithUserMessage(c('PagesMessagingHomePageletAction').CLICK_MESSAGE,this.state.lastUnreadMessage?this.state.lastUnreadMessage.thread.snippet:'');}.bind(this);this.state={lastUnreadMessage:null,replyMessage:'',noMoreMessage:false,shouldShowFullView:false};}o.prototype.componentDidMount=function(){this.$PagesMessagingInboxOverview1.fetch();this.$PagesMessagingInboxOverview3.logEvent(c('PagesMessagingHomePageletAction').RENDER);};o.prototype.componentWillUnmount=function(){this.$PagesMessagingInboxOverview1.cleanup();};o.prototype.componentWillReceiveProps=function(p){if(p.pageInfo!==this.props.pageInfo){this.setState({lastUnreadMessage:null});this.$PagesMessagingInboxOverview1=this.$PagesMessagingInboxOverview8(p.pageInfo);this.$PagesMessagingInboxOverview1.fetch();}};o.prototype.render=function(){if(this.state.noMoreMessage&&this.props.shouldHideIfNoMoreMessage)return null;var p=null;if(this.state.noMoreMessage){p=this.$PagesMessagingInboxOverview10();}else{var q=this.state.lastUnreadMessage;if(q){p=this.$PagesMessagingInboxOverview11(q);}else p=this.$PagesMessagingInboxOverview12();}return (c('React').createElement('div',{className:this.props.className},p));};o.prototype.$PagesMessagingInboxOverview13=function(){var p=this.state.lastUnreadMessage;!(this.$PagesMessagingInboxOverview2&&p&&this.$PagesMessagingInboxOverview2.getTargetThreadID()===p.thread.thread_id)?i(0):undefined;};o.prototype.$PagesMessagingInboxOverview8=function(p){return new (c('PagesMessageSnippetFetcher'))(p.id.toString(),function(q){return this.$PagesMessagingInboxOverview14(q);}.bind(this),function(){return this.$PagesMessagingInboxOverview15();}.bind(this));};o.prototype.$PagesMessagingInboxOverview14=function(p){this.setState({lastUnreadMessage:p,noMoreMessage:false},function(){this.$PagesMessagingInboxOverview2=new (c('PagesMessagingInboxOverviewMessageProcessor'))(this.props.pageInfo.creatorInfo,this.props.pageInfo.id,this.props.isEmbedded,p);}.bind(this));};o.prototype.$PagesMessagingInboxOverview15=function(){this.setState({noMoreMessage:true});};o.prototype.$PagesMessagingInboxOverview9=function(p){if(p.key==='Enter'&&this.state.replyMessage.length>0){this.$PagesMessagingInboxOverview13();this.$PagesMessagingInboxOverview2.sendMessage(this.state.replyMessage);this.setState({replyMessage:''});}};o.prototype.$PagesMessagingInboxOverview4=function(p){this.$PagesMessagingInboxOverview13();switch(p){case c('PagesMessengerActions').MARK_AS_READ:this.$PagesMessagingInboxOverview2.markAsRead();break;case c('PagesMessengerActions').MARK_AS_SPAM:this.$PagesMessagingInboxOverview2.markAsSpam();break;case c('PagesMessengerActions').ARCHIVE:this.$PagesMessagingInboxOverview2.markAsArchive();break;case c('PagesMessengerActions').GO_TO_INBOX:this.$PagesMessagingInboxOverview3.logEvent(c('PagesMessagingHomePageletAction').GO_TO_INBOX);break;}};o.prototype.$PagesMessagingInboxOverview10=function(){return (c('React').createElement('div',{className:"_4c40"},j._("Plus de messages non lus")));};o.prototype.$PagesMessagingInboxOverview12=function(){return (c('React').createElement(c('PagesMessagingMessageSnippet.react'),{className:"_3-8y _2iza _12f2",href:'#',message:this.state.lastUnreadMessage,onBodyClicked:c('emptyFunction'),shouldShowFullView:false,pageID:this.props.pageInfo.id}));};o.prototype.$PagesMessagingInboxOverview16=function(p){return c('PagesMessageSnippetFetcher').getInboxURI(this.props.pageInfo.uriToken,p.thread.thread_id);};o.prototype.$PagesMessagingInboxOverview11=function(p){return (c('React').createElement('div',{className:"_3-8y"},c('React').createElement(c('LeftRight.react'),null,c('React').createElement('div',{className:"_2iz9"},j._("Dernier message non lu")),c('React').createElement(c('PagesMessagingRelativeTimestamp.react'),{className:"_2iz6",utcTimestamp:p.thread.last_message_timestamp,shouldShorternTime:false})),c('React').createElement(c('PagesMessagingMessageSnippet.react'),{className:"_2iza",href:this.$PagesMessagingInboxOverview16(p),message:p,onBodyClicked:this.$PagesMessagingInboxOverview7,shouldShowFullView:this.state.shouldShowFullView,pageID:this.props.pageInfo.id}),this.$PagesMessagingInboxOverview17(p)));};o.prototype.$PagesMessagingInboxOverview17=function(p){var q=this.state.lastUnreadMessage;if(!q||!this.state.shouldShowFullView)return null;var r=j._("R\u00e9pondez \u00e0 {sender short name} ici...",[j.param('sender short name',q.senderShortName)]);return (c('React').createElement('div',{className:"_12f1 _3x9o"},c('React').createElement(c('Layout.react'),null,c('React').createElement(n,{className:"_2pii"},c('React').createElement(c('AbstractTextInput.react'),{placeholder:r,value:this.state.replyMessage,onChange:this.$PagesMessagingInboxOverview5,onKeyDown:this.$PagesMessagingInboxOverview6,ref:'input'})),c('React').createElement(m,null,c('React').createElement(c('PagesMessagingInboxOverviewActionMenu.react'),{className:"_12f0",message:p,onActionTaken:this.$PagesMessagingInboxOverview4,inboxUri:this.$PagesMessagingInboxOverview16(p)})))));};f.exports=o;},null);
__d('PagesMessagingInlineInboxView.react',['PagesMessagingInboxOverview.react','React'],function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();h=babelHelpers.inherits(j,c('React').Component);i=h&&h.prototype;function j(k,l){i.constructor.call(this,k,l);}j.prototype.render=function(){return (c('React').createElement(c('PagesMessagingInboxOverview.react'),{isEmbedded:true,pageInfo:this.props.pageInfo,shouldHideIfNoMoreMessage:true}));};f.exports=j;},null);