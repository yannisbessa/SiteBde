/*!CK:3344506136!*//*1457667374,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["himqc"]); }

__d('FBToggleSwitch.react',['cx','AbstractCheckboxInput.react','React','joinClasses'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('React').createClass({displayName:'FBToggleSwitch',propTypes:{animate:i.bool,indeterminate:i.bool,onToggle:i.func,disabled:i.bool,tooltip:i.string},render:function(){var k="_ypo"+(this.props.animate?' '+"_ypp":'')+(this.props.disabled?' '+"_ypq":''),l,m;if(this.props.indeterminate){m=this.props.checked;}else l=this.props.checked;return (c('React').createElement(c('AbstractCheckboxInput.react'),babelHelpers['extends']({},this.props,{checked:l,className:c('joinClasses')(this.props.className,k),defaultChecked:m,onChange:this._onChange}),undefined));},_onChange:function(k){if(this.props.onToggle&&!this.props.disabled)this.props.onToggle(k.target.checked);}});f.exports=j;},null);
__d("XGamesChatBanMessageSenderController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/games\/async\/chat\/ban-user\/",{app_id:{type:"Int",required:true},message_id:{type:"Int",required:true},channel:{type:"String",required:true}});},null);
__d("XGamesChatBlockMessageSenderController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/games\/async\/chat\/block-message-sender\/",{app_id:{type:"Int",required:true},channel:{type:"String",required:true},id:{type:"Int",required:true}});},null);
__d("XGamesChatFetchMessagesController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/games\/async\/chat\/fetch\/",{channel:{type:"String",required:true},exclude_viewer:{type:"Bool",defaultValue:false},cursor:{type:"Int",defaultValue:0}});},null);
__d("XGamesChatHideMessageController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/games\/async\/chat\/hide-message\/",{app_id:{type:"Int",required:true},channel:{type:"String",required:true},id:{type:"Int",required:true}});},null);
__d("XGamesChatPostMessageController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/games\/async\/chat\/post-message\/",{app_id:{type:"Int",required:true},channel:{type:"String",required:true},text:{type:"String",required:true}});},null);
__d("XGamesChatReportMessageSenderController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/games\/async\/chat\/report-message-sender\/",{app_id:{type:"Int",required:true},channel:{type:"String",required:true},id:{type:"Int",required:true}});},null);
__d("XGamesChatSetHideController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/games\/async\/chat\/set-hide-chat\/",{app_id:{type:"Int",required:true},hidden:{type:"Bool",defaultValue:false}});},null);
__d("XGamesChatUnbanMessageSenderController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/games\/async\/chat\/unban-user\/",{app_id:{type:"Int",required:true},message_id:{type:"Int",required:true},channel:{type:"String",required:true}});},null);
__d("XGamesChatUnblockMessageSenderController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/games\/async\/chat\/unblock-message-sender\/",{app_id:{type:"Int",required:true},channel:{type:"String",required:true},id:{type:"Int",required:true}});},null);
__d("XGamesChatUnhideMessageController",["XController"],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/games\/async\/chat\/unhide-message\/",{app_id:{type:"Int",required:true},channel:{type:"String",required:true},id:{type:"Int",required:true}});},null);
__d('GamerChat.react',['cx','fbt','AsyncRequest','FBToggleSwitch.react','Layout.react','Link.react','React','ReactComponentWithPureRenderMixin','ScrollableArea.react','Set','TextWithEntities.react','Tooltip.react','XGamesChatFetchMessagesController','XGamesChatPostMessageController','XGamesChatHideMessageController','XGamesChatUnhideMessageController','XGamesChatBlockMessageSenderController','XGamesChatUnblockMessageSenderController','XGamesChatReportMessageSenderController','XGamesChatSetHideController','XGamesChatBanMessageSenderController','XGamesChatUnbanMessageSenderController','XUITextInput.react','XUIButton.react','getURLRanges'],function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('Layout.react').Column,k=c('Layout.react').FillColumn,l=c('React').PropTypes,m=500,n=250,o=0,p=c('React').createClass({displayName:'GamerChat',_manuallyScrolled:false,mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{appID:l.string.isRequired,channel:l.string.isRequired,identifier:l.string.isRequired,gameName:l.string.isRequired,maxMessageLength:l.number.isRequired,hidden:l.bool,isAdmin:l.bool},getInitialState:function(){return {hidden:this._getHiddenSetting(),messages:[],hiddenIDs:[],blockedIDs:[],reportedIDs:[],bannedIDs:[],identifier:this.props.identifier};},_getHiddenSetting:function(){var r=this.props.hidden;if(r===null||r===undefined)return true;return r;},_toggleHiddenSetting:function(){var r=!this.state.hidden;this.setState({hidden:r});if(r){clearInterval(this.updateChatInterval);}else this._scheduleRecurringUpdates();var s=c('XGamesChatSetHideController').getURIBuilder().setInt('app_id',this.props.appID).setBool('hidden',r).getURI();new (c('AsyncRequest'))(s).setMethod('POST').send();},_appendNewMessages:function(r){var s=new (c('Set'))(this.state.messages.map(function(v){return v.id;}).filter(function(v){return !!v;})),t=r.filter(function(v){var w=v.id;return w?!s.has(w):true;});if(t.length===0)return;var u=this.state.messages.concat(t);this.setState({messages:u.slice(Math.max(u.length-m,0))});},_fetchNewMessages:function(r){new (c('AsyncRequest'))(r).setHandler(function(s){var t=s.payload.messages;this._next_cursor=s.payload.next_cursor;t.reverse();this._appendNewMessages(t);}.bind(this)).send();},_scheduleRecurringUpdates:function(){this.updateChatInterval=setInterval(function(){var r=c('XGamesChatFetchMessagesController').getURIBuilder().setString('channel',this.props.channel).setBool('exclude_viewer',true).setInt('cursor',this._next_cursor).getURI();this._fetchNewMessages(r);}.bind(this),1000);},componentDidMount:function(){var r=c('XGamesChatFetchMessagesController').getURIBuilder().setString('channel',this.props.channel).getURI();this._fetchNewMessages(r);if(!this.state.hidden)this._scheduleRecurringUpdates();},componentWillUnmount:function(){clearInterval(this.updateChatInterval);},_onSubmitMessage:function(){this._manuallyScrolled=false;var r=this.refs.messageInput.refs.textInput,s=r.getValue();this.setState({text:''});s=s.trim();if(!s)return;this._appendNewMessages([{name:this.state.identifier,text:s,id:'local_message_'+o++,isViewerSender:true}]);var t=c('XGamesChatPostMessageController').getURIBuilder().setInt('app_id',this.props.appID).setString('channel',this.props.channel).setString('text',s).getURI();new (c('AsyncRequest'))(t).setMethod('POST').send();},_onScroll:function(){this._manuallyScrolled=!this.refs.scrollArea.getArea().isScrolledToBottom();},_textChanged:function(r){this.setState({text:r.target.value});},_onBlockSender:function(r){this.setState({blockedIDs:this.state.blockedIDs.concat([r])});var s=c('XGamesChatBlockMessageSenderController').getURIBuilder().setInt('app_id',this.props.appID).setString('channel',this.props.channel).setInt('id',r).getURI();new (c('AsyncRequest'))(s).setMethod('POST').send();},_onReportSender:function(r){this.setState({reportedIDs:this.state.reportedIDs.concat([r])});var s=c('XGamesChatReportMessageSenderController').getURIBuilder().setInt('app_id',this.props.appID).setString('channel',this.props.channel).setInt('id',r).getURI();new (c('AsyncRequest'))(s).setMethod('POST').send();},_onBanSender:function(r){this.setState({bannedIDs:this.state.bannedIDs.concat([r])});var s=c('XGamesChatBanMessageSenderController').getURIBuilder().setInt('app_id',this.props.appID).setString('channel',this.props.channel).setInt('message_id',r).getURI();new (c('AsyncRequest'))(s).setMethod('POST').send();},_onUnbanSender:function(r){this.setState({bannedIDs:this.state.bannedIDs.filter(function(t){return t!==r;})});var s=c('XGamesChatUnbanMessageSenderController').getURIBuilder().setInt('app_id',this.props.appID).setString('channel',this.props.channel).setInt('message_id',r).getURI();new (c('AsyncRequest'))(s).setMethod('POST').send();},_onUnblockSender:function(r){this.setState({blockedIDs:this.state.blockedIDs.filter(function(t){return t!==r;})});var s=c('XGamesChatUnblockMessageSenderController').getURIBuilder().setInt('app_id',this.props.appID).setString('channel',this.props.channel).setInt('id',r).getURI();new (c('AsyncRequest'))(s).setMethod('POST').send();},_onHideMessage:function(r){this.setState({hiddenIDs:this.state.hiddenIDs.concat([r])});var s=c('XGamesChatHideMessageController').getURIBuilder().setInt('app_id',this.props.appID).setString('channel',this.props.channel).setInt('id',r).getURI();new (c('AsyncRequest'))(s).setMethod('POST').send();},_onUnhideMessage:function(r){this.setState({hiddenIDs:this.state.hiddenIDs.filter(function(t){return t!==r;})});var s=c('XGamesChatUnhideMessageController').getURIBuilder().setInt('app_id',this.props.appID).setString('channel',this.props.channel).setInt('id',r).getURI();new (c('AsyncRequest'))(s).setMethod('POST').send();},_getTextEntry:function(){return (c('React').createElement(c('Layout.react'),{className:"_56xm"},c('React').createElement(k,null,c('React').createElement(c('XUITextInput.react'),{className:"_56xn",ref:'messageInput',maxLength:this.props.maxMessageLength,height:'tall',placeholder:i._("\u00c9crivez un message..."),value:this.state.text,onChange:this._textChanged,onEnter:this._onSubmitMessage})),c('React').createElement(j,null,c('React').createElement(c('Tooltip.react'),{tooltip:i._("Vous discutez en tant que {chat handle}. Les messages sont visibles des personnes qui jouent \u00e0 {game name}.",[i.param('chat handle',this.state.identifier),i.param('game name',this.props.gameName)])},c('React').createElement(c('XUIButton.react'),{className:"_4q_8",label:i._("Envoyer"),use:'confirm',onClick:this._onSubmitMessage})))));},componentDidUpdate:function(){if(!this._manuallyScrolled&&!this.state.hidden)this.refs.scrollArea.getArea().scrollToBottom(false);},render:function(){var r=this.state.hidden?null:c('React').createElement('div',{className:"_4q_9"},c('React').createElement(c('ScrollableArea.react'),{height:n,onScroll:this._onScroll,ref:'scrollArea'},this.state.messages.map(function(s){return (c('React').createElement(q,{blockedIDs:this.state.blockedIDs,hiddenIDs:this.state.hiddenIDs,key:s.id,message:s,onBanSender:this._onBanSender,onBlockSender:this._onBlockSender,onHideMessage:this._onHideMessage,onReportSender:this._onReportSender,onUnblockSender:this._onUnblockSender,onUnhideMessage:this._onUnhideMessage,onUnbanSender:this._onUnbanSender,reportedIDs:this.state.reportedIDs,bannedIDs:this.state.bannedIDs,isAdmin:this.props.isAdmin}));}.bind(this))),this._getTextEntry());return (c('React').createElement('div',{className:!this.state.hidden?"_3-95":''},c('React').createElement(c('Layout.react'),{className:"uiHeader pbs clearfix uiHeaderTop _2zwc"},c('React').createElement(k,{className:"uiHeaderTitle _43md",onClick:this._toggleHiddenSetting},i._("Discussions en direct")),c('React').createElement(j,null,c('React').createElement(c('Tooltip.react'),{tooltip:this.state.hidden?i._("Voir la discussion"):i._("Masquer la discussion")},c('React').createElement(c('FBToggleSwitch.react'),{checked:!this.state.hidden,onToggle:this._toggleHiddenSetting})))),r));}}),q=c('React').createClass({displayName:'ChatMessage',mixins:[c('ReactComponentWithPureRenderMixin')],propTypes:{blockedIDs:l.array.isRequired,hiddenIDs:l.array.isRequired,message:l.object.isRequired,onBlockSender:l.func.isRequired,onHideMessage:l.func.isRequired,onReportSender:l.func.isRequired,onUnblockSender:l.func.isRequired,onUnhideMessage:l.func.isRequired,reportedIDs:l.array.isRequired,bannedIDs:l.array.isRequired,onBanSender:l.func.isRequired,onUnbanSender:l.func.isRequired,isAdmin:l.bool.isRequired},render:function(){var r=this.props.message,s=new (c('Set'))(this.props.blockedIDs),t=new (c('Set'))(this.props.hiddenIDs),u=new (c('Set'))(this.props.reportedIDs),v=new (c('Set'))(this.props.bannedIDs);if(v.has(r.id))return (c('React').createElement('div',{key:r.id,className:"_1mye _1myf"},i._("{name} a \u00e9t\u00e9 banni(e).",[i.param('name',r.name)]),' ',c('React').createElement(c('Link.react'),{onClick:function(){return this.props.onUnbanSender(r.id);}.bind(this)},i._("Annuler"))));if(s.has(r.id))return (c('React').createElement('div',{key:r.id,className:"_1mye _1myf"},i._("{name} a \u00e9t\u00e9 mis en sourdine.",[i.param('name',r.name)]),' ',c('React').createElement(c('Link.react'),{onClick:function(){return this.props.onUnblockSender(r.id);}.bind(this)},i._("Annuler"))));if(u.has(r.id))return (c('React').createElement('div',{key:r.id,className:"_1mye _1myf"},i._("{name} a \u00e9t\u00e9 signal\u00e9.",[i.param('name',r.name)]),' ',c('React').createElement(c('Link.react'),{onClick:function(){return this.props.onBlockSender(r.id);}.bind(this)},i._("Mettre {name} en sourdine",[i.param('name',r.name)]))));if(t.has(r.id))return (c('React').createElement('div',{key:r.id,className:"_1mye _1myf"},i._("Ce message a \u00e9t\u00e9 masqu\u00e9."),c('React').createElement('br',null),c('React').createElement(c('Link.react'),{onClick:function(){return this.props.onUnhideMessage(r.id);}.bind(this)},i._("Afficher")),' ','·',' ',c('React').createElement(c('Link.react'),{onClick:function(){return this.props.onBlockSender(r.id);}.bind(this)},i._("Sourdine")),' ','·',' ',c('React').createElement(c('Link.react'),{onClick:function(){return this.props.onReportSender(r.id);}.bind(this)},i._("Signaler")),this.props.isAdmin===true?c('React').createElement('span',null,' ','·',' ',c('React').createElement(c('Link.react'),{onClick:function(){return this.props.onBanSender(r.id);}.bind(this)},i._("Bannir"))):null));var w=null,x=c('React').createElement('span',{className:"_1p2t"},r.name,':');if(!r.isViewerSender){w=c('React').createElement(c('Tooltip.react'),{className:"_5l3i",position:'above',tooltip:i._("Masquer")},c('React').createElement('div',{className:"_1myg",onClick:function(){return this.props.onHideMessage(r.id);}.bind(this)}));x=c('React').createElement('span',{className:"_56xk"},r.name,':');}return (c('React').createElement('div',{className:"_1myf"},w,x,c('React').createElement('span',{className:"_56xl"},c('React').createElement(c('TextWithEntities.react'),{text:r.text,ranges:c('getURLRanges')(r.text),renderEmoticons:true,renderEmoji:true}))));}});f.exports=p;},null);